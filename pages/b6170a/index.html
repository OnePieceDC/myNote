<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>网络IO模型 | DC&#39;s blog</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="icon" href="/img/favicon.ico">
    <link rel="stylesheet" href="/fonts/iconfont.css">
    <meta name="description" content="人类终将毁灭,世界属于三体!">
    <meta name="keywords" content="DC的个人博客.">
    
    <link rel="preload" href="/assets/css/0.styles.66b92039.css" as="style"><link rel="preload" href="/assets/js/app.ac54adc6.js" as="script"><link rel="preload" href="/assets/js/4.7ddc74e3.js" as="script"><link rel="preload" href="/assets/js/1.a0c4ff1b.js" as="script"><link rel="preload" href="/assets/js/3.8b03321d.js" as="script"><link rel="preload" href="/assets/js/53.ecbb032d.js" as="script"><link rel="preload" href="/assets/js/104.cae2d944.js" as="script"><link rel="preload" href="/assets/js/184.46eabf07.js" as="script"><link rel="prefetch" href="/assets/js/10.a91ae011.js"><link rel="prefetch" href="/assets/js/100.2e8ea472.js"><link rel="prefetch" href="/assets/js/101.46f57a02.js"><link rel="prefetch" href="/assets/js/102.f51bcd80.js"><link rel="prefetch" href="/assets/js/103.3f003e0e.js"><link rel="prefetch" href="/assets/js/105.6c6ebc28.js"><link rel="prefetch" href="/assets/js/106.47dc8889.js"><link rel="prefetch" href="/assets/js/107.6b5602b4.js"><link rel="prefetch" href="/assets/js/108.46f0c21d.js"><link rel="prefetch" href="/assets/js/109.0f1168a5.js"><link rel="prefetch" href="/assets/js/11.e6a94228.js"><link rel="prefetch" href="/assets/js/110.6a961498.js"><link rel="prefetch" href="/assets/js/111.c6f27c88.js"><link rel="prefetch" href="/assets/js/112.9ee3d3bb.js"><link rel="prefetch" href="/assets/js/113.82b72aa0.js"><link rel="prefetch" href="/assets/js/114.7487460e.js"><link rel="prefetch" href="/assets/js/115.cd079d0a.js"><link rel="prefetch" href="/assets/js/116.b6b829eb.js"><link rel="prefetch" href="/assets/js/117.89d9336c.js"><link rel="prefetch" href="/assets/js/118.467c4437.js"><link rel="prefetch" href="/assets/js/119.c4b2ac40.js"><link rel="prefetch" href="/assets/js/12.9d3501e4.js"><link rel="prefetch" href="/assets/js/120.5ff31c09.js"><link rel="prefetch" href="/assets/js/121.2e59c3a5.js"><link rel="prefetch" href="/assets/js/122.a66096cf.js"><link rel="prefetch" href="/assets/js/123.4885ba5f.js"><link rel="prefetch" href="/assets/js/124.cacc66be.js"><link rel="prefetch" href="/assets/js/125.dc5b30fe.js"><link rel="prefetch" href="/assets/js/126.4e21eb5e.js"><link rel="prefetch" href="/assets/js/127.cb36a9bf.js"><link rel="prefetch" href="/assets/js/128.ce38358e.js"><link rel="prefetch" href="/assets/js/129.e5f414eb.js"><link rel="prefetch" href="/assets/js/13.ca017a68.js"><link rel="prefetch" href="/assets/js/130.17b597f0.js"><link rel="prefetch" href="/assets/js/131.e1ded2dc.js"><link rel="prefetch" href="/assets/js/132.aae1c627.js"><link rel="prefetch" href="/assets/js/133.73cecdb3.js"><link rel="prefetch" href="/assets/js/134.80cf38a0.js"><link rel="prefetch" href="/assets/js/135.735ed588.js"><link rel="prefetch" href="/assets/js/136.91f8db08.js"><link rel="prefetch" href="/assets/js/137.d6fb8bda.js"><link rel="prefetch" href="/assets/js/138.75cafe73.js"><link rel="prefetch" href="/assets/js/139.b01bf0db.js"><link rel="prefetch" href="/assets/js/14.ee2605b5.js"><link rel="prefetch" href="/assets/js/140.ff0a7911.js"><link rel="prefetch" href="/assets/js/141.c69e7f54.js"><link rel="prefetch" href="/assets/js/142.997b03ac.js"><link rel="prefetch" href="/assets/js/143.e40faea8.js"><link rel="prefetch" href="/assets/js/144.369f23e5.js"><link rel="prefetch" href="/assets/js/145.1268424d.js"><link rel="prefetch" href="/assets/js/146.94c65c4a.js"><link rel="prefetch" href="/assets/js/147.05fe6a36.js"><link rel="prefetch" href="/assets/js/148.327cc29d.js"><link rel="prefetch" href="/assets/js/149.90068676.js"><link rel="prefetch" href="/assets/js/15.42e0a0e4.js"><link rel="prefetch" href="/assets/js/150.b4b780bb.js"><link rel="prefetch" href="/assets/js/151.b4611012.js"><link rel="prefetch" href="/assets/js/152.4d2c8246.js"><link rel="prefetch" href="/assets/js/153.f32dfa58.js"><link rel="prefetch" href="/assets/js/154.b79a78fb.js"><link rel="prefetch" href="/assets/js/155.6ad2865c.js"><link rel="prefetch" href="/assets/js/156.fd49a1af.js"><link rel="prefetch" href="/assets/js/157.55113800.js"><link rel="prefetch" href="/assets/js/158.af321bc9.js"><link rel="prefetch" href="/assets/js/159.37d9c659.js"><link rel="prefetch" href="/assets/js/16.007f45b3.js"><link rel="prefetch" href="/assets/js/160.7a3b5a9a.js"><link rel="prefetch" href="/assets/js/161.fc1fbea8.js"><link rel="prefetch" href="/assets/js/162.2f8d3d1c.js"><link rel="prefetch" href="/assets/js/163.aa889940.js"><link rel="prefetch" href="/assets/js/164.5d8b2cb7.js"><link rel="prefetch" href="/assets/js/165.44d4a9b5.js"><link rel="prefetch" href="/assets/js/166.c1b4c4d4.js"><link rel="prefetch" href="/assets/js/167.0c39929e.js"><link rel="prefetch" href="/assets/js/168.fede035a.js"><link rel="prefetch" href="/assets/js/169.ff940d50.js"><link rel="prefetch" href="/assets/js/17.7395c644.js"><link rel="prefetch" href="/assets/js/170.b6fcb3bf.js"><link rel="prefetch" href="/assets/js/171.2b927a7c.js"><link rel="prefetch" href="/assets/js/172.b07a90a1.js"><link rel="prefetch" href="/assets/js/173.367352bf.js"><link rel="prefetch" href="/assets/js/174.4ea4e20f.js"><link rel="prefetch" href="/assets/js/175.d9679b61.js"><link rel="prefetch" href="/assets/js/176.f7804143.js"><link rel="prefetch" href="/assets/js/177.c5d1e680.js"><link rel="prefetch" href="/assets/js/178.808293fa.js"><link rel="prefetch" href="/assets/js/179.2acf6b3c.js"><link rel="prefetch" href="/assets/js/18.46f9153d.js"><link rel="prefetch" href="/assets/js/180.ddf3ecf7.js"><link rel="prefetch" href="/assets/js/181.4da0855c.js"><link rel="prefetch" href="/assets/js/182.591d135a.js"><link rel="prefetch" href="/assets/js/183.9d08f9fe.js"><link rel="prefetch" href="/assets/js/185.ee1c8428.js"><link rel="prefetch" href="/assets/js/186.c7b19133.js"><link rel="prefetch" href="/assets/js/187.52945990.js"><link rel="prefetch" href="/assets/js/188.a1d395c5.js"><link rel="prefetch" href="/assets/js/189.5b66165e.js"><link rel="prefetch" href="/assets/js/19.2db19edb.js"><link rel="prefetch" href="/assets/js/190.265a75de.js"><link rel="prefetch" href="/assets/js/191.b4c65143.js"><link rel="prefetch" href="/assets/js/192.cc4d4115.js"><link rel="prefetch" href="/assets/js/193.fa02ecc5.js"><link rel="prefetch" href="/assets/js/194.b0c9ad53.js"><link rel="prefetch" href="/assets/js/195.eda8cd34.js"><link rel="prefetch" href="/assets/js/196.cbae4dc6.js"><link rel="prefetch" href="/assets/js/197.693b1b85.js"><link rel="prefetch" href="/assets/js/198.8213665b.js"><link rel="prefetch" href="/assets/js/199.ddf0036d.js"><link rel="prefetch" href="/assets/js/2.4c15b693.js"><link rel="prefetch" href="/assets/js/20.6742e8ae.js"><link rel="prefetch" href="/assets/js/200.340df508.js"><link rel="prefetch" href="/assets/js/201.7431c15b.js"><link rel="prefetch" href="/assets/js/202.217b2b38.js"><link rel="prefetch" href="/assets/js/203.06c6a93d.js"><link rel="prefetch" href="/assets/js/204.a068a898.js"><link rel="prefetch" href="/assets/js/205.9361d3f5.js"><link rel="prefetch" href="/assets/js/206.886beca0.js"><link rel="prefetch" href="/assets/js/207.2278bda8.js"><link rel="prefetch" href="/assets/js/208.db0acc0d.js"><link rel="prefetch" href="/assets/js/209.0e05b204.js"><link rel="prefetch" href="/assets/js/21.fd552a4e.js"><link rel="prefetch" href="/assets/js/210.4c730041.js"><link rel="prefetch" href="/assets/js/211.417dbee1.js"><link rel="prefetch" href="/assets/js/212.eef4f4a3.js"><link rel="prefetch" href="/assets/js/213.ab742b0b.js"><link rel="prefetch" href="/assets/js/214.a57228de.js"><link rel="prefetch" href="/assets/js/215.37f52459.js"><link rel="prefetch" href="/assets/js/216.2f110f92.js"><link rel="prefetch" href="/assets/js/217.09654311.js"><link rel="prefetch" href="/assets/js/218.a7568950.js"><link rel="prefetch" href="/assets/js/219.628ee193.js"><link rel="prefetch" href="/assets/js/22.465a76d2.js"><link rel="prefetch" href="/assets/js/220.c5df9186.js"><link rel="prefetch" href="/assets/js/221.101ddb09.js"><link rel="prefetch" href="/assets/js/222.db210e3c.js"><link rel="prefetch" href="/assets/js/223.429cbf14.js"><link rel="prefetch" href="/assets/js/224.aa002868.js"><link rel="prefetch" href="/assets/js/225.79a40017.js"><link rel="prefetch" href="/assets/js/226.3e08228b.js"><link rel="prefetch" href="/assets/js/227.a09dd4b4.js"><link rel="prefetch" href="/assets/js/228.f930c492.js"><link rel="prefetch" href="/assets/js/229.f639a9e4.js"><link rel="prefetch" href="/assets/js/23.df6831af.js"><link rel="prefetch" href="/assets/js/230.e8ac7aad.js"><link rel="prefetch" href="/assets/js/231.99501214.js"><link rel="prefetch" href="/assets/js/232.e2932792.js"><link rel="prefetch" href="/assets/js/233.43dfa689.js"><link rel="prefetch" href="/assets/js/234.7951f9c4.js"><link rel="prefetch" href="/assets/js/235.1dc96b6c.js"><link rel="prefetch" href="/assets/js/236.40b8d4e4.js"><link rel="prefetch" href="/assets/js/237.75a692de.js"><link rel="prefetch" href="/assets/js/238.cc9d9ac1.js"><link rel="prefetch" href="/assets/js/239.4616a566.js"><link rel="prefetch" href="/assets/js/24.b68dc734.js"><link rel="prefetch" href="/assets/js/240.dd825147.js"><link rel="prefetch" href="/assets/js/241.85e3219b.js"><link rel="prefetch" href="/assets/js/242.bf4123c4.js"><link rel="prefetch" href="/assets/js/243.ce68f4f0.js"><link rel="prefetch" href="/assets/js/244.e2598d4d.js"><link rel="prefetch" href="/assets/js/245.2c696827.js"><link rel="prefetch" href="/assets/js/246.2c44a497.js"><link rel="prefetch" href="/assets/js/247.02405fce.js"><link rel="prefetch" href="/assets/js/248.6727bdf6.js"><link rel="prefetch" href="/assets/js/249.4901f575.js"><link rel="prefetch" href="/assets/js/25.d639c65c.js"><link rel="prefetch" href="/assets/js/250.c922c9ea.js"><link rel="prefetch" href="/assets/js/251.b1350ead.js"><link rel="prefetch" href="/assets/js/252.8295c5ea.js"><link rel="prefetch" href="/assets/js/253.b0a9ba20.js"><link rel="prefetch" href="/assets/js/254.d208b848.js"><link rel="prefetch" href="/assets/js/255.2cfb6ad3.js"><link rel="prefetch" href="/assets/js/256.e7687a81.js"><link rel="prefetch" href="/assets/js/257.db329d54.js"><link rel="prefetch" href="/assets/js/258.be75b1f9.js"><link rel="prefetch" href="/assets/js/259.67500f7e.js"><link rel="prefetch" href="/assets/js/26.9db429a9.js"><link rel="prefetch" href="/assets/js/260.73609cfa.js"><link rel="prefetch" href="/assets/js/261.22fc7c08.js"><link rel="prefetch" href="/assets/js/262.2c620ccd.js"><link rel="prefetch" href="/assets/js/263.e0ce1454.js"><link rel="prefetch" href="/assets/js/264.7fe82318.js"><link rel="prefetch" href="/assets/js/265.537d06c5.js"><link rel="prefetch" href="/assets/js/266.901695a7.js"><link rel="prefetch" href="/assets/js/267.8eb24590.js"><link rel="prefetch" href="/assets/js/268.a21e44dc.js"><link rel="prefetch" href="/assets/js/269.33e6ce5d.js"><link rel="prefetch" href="/assets/js/27.2296e284.js"><link rel="prefetch" href="/assets/js/270.31507ac3.js"><link rel="prefetch" href="/assets/js/271.b9406b42.js"><link rel="prefetch" href="/assets/js/272.0acaba6f.js"><link rel="prefetch" href="/assets/js/273.c2e359b0.js"><link rel="prefetch" href="/assets/js/274.a80428a6.js"><link rel="prefetch" href="/assets/js/28.7e4f4dc1.js"><link rel="prefetch" href="/assets/js/29.ba75f79a.js"><link rel="prefetch" href="/assets/js/30.16cd3622.js"><link rel="prefetch" href="/assets/js/31.54ed5bc1.js"><link rel="prefetch" href="/assets/js/32.b2fbba6a.js"><link rel="prefetch" href="/assets/js/33.f7ff0107.js"><link rel="prefetch" href="/assets/js/34.4b2cea7d.js"><link rel="prefetch" href="/assets/js/35.1159e74c.js"><link rel="prefetch" href="/assets/js/36.0b6296f3.js"><link rel="prefetch" href="/assets/js/37.fc67879e.js"><link rel="prefetch" href="/assets/js/38.637afaf8.js"><link rel="prefetch" href="/assets/js/39.748a78f3.js"><link rel="prefetch" href="/assets/js/40.4fede9bb.js"><link rel="prefetch" href="/assets/js/41.c7f0b087.js"><link rel="prefetch" href="/assets/js/42.5b1a487d.js"><link rel="prefetch" href="/assets/js/43.59275b93.js"><link rel="prefetch" href="/assets/js/44.b18a4c94.js"><link rel="prefetch" href="/assets/js/45.bc8f7cb3.js"><link rel="prefetch" href="/assets/js/46.6a4ec89f.js"><link rel="prefetch" href="/assets/js/47.e1e129e6.js"><link rel="prefetch" href="/assets/js/48.c284ce23.js"><link rel="prefetch" href="/assets/js/49.17e5dd65.js"><link rel="prefetch" href="/assets/js/5.e3d12916.js"><link rel="prefetch" href="/assets/js/50.34c3ac45.js"><link rel="prefetch" href="/assets/js/51.035f7031.js"><link rel="prefetch" href="/assets/js/52.e9ef227a.js"><link rel="prefetch" href="/assets/js/54.e9af4cfe.js"><link rel="prefetch" href="/assets/js/55.7e71402b.js"><link rel="prefetch" href="/assets/js/56.511071fe.js"><link rel="prefetch" href="/assets/js/57.13b7fe79.js"><link rel="prefetch" href="/assets/js/58.e51f8b0e.js"><link rel="prefetch" href="/assets/js/59.a1b8bdb7.js"><link rel="prefetch" href="/assets/js/6.5fc3f358.js"><link rel="prefetch" href="/assets/js/60.fd7e1c08.js"><link rel="prefetch" href="/assets/js/61.0daf2361.js"><link rel="prefetch" href="/assets/js/62.04632944.js"><link rel="prefetch" href="/assets/js/63.f0dd5615.js"><link rel="prefetch" href="/assets/js/64.89a4b562.js"><link rel="prefetch" href="/assets/js/65.6764ff0c.js"><link rel="prefetch" href="/assets/js/66.049bdee1.js"><link rel="prefetch" href="/assets/js/67.b0d4ec16.js"><link rel="prefetch" href="/assets/js/68.46d97067.js"><link rel="prefetch" href="/assets/js/69.f540f0da.js"><link rel="prefetch" href="/assets/js/7.ce17dd73.js"><link rel="prefetch" href="/assets/js/70.17d8f857.js"><link rel="prefetch" href="/assets/js/71.b2a166a0.js"><link rel="prefetch" href="/assets/js/72.1c17a875.js"><link rel="prefetch" href="/assets/js/73.dac8984b.js"><link rel="prefetch" href="/assets/js/74.5bbc33ac.js"><link rel="prefetch" href="/assets/js/75.483644c7.js"><link rel="prefetch" href="/assets/js/76.de5461ab.js"><link rel="prefetch" href="/assets/js/77.7fa90702.js"><link rel="prefetch" href="/assets/js/78.f41853b8.js"><link rel="prefetch" href="/assets/js/79.598b50e6.js"><link rel="prefetch" href="/assets/js/80.61d2d23a.js"><link rel="prefetch" href="/assets/js/81.d310c6e4.js"><link rel="prefetch" href="/assets/js/82.22aa814c.js"><link rel="prefetch" href="/assets/js/83.f493eba4.js"><link rel="prefetch" href="/assets/js/84.3a32a1eb.js"><link rel="prefetch" href="/assets/js/85.2f47134e.js"><link rel="prefetch" href="/assets/js/86.74e65a77.js"><link rel="prefetch" href="/assets/js/87.e87bff96.js"><link rel="prefetch" href="/assets/js/88.aabc97af.js"><link rel="prefetch" href="/assets/js/89.b0945d87.js"><link rel="prefetch" href="/assets/js/90.630f62d3.js"><link rel="prefetch" href="/assets/js/91.ed816647.js"><link rel="prefetch" href="/assets/js/92.19065457.js"><link rel="prefetch" href="/assets/js/93.a0fe1919.js"><link rel="prefetch" href="/assets/js/94.51e48580.js"><link rel="prefetch" href="/assets/js/95.e591bede.js"><link rel="prefetch" href="/assets/js/96.1723f1d6.js"><link rel="prefetch" href="/assets/js/97.02bbb7d4.js"><link rel="prefetch" href="/assets/js/98.a3625ba6.js"><link rel="prefetch" href="/assets/js/99.1accbf48.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.5959bfd2.js">
    <link rel="stylesheet" href="/assets/css/0.styles.66b92039.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu have-body-img"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/nav-logo.png" alt="DC's blog" class="logo"> <span class="site-name can-hide">DC's blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="IT必备" class="dropdown-title"><a href="/IT/" class="link-title">IT必备</a> <span class="title" style="display:none;">IT必备</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/IT/basis/" class="nav-link">计算机基础</a></li><li class="dropdown-item"><!----> <a href="/IT/linux/" class="nav-link">linux基础</a></li><li class="dropdown-item"><!----> <a href="/IT/mysql/" class="nav-link">mysql</a></li><li class="dropdown-item"><!----> <a href="/IT/git/" class="nav-link">git</a></li><li class="dropdown-item"><!----> <a href="/IT/structure/" class="nav-link">数据结构与算法</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Python" class="dropdown-title"><a href="/python/" class="link-title">Python</a> <span class="title" style="display:none;">Python</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/python/basis/" class="nav-link">opp</a></li><li class="dropdown-item"><!----> <a href="/python/oop/" class="nav-link">oop</a></li><li class="dropdown-item"><!----> <a href="/python/Network_concurrency/" class="nav-link">网络并发编程</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><a href="/front_end/" class="link-title">前端</a> <span class="title" style="display:none;">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/front_end/html/" class="nav-link">html</a></li><li class="dropdown-item"><!----> <a href="/front_end/css/" class="nav-link">css</a></li><li class="dropdown-item"><!----> <a href="/front_end/js/" class="nav-link">javascript</a></li><li class="dropdown-item"><!----> <a href="/front_end/jquery/" class="nav-link">jquery</a></li><li class="dropdown-item"><!----> <a href="/front_end/ui/" class="nav-link">UI</a></li><li class="dropdown-item"><!----> <a href="/front_end/vue/" class="nav-link">vue</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="后端" class="dropdown-title"><a href="/python_web/" class="link-title">后端</a> <span class="title" style="display:none;">后端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/python_web/django/" class="nav-link">Django</a></li><li class="dropdown-item"><!----> <a href="/python_web/drf/" class="nav-link">drf</a></li><li class="dropdown-item"><!----> <a href="/python_web/drf_re/" class="nav-link">drf_re</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="实战" class="dropdown-title"><a href="/project/" class="link-title">实战</a> <span class="title" style="display:none;">实战</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>前后端不分离</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/project/bbs/" class="nav-link">BBS</a></li><li class="dropdown-subitem"><a href="/project/order/" class="nav-link">订单系统</a></li><li class="dropdown-subitem"><a href="/project/crm/" class="nav-link">CRM</a></li></ul></li><li class="dropdown-item"><h4>前后端分离</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/project/supply/" class="nav-link">供应链系统</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其他" class="dropdown-title"><a href="/other/" class="link-title">其他</a> <span class="title" style="display:none;">其他</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/other/essays/" class="nav-link">杂文</a></li><li class="dropdown-item"><h4>关于我</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/about/" class="nav-link">me</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><!----> <span class="title" style="display:;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/OnePieceDC/" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="/img/avatar.gif"> <div class="blogger-info"><h3>DC</h3> <span>愿我一生欢喜,不为世俗所及.</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="IT必备" class="dropdown-title"><a href="/IT/" class="link-title">IT必备</a> <span class="title" style="display:none;">IT必备</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/IT/basis/" class="nav-link">计算机基础</a></li><li class="dropdown-item"><!----> <a href="/IT/linux/" class="nav-link">linux基础</a></li><li class="dropdown-item"><!----> <a href="/IT/mysql/" class="nav-link">mysql</a></li><li class="dropdown-item"><!----> <a href="/IT/git/" class="nav-link">git</a></li><li class="dropdown-item"><!----> <a href="/IT/structure/" class="nav-link">数据结构与算法</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Python" class="dropdown-title"><a href="/python/" class="link-title">Python</a> <span class="title" style="display:none;">Python</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/python/basis/" class="nav-link">opp</a></li><li class="dropdown-item"><!----> <a href="/python/oop/" class="nav-link">oop</a></li><li class="dropdown-item"><!----> <a href="/python/Network_concurrency/" class="nav-link">网络并发编程</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><a href="/front_end/" class="link-title">前端</a> <span class="title" style="display:none;">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/front_end/html/" class="nav-link">html</a></li><li class="dropdown-item"><!----> <a href="/front_end/css/" class="nav-link">css</a></li><li class="dropdown-item"><!----> <a href="/front_end/js/" class="nav-link">javascript</a></li><li class="dropdown-item"><!----> <a href="/front_end/jquery/" class="nav-link">jquery</a></li><li class="dropdown-item"><!----> <a href="/front_end/ui/" class="nav-link">UI</a></li><li class="dropdown-item"><!----> <a href="/front_end/vue/" class="nav-link">vue</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="后端" class="dropdown-title"><a href="/python_web/" class="link-title">后端</a> <span class="title" style="display:none;">后端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/python_web/django/" class="nav-link">Django</a></li><li class="dropdown-item"><!----> <a href="/python_web/drf/" class="nav-link">drf</a></li><li class="dropdown-item"><!----> <a href="/python_web/drf_re/" class="nav-link">drf_re</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="实战" class="dropdown-title"><a href="/project/" class="link-title">实战</a> <span class="title" style="display:none;">实战</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>前后端不分离</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/project/bbs/" class="nav-link">BBS</a></li><li class="dropdown-subitem"><a href="/project/order/" class="nav-link">订单系统</a></li><li class="dropdown-subitem"><a href="/project/crm/" class="nav-link">CRM</a></li></ul></li><li class="dropdown-item"><h4>前后端分离</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/project/supply/" class="nav-link">供应链系统</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其他" class="dropdown-title"><a href="/other/" class="link-title">其他</a> <span class="title" style="display:none;">其他</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/other/essays/" class="nav-link">杂文</a></li><li class="dropdown-item"><h4>关于我</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/about/" class="nav-link">me</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><!----> <span class="title" style="display:;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/OnePieceDC/" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>python面向过程</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>python面向对象</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>网络并发编程</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/f6096c/" class="sidebar-link">计算机网络储备</a></li><li><a href="/pages/8929d1/" class="sidebar-link">TCP简单实现</a></li><li><a href="/pages/1fd13a/" class="sidebar-link">TCP粘包问题</a></li><li><a href="/pages/0915cd/" class="sidebar-link">文件传输、UDP</a></li><li><a href="/pages/4190fd/" class="sidebar-link">socketserver模块</a></li><li><a href="/pages/853189/" class="sidebar-link">进程理论储备</a></li><li><a href="/pages/4965f0/" class="sidebar-link">进程开发必用</a></li><li><a href="/pages/6e01f6/" class="sidebar-link">进程开发必知</a></li><li><a href="/pages/d2875e/" class="sidebar-link">生产者消费者模型</a></li><li><a href="/pages/748b7d/" class="sidebar-link">线程开发</a></li><li><a href="/pages/29b933/" class="sidebar-link">GIL详解</a></li><li><a href="/pages/2a244a/" class="sidebar-link">进程池与线程池</a></li><li><a href="/pages/c7249b/" class="sidebar-link">协程</a></li><li><a href="/pages/b6170a/" aria-current="page" class="active sidebar-link">网络IO模型</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/pages/b6170a/#io模型介绍" class="sidebar-link">IO模型介绍</a></li><li class="sidebar-sub-header level2"><a href="/pages/b6170a/#阻塞io" class="sidebar-link">阻塞IO</a></li><li class="sidebar-sub-header level2"><a href="/pages/b6170a/#非阻塞io" class="sidebar-link">非阻塞IO</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/b6170a/#原理" class="sidebar-link">原理</a></li><li class="sidebar-sub-header level3"><a href="/pages/b6170a/#代码实现" class="sidebar-link">代码实现</a></li><li class="sidebar-sub-header level5"><a href="/pages/b6170a/#服务端" class="sidebar-link">服务端</a></li><li class="sidebar-sub-header level5"><a href="/pages/b6170a/#客户端" class="sidebar-link">客户端</a></li><li class="sidebar-sub-header level3"><a href="/pages/b6170a/#弊端" class="sidebar-link">弊端</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/b6170a/#多路复用io" class="sidebar-link">多路复用IO!!</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/b6170a/#原理-2" class="sidebar-link">原理</a></li><li class="sidebar-sub-header level3"><a href="/pages/b6170a/#代码实现-2" class="sidebar-link">代码实现</a></li><li class="sidebar-sub-header level5"><a href="/pages/b6170a/#初探select-select" class="sidebar-link">初探select.select()</a></li><li class="sidebar-sub-header level5"><a href="/pages/b6170a/#实现不停的建链接" class="sidebar-link">实现不停的建链接</a></li><li class="sidebar-sub-header level5"><a href="/pages/b6170a/#收发消息的思考" class="sidebar-link">收发消息的思考</a></li><li class="sidebar-sub-header level5"><a href="/pages/b6170a/#完整版" class="sidebar-link">完整版</a></li><li class="sidebar-sub-header level3"><a href="/pages/b6170a/#epoll接口" class="sidebar-link">epoll接口</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/b6170a/#异步io" class="sidebar-link">异步IO</a></li></ul></li><li><a href="/pages/45898a/" class="sidebar-link">轮询长轮询</a></li><li><a href="/pages/0fe06e/" class="sidebar-link">channels</a></li><li><a href="/pages/dde9a8/" class="sidebar-link">小项目之手撸ORM</a></li><li><a href="/pages/cfbd3c/" class="sidebar-link">小项目之仿优酷</a></li><li><a href="/pages/d880de/" class="sidebar-link">脚本编写</a></li></ul></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-91157402><div class="articleInfo" data-v-91157402><ul class="breadcrumbs" data-v-91157402><li data-v-91157402><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-91157402></a></li> <li data-v-91157402><a href="/categories/?category=python_Need" title="分类" data-v-91157402>python_Need</a></li><li data-v-91157402><a href="/categories/?category=%E7%BD%91%E7%BB%9C%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B" title="分类" data-v-91157402>网络并发编程</a></li></ul> <div class="info" data-v-91157402><div title="作者" class="author iconfont icon-touxiang" data-v-91157402><a href="https://github.com/OnePieceDC" target="_blank" title="作者" class="beLink" data-v-91157402>DC</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-91157402><a href="javascript:;" data-v-91157402>2023-03-07</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABGpJREFUSA3tVVtoXFUU3fvOI53UlmCaKIFmwEhsE7QK0ipFEdHEKpXaZGrp15SINsXUWvBDpBgQRKi0+KKoFeJHfZA+ED9KKoIU2gYD9UejTW4rVIzm0VSTziPzuNu1z507dibTTjL4U/DAzLn3nL3X2o91ziX6f9wMFdh6Jvbm9nNSV0msViVO6tN1Rm7NMu2OpeJ9lWBUTDxrJbYTS0hInuwciu9eLHlFxCLCZEk3MegsJmZ5K/JD6t7FkFdEvGUo1g7qJoG3MHImqRIn8/nzY1K9UPKKiJmtnUqHVE3Gbuay6vJE/N2FEmuxFjW2nUuE0yQXRRxLiTUAzs36zhZvOXJPdX850EVnnLZkB8prodQoM5JGj7Xk2mvC7JB8tG04Ef5PiXtG0UtxupRQSfTnBoCy554x18yJHI6I+G5Eru4LHmPJZEQsrvPUbMiA8G/WgMK7w7I+ez7++o2ANfbrjvaOl1tFMs+htG3IrZH9/hDX1Pr8Tc0UvH8tcX29KzAgIGcEkINyW5BF9x891hw6VYqgJHEk0huccS7vh3C6gTiODL+26huuBtbct8eZnqLML8PkxGYpuPZBqtqwkSjgc4mB5gbgig5i+y0UDK35LMxXisn9xQtK+nd26gTIHsHe/oblK/b29fUmN/8Y+9jAQrnBp56m1LcDlDp9irKTExSKduXJVWSqdBMA08pEJnEIOB3FPPMybu/oeV8zFeYN3xx576Q6RH+VmplE4ncQV5v+5rzSoyOU7PuEAg8g803PwBJ0CExno/jcMbN8tONYeOmHiuUNryvm3fRUy4tMPVLdAGkUhNWuggGrJcXPv+ouCjz0MKUHz1J2/E8IC9nqTabcxgaBYM0hPhD5Y65FsbxRQKxCQrDjDctW7PUM3HuZunFyifSAqEfuzCp48Il24luWUWZoyJCaPR82jE0+kFA643wRFVni4RYSq3ohJO2pZ7B5dO4xkDWbEpossJPLSrPjYID8rS2UHTlvyNxqIGsg674XJJ7vnh5L7PNwC4hh2sjCI96mzszOTpxLF0T7l88Yz7lAuK6OnL8gXLOnTvpzSb22YG8W7us3jSebFHeeqnXRG1vt+MoUM84LQIBmMsCTAcOauTh0T0l0neQK7m2bLMt2mGxU3HYssS0J2cdv5wljlPsrIuZLAG/2DOZIXgCYT8uMGZN+e2kSirfxZOPCsC0f24nTZzspnVn9VePS1Z5vubmAGGXG8ZFno9Hel0yfA5ZPhF7Dh972BQJ2qCpgH67lmWtBYbvk6sz02wjky2vXyz0XErP/kFB619js1BtwfOV4OPRqOQBjy3Qbk18vigUPPSD5ceHnwck7W9bhAqZdd7SuG7w4/P2F/GaJh8c7e9qgow+Q7cGBo+98WsLkuktFqiZabtXuQTu/Y5ETbR0v7tNSFnvrmu6pjdoan2KjMu8q/Hmj1EfCO2ZGfEIbIXKUlw8qaX9/b2oeSJmFksSeT/Fn0V3nSypChh4Gjh74ybO9aeZ/AN2dwciu2/MhAAAAAElFTkSuQmCC">网络IO模型<!----></h1> <!----> <div class="theme-vdoing-content content__default"><p>本节阐述的IO模型不是单线程下的所有IO. <font color="brown">针对的是linux单线程下的network IO!!!</font> <font color="gray">网络IO远比本地IO慢的多!</font></p> <p><font color="green"><em>本章节IO模型的代码可以不写,因为在开发中不会去写这些东西,但我们要知道它的底层是如何实现的!!!</em></font></p> <h2 id="io模型介绍"><a href="#io模型介绍" class="header-anchor">#</a> IO模型介绍</h2> <p><font color="brown">IO Model一共可以分为5种: </font><br>
1&gt; blocking IO    <font color="gray">阻塞IO</font><br>
2&gt; nonblocking IO    <font color="gray">非阻塞IO </font><br>
3&gt; IO multiplexing    <font color="gray">IO多路复用 </font><br>
4&gt; signal driven IO     <font color="gray">信号驱动IO (不常用,本节不会进行相关阐述) </font><br>
5&gt; asynchronous IO    <font color="gray">异步IO</font></p> <p><font color="purple">网络编程(TCP、UDP)中涉及到的IO操作:</font></p> <table><thead><tr><th>I/O</th> <th>服务端</th> <th>客户端</th></tr></thead> <tbody><tr><td>收/输入/input<br><font color="gray">上:TCP 下:UDP</font></td> <td>accept、recv<br>recvfrom</td> <td>recv<br>recvfrom</td></tr> <tr><td>发/输出/output<br><font color="gray">上:TCP 下:UDP</font></td> <td>send<br>sendto</td> <td>connect、send<br>sendto</td></tr></tbody></table> <p><font color="gray">其它输入操作: read、readv、recvmsg; 其它输出操作: write、writev、sendmsg</font></p> <p><font color="purple">当I/O发生时,会分为两个阶段:</font><br>
1&gt; wait data -- 等待数据准备 <font color="gray">(Waiting for the data to be ready) </font><br>
2&gt; copy data -- 将数据从内核拷贝到进程中 <font color="gray">(Copying the data from the kernel to the process) </font><br> <font color="red">其中,收消息的IO操作会经历上面两个阶段,发消息只会经历第二个copy data的阶段! </font><br> <font color="green">wait data结束,意味着OS缓存中拥有了该数据!</font></p> <p><font color="blue">以服务端的recv操作和send操作为例: </font><br> <strong>△ recv:</strong><br> <font color="green">wait data:</font> C端应用程序产生msg数据 -- 将C端应用程序内存中的mag数据拷贝给C端OS -- C端OS将数据沿着网络传输给S端的OS -- S端OS收到后回复一个确认信息 -- C端OS将缓存中的msg数据清除<br> <font color="green">copy data:</font> 将S端OS缓存中的msg数据拷贝一份到S端应用程序内存中 -- 拷贝后,S端OS缓存中的msg数据自动销毁<br> <strong>△ send:</strong><br> <font color="green">copy data:</font> 将S端应用程序内存中的数据拷贝到S端OS缓存中<br> <font color="blue">Q: 为什么用户能明显体会到收消息的等待,而发消息则不会？</font><br>
A: <font color="brown">wait data阶段会经历网络延迟,耗时长 ; copy data阶段是本地拷贝,速度很快,耗时短. </font></p> <p>网络IO模型将围绕着这两个阶段展开阐述!</p> <hr> <h2 id="阻塞io"><a href="#阻塞io" class="header-anchor">#</a> 阻塞IO</h2> <blockquote><p>blocking IO  -- 不能实现并发</p></blockquote> <p><img src="/assets/img/block_io.a8708fd0.png" alt=""></p> <p><font color="brown">图6.1 阻塞I/O模型. 进程在调用recvfrom时阻塞.图中是以UDP的recvfrom操作为例的.</font><br>
1&gt; 应用程序调用收消息的recvfrom接口,该接口会发送一个系统调用给操作系统..问操作系统有没有数据给我.<br>
2&gt; 操作系统没有数据给应用程序,应用程序开始阻塞,进入wait data阶段,OS调用网卡接收消息<br>
3&gt; 直到wait data结束,数据来到了OS缓存中<br>
4&gt; 接着进入copy data阶段.将数据从OS缓存拷贝到应用程序内存中<br>
5&gt; 拷贝完成后,recvfrom操作结束</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token punctuation">[</span>网络编程学习历程<span class="token punctuation">]</span>
<span class="token number">1</span><span class="token operator">&gt;</span> 两个循环
我们刚接触网络编程时<span class="token punctuation">,</span>写的程序就是阻塞IO的<span class="token punctuation">.</span>遇到IO就在原地等<span class="token punctuation">,</span>不能实现并发<span class="token punctuation">,</span>效率非常低<span class="token punctuation">.</span>
具体回顾下<span class="token punctuation">:</span>写了两个循环<span class="token punctuation">,</span>外层链接循环<span class="token punctuation">,</span>里层通信循环<span class="token punctuation">;</span>accept阻塞结束后才能执行下一行代码<span class="token punctuation">.</span>recv同理<span class="token punctuation">.</span>
弊端 <span class="token operator">-</span><span class="token operator">-</span> 建完链接后不能干通信<span class="token punctuation">,</span>通信完后才能重新建立下一个链接<span class="token punctuation">.</span>
       所以的活都由一个线程干!遇阻塞全歇菜<span class="token punctuation">.</span>
       如在调用recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>时<span class="token punctuation">,</span>线程将被阻塞<span class="token punctuation">,</span>在此期间<span class="token punctuation">,</span>线程将无法执行任何运算或响应任何的网络请求<span class="token punctuation">.</span>

<span class="token number">2</span><span class="token operator">&gt;</span> 并发解决方案<span class="token punctuation">:</span>多进程、多线程
此处是IO密集型的<span class="token punctuation">,</span>使用多线程<span class="token punctuation">.</span>让主线程不断的建立链接<span class="token punctuation">,</span>每建立一个链接就启用一个子线程负责该链接的通信<span class="token punctuation">.</span>
注意 <span class="token operator">-</span><span class="token operator">-</span> 此解决方案并没有将IO问题解决!
分析 <span class="token operator">-</span><span class="token operator">-</span> 该思路的I<span class="token operator">/</span>O问题遇到阻塞还是会经历wait data和copy data的阶段<span class="token punctuation">.</span>该阻的一个都不会落下<span class="token punctuation">.</span>
       但某个子线程阻塞了并不影响其它子线程的执行<span class="token punctuation">.</span>
       即多线程<span class="token operator">/</span>多进程的目的是让每个连接都拥有独立的线程<span class="token operator">/</span>进程<span class="token punctuation">,</span>使得任何一个连接的阻塞都不会影响其他的连接<span class="token punctuation">.</span>
弊端 <span class="token operator">-</span><span class="token operator">-</span> 若并发的客户端个数过多<span class="token punctuation">,</span>会导致服务端启动的线程数过多<span class="token punctuation">.</span>机器受不了<span class="token punctuation">.</span>
       具体来说<span class="token punctuation">,</span>开启多进程<span class="token operator">/</span>多线程<span class="token punctuation">,</span>在遇到成百上千的连接请求时<span class="token punctuation">.</span>无论多线程还是多进程都会严重占据系统资源
       降低系统对外界响应效率<span class="token punctuation">,</span>而且线程与进程本身也更容易进入假死状态<span class="token punctuation">(</span>OS忙于切换啦<span class="token punctuation">,</span>不会真正的干活<span class="token punctuation">)</span>

<span class="token number">3</span><span class="token operator">&gt;</span> 池<span class="token punctuation">:</span>对链接数加以限制<span class="token punctuation">,</span>控制在机器可承受的范围内<span class="token punctuation">.</span>
说到池<span class="token punctuation">,</span>我们往往会想到<span class="token string">&quot;线程池&quot;</span>或<span class="token string">&quot;连接池&quot;</span><span class="token punctuation">.</span>
   “线程池”旨在减少创建和销毁线程的频率<span class="token punctuation">,</span>其维持一定合理数量的线程<span class="token punctuation">,</span>并让空闲的线程重新承担新的执行任务<span class="token punctuation">.</span>
   “连接池”维持连接的缓存池<span class="token punctuation">,</span>尽量重用已有的连接、减少创建和关闭连接的频率<span class="token punctuation">.</span>
   这两种技术都可以很好的降低系统开销<span class="token punctuation">,</span>都被广泛应用很多大型系统<span class="token punctuation">,</span>如websphere、tomcat和各种数据库等<span class="token punctuation">.</span>
Ps<span class="token punctuation">:</span>回顾一下这句话<span class="token punctuation">,</span>半连接池backlog限制的是<span class="token operator">&lt;</span>同一时刻<span class="token operator">&gt;</span>的请求数!
线程池vs连接池详解参考链接<span class="token punctuation">:</span>`https<span class="token punctuation">:</span><span class="token operator">//</span>www<span class="token punctuation">.</span>jianshu<span class="token punctuation">.</span>com<span class="token operator">/</span>p<span class="token operator">/</span>a25bc5ff7942`
注意 <span class="token operator">-</span><span class="token operator">-</span> 运用池<span class="token punctuation">,</span>这不是提升效率的方案<span class="token punctuation">,</span>只是让机器面对高并发时不宕机的则中方案<span class="token punctuation">.</span>
问题 <span class="token operator">-</span><span class="token operator">-</span> “线程池”和“连接池”技术也只是在一定程度上缓解了频繁调用IO接口带来的资源占用<span class="token punctuation">.</span>
        假设机器只能扛住<span class="token number">100</span>的并发<span class="token punctuation">,</span>若来<span class="token number">10</span>个任务<span class="token punctuation">,</span>没必要用池<span class="token punctuation">.</span>
        若来<span class="token number">200</span>个任务<span class="token punctuation">,</span>用线程池限制连接数<span class="token punctuation">,</span>这效率必然会比直接开<span class="token number">200</span>个线程低<span class="token punctuation">.</span>
        但因为切换的速度够快<span class="token punctuation">.</span>用户不会有明显的等待<span class="token punctuation">.</span>
        但是当请求大大超过上限时<span class="token punctuation">,</span>比如<span class="token number">1</span>千万<span class="token punctuation">,</span>“池”构成的系统对外界的响应并不比没有池的时候效果好多少<span class="token punctuation">.</span>
        所以使用“池”必须考虑其面临的响应规模<span class="token punctuation">,</span>并根据响应规模调整“池”的大小<span class="token punctuation">.</span>
        
到这里<span class="token punctuation">,</span>不管是多进程<span class="token operator">/</span>多线程还是池<span class="token punctuation">,</span>都对单个线程下的IO行为置之不理<span class="token punctuation">.</span>那如何是好?

<span class="token number">4</span><span class="token operator">&gt;</span> 协程
将单个线程下的IO降到最低<span class="token punctuation">,</span>监测单线程下的IO<span class="token punctuation">,</span>遇到IO就切<span class="token punctuation">,</span>效率也就提升上去了<span class="token punctuation">.</span>单个线程能抗的并发数就多起来了<span class="token punctuation">.</span>
多线程<span class="token operator">+</span>协程 <span class="token operator">-</span><span class="token operator">-</span> <span class="token number">1000</span>个线程<span class="token punctuation">,</span>每个线程能扛住<span class="token number">1000</span>个任务<span class="token punctuation">,</span>一百万的并发就搞定了<span class="token punctuation">.</span>

不借助已有的gevent模块<span class="token punctuation">,</span>使用某种IO模型自己实现协程<span class="token punctuation">(</span>单线程下实现并发<span class="token punctuation">)</span>!!
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br></div></div><hr> <h2 id="非阻塞io"><a href="#非阻塞io" class="header-anchor">#</a> 非阻塞IO</h2> <blockquote><p>non-blocking IO<br>
在非阻塞式IO中, 应用程序需要不断的主动询问操作系统内核(kernel)数据准备好了没有.</p></blockquote> <h3 id="原理"><a href="#原理" class="header-anchor">#</a> 原理</h3> <p><img src="/assets/img/non_block.43b48e14.png" alt=""></p> <p><font color="brown">图6.2 非阻塞I/O模型. 进程重复调用recvfrom, 等待OK返回. (轮询)  </font><br>
1&gt; 同样的, 应用程序会调用收消息的recvfrom接口,该接口会发送一个系统调用给操作系统..<br>
2&gt; 若kernel/操作系统中的数据还没有准备好,那么它并不会block/阻塞用户进程, 而是立刻返回一个error<br>
3&gt; 用户进程判断结果是一个error时, 它就知道数据还没有准备好, 于是用户进程就可以在本次到下次再发起read询问的时间间隔内做其他事情, 或者直接再次发送read操作(recvfrom)<br>
4&gt; 一旦kernel中的数据准备好了,并且又再次收到了用户进程的system call, 那么它马上就将数据拷贝到了应用程序内存 <font color="blue">(这一copy data阶段是阻塞的,是不可避免的,在这期间是不能干其它事情的).</font></p> <p><font color="gray">也就是说 <strong>非阻塞的recvform系统调用调用之后,进程并没有被阻塞,</strong> 内核马上返回给进程. 若数据还没准备好,此时会返回一个error. 进程在得到返回之后,可以干点别的事情,然后再发起recvform系统调用. <em>重复上面的过程,循环往复的进行recvform系统调用.</em> <strong>这个过程通常被称之为轮询.</strong> 轮询检查内核数据,直到数据准备好,再拷贝数据到进程,进行数据处理. 需要注意,拷贝数据的整个过程,进程仍然是属于阻塞的状态.</font></p> <p>该方案将花时间最长的wait data阶段利用了起来,利用此阶段的时间干单线程下其它计算的活.<br>
单线程的效率得到了提升.</p> <h3 id="代码实现"><a href="#代码实现" class="header-anchor">#</a> 代码实现</h3> <blockquote><p>recvfrom原本是阻塞操作,要等两个阶段完完整整做完后再执行下一行代码,我们要将其变为非阻塞的.<br>
关键代码 -- <code>server.setblocking(False)</code></p> <p><font color="brown">非阻塞IO的精髓在于完全没有阻塞!</font></p></blockquote> <h5 id="服务端"><a href="#服务端" class="header-anchor">#</a> 服务端</h5> <blockquote><p>运用非阻塞IO模型,服务端在单线程下就实现了并发.</p></blockquote> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">from</span> socket <span class="token keyword">import</span> <span class="token operator">*</span>

server <span class="token operator">=</span> socket<span class="token punctuation">(</span>AF_INET<span class="token punctuation">,</span> SOCK_STREAM<span class="token punctuation">)</span>
server<span class="token punctuation">.</span>bind<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">&quot;127.0.0.1&quot;</span><span class="token punctuation">,</span> <span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
server<span class="token punctuation">.</span>listen<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>

<span class="token comment"># -- 设置阻塞与否,默认flag参数值为True,代表默认的IO模型是阻塞的</span>
<span class="token comment"># -- 此处我们设置flag的参数指为False 将I/O模型变为非阻塞的</span>
<span class="token comment">#    非阻塞IO模型里,若程序的IO操作的wait data阶段没有做完,会抛BlockingIOError异常</span>
<span class="token comment">#    该服务端中涉及到的IO操作有 accept、recv、send</span>
server<span class="token punctuation">.</span>setblocking<span class="token punctuation">(</span><span class="token boolean">False</span><span class="token punctuation">)</span>

conn_l <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
    <span class="token comment"># -- 实现了遇到IO就做其它事情</span>
    <span class="token comment">#    try里的代码报错就执行except里的代码,except里的代码执行完后,因为while True循环.</span>
    <span class="token comment">#    循环往复这一过程. 当然except子代码块里的也有可能遇到IO,同样的捕获异常.</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;总连接数[%s]&quot;</span> <span class="token operator">%</span> <span class="token builtin">len</span><span class="token punctuation">(</span>conn_l<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># -- 每启动一个客户端,连接数就会加1</span>
        conn<span class="token punctuation">,</span> addr <span class="token operator">=</span> server<span class="token punctuation">.</span>accept<span class="token punctuation">(</span><span class="token punctuation">)</span>
        conn_l<span class="token punctuation">.</span>append<span class="token punctuation">(</span>conn<span class="token punctuation">)</span>  <span class="token comment"># -- 若不执行此操作,每次与客户端新建立的链接就会被覆盖掉</span>
    <span class="token keyword">except</span> BlockingIOError<span class="token punctuation">:</span>
        <span class="token comment"># print(&quot;做了2s其它的事情!&quot;)</span>
        <span class="token comment"># time.sleep(2)  # -- 此处不是模拟io,而是模拟做其它计算用了2s的时间</span>
        <span class="token comment"># -- 进一步明确,其它事情指的是做通信循环的活</span>
        <span class="token comment">#    (若要考虑粘包问题) 一点提示: conn作为key,value对应上此conn收的数据,收的数据做一个拼接</span>
        <span class="token comment">#    比如:conn_msg_l = []  conn_msg_l[conn] = data</span>
        <span class="token comment">#        conn_msg_l列表中的每一个元素是字典 {链接:该链接收到的消息&quot;拼接&quot;}</span>
        del_conn_l <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> conn <span class="token keyword">in</span> conn_l<span class="token punctuation">:</span>
            <span class="token keyword">try</span><span class="token punctuation">:</span>
                <span class="token comment"># -- 要知道,conn_l里的一堆链接是归操作系统管</span>
                <span class="token comment">#    哪怕这一堆链接的客户端同时发数据过来,收到的数据都会先往服务端的OS缓存里存.</span>
                <span class="token comment">#    该程序询问当前循环到的链接在OS缓存中有无对应的数据</span>
                <span class="token comment">#    OS和应用程序是互相不干扰的两个进程,各自可以干各自的事情</span>
                data <span class="token operator">=</span> conn<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
                <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>  <span class="token comment"># -- 解决Linux下客户端断开链接,服务端一直接收空字符串的问题</span>
                    conn<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token comment"># -- 为啥不直接conn_l.remove(conn)呢? 因为不要在for循环里改变循环对象的结构!</span>
                    del_conn_l<span class="token punctuation">.</span>append<span class="token punctuation">(</span>conn<span class="token punctuation">)</span>
                    <span class="token keyword">continue</span>
                conn<span class="token punctuation">.</span>send<span class="token punctuation">(</span>data<span class="token punctuation">.</span>upper<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">except</span> BlockingIOError<span class="token punctuation">:</span>
                <span class="token keyword">continue</span>  <span class="token comment"># -- 第一个连接进行recv操作时没数据,不代表第2个没有 这里写成pass也行</span>
            <span class="token keyword">except</span> ConnectionResetError<span class="token punctuation">:</span>  <span class="token comment"># -- 解决windows下客户端断开链接的问题</span>
                conn<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
                del_conn_l<span class="token punctuation">.</span>append<span class="token punctuation">(</span>conn<span class="token punctuation">)</span>

        <span class="token keyword">for</span> conn <span class="token keyword">in</span> del_conn_l<span class="token punctuation">:</span>
            conn_l<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>conn<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br></div></div><h5 id="客户端"><a href="#客户端" class="header-anchor">#</a> 客户端</h5> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> os
<span class="token keyword">from</span> socket <span class="token keyword">import</span> <span class="token operator">*</span>

client <span class="token operator">=</span> socket<span class="token punctuation">(</span>AF_INET<span class="token punctuation">,</span> SOCK_STREAM<span class="token punctuation">)</span>
client<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">&quot;127.0.0.1&quot;</span><span class="token punctuation">,</span> <span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
    msg <span class="token operator">=</span> <span class="token string">&quot;%s hello&quot;</span> <span class="token operator">%</span> os<span class="token punctuation">.</span>getpid<span class="token punctuation">(</span><span class="token punctuation">)</span>
    client<span class="token punctuation">.</span>send<span class="token punctuation">(</span>msg<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    data <span class="token operator">=</span> client<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    
<span class="token triple-quoted-string string">&quot;&quot;&quot;
当然,可以以多线程的形式模拟多个客户端
&quot;&quot;&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h3 id="弊端"><a href="#弊端" class="header-anchor">#</a> 弊端</h3> <blockquote><p>非阻塞IO模型是不被推荐的!</p></blockquote> <p>1&gt; 非阻塞IO,一点IO都没有.. 虽然在单线程下实现了并发,内存占用少了,但 <font color="green">对cpu的无效占用过高!!</font><br>
     循环调用recv()将大幅度推高CPU占用率.. 而且大多数的轮询是没有意义的.白占cpu还不干活.<br>
2&gt; <font color="green">若conn_l列表中的连接数很多,for循环一次也会很慢.</font><br>
3&gt; 按照服务端代码的运行逻辑, accept询问OS有无连接,若没有,就去干通信循环的活了.. <font color="green">在干通讯循环的活的过程中,新的连接来啦,没有得到及时的处理!!</font> 导致整体数据吞吐量的降低! 不能及时反馈客户端的信息!</p> <p><font color="brown">扩展阅读链接: ``https://blog.csdn.net/pythontide/article/details/109242386`</font><br> <font color="gray">注意send()触发BlockingIOError异常的条件,并不是说写个send代码就会触发异常..</font>
后文的多路复用IO中也有对send操作阻塞的解释!!</p> <hr> <h2 id="多路复用io"><a href="#多路复用io" class="header-anchor">#</a> 多路复用IO!!</h2> <blockquote><p>IO multiplexing;  有些地方也称这种IO方式为事件驱动IO(event driven IO)</p></blockquote> <h3 id="原理-2"><a href="#原理-2" class="header-anchor">#</a> 原理</h3> <p><img src="/assets/img/multiplexing.a70bf220.png" alt=""></p> <p><font color="brown">图6.3 I/O多路复用模型</font><br> <font color="brown">进程在select调用中阻塞,等待可能的多个套接字中的一个变得可读; 将数据复制到应用程序的缓冲区.</font><br>
1&gt; <font color="blue"><em><strong>wait data阶段.</strong></em> 在阻塞与非阻塞IO模型中, 是应用程序的套接字对象直接调用 recv、recvfrom、accept 发起系统调用请求的, 在IO多路复用模型中, 是通过select模块发起的. 该系统调用会问操作系统有无数据;</font><br>
2&gt; select模块帮我们管理着一堆套接字,<font color="green">select发起系统调用问OS,这堆socket中有无准备好数据的, 会阻塞住!</font>(可以设置timeout) 当有数据到达了OS缓存时, 解除阻塞, 将准备好数据的socket通知给 用户/应用程序 进程..<br>
3&gt; 接着进入 <em><strong>copy data阶段,</strong></em> 应用程序将那些有数据到达的socket对象通过recvfrom <font color="green">并发</font> 的发起系统调用, <font color="gray">因为select已经帮忙问了, 所以 <strong>不会阻塞,</strong></font> 该系统调用会直接将数据从OS内核复制到应用程序内存.速度会很快.</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code>再提醒一点<span class="token punctuation">,</span>应用程序发起的recv等收消息的操作<span class="token punctuation">:</span>
<span class="token number">1</span><span class="token operator">&gt;</span> 阻塞模型的IO操作会经历两个阶段<span class="token punctuation">,</span>两个阶段都会block<span class="token punctuation">.</span>
<span class="token number">2</span><span class="token operator">&gt;</span> 非阻塞模型当socket对象的IO操作<span class="token punctuation">(</span>accept、recv<span class="token punctuation">)</span>在OS缓存中没有相应的数据时<span class="token punctuation">,</span>暂且只经历wait data阶段
   但不会阻塞<span class="token punctuation">.</span>会在这期间做其它的活!
   <span class="token punctuation">(</span>通过非阻塞IO的代码实现<span class="token punctuation">,</span>可以看到accept、recv做的其它活<span class="token punctuation">,</span>实际上指的都是通信循环<span class="token punctuation">)</span><span class="token punctuation">.</span> 
   当有相应的数据后<span class="token punctuation">,</span>该IO操作会再经历copy data阶段<span class="token punctuation">.</span>
   copy data阶段是block的<span class="token punctuation">,</span>不可避免的<span class="token punctuation">.</span>但copy data阶段速度很快! 
   So<span class="token punctuation">,</span>非阻塞模型的IO操作也会经历两个阶段<span class="token punctuation">.</span>第一个阶段不阻塞<span class="token punctuation">,</span>第二个阶段阻塞<span class="token punctuation">.</span>
<span class="token number">3</span><span class="token operator">&gt;</span> IO多路复用的select模块只会经历wait data阶段!!询问操作系统有无数据<span class="token punctuation">.</span>并不会真正的收数据!

效率比较<span class="token punctuation">:</span> 非阻塞 <span class="token operator">&gt;</span> 阻塞
阻塞与多路复用的效率比较呢？
<span class="token number">1</span><span class="token operator">&gt;</span> 假设select只管一个socket<span class="token punctuation">,</span>与阻塞模型相比<span class="token punctuation">,</span>阻塞模型的效率高!
   他们都会经历两个阶段<span class="token punctuation">(</span>两个阶段都要等<span class="token punctuation">)</span><span class="token punctuation">,</span>但多路复用比阻塞多了两个过程<span class="token punctuation">.</span>
   一个是有数据到达后<span class="token punctuation">,</span><span class="token keyword">return</span> readable返回结果<span class="token punctuation">,</span>以及 recvfrom在数据到达后会进行一次 system call<span class="token punctuation">.</span>
<span class="token number">2</span><span class="token operator">&gt;</span> 假设select管理多个socket<span class="token punctuation">,</span>与阻塞模型相比<span class="token punctuation">,</span>IO多路复用模型的效率高!
   因为阻塞IO同一时间只能问一个<span class="token punctuation">,</span>这一个阻塞住了<span class="token punctuation">,</span>后面的都运行不了啦<span class="token punctuation">.</span>
   而多路复用IO可以一次性的问多个<span class="token punctuation">,</span>是并发的<span class="token punctuation">,</span>没有消息过来<span class="token punctuation">,</span>会阻住<span class="token punctuation">,</span>但一个套接字阻住啦<span class="token punctuation">,</span>不会影响其它的套接字<span class="token punctuation">.</span>
非阻塞与多路复用的效率比较呢？非阻塞的效率高<span class="token punctuation">.</span>
可以仔细品一品<span class="token punctuation">,</span>非阻塞IO与select的工作流程很像!但非阻塞IO是应用程序在问<span class="token punctuation">,</span>多路复用是select在问<span class="token punctuation">.</span>
IO多路复用询问完后<span class="token punctuation">,</span>要返回那些有数据的套接字<span class="token punctuation">,</span>基于这些准备好的套接字再发起请求<span class="token punctuation">.</span>
但为何不用非阻塞IO模型呢？因为非阻塞的cpu占用率很高<span class="token punctuation">.</span>它会不间断的询问!
而多路复用IO中select<span class="token punctuation">.</span>select<span class="token punctuation">(</span><span class="token punctuation">)</span>处会阻塞住!!等待数据<span class="token punctuation">(</span>链接、消息<span class="token punctuation">)</span>发过来<span class="token punctuation">.</span>
我们也可以给多路复用中的select设置超时时间<span class="token punctuation">.</span> 在超时时间里来数据了或者超时时间到了<span class="token punctuation">,</span>都会接触阻塞!
那非阻塞IO模型在询问时加个time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>不就行了嘛?no<span class="token punctuation">,</span>这样写死了啊<span class="token punctuation">,</span>否管有没有数据来<span class="token punctuation">,</span>都会睡够<span class="token number">3</span>秒<span class="token punctuation">.</span>
可能刚睡下去<span class="token number">0</span><span class="token punctuation">.</span>01s<span class="token punctuation">,</span>就来数据了<span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><h3 id="代码实现-2"><a href="#代码实现-2" class="header-anchor">#</a> 代码实现</h3> <h5 id="初探select-select"><a href="#初探select-select" class="header-anchor">#</a> 初探select.select()</h5> <blockquote><p>select模块询问操作系统我维护的列表里哪些套接字有消息/数据过来啦!</p></blockquote> <p><strong>有四个参数:</strong><br>
1&gt; rlist -- 与收消息有关的套接字对象  <font color="blue">server专门建立链接、一堆conn专门收消息</font><br> <em>socket()实例化的server可通过accept方法建立链接conn; conn可以调用recv方法收到消息.</em><br> <font color="gray">Ps: 可以打印server和链接conn,可以看到它们都是&lt;socket.socket&gt;套接字对象</font><br>
2&gt; wlist -- 与写数据相关的套接字 <font color="blue">conn</font><br>
                conn.send()        <font color="gray">若数据量小IO时间忽略不计;若数据量大也会感觉到等待</font><br>
3&gt; xlist -- 跟异常有关,用不到 但这里还是得传值<br>
4&gt; timeout -- 超时时间,是可选的参数,默认值为None<br> <font color="blue">指定一个时间(s),若在该时间内得到了OS返回结果或者时间到了没结果,都会继续运行下面的代码!!</font><br> <font color="gray">解决了非阻塞IO模型中不停的询问,中间没有任何的阻塞导致cpu有大量时间是无效占用的问题!</font><br> <font color="green">没有必要指定timeout参数,select.select()是等OS有返回结果;不是不间断的询问..</font><br> <font color="brown">select.select()会阻塞但该阻塞是合理的, 因为没数据就该原地等着,但有数据就不会阻塞了!!</font></p> <p><strong>返回值:</strong> <font color="blue">返回三个列表, 里面只存放 有数据的/准备好的 套接字对象</font></p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token triple-quoted-string string">&quot;&quot;&quot;
★ -- 客户端代码
&quot;&quot;&quot;</span>
<span class="token keyword">import</span> os
<span class="token keyword">from</span> socket <span class="token keyword">import</span> <span class="token operator">*</span>

client <span class="token operator">=</span> socket<span class="token punctuation">(</span>AF_INET<span class="token punctuation">,</span> SOCK_STREAM<span class="token punctuation">)</span>
client<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">&quot;127.0.0.1&quot;</span><span class="token punctuation">,</span> <span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
    msg <span class="token operator">=</span> <span class="token string">&quot;%s hello&quot;</span> <span class="token operator">%</span> os<span class="token punctuation">.</span>getpid<span class="token punctuation">(</span><span class="token punctuation">)</span>
    client<span class="token punctuation">.</span>send<span class="token punctuation">(</span>msg<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    data <span class="token operator">=</span> client<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  

<span class="token triple-quoted-string string">&quot;&quot;&quot;
★ -- 服务端代码
&quot;&quot;&quot;</span>
<span class="token keyword">import</span> select
<span class="token keyword">from</span> socket <span class="token keyword">import</span> <span class="token operator">*</span>

server <span class="token operator">=</span> socket<span class="token punctuation">(</span>AF_INET<span class="token punctuation">,</span> SOCK_STREAM<span class="token punctuation">)</span>
server<span class="token punctuation">.</span>bind<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">&quot;127.0.0.1&quot;</span><span class="token punctuation">,</span> <span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
server<span class="token punctuation">.</span>listen<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>

server<span class="token punctuation">.</span>setblocking<span class="token punctuation">(</span><span class="token boolean">False</span><span class="token punctuation">)</span>

read_list <span class="token operator">=</span> <span class="token punctuation">[</span>server<span class="token punctuation">,</span> <span class="token punctuation">]</span>
write_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

<span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
    <span class="token comment"># -- rl列表里的就是server这个套接字对象,因为只有它有对应的数据</span>
    rl<span class="token punctuation">,</span> wl<span class="token punctuation">,</span> xl <span class="token operator">=</span> select<span class="token punctuation">.</span>select<span class="token punctuation">(</span>read_list<span class="token punctuation">,</span> write_list<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token comment"># print(rl[0] is server)  # -- True</span>
    <span class="token comment"># print(rl, wl, xl)  # -- [&lt;socket.socket fd=3, family=AddressFamily.AF_INET, </span>
                         <span class="token comment">#     type=SocketKind.SOCK_STREAM, proto=0, </span>
                         <span class="token comment">#     laddr=('127.0.0.1', 8080)&gt;] [] []</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;++++++&quot;</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br></div></div><p><font color="blue">启动服务端,再启动客户端.可以发现 服务端的控制台 一直不停的打印 &quot;++++++&quot;. 为何?</font><br>
1&gt; 一开始启动服务端时,是阻塞在select.select()处的.. 因为select监听到OS缓存中没有数据<br>
2&gt; 接着启动客户端,发送了一个链接请求到服务端所在机器的OS缓存中. select模块监听到read_list读列表中的server套接字有消息过来<font color="gray">(在OS缓存中有对应的链接数据)</font>,不再阻塞,继续执行下一行代码.<code>print(&quot;++++++&quot;)</code><br>
3&gt; 因为while True的存在.循环往复过程中, 因为<font color="blue">OS缓存中的请求链接没有被取走</font><font color="gray">(应调用accept方法取走server套接字对应的链接数据)</font>, OS缓存中一直有数据, 所以select.select()不会阻塞.</p> <p><font color="brown">如果select.select()不设置超时时间,什么时候阻塞在原地? select模块维护着一堆套接字,去问OS时,问这些套接字有无对应的数据准备好,若没有就会一直在原地等着!select会一直问.直到有数据准备好,不再阻塞.</font></p> <p><font color="green"><strong>注意!!!!!!</strong> 应用程序select.select()发起一个系统调用后, 是操作系统在 <strong>遍历</strong> read_list看里面的套接字对象在OS缓存里有无对应数据,会将准备好数据的套接字对象返回!!</font> <font color="brown">相当于select.select()是一个读操作,OS系统去问这些套接字是否准备好数据..有准备好的才会有返回结果...</font></p> <p><font color="red">Q: select.select()里设置超时时间为3秒,与非阻塞IO模型里设置一个time.sleep(3)是一回事吗?</font><br> <strong>A:</strong> no! 假设0.1s就来数据了,前者只会等0.1; 后者会等满3s!!<br> <font color="deepgray">Ps 那执行完select.select(),在执行其它代码时来数据了咋整? 没有办法,机制就是这样的!!只不过其它代码都是大量的计算,速度很快!!</font></p> <h5 id="实现不停的建链接"><a href="#实现不停的建链接" class="header-anchor">#</a> 实现不停的建链接</h5> <blockquote><p>能够实现不停的建立链接,建立链接的阻塞操作不会影响通信(即已建好的链接收消息的操作不会阻塞住)!!</p></blockquote> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token triple-quoted-string string">&quot;&quot;&quot;
★ -- 客户端代码
&quot;&quot;&quot;</span>
<span class="token keyword">from</span> socket <span class="token keyword">import</span> <span class="token operator">*</span>

client <span class="token operator">=</span> socket<span class="token punctuation">(</span>AF_INET<span class="token punctuation">,</span> SOCK_STREAM<span class="token punctuation">)</span>
client<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">&quot;127.0.0.1&quot;</span><span class="token punctuation">,</span> <span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
    msg <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">&quot;&gt;&gt;:&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># -- 这里改动了下,便于实验</span>
    client<span class="token punctuation">.</span>send<span class="token punctuation">(</span>msg<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    data <span class="token operator">=</span> client<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    

<span class="token triple-quoted-string string">&quot;&quot;&quot;
★ -- 服务端代码
&quot;&quot;&quot;</span>
<span class="token keyword">import</span> select
<span class="token keyword">from</span> socket <span class="token keyword">import</span> <span class="token operator">*</span>

server <span class="token operator">=</span> socket<span class="token punctuation">(</span>AF_INET<span class="token punctuation">,</span> SOCK_STREAM<span class="token punctuation">)</span>
server<span class="token punctuation">.</span>bind<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">&quot;127.0.0.1&quot;</span><span class="token punctuation">,</span> <span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
server<span class="token punctuation">.</span>listen<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>

server<span class="token punctuation">.</span>setblocking<span class="token punctuation">(</span><span class="token boolean">False</span><span class="token punctuation">)</span>

read_list <span class="token operator">=</span> <span class="token punctuation">[</span>server<span class="token punctuation">,</span> <span class="token punctuation">]</span>
write_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

<span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
    rl<span class="token punctuation">,</span> wl<span class="token punctuation">,</span> xl <span class="token operator">=</span> select<span class="token punctuation">.</span>select<span class="token punctuation">(</span>read_list<span class="token punctuation">,</span> write_list<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;read_list:%s rl:%s wl:%s&quot;</span> <span class="token operator">%</span> <span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>read_list<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>rl<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>wl<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> sk <span class="token keyword">in</span> rl<span class="token punctuation">:</span>
        <span class="token keyword">if</span> sk <span class="token operator">==</span> server<span class="token punctuation">:</span>
            conn<span class="token punctuation">,</span> addr <span class="token operator">=</span> sk<span class="token punctuation">.</span>accept<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># -- 取出server对应的链接数据,完成三次握手建立链接</span>
            read_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>conn<span class="token punctuation">)</span>  <span class="token comment"># -- 别忘了将conn交给select监管</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token comment"># -- 收消息</span>
            <span class="token keyword">pass</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br></div></div><p><img src="/assets/img/15.e4b59b99.jpeg" alt=""></p> <p>1&gt; 先启动服务端,server套接字没有数据准备好,阻塞在select.select()处;<br>
2&gt; 启动客户端0,发送了一个connect链接请求到服务端,select模块监测到啦,解除阻塞,往下运行代码.此时read_list中还是只有server这个套接字对象,rl列表的长度为1,存放的就是套接字对象server,表明它的 数据 准备好了;<br>
3&gt; <font color="green">server套接字对象调用accept方法取出OS缓存中的链接,</font> 并返回了一个conn套接字对象. <font color="green">将conn套接字对象添加到read_list中,以便得到select模块的监听;</font> 此时read_list列表的长度为2,rl列表的长度为0(被取走了)..<br>
4&gt; 启动客户端1,同理,rl列表的长度重新变为1.. 再启动客户端2,以此类推..<br>
最后,服务端阻塞在select.select()处,此时,<code>read_list = [server,conn0,conn1,conn2],rl = []</code> <font color="gray">(这是伪代码)</font></p> <p><font color="blue"><strong>注意,</strong> 程序中的conn跟打开一个文件一样,占用两方面的资源,应用程序的资源(conn变量名)以及操作系统的资源(对应OS里维护的一个TCP链接)... server套接字对象同理.</font></p> <p>该程序中服务端进来的只有链接,所以rl的长度一直是1..(准备好的套接字对象只有一个)<br> <font color="gray">Ps: 客户端发完connect链接请求后,就阻塞在input()处了..</font></p> <h5 id="收发消息的思考"><a href="#收发消息的思考" class="header-anchor">#</a> 收发消息的思考</h5> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
    rl<span class="token punctuation">,</span> wl<span class="token punctuation">,</span> xl <span class="token operator">=</span> select<span class="token punctuation">.</span>select<span class="token punctuation">(</span>read_list<span class="token punctuation">,</span> write_list<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> sk <span class="token keyword">in</span> rl<span class="token punctuation">:</span>
        <span class="token keyword">if</span> sk <span class="token operator">==</span> server<span class="token punctuation">:</span>
            conn<span class="token punctuation">,</span> addr <span class="token operator">=</span> sk<span class="token punctuation">.</span>accept<span class="token punctuation">(</span><span class="token punctuation">)</span>
            read_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>conn<span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token comment"># -- 收消息</span>
            data <span class="token operator">=</span> sk<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
            sk<span class="token punctuation">.</span>send<span class="token punctuation">(</span>data<span class="token punctuation">.</span>upper<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>建立完链接后,客户端0-2依次向服务端发消息.. 结果如下:</p> <p><img src="/assets/img/22.4e1fea81.jpeg" alt=""></p> <p>Q: <font color="blue">客户端收发消息这样写,也能实现多个客户端的并发!! 但存在什么问题呢?</font><br> <font color="gray">(客户端发空数据、客户端突然断开、粘包现象这些都暂且不考虑) </font><br>
A: <font color="brown">要给一堆套接字回复信息,send操作也属于一种IO行为,速度很快!它会将应用程序内存的数据拷贝到OS缓存中,OS的缓存大小总归是有限制的(内存的一小部分作为缓存). 若OS缓存满了,就send不进数据了.. 就需要原地等着,等OS将这些数据发送后,缓存空闲了,才能继续进行send操作!! 不应该因为send操作让程序陷入阻塞.</font></p> <h5 id="完整版"><a href="#完整版" class="header-anchor">#</a> 完整版</h5> <blockquote><p>有没有可能导致cpu的占用率很高?<br>
客户端们不停的向服务端发消息,服务端不停的取数据计算.. 但这是有效的cpu占用!!!</p></blockquote> <p><font color="gray">Ps: 以下代码运行起来,cpu飙升是因为,服务端和客户端都运行在同一台机器上,客户端在死循环的发送消息.</font></p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token triple-quoted-string string">&quot;&quot;&quot;
★ -- 客户端代码
&quot;&quot;&quot;</span>
<span class="token keyword">import</span> os
<span class="token keyword">from</span> socket <span class="token keyword">import</span> <span class="token operator">*</span>

client <span class="token operator">=</span> socket<span class="token punctuation">(</span>AF_INET<span class="token punctuation">,</span> SOCK_STREAM<span class="token punctuation">)</span>
client<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">&quot;127.0.0.1&quot;</span><span class="token punctuation">,</span> <span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>  <span class="token comment"># -- 不停的给服务端发消息 Hhh</span>
    msg <span class="token operator">=</span> <span class="token string">&quot;%s say hello&quot;</span> <span class="token operator">%</span> os<span class="token punctuation">.</span>getpid<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token keyword">not</span> msg<span class="token punctuation">:</span> <span class="token keyword">continue</span>
    client<span class="token punctuation">.</span>send<span class="token punctuation">(</span>msg<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    data <span class="token operator">=</span> client<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

client<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>


<span class="token triple-quoted-string string">&quot;&quot;&quot;
★ -- 服务端代码
&quot;&quot;&quot;</span>
<span class="token keyword">import</span> select
<span class="token keyword">from</span> socket <span class="token keyword">import</span> <span class="token operator">*</span>

server <span class="token operator">=</span> socket<span class="token punctuation">(</span>AF_INET<span class="token punctuation">,</span> SOCK_STREAM<span class="token punctuation">)</span>
server<span class="token punctuation">.</span>bind<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">&quot;127.0.0.1&quot;</span><span class="token punctuation">,</span> <span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
server<span class="token punctuation">.</span>listen<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>

server<span class="token punctuation">.</span>setblocking<span class="token punctuation">(</span><span class="token boolean">False</span><span class="token punctuation">)</span>

read_list <span class="token operator">=</span> <span class="token punctuation">[</span>server<span class="token punctuation">,</span> <span class="token punctuation">]</span>
write_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
data_dic <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
    rl<span class="token punctuation">,</span> wl<span class="token punctuation">,</span> xl <span class="token operator">=</span> select<span class="token punctuation">.</span>select<span class="token punctuation">(</span>read_list<span class="token punctuation">,</span> write_list<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> sk <span class="token keyword">in</span> rl<span class="token punctuation">:</span>
        <span class="token keyword">if</span> sk <span class="token operator">==</span> server<span class="token punctuation">:</span>
            conn<span class="token punctuation">,</span> addr <span class="token operator">=</span> sk<span class="token punctuation">.</span>accept<span class="token punctuation">(</span><span class="token punctuation">)</span>
            read_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>conn<span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token comment"># -- 收消息</span>
            <span class="token comment"># data = sk.recv(1024)</span>
            <span class="token comment"># write_list.append(sk)</span>
            <span class="token comment"># data_dic[sk] = data</span>
            <span class="token keyword">try</span><span class="token punctuation">:</span>
                data <span class="token operator">=</span> sk<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
                <span class="token keyword">if</span> <span class="token keyword">not</span> data<span class="token punctuation">:</span>
                    sk<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
                    read_list<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>sk<span class="token punctuation">)</span>
                    <span class="token keyword">continue</span>
                write_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>sk<span class="token punctuation">)</span>  <span class="token comment"># -- 收到消息,准备回消息才加到write_list中的!</span>
                data_dic<span class="token punctuation">[</span>sk<span class="token punctuation">]</span> <span class="token operator">=</span> data  <span class="token comment"># -- 用字典建立好关系,并没有发</span>
            <span class="token keyword">except</span> ConnectionResetError<span class="token punctuation">:</span>
                sk<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
                read_list<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>sk<span class="token punctuation">)</span>

    <span class="token comment"># -- 发消息</span>
    <span class="token keyword">for</span> sk <span class="token keyword">in</span> wl<span class="token punctuation">:</span>
        sk<span class="token punctuation">.</span>send<span class="token punctuation">(</span>data_dic<span class="token punctuation">[</span>sk<span class="token punctuation">]</span><span class="token punctuation">.</span>upper<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        data_dic<span class="token punctuation">.</span>pop<span class="token punctuation">(</span>sk<span class="token punctuation">)</span>  <span class="token comment"># -- 发完后,此数据就没意义啦,在数据字典中清除</span>
        <span class="token comment"># -- 回完消息后删除,不然随着对同一个客户端消息的接收,write_list中会有很多重复sk</span>
        write_list<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>sk<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br></div></div><h3 id="epoll接口"><a href="#epoll接口" class="header-anchor">#</a> epoll接口</h3> <p>首先要明白一点, select模块并不能代表多路复用IO模型.. 它仅仅只是一个模块!<br> <font color="brown">真正支持 <em><strong>利用select模块的select接口发起系统调用的多路复用IO模型</strong></em> 的是操作系统!!</font><br>
包括前面的非阻塞IO模型也是OS支持的<font color="gray">(发起一个请求,OS说没有,直接抛异常)</font>.</p> <p>但这种使用select接口的多路复用IO模型有个缺点!! <font color="blue">若read_list中有一万个套接字,OS遍历询问里面的套接字的数据准备好没,前9999个都没有,那询问的这9千多次都是无用的,这样的效率很低很低!!</font></p> <p>那如何是好呢? select接口的原理是OS主动去遍历这些套接字好没好,得操作系统去问.这样效率低. 但如果这些套接字好了主动告诉OS,这样的效率就高了.</p> <p>怎么做? 给每个套接字对象绑定一个类似于回调函数的东西.在套接字对象有数据时主动去触发回调函数. 比如list_1里面的某个套接字好了,会将其在list_1里的索引放到list_2列表里. 操作系统直接返回list_2列表给应用程序用就行啦! 不会像使用select接口的多路复用IO模型随着套接字个数的增多效率变低. --- <font color="red">这就是epoll模型!!</font></p> <p><font color="gray">Ps: 在select和epoll之间还有一种接口,叫做poll.. poll跟select半斤八两,只不过poll比select支持的套接字数多一点.依旧没有改变select的本质,还是OS一个个的去遍历!!</font></p> <p><strong>注意:</strong> <font color="brown">epoll模型 windows不支持! </font><br>
基于网络通信的软件就是套接字软件,通常套接字服务端软件都是运行在linux之上!! <font color="brown">linux支持epoll模型. </font><br> <font color="red">nginx里的单线程就是基于epoll来解决IO问题的.</font> 所以,nginx运行在window上效率会大打折扣.</p> <p><font color="green">扩展:</font> 基于selectors模块写的代码会根据当前操作系统的不同选择操作系统所支持的接口(select/poll/epoll)..<br>
参考链接 - <code>https://www.cnblogs.com/linhaifeng/articles/7454717.html#_label7</code></p> <hr> <h2 id="异步io"><a href="#异步io" class="header-anchor">#</a> 异步IO</h2> <blockquote><p>Asynchronous I/O 效率最高的一种!!</p></blockquote> <p><img src="/assets/img/17.98065858.png" alt=""></p> <p><font color="brown">图6.5 异步I/O模型 进程继续执行</font><br>
1&gt; 用户进程发起read操作之后(仅仅就发了个信号给OS), 立刻就可以开始去做其它的事.<br>
2&gt; 另一方面, 从kernel的角度, 当它受到一个asynchronous read之后, 首先它会立刻返回.<br>
     所以不会对用户进程产生任何block.<br>
3&gt; kernel会经历wait data、copy data阶段 -- 等待数据准备完成, 然后将数据拷贝到用户内存<br>
4&gt; 当这一切都完成之后, kernel会给用户进程发送一个signal, 告诉它read操作完成了!!</p> <p><font color="gray">Ps: 前端的Ajax就是典型的应用异步IO的场景!!</font></p> <div class="language-python line-numbers-mode"><pre class="language-python"><code>★ <span class="token operator">-</span><span class="token operator">-</span> 效率比较
阻塞IO<span class="token punctuation">:</span> 发完请求后<span class="token punctuation">,</span>就在原地等着<span class="token punctuation">,</span>没什么好比的
非阻塞IO<span class="token punctuation">:</span> 只是解决了wait data阶段的IO问题<span class="token punctuation">,</span>copy data阶段的IO是没有解决的<span class="token punctuation">.</span>
IO多路复用<span class="token punctuation">:</span> 不考虑cpu占用率<span class="token punctuation">,</span>IO多路复用的效率比非阻塞IO低<span class="token punctuation">;</span>
           因为相比之下<span class="token punctuation">,</span>IO多路复用还多了 <span class="token keyword">return</span> readable 和 system call 两个步骤<span class="token punctuation">.</span>
           但不使用非阻塞IO<span class="token punctuation">,</span>是因为非阻塞IO大量的无效占用CPU<span class="token punctuation">.</span>
异步IO<span class="token punctuation">:</span> OS帮忙经历两个阶段 <span class="token operator">-</span><span class="token operator">-</span> 效率最高!!
  
注意 <span class="token operator">~</span> 这些IO模型的实现都得OS支持才行<span class="token punctuation">.</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p><font color="brown">异步IO的代码实现暂且略过,在爬虫课程中会详细讲解!</font></p> <hr></div></div> <!----> <div class="page-edit"><!----> <!----> <!----></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/c7249b/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">协程</div></a> <a href="/pages/45898a/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">轮询长轮询</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/c7249b/" class="prev">协程</a></span> <span class="next"><a href="/pages/45898a/">轮询长轮询</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/pages/8sk2b3/"><div>
            搜索相关
            <!----></div></a> <span class="date">03-22</span></dt></dl><dl><dd>02</dd> <dt><a href="/pages/2kn2p2/"><div>
            CURD
            <!----></div></a> <span class="date">03-20</span></dt></dl><dl><dd>03</dd> <dt><a href="/pages/1kn1m1/"><div>
            自动生成
            <!----></div></a> <span class="date">03-15</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="https://github.com/OnePieceDC" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://www.cnblogs.com/DC0307/" title="博客园" target="_blank" class="iconfont icon-bokeyuan"></a><a href="https://music.163.com/#/song?id=1854188649" title="听音乐" target="_blank" class="iconfont icon-erji"></a><a href="https://www.jianshu.com/u/5310eb537315" title="简书" target="_blank" class="iconfont icon-jianshu"></a><a href="mailto:1415806497@qq.com" title="QQ" target="_blank" class="iconfont icon-youjian"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2023-2024
    <span>DC | One Piece</span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <div class="body-bg" style="background:url() center center / cover no-repeat;opacity:0.5;"></div> <!----> <!----></div><div class="global-ui"><!----><div id="goTop" class="hide-cat" data-v-8ccb5928></div><div></div><canvas id="vuepress-canvas-cursor"></canvas><div></div><div></div></div></div>
    <script src="/assets/js/app.ac54adc6.js" defer></script><script src="/assets/js/4.7ddc74e3.js" defer></script><script src="/assets/js/1.a0c4ff1b.js" defer></script><script src="/assets/js/3.8b03321d.js" defer></script><script src="/assets/js/53.ecbb032d.js" defer></script><script src="/assets/js/104.cae2d944.js" defer></script><script src="/assets/js/184.46eabf07.js" defer></script>
  </body>
</html>
