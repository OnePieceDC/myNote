<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>函数高级 | DC&#39;s blog</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="icon" href="/img/favicon.ico">
    <link rel="stylesheet" href="/fonts/iconfont.css">
    <meta name="description" content="人类终将毁灭,世界属于三体!">
    <meta name="keywords" content="DC的个人博客.">
    
    <link rel="preload" href="/assets/css/0.styles.66b92039.css" as="style"><link rel="preload" href="/assets/js/app.ac54adc6.js" as="script"><link rel="preload" href="/assets/js/4.7ddc74e3.js" as="script"><link rel="preload" href="/assets/js/1.a0c4ff1b.js" as="script"><link rel="preload" href="/assets/js/3.8b03321d.js" as="script"><link rel="preload" href="/assets/js/90.630f62d3.js" as="script"><link rel="preload" href="/assets/js/104.cae2d944.js" as="script"><link rel="preload" href="/assets/js/184.46eabf07.js" as="script"><link rel="prefetch" href="/assets/js/10.a91ae011.js"><link rel="prefetch" href="/assets/js/100.2e8ea472.js"><link rel="prefetch" href="/assets/js/101.46f57a02.js"><link rel="prefetch" href="/assets/js/102.f51bcd80.js"><link rel="prefetch" href="/assets/js/103.3f003e0e.js"><link rel="prefetch" href="/assets/js/105.6c6ebc28.js"><link rel="prefetch" href="/assets/js/106.47dc8889.js"><link rel="prefetch" href="/assets/js/107.6b5602b4.js"><link rel="prefetch" href="/assets/js/108.46f0c21d.js"><link rel="prefetch" href="/assets/js/109.0f1168a5.js"><link rel="prefetch" href="/assets/js/11.e6a94228.js"><link rel="prefetch" href="/assets/js/110.6a961498.js"><link rel="prefetch" href="/assets/js/111.c6f27c88.js"><link rel="prefetch" href="/assets/js/112.9ee3d3bb.js"><link rel="prefetch" href="/assets/js/113.82b72aa0.js"><link rel="prefetch" href="/assets/js/114.7487460e.js"><link rel="prefetch" href="/assets/js/115.cd079d0a.js"><link rel="prefetch" href="/assets/js/116.b6b829eb.js"><link rel="prefetch" href="/assets/js/117.89d9336c.js"><link rel="prefetch" href="/assets/js/118.467c4437.js"><link rel="prefetch" href="/assets/js/119.c4b2ac40.js"><link rel="prefetch" href="/assets/js/12.9d3501e4.js"><link rel="prefetch" href="/assets/js/120.5ff31c09.js"><link rel="prefetch" href="/assets/js/121.2e59c3a5.js"><link rel="prefetch" href="/assets/js/122.a66096cf.js"><link rel="prefetch" href="/assets/js/123.4885ba5f.js"><link rel="prefetch" href="/assets/js/124.cacc66be.js"><link rel="prefetch" href="/assets/js/125.dc5b30fe.js"><link rel="prefetch" href="/assets/js/126.4e21eb5e.js"><link rel="prefetch" href="/assets/js/127.cb36a9bf.js"><link rel="prefetch" href="/assets/js/128.ce38358e.js"><link rel="prefetch" href="/assets/js/129.e5f414eb.js"><link rel="prefetch" href="/assets/js/13.ca017a68.js"><link rel="prefetch" href="/assets/js/130.17b597f0.js"><link rel="prefetch" href="/assets/js/131.e1ded2dc.js"><link rel="prefetch" href="/assets/js/132.aae1c627.js"><link rel="prefetch" href="/assets/js/133.73cecdb3.js"><link rel="prefetch" href="/assets/js/134.80cf38a0.js"><link rel="prefetch" href="/assets/js/135.735ed588.js"><link rel="prefetch" href="/assets/js/136.91f8db08.js"><link rel="prefetch" href="/assets/js/137.d6fb8bda.js"><link rel="prefetch" href="/assets/js/138.75cafe73.js"><link rel="prefetch" href="/assets/js/139.b01bf0db.js"><link rel="prefetch" href="/assets/js/14.ee2605b5.js"><link rel="prefetch" href="/assets/js/140.ff0a7911.js"><link rel="prefetch" href="/assets/js/141.c69e7f54.js"><link rel="prefetch" href="/assets/js/142.997b03ac.js"><link rel="prefetch" href="/assets/js/143.e40faea8.js"><link rel="prefetch" href="/assets/js/144.369f23e5.js"><link rel="prefetch" href="/assets/js/145.1268424d.js"><link rel="prefetch" href="/assets/js/146.94c65c4a.js"><link rel="prefetch" href="/assets/js/147.05fe6a36.js"><link rel="prefetch" href="/assets/js/148.327cc29d.js"><link rel="prefetch" href="/assets/js/149.90068676.js"><link rel="prefetch" href="/assets/js/15.42e0a0e4.js"><link rel="prefetch" href="/assets/js/150.b4b780bb.js"><link rel="prefetch" href="/assets/js/151.b4611012.js"><link rel="prefetch" href="/assets/js/152.4d2c8246.js"><link rel="prefetch" href="/assets/js/153.f32dfa58.js"><link rel="prefetch" href="/assets/js/154.b79a78fb.js"><link rel="prefetch" href="/assets/js/155.6ad2865c.js"><link rel="prefetch" href="/assets/js/156.fd49a1af.js"><link rel="prefetch" href="/assets/js/157.55113800.js"><link rel="prefetch" href="/assets/js/158.af321bc9.js"><link rel="prefetch" href="/assets/js/159.37d9c659.js"><link rel="prefetch" href="/assets/js/16.007f45b3.js"><link rel="prefetch" href="/assets/js/160.7a3b5a9a.js"><link rel="prefetch" href="/assets/js/161.fc1fbea8.js"><link rel="prefetch" href="/assets/js/162.2f8d3d1c.js"><link rel="prefetch" href="/assets/js/163.aa889940.js"><link rel="prefetch" href="/assets/js/164.5d8b2cb7.js"><link rel="prefetch" href="/assets/js/165.44d4a9b5.js"><link rel="prefetch" href="/assets/js/166.c1b4c4d4.js"><link rel="prefetch" href="/assets/js/167.0c39929e.js"><link rel="prefetch" href="/assets/js/168.fede035a.js"><link rel="prefetch" href="/assets/js/169.ff940d50.js"><link rel="prefetch" href="/assets/js/17.7395c644.js"><link rel="prefetch" href="/assets/js/170.b6fcb3bf.js"><link rel="prefetch" href="/assets/js/171.2b927a7c.js"><link rel="prefetch" href="/assets/js/172.b07a90a1.js"><link rel="prefetch" href="/assets/js/173.367352bf.js"><link rel="prefetch" href="/assets/js/174.4ea4e20f.js"><link rel="prefetch" href="/assets/js/175.d9679b61.js"><link rel="prefetch" href="/assets/js/176.f7804143.js"><link rel="prefetch" href="/assets/js/177.c5d1e680.js"><link rel="prefetch" href="/assets/js/178.808293fa.js"><link rel="prefetch" href="/assets/js/179.2acf6b3c.js"><link rel="prefetch" href="/assets/js/18.46f9153d.js"><link rel="prefetch" href="/assets/js/180.ddf3ecf7.js"><link rel="prefetch" href="/assets/js/181.4da0855c.js"><link rel="prefetch" href="/assets/js/182.591d135a.js"><link rel="prefetch" href="/assets/js/183.9d08f9fe.js"><link rel="prefetch" href="/assets/js/185.ee1c8428.js"><link rel="prefetch" href="/assets/js/186.c7b19133.js"><link rel="prefetch" href="/assets/js/187.52945990.js"><link rel="prefetch" href="/assets/js/188.a1d395c5.js"><link rel="prefetch" href="/assets/js/189.5b66165e.js"><link rel="prefetch" href="/assets/js/19.2db19edb.js"><link rel="prefetch" href="/assets/js/190.265a75de.js"><link rel="prefetch" href="/assets/js/191.b4c65143.js"><link rel="prefetch" href="/assets/js/192.cc4d4115.js"><link rel="prefetch" href="/assets/js/193.fa02ecc5.js"><link rel="prefetch" href="/assets/js/194.b0c9ad53.js"><link rel="prefetch" href="/assets/js/195.eda8cd34.js"><link rel="prefetch" href="/assets/js/196.cbae4dc6.js"><link rel="prefetch" href="/assets/js/197.693b1b85.js"><link rel="prefetch" href="/assets/js/198.8213665b.js"><link rel="prefetch" href="/assets/js/199.ddf0036d.js"><link rel="prefetch" href="/assets/js/2.4c15b693.js"><link rel="prefetch" href="/assets/js/20.6742e8ae.js"><link rel="prefetch" href="/assets/js/200.340df508.js"><link rel="prefetch" href="/assets/js/201.7431c15b.js"><link rel="prefetch" href="/assets/js/202.217b2b38.js"><link rel="prefetch" href="/assets/js/203.06c6a93d.js"><link rel="prefetch" href="/assets/js/204.a068a898.js"><link rel="prefetch" href="/assets/js/205.9361d3f5.js"><link rel="prefetch" href="/assets/js/206.886beca0.js"><link rel="prefetch" href="/assets/js/207.2278bda8.js"><link rel="prefetch" href="/assets/js/208.db0acc0d.js"><link rel="prefetch" href="/assets/js/209.0e05b204.js"><link rel="prefetch" href="/assets/js/21.fd552a4e.js"><link rel="prefetch" href="/assets/js/210.4c730041.js"><link rel="prefetch" href="/assets/js/211.417dbee1.js"><link rel="prefetch" href="/assets/js/212.eef4f4a3.js"><link rel="prefetch" href="/assets/js/213.ab742b0b.js"><link rel="prefetch" href="/assets/js/214.a57228de.js"><link rel="prefetch" href="/assets/js/215.37f52459.js"><link rel="prefetch" href="/assets/js/216.2f110f92.js"><link rel="prefetch" href="/assets/js/217.09654311.js"><link rel="prefetch" href="/assets/js/218.a7568950.js"><link rel="prefetch" href="/assets/js/219.628ee193.js"><link rel="prefetch" href="/assets/js/22.465a76d2.js"><link rel="prefetch" href="/assets/js/220.c5df9186.js"><link rel="prefetch" href="/assets/js/221.101ddb09.js"><link rel="prefetch" href="/assets/js/222.db210e3c.js"><link rel="prefetch" href="/assets/js/223.429cbf14.js"><link rel="prefetch" href="/assets/js/224.aa002868.js"><link rel="prefetch" href="/assets/js/225.79a40017.js"><link rel="prefetch" href="/assets/js/226.3e08228b.js"><link rel="prefetch" href="/assets/js/227.a09dd4b4.js"><link rel="prefetch" href="/assets/js/228.f930c492.js"><link rel="prefetch" href="/assets/js/229.f639a9e4.js"><link rel="prefetch" href="/assets/js/23.df6831af.js"><link rel="prefetch" href="/assets/js/230.e8ac7aad.js"><link rel="prefetch" href="/assets/js/231.99501214.js"><link rel="prefetch" href="/assets/js/232.e2932792.js"><link rel="prefetch" href="/assets/js/233.43dfa689.js"><link rel="prefetch" href="/assets/js/234.7951f9c4.js"><link rel="prefetch" href="/assets/js/235.1dc96b6c.js"><link rel="prefetch" href="/assets/js/236.40b8d4e4.js"><link rel="prefetch" href="/assets/js/237.75a692de.js"><link rel="prefetch" href="/assets/js/238.cc9d9ac1.js"><link rel="prefetch" href="/assets/js/239.4616a566.js"><link rel="prefetch" href="/assets/js/24.b68dc734.js"><link rel="prefetch" href="/assets/js/240.dd825147.js"><link rel="prefetch" href="/assets/js/241.85e3219b.js"><link rel="prefetch" href="/assets/js/242.bf4123c4.js"><link rel="prefetch" href="/assets/js/243.ce68f4f0.js"><link rel="prefetch" href="/assets/js/244.e2598d4d.js"><link rel="prefetch" href="/assets/js/245.2c696827.js"><link rel="prefetch" href="/assets/js/246.2c44a497.js"><link rel="prefetch" href="/assets/js/247.02405fce.js"><link rel="prefetch" href="/assets/js/248.6727bdf6.js"><link rel="prefetch" href="/assets/js/249.4901f575.js"><link rel="prefetch" href="/assets/js/25.d639c65c.js"><link rel="prefetch" href="/assets/js/250.c922c9ea.js"><link rel="prefetch" href="/assets/js/251.b1350ead.js"><link rel="prefetch" href="/assets/js/252.8295c5ea.js"><link rel="prefetch" href="/assets/js/253.b0a9ba20.js"><link rel="prefetch" href="/assets/js/254.d208b848.js"><link rel="prefetch" href="/assets/js/255.2cfb6ad3.js"><link rel="prefetch" href="/assets/js/256.e7687a81.js"><link rel="prefetch" href="/assets/js/257.db329d54.js"><link rel="prefetch" href="/assets/js/258.be75b1f9.js"><link rel="prefetch" href="/assets/js/259.67500f7e.js"><link rel="prefetch" href="/assets/js/26.9db429a9.js"><link rel="prefetch" href="/assets/js/260.73609cfa.js"><link rel="prefetch" href="/assets/js/261.22fc7c08.js"><link rel="prefetch" href="/assets/js/262.2c620ccd.js"><link rel="prefetch" href="/assets/js/263.e0ce1454.js"><link rel="prefetch" href="/assets/js/264.7fe82318.js"><link rel="prefetch" href="/assets/js/265.537d06c5.js"><link rel="prefetch" href="/assets/js/266.901695a7.js"><link rel="prefetch" href="/assets/js/267.8eb24590.js"><link rel="prefetch" href="/assets/js/268.a21e44dc.js"><link rel="prefetch" href="/assets/js/269.33e6ce5d.js"><link rel="prefetch" href="/assets/js/27.2296e284.js"><link rel="prefetch" href="/assets/js/270.31507ac3.js"><link rel="prefetch" href="/assets/js/271.b9406b42.js"><link rel="prefetch" href="/assets/js/272.0acaba6f.js"><link rel="prefetch" href="/assets/js/273.c2e359b0.js"><link rel="prefetch" href="/assets/js/274.a80428a6.js"><link rel="prefetch" href="/assets/js/28.7e4f4dc1.js"><link rel="prefetch" href="/assets/js/29.ba75f79a.js"><link rel="prefetch" href="/assets/js/30.16cd3622.js"><link rel="prefetch" href="/assets/js/31.54ed5bc1.js"><link rel="prefetch" href="/assets/js/32.b2fbba6a.js"><link rel="prefetch" href="/assets/js/33.f7ff0107.js"><link rel="prefetch" href="/assets/js/34.4b2cea7d.js"><link rel="prefetch" href="/assets/js/35.1159e74c.js"><link rel="prefetch" href="/assets/js/36.0b6296f3.js"><link rel="prefetch" href="/assets/js/37.fc67879e.js"><link rel="prefetch" href="/assets/js/38.637afaf8.js"><link rel="prefetch" href="/assets/js/39.748a78f3.js"><link rel="prefetch" href="/assets/js/40.4fede9bb.js"><link rel="prefetch" href="/assets/js/41.c7f0b087.js"><link rel="prefetch" href="/assets/js/42.5b1a487d.js"><link rel="prefetch" href="/assets/js/43.59275b93.js"><link rel="prefetch" href="/assets/js/44.b18a4c94.js"><link rel="prefetch" href="/assets/js/45.bc8f7cb3.js"><link rel="prefetch" href="/assets/js/46.6a4ec89f.js"><link rel="prefetch" href="/assets/js/47.e1e129e6.js"><link rel="prefetch" href="/assets/js/48.c284ce23.js"><link rel="prefetch" href="/assets/js/49.17e5dd65.js"><link rel="prefetch" href="/assets/js/5.e3d12916.js"><link rel="prefetch" href="/assets/js/50.34c3ac45.js"><link rel="prefetch" href="/assets/js/51.035f7031.js"><link rel="prefetch" href="/assets/js/52.e9ef227a.js"><link rel="prefetch" href="/assets/js/53.ecbb032d.js"><link rel="prefetch" href="/assets/js/54.e9af4cfe.js"><link rel="prefetch" href="/assets/js/55.7e71402b.js"><link rel="prefetch" href="/assets/js/56.511071fe.js"><link rel="prefetch" href="/assets/js/57.13b7fe79.js"><link rel="prefetch" href="/assets/js/58.e51f8b0e.js"><link rel="prefetch" href="/assets/js/59.a1b8bdb7.js"><link rel="prefetch" href="/assets/js/6.5fc3f358.js"><link rel="prefetch" href="/assets/js/60.fd7e1c08.js"><link rel="prefetch" href="/assets/js/61.0daf2361.js"><link rel="prefetch" href="/assets/js/62.04632944.js"><link rel="prefetch" href="/assets/js/63.f0dd5615.js"><link rel="prefetch" href="/assets/js/64.89a4b562.js"><link rel="prefetch" href="/assets/js/65.6764ff0c.js"><link rel="prefetch" href="/assets/js/66.049bdee1.js"><link rel="prefetch" href="/assets/js/67.b0d4ec16.js"><link rel="prefetch" href="/assets/js/68.46d97067.js"><link rel="prefetch" href="/assets/js/69.f540f0da.js"><link rel="prefetch" href="/assets/js/7.ce17dd73.js"><link rel="prefetch" href="/assets/js/70.17d8f857.js"><link rel="prefetch" href="/assets/js/71.b2a166a0.js"><link rel="prefetch" href="/assets/js/72.1c17a875.js"><link rel="prefetch" href="/assets/js/73.dac8984b.js"><link rel="prefetch" href="/assets/js/74.5bbc33ac.js"><link rel="prefetch" href="/assets/js/75.483644c7.js"><link rel="prefetch" href="/assets/js/76.de5461ab.js"><link rel="prefetch" href="/assets/js/77.7fa90702.js"><link rel="prefetch" href="/assets/js/78.f41853b8.js"><link rel="prefetch" href="/assets/js/79.598b50e6.js"><link rel="prefetch" href="/assets/js/80.61d2d23a.js"><link rel="prefetch" href="/assets/js/81.d310c6e4.js"><link rel="prefetch" href="/assets/js/82.22aa814c.js"><link rel="prefetch" href="/assets/js/83.f493eba4.js"><link rel="prefetch" href="/assets/js/84.3a32a1eb.js"><link rel="prefetch" href="/assets/js/85.2f47134e.js"><link rel="prefetch" href="/assets/js/86.74e65a77.js"><link rel="prefetch" href="/assets/js/87.e87bff96.js"><link rel="prefetch" href="/assets/js/88.aabc97af.js"><link rel="prefetch" href="/assets/js/89.b0945d87.js"><link rel="prefetch" href="/assets/js/91.ed816647.js"><link rel="prefetch" href="/assets/js/92.19065457.js"><link rel="prefetch" href="/assets/js/93.a0fe1919.js"><link rel="prefetch" href="/assets/js/94.51e48580.js"><link rel="prefetch" href="/assets/js/95.e591bede.js"><link rel="prefetch" href="/assets/js/96.1723f1d6.js"><link rel="prefetch" href="/assets/js/97.02bbb7d4.js"><link rel="prefetch" href="/assets/js/98.a3625ba6.js"><link rel="prefetch" href="/assets/js/99.1accbf48.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.5959bfd2.js">
    <link rel="stylesheet" href="/assets/css/0.styles.66b92039.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu have-body-img"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/nav-logo.png" alt="DC's blog" class="logo"> <span class="site-name can-hide">DC's blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="IT必备" class="dropdown-title"><a href="/IT/" class="link-title">IT必备</a> <span class="title" style="display:none;">IT必备</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/IT/basis/" class="nav-link">计算机基础</a></li><li class="dropdown-item"><!----> <a href="/IT/linux/" class="nav-link">linux基础</a></li><li class="dropdown-item"><!----> <a href="/IT/mysql/" class="nav-link">mysql</a></li><li class="dropdown-item"><!----> <a href="/IT/git/" class="nav-link">git</a></li><li class="dropdown-item"><!----> <a href="/IT/structure/" class="nav-link">数据结构与算法</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Python" class="dropdown-title"><a href="/python/" class="link-title">Python</a> <span class="title" style="display:none;">Python</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/python/basis/" class="nav-link">opp</a></li><li class="dropdown-item"><!----> <a href="/python/oop/" class="nav-link">oop</a></li><li class="dropdown-item"><!----> <a href="/python/Network_concurrency/" class="nav-link">网络并发编程</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><a href="/front_end/" class="link-title">前端</a> <span class="title" style="display:none;">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/front_end/html/" class="nav-link">html</a></li><li class="dropdown-item"><!----> <a href="/front_end/css/" class="nav-link">css</a></li><li class="dropdown-item"><!----> <a href="/front_end/js/" class="nav-link">javascript</a></li><li class="dropdown-item"><!----> <a href="/front_end/jquery/" class="nav-link">jquery</a></li><li class="dropdown-item"><!----> <a href="/front_end/ui/" class="nav-link">UI</a></li><li class="dropdown-item"><!----> <a href="/front_end/vue/" class="nav-link">vue</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="后端" class="dropdown-title"><a href="/python_web/" class="link-title">后端</a> <span class="title" style="display:none;">后端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/python_web/django/" class="nav-link">Django</a></li><li class="dropdown-item"><!----> <a href="/python_web/drf/" class="nav-link">drf</a></li><li class="dropdown-item"><!----> <a href="/python_web/drf_re/" class="nav-link">drf_re</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="实战" class="dropdown-title"><a href="/project/" class="link-title">实战</a> <span class="title" style="display:none;">实战</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>前后端不分离</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/project/bbs/" class="nav-link">BBS</a></li><li class="dropdown-subitem"><a href="/project/order/" class="nav-link">订单系统</a></li><li class="dropdown-subitem"><a href="/project/crm/" class="nav-link">CRM</a></li></ul></li><li class="dropdown-item"><h4>前后端分离</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/project/supply/" class="nav-link">供应链系统</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其他" class="dropdown-title"><a href="/other/" class="link-title">其他</a> <span class="title" style="display:none;">其他</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/other/essays/" class="nav-link">杂文</a></li><li class="dropdown-item"><h4>关于我</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/about/" class="nav-link">me</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><!----> <span class="title" style="display:;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/OnePieceDC/" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="/img/avatar.gif"> <div class="blogger-info"><h3>DC</h3> <span>愿我一生欢喜,不为世俗所及.</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="IT必备" class="dropdown-title"><a href="/IT/" class="link-title">IT必备</a> <span class="title" style="display:none;">IT必备</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/IT/basis/" class="nav-link">计算机基础</a></li><li class="dropdown-item"><!----> <a href="/IT/linux/" class="nav-link">linux基础</a></li><li class="dropdown-item"><!----> <a href="/IT/mysql/" class="nav-link">mysql</a></li><li class="dropdown-item"><!----> <a href="/IT/git/" class="nav-link">git</a></li><li class="dropdown-item"><!----> <a href="/IT/structure/" class="nav-link">数据结构与算法</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Python" class="dropdown-title"><a href="/python/" class="link-title">Python</a> <span class="title" style="display:none;">Python</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/python/basis/" class="nav-link">opp</a></li><li class="dropdown-item"><!----> <a href="/python/oop/" class="nav-link">oop</a></li><li class="dropdown-item"><!----> <a href="/python/Network_concurrency/" class="nav-link">网络并发编程</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><a href="/front_end/" class="link-title">前端</a> <span class="title" style="display:none;">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/front_end/html/" class="nav-link">html</a></li><li class="dropdown-item"><!----> <a href="/front_end/css/" class="nav-link">css</a></li><li class="dropdown-item"><!----> <a href="/front_end/js/" class="nav-link">javascript</a></li><li class="dropdown-item"><!----> <a href="/front_end/jquery/" class="nav-link">jquery</a></li><li class="dropdown-item"><!----> <a href="/front_end/ui/" class="nav-link">UI</a></li><li class="dropdown-item"><!----> <a href="/front_end/vue/" class="nav-link">vue</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="后端" class="dropdown-title"><a href="/python_web/" class="link-title">后端</a> <span class="title" style="display:none;">后端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/python_web/django/" class="nav-link">Django</a></li><li class="dropdown-item"><!----> <a href="/python_web/drf/" class="nav-link">drf</a></li><li class="dropdown-item"><!----> <a href="/python_web/drf_re/" class="nav-link">drf_re</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="实战" class="dropdown-title"><a href="/project/" class="link-title">实战</a> <span class="title" style="display:none;">实战</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>前后端不分离</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/project/bbs/" class="nav-link">BBS</a></li><li class="dropdown-subitem"><a href="/project/order/" class="nav-link">订单系统</a></li><li class="dropdown-subitem"><a href="/project/crm/" class="nav-link">CRM</a></li></ul></li><li class="dropdown-item"><h4>前后端分离</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/project/supply/" class="nav-link">供应链系统</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其他" class="dropdown-title"><a href="/other/" class="link-title">其他</a> <span class="title" style="display:none;">其他</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/other/essays/" class="nav-link">杂文</a></li><li class="dropdown-item"><h4>关于我</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/about/" class="nav-link">me</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><!----> <span class="title" style="display:;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/OnePieceDC/" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>python面向过程</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/7db416/" class="sidebar-link">Python语言介绍</a></li><li><a href="/pages/3beb21/" class="sidebar-link">基本运算符和流程控制</a></li><li><a href="/pages/e8386b/" class="sidebar-link">数据类型之序列</a></li><li><a href="/pages/49737b/" class="sidebar-link">数据类型之哈希</a></li><li><a href="/pages/17fb72/" class="sidebar-link">函数基础</a></li><li><a href="/pages/bd8ead/" aria-current="page" class="active sidebar-link">函数高级</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/pages/bd8ead/#变量的可见性与引用" class="sidebar-link">变量的可见性与引用</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/bd8ead/#命名空间与作用域" class="sidebar-link">命名空间与作用域</a></li><li class="sidebar-sub-header level5"><a href="/pages/bd8ead/#专业名词解释" class="sidebar-link">专业名词解释</a></li><li class="sidebar-sub-header level5"><a href="/pages/bd8ead/#结合官方文档分析" class="sidebar-link">结合官方文档分析</a></li><li class="sidebar-sub-header level5"><a href="/pages/bd8ead/#函数报错分析" class="sidebar-link">函数报错分析</a></li><li class="sidebar-sub-header level3"><a href="/pages/bd8ead/#四大案例实践" class="sidebar-link">四大案例实践</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/bd8ead/#闭包函数" class="sidebar-link">闭包函数</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/bd8ead/#函数代码执行过程" class="sidebar-link">函数代码执行过程!!</a></li><li class="sidebar-sub-header level3"><a href="/pages/bd8ead/#传统函数-vs-闭包" class="sidebar-link">传统函数 vs 闭包</a></li><li class="sidebar-sub-header level3"><a href="/pages/bd8ead/#闭包初探" class="sidebar-link">闭包初探</a></li><li class="sidebar-sub-header level5"><a href="/pages/bd8ead/#自由变量的存储" class="sidebar-link">自由变量的存储</a></li><li class="sidebar-sub-header level5"><a href="/pages/bd8ead/#id不同缘由" class="sidebar-link">id不同缘由</a></li><li class="sidebar-sub-header level3"><a href="/pages/bd8ead/#闭包陷阱" class="sidebar-link">闭包陷阱</a></li><li class="sidebar-sub-header level3"><a href="/pages/bd8ead/#nonlocal" class="sidebar-link">nonlocal</a></li><li class="sidebar-sub-header level3"><a href="/pages/bd8ead/#为函数体传值" class="sidebar-link">为函数体传值</a></li><li class="sidebar-sub-header level5"><a href="/pages/bd8ead/#参数形式" class="sidebar-link">参数形式</a></li><li class="sidebar-sub-header level5"><a href="/pages/bd8ead/#包给函数-惰性计算" class="sidebar-link">包给函数/惰性计算</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/bd8ead/#函数装饰器" class="sidebar-link">函数装饰器</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/bd8ead/#开放封闭原则" class="sidebar-link">开放封闭原则</a></li><li class="sidebar-sub-header level3"><a href="/pages/bd8ead/#无参装饰器" class="sidebar-link">无参装饰器</a></li><li class="sidebar-sub-header level3"><a href="/pages/bd8ead/#有参装饰器" class="sidebar-link">有参装饰器</a></li><li class="sidebar-sub-header level5"><a href="/pages/bd8ead/#计时程序" class="sidebar-link">计时程序</a></li><li class="sidebar-sub-header level5"><a href="/pages/bd8ead/#登录用户认证" class="sidebar-link">登录用户认证</a></li><li class="sidebar-sub-header level5"><a href="/pages/bd8ead/#将函数装到字典中" class="sidebar-link">将函数装到字典中</a></li><li class="sidebar-sub-header level3"><a href="/pages/bd8ead/#多个装饰器" class="sidebar-link">多个装饰器</a></li><li class="sidebar-sub-header level5"><a href="/pages/bd8ead/#被装饰函数定义阶段" class="sidebar-link">被装饰函数定义阶段</a></li><li class="sidebar-sub-header level5"><a href="/pages/bd8ead/#被装饰函数调用阶段" class="sidebar-link">被装饰函数调用阶段</a></li></ul></li></ul></li><li><a href="/pages/1654ca/" class="sidebar-link">函数进阶</a></li><li><a href="/pages/3134ef/" class="sidebar-link">文件处理</a></li><li><a href="/pages/41e853/" class="sidebar-link">必用模块</a></li><li><a href="/pages/fe6035/" class="sidebar-link">常用模块</a></li><li><a href="/pages/9cb17f/" class="sidebar-link">模块导入与包</a></li><li><a href="/pages/d4c919/" class="sidebar-link">开胃小菜</a></li><li><a href="/pages/d74f40/" class="sidebar-link">饶头训练</a></li><li><a href="/pages/a6e50e/" class="sidebar-link">小项目之ATM_shopping</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>python面向对象</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>网络并发编程</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-91157402><div class="articleInfo" data-v-91157402><ul class="breadcrumbs" data-v-91157402><li data-v-91157402><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-91157402></a></li> <li data-v-91157402><a href="/categories/?category=python_Need" title="分类" data-v-91157402>python_Need</a></li><li data-v-91157402><a href="/categories/?category=python%E9%9D%A2%E5%90%91%E8%BF%87%E7%A8%8B" title="分类" data-v-91157402>python面向过程</a></li></ul> <div class="info" data-v-91157402><div title="作者" class="author iconfont icon-touxiang" data-v-91157402><a href="https://github.com/OnePieceDC" target="_blank" title="作者" class="beLink" data-v-91157402>DC</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-91157402><a href="javascript:;" data-v-91157402>2023-10-26</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABGpJREFUSA3tVVtoXFUU3fvOI53UlmCaKIFmwEhsE7QK0ipFEdHEKpXaZGrp15SINsXUWvBDpBgQRKi0+KKoFeJHfZA+ED9KKoIU2gYD9UejTW4rVIzm0VSTziPzuNu1z507dibTTjL4U/DAzLn3nL3X2o91ziX6f9wMFdh6Jvbm9nNSV0msViVO6tN1Rm7NMu2OpeJ9lWBUTDxrJbYTS0hInuwciu9eLHlFxCLCZEk3MegsJmZ5K/JD6t7FkFdEvGUo1g7qJoG3MHImqRIn8/nzY1K9UPKKiJmtnUqHVE3Gbuay6vJE/N2FEmuxFjW2nUuE0yQXRRxLiTUAzs36zhZvOXJPdX850EVnnLZkB8prodQoM5JGj7Xk2mvC7JB8tG04Ef5PiXtG0UtxupRQSfTnBoCy554x18yJHI6I+G5Eru4LHmPJZEQsrvPUbMiA8G/WgMK7w7I+ez7++o2ANfbrjvaOl1tFMs+htG3IrZH9/hDX1Pr8Tc0UvH8tcX29KzAgIGcEkINyW5BF9x891hw6VYqgJHEk0huccS7vh3C6gTiODL+26huuBtbct8eZnqLML8PkxGYpuPZBqtqwkSjgc4mB5gbgig5i+y0UDK35LMxXisn9xQtK+nd26gTIHsHe/oblK/b29fUmN/8Y+9jAQrnBp56m1LcDlDp9irKTExSKduXJVWSqdBMA08pEJnEIOB3FPPMybu/oeV8zFeYN3xx576Q6RH+VmplE4ncQV5v+5rzSoyOU7PuEAg8g803PwBJ0CExno/jcMbN8tONYeOmHiuUNryvm3fRUy4tMPVLdAGkUhNWuggGrJcXPv+ouCjz0MKUHz1J2/E8IC9nqTabcxgaBYM0hPhD5Y65FsbxRQKxCQrDjDctW7PUM3HuZunFyifSAqEfuzCp48Il24luWUWZoyJCaPR82jE0+kFA643wRFVni4RYSq3ohJO2pZ7B5dO4xkDWbEpossJPLSrPjYID8rS2UHTlvyNxqIGsg674XJJ7vnh5L7PNwC4hh2sjCI96mzszOTpxLF0T7l88Yz7lAuK6OnL8gXLOnTvpzSb22YG8W7us3jSebFHeeqnXRG1vt+MoUM84LQIBmMsCTAcOauTh0T0l0neQK7m2bLMt2mGxU3HYssS0J2cdv5wljlPsrIuZLAG/2DOZIXgCYT8uMGZN+e2kSirfxZOPCsC0f24nTZzspnVn9VePS1Z5vubmAGGXG8ZFno9Hel0yfA5ZPhF7Dh972BQJ2qCpgH67lmWtBYbvk6sz02wjky2vXyz0XErP/kFB619js1BtwfOV4OPRqOQBjy3Qbk18vigUPPSD5ceHnwck7W9bhAqZdd7SuG7w4/P2F/GaJh8c7e9qgow+Q7cGBo+98WsLkuktFqiZabtXuQTu/Y5ETbR0v7tNSFnvrmu6pjdoan2KjMu8q/Hmj1EfCO2ZGfEIbIXKUlw8qaX9/b2oeSJmFksSeT/Fn0V3nSypChh4Gjh74ybO9aeZ/AN2dwciu2/MhAAAAAElFTkSuQmCC">函数高级<!----></h1> <!----> <div class="theme-vdoing-content content__default"><h2 id="变量的可见性与引用"><a href="#变量的可见性与引用" class="header-anchor">#</a> 变量的可见性与引用</h2> <blockquote><p>学到这里,我们再深层次的剖析下UnboundLocalError错误,在前文的阐述中有这么一段文字 <font color="gray"><em>&quot;到这一步a变量已经定性为一个局部变量啦,但是此a变量还未完成绑定&quot;</em></font>, 这涉及到python的 <font color="red"><strong>可见性与绑定</strong></font>.</p></blockquote> <p><strong>参考链接</strong>: <code>https://www.cnblogs.com/yssjun/p/9873689.html</code></p> <p>目标: 也就是我们想弄清楚, 满足什么条件变量名在局部命名空间中就是可见的..<br> <font color="gray">现阶段,不要纠结底层怎么实现可见性的,那是需要经过阅读源码进行分析的..饶过我吧...修行不够,看不懂源码.</font></p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    a <span class="token operator">+=</span> <span class="token number">4</span>    <span class="token comment"># -- UnboundLocalError:local variable 'a' referenced before assignment</span>
    <span class="token keyword">return</span> a

a <span class="token operator">=</span> <span class="token number">1</span>
func<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="命名空间与作用域"><a href="#命名空间与作用域" class="header-anchor">#</a> 命名空间与作用域</h3> <blockquote><p><font color="red"><strong>作用域即代码块!!</strong></font><br> <font color="gray"><strong>scope空间里的变量作用的范围就是所对应的代码块,这些变量在该代码块中是可见的</strong></font><br> <strong><font color="red">作用域关系LEGB/函数里引用变量的搜索路径/依次从LEGB作用域对应的scope中查找!</font></strong><br> <font color="gray"><strong>从嵌套的里层往外层查找</strong></font><br> <strong>作用域关系</strong> 查找顺序LEGB,所以跟 <strong>代码块的嵌套</strong> 有关, 查的是LEGB对应的scope,所以跟<strong>代码块的环境</strong>有关!</p></blockquote> <h5 id="专业名词解释"><a href="#专业名词解释" class="header-anchor">#</a> 专业名词解释</h5> <blockquote><p><strong>说明:</strong> python中的函数、类、模块都是代码块, 只不过在此处讨论的重点是函数的命名空间和作用域,所以特此声明下以下阐述中的代码块统统指函数..</p></blockquote> <p><strong><font color="green">code block</font></strong><br>
        我们可以对代码进行分块<font color="green">code block</font>.  举个例子,定义了一个&amp;NBSP;类,这个类里面又定义了函数B、函数C, 函数C里嵌套了函数D, 那么&amp;NBSP;是一个代码块,里面包含B、C两个代码块..C又包含D这个代码块.</p> <p><strong><font color="green">scope</font></strong><br>
        程序开始运行后, python解释器会从上到下执行代码,执行到某个代码块时,会为其一对一分配命名空间<font color="green">scope</font> (是真实的内存空间) , 用于存放代码块里面 <strong>绑定</strong> 的变量名(变量名与对象之间的关系)..<br>
需要注意的是, 代码块看起来是嵌套的(A包含B和C,B包含D),但代码块对应的scope是相互独立的..</p> <p><strong><font color="green">block’s environment</font></strong><br>
        该code block中所有scope中可见的name的集合构成block的环境 称作该代码块的环境.</p> <p><strong><font color="green">local variable,global variable</font></strong><br>
        scope命名空间也有很多分类,我们接触最多的是全局命名空间和局部命名空间.<br>
        整个py模块/执行文件以及py执行文件里使用 <code>import</code>  语句加载的任何模块都会对应一个全局命名空间...<br>
        一个个code block代码块对应的是一个个的局部命名空间..<br> <font color="gray">代码块 ----- 局部命名空间 ; import加载的模块、py文件 ------ 全局命名空间 </font><br>
   &amp;nbsfp;    在全局scope和局部scope之中定义的变量分别叫做 <font color="green">local variable</font>局部变量和 <font color="green">global variable</font>全局变量..
        查阅资料时,经常会看到,<font color="gray">&quot;在全局作用域里定义的变量叫做全局变量..&quot;</font>说的是全局、局部<font color="green">作用域</font>而不是全局、局部scope命名空间.. 这些说法都没毛病..
        我们这样想就想通了, <strong>作用域与命名空间依托于/作用于同一块代码块,这个代码块中的绑定操作中的变量归命名空间管;这个代码块中的引用变量归作用域管,按照作用域关系LEGB的规则在scope中调用被引用的变量..</strong><br> <font color="blue">作用域是代码块静态的体现,scope命名空间是代码块动态的体现</font></p> <p><strong><font color="green">Free variable</font></strong><br> <font color="green">Free variable</font>是一个比较重要的概念, 闭包那里会详细阐述, 这里简单提一嘴, 在闭包中引用的父函数中的局部变量是一个自由变量,而且该自由变量被存放在一个cell对象中..</p> <p><strong><font color="green">bind name</font></strong><br>
        scope用于存放code block里定义的变量,具体来说,将某一个对象与变量进行绑定,并将这绑定关系存放在命名空间中. code block中的哪些代码在执行时需要进行 <font color="green">bind name</font> 绑定操作呢？<br>
1&gt; 函数的形参a、b	<code>def func(a,b):pass</code><br>
2&gt; py文件中的import  <code>import numpy</code><br>
3&gt; 直接赋值的操作 <code>a = 1</code><br>
4&gt; for 循环 中的 i   <code>for i in range(10):pass</code><br>
5&gt; 异常处理except后的名字、文件处理 <code>with open(..) as f</code> as后面的f 等</p> <table><thead><tr><th>名词</th> <th>解释</th></tr></thead> <tbody><tr><td>代码块 code block</td> <td>作为一个单元(Unit)被执行的一段python程序文本.eg: 一个模块、函数体和类的定义等</td></tr> <tr><td>命名空间 scope</td> <td>将block代码块中的变量bind绑定到该block对应的命名空间中</td></tr> <tr><td>局部变量<br>local variable</td> <td>在一个block中被绑定(eg 函数中)的变量</td></tr> <tr><td>全局变量<br>global variable</td> <td>在一个module中被绑定(eg py模块)的变量</td></tr> <tr><td>自由变量<br>free variable</td> <td>在某个block中被引用,但没有在该代码块中被定义的变量</td></tr></tbody></table> <h5 id="结合官方文档分析"><a href="#结合官方文档分析" class="header-anchor">#</a> 结合官方文档分析</h5> <p><strong>代码块环境</strong><br> <font color="lightblue"><em>&quot;The set of all such scopes visible to a code block is called the block’s environment.&quot;</em></font></p> <p><strong>LEGB</strong><br> <font color="lightblue"><em>&quot;When a name is used in a code block, it is resolved using the nearest enclosing scope&quot;</em></font><br>
        这段话告诉我们当一个name被引用时,它会在其最近的scope中寻找被引用name的定义</p> <p><strong>变量的可见性</strong><br> <font color="lightblue"><em>&quot;The local variables of a code block can be determined by <strong>scanning</strong> the entire <strong>text</strong> of the block for name binding operations.&quot;</em></font><br>
        代码块(eg 函数里的代码)开始执行啦,解释器会为其分配内存空间scope. 但在真正执行之前会先扫瞄函数体里的代码,若存在绑定操作的代码,对象绑定的变量在scope空间便具有了可见性...该变量就定性成了局部变量; 扫描完后,开始真正执行,完成绑定操作..变量便可以被引用.</p> <p><strong>自由变量</strong><br> <font color="lightblue">&quot;If a variable is used in a code block but not defined there, it is a <em>free variable</em>.&quot;</font><br> <font color="blue">注意: 函数嵌套,A函数包含B函数..A执行时会扫描B函数的代码,有两点,其一B函数里绑定操作的变量不会存入A的scope中.其二扫描时会记录B中未在B里定义却引用A中可见的变量..当A执行完释放,这些局部变量就成了自由变量,但这些自由变量能否被B成功引用取决于这些自由变量是否完成绑定..</font></p> <p><strong>Python在作用域里对变量的赋值操作规则</strong><br> <font color="gray">若这个变量在该作用域里不存在, 则将这次赋值视为对这个变量的定义..若存在,则对其绑定新的对象; </font><br>
        假设代码块(一个函数)在真正执行之前,扫描到函数中依次有两个直接赋值的操作 <code>a = 1</code> 和 <code>a=&quot;Hello&quot;</code> , a变量便具有了可变性,只要其中有一个操作完成了执行,a变量就完成了定义/绑定,就可以被引用.. 若对a变量被多次执行赋值操作,a变量就会经历绑定新的对象的过程..</p> <p><strong>UnboundLocalError报错</strong><br> <font color="lightblue"><em>&quot;If the name refers to a local variable that has not been bound, a <code>UnboundLocalError</code> exception is raised. &quot;</em></font><br>
若引用的变量是 <strong>局部变量</strong> (代码块中的变量) ,但还未完成绑定,就会报错 <code>UnboundLocalError</code> ..<br> <strong>注意</strong> 引用的是局部变量!! 自由变量跟局部变量是两个不同的概念!!</p> <h5 id="函数报错分析"><a href="#函数报错分析" class="header-anchor">#</a> 函数报错分析</h5> <p><font color="red">★ <strong>排错思路</strong> : 先扫描,根据绑定操作定性局部变量; 引用变量时根据LEGB规则查找.若引用的局部变量只有可见性..UnboundLocalError</font></p> <p>1&gt; Python中要想引用一个name, 该name必须要可见而且是完成绑定了的!<br>
2&gt; 但凡执行的代码块里有绑定操作,绑定的变量在所在代码块对应的scope就具有可见性<br>
     具备可见性的变量将会被定性为局部变量.绑定操作真正执行后,可见性变量晋升为可被引用的变量.<br>
      (不管代码块里绑定操作的代码是否会执行,因为对代码块中代码的扫描会发生在代码块真正执行之前)<br>
3&gt; 若引用了某个变量,此变量在各个作用域里都找不到(LEGB),就会报错 <code>NameError</code> ;<br>
     若引用的变量是 <strong>局部变量</strong> ,但还未完成绑定,就会报错 <code>UnboundLocalError</code> ..<br>
4&gt; 若这个变量在该作用域(函数)里不存在, 则将这次赋值视为对这个变量的定义.. 若存在,则对其绑定新的对象;</p> <p><img src="/assets/img/variable_error.4a276883.png" alt=""></p> <h3 id="四大案例实践"><a href="#四大案例实践" class="header-anchor">#</a> 四大案例实践</h3> <p>▲ 案例一分析</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token triple-quoted-string string">&quot;&quot;&quot;分析
在outer_func中我们定义了变量loc_var,因为赋值是一种绑定操作,因此loc_var具有可见性,并且完成了绑定,可以被引用. 但根据报错,在outer_func中定义的函数inner_func并不能引用变量loc_var.. 这就让人很疑惑.
这报错结果与代码块的环境block’s environment的概念相矛盾了.因为block’s environment告诉我们函数中的scope是可以扩展到其内定义的所有scope中的.也就意味着outer_func函数中的loc_var变量是可以被inner_func函数所引用的..	问题出在哪里呢？继续往下看.

当我们执行clo_func()后,inner_func函数的函数体代码开始执行,先扫描,扫描到了loc_var += &quot; in inner func&quot;这个赋值/绑定操作,inner_func函数中的loc_var变量便具有了可见性.扫描完毕后开始真正执行代码.
该赋值操作可以换个写法 loc_var = loc_var + &quot; in inner func&quot;
&quot;=&quot;号右边的loc_var变量会先被引用,根据变量的引用规则(LEGB),会先在loc_var变量所在的inner_func函数对应的scope查找loc_var,发现在此scope中,loc_var是可见的,所以不会使用outer_func中定义的loc_var..
但此scope中loc_var变量还没有完成绑定就被引用啦,所以报错UnboundLocalError!!
&quot;&quot;&quot;</span>
<span class="token keyword">def</span> <span class="token function">outer_func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    loc_var <span class="token operator">=</span> <span class="token string">&quot;local variable&quot;</span>  <span class="token comment"># -- inner_func中没有引用此处的loc_var</span>

    <span class="token keyword">def</span> <span class="token function">inner_func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 该行报错 --UnboundLocalError:local variable 'loc_var' referenced before assignment</span>
        loc_var <span class="token operator">+=</span> <span class="token string">&quot; in inner func&quot;</span>	

        <span class="token keyword">return</span> loc_var

    <span class="token keyword">return</span> inner_func


clo_func <span class="token operator">=</span> outer_func<span class="token punctuation">(</span><span class="token punctuation">)</span>
clo_func<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p>▲ 案例二分析</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token triple-quoted-string string">&quot;&quot;&quot;分析
flag为False `sel_res = 'Do select name = %s' % name`赋值语句不会执行
is_format为true 在执行`return sel_res if is_format else name`语句时会引用sel_res变量

因为get_select_desc执行之前会扫描代码块代码,绑定操作中的sel_res变量就具有了可见性;
但在return语句中引用了还未完成绑定的局部变量sel_res,所以报错UnboundLocalError..
&quot;&quot;&quot;</span>
<span class="token keyword">def</span> <span class="token function">get_select_desc</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> flag<span class="token punctuation">,</span> is_format<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> flag<span class="token punctuation">:</span>
        sel_res <span class="token operator">=</span> <span class="token string">'Do select name = %s'</span> <span class="token operator">%</span> name
    <span class="token comment"># -- UnboundLocalError: local variable 'sel_res' referenced before assignment</span>
    <span class="token keyword">return</span> sel_res <span class="token keyword">if</span> is_format <span class="token keyword">else</span> name


get_select_desc<span class="token punctuation">(</span><span class="token string">'Error'</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>▲ 案例三分析</p> <p>此案例主要是针对free variable的引用</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token triple-quoted-string string">&quot;&quot;&quot;
在创建闭包inner_func时,loc_var1和loc_var2作为父函数outer_func中的两个local variable.具有可见性.
返回闭包函数inner_func之后,执行该闭包函数,可以发现在闭包中引用了outer_func中的local variable.
被引用的local variable被称为一个free variable.
但是闭包中的free variable可不可以被引用取决于它们有没有被绑定到具体的对象,引用有两个前提--可见+执行绑定.
&quot;&quot;&quot;</span>
<span class="token keyword">def</span> <span class="token function">outer_func</span><span class="token punctuation">(</span>out_flag<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># -- outer_func中的局部变量loc_var1和loc_var2若被inner_func引用,</span>
    <span class="token comment">#    则被引用的局部变量称为free variable自由变量</span>
    <span class="token keyword">if</span> out_flag<span class="token punctuation">:</span> <span class="token comment"># True</span>
        loc_var1 <span class="token operator">=</span> <span class="token string">'local variable with flag'</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        loc_var2 <span class="token operator">=</span> <span class="token string">'local variable without flag'</span>

    <span class="token keyword">def</span> <span class="token function">inner_func</span><span class="token punctuation">(</span>in_flag<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># -- NameError:</span>
        <span class="token comment">#    free variable 'loc_var2' referenced before assignment in enclosing scope</span>
        <span class="token comment"># loc_var1可以被引用,loc_var2因为没有完成绑定所以不能被引用！</span>
        <span class="token keyword">return</span> loc_var1 <span class="token keyword">if</span> in_flag <span class="token keyword">else</span> loc_var2

    <span class="token keyword">return</span> inner_func


clo_func <span class="token operator">=</span> outer_func<span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>clo_func<span class="token punctuation">(</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p>▲ 案例四分析</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token triple-quoted-string string">&quot;&quot;&quot;
代码从上往下执行,sys先是全局变量
add_path函数准备执行,先扫描,发现了绑定操作import sys,sys被定性为了局部变量
add_path函数真正开始执行, path_list = sys.path 引用了还未完成绑定的局部变量sys
&quot;&quot;&quot;</span>
<span class="token keyword">import</span> sys

<span class="token keyword">def</span> <span class="token function">add_path</span><span class="token punctuation">(</span>new_path<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># UnboundLocalError:local variable 'sys' referenced before assignment</span>
    path_list <span class="token operator">=</span> sys<span class="token punctuation">.</span>path

    <span class="token keyword">if</span> new_path <span class="token keyword">not</span> <span class="token keyword">in</span> path_list<span class="token punctuation">:</span>
        <span class="token keyword">import</span> sys
        sys<span class="token punctuation">.</span>path<span class="token punctuation">.</span>append<span class="token punctuation">(</span>new_path<span class="token punctuation">)</span>

add_path<span class="token punctuation">(</span><span class="token string">'./'</span><span class="token punctuation">)</span>


<span class="token comment"># --- --- --- 同理 简化版本</span>
i <span class="token operator">=</span> <span class="token number">10</span>

<span class="token keyword">def</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># UnboundLocalError:local variable 'i' referenced before assignment</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>

func<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><hr> <h2 id="闭包函数"><a href="#闭包函数" class="header-anchor">#</a> 闭包函数</h2> <h3 id="函数代码执行过程"><a href="#函数代码执行过程" class="header-anchor">#</a> 函数代码执行过程!!</h3> <blockquote><p><font color="gray">参考链接: <code>https://www.cnblogs.com/traditional/p/13544103.html</code></font><br> <code>https://www.icode9.com/content-1-1334531.html</code></p></blockquote> <p><strong>PyCodeObject</strong>:<br>
        代码对象, 是一段代码编译后形成的对象. 在函数中对应的就是函数体的代码编译结果. <font color="brown">静态的</font><br> <strong>PyFunctionObject</strong>:<br>
        函数对象, 它是对PyCodeObject的封装. 相当于<code>PyCodeObject + 函数def</code>定义这一行代码.<br>
        在PyCodeObject基础上增加了函数的名称、所属模块、参数默认值、globals、builtins.<br> <strong>PyFrameObject</strong>:<br>
        函数执行时对应的栈帧, 它用于承载PyFunctionObject在执行时所需要的动态信息. <font color="brown">动态的</font><br>
        包括函数的实参、函数执行时所需的栈、全局变量、局部变量、当前执行到的指令的编号.</p> <p><img src="/assets/img/function_execution_principle.f2dd4072.png" alt=""></p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment"># -- 虚拟机从上到下执行字节码</span>
name <span class="token operator">=</span> <span class="token string">&quot;夏色祭&quot;</span>
age <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span>

<span class="token comment"># pia, 出现了一个def,来到了一个新的代码块,会对应创建一个新的PyCodeObject对象</span>
<span class="token comment"># 接着会将PyCodeObject对象封装成PyFunctionObject</span>
<span class="token comment"># 当执行完def语句之后,一个函数就被创建了,放在当前的local空间中</span>
<span class="token comment"># 注意:PyFunctionObject在执行到函数定义指令MAKE_FUNCTION时生成,生成后是静态不变的.</span>
<span class="token comment"># 也就是说,一个函数一旦定义,其函数名参数默认值、函数绑定的globals和builtins信息(都是封装的内容)不再变化.</span>
<span class="token keyword">def</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">pass</span>

<span class="token comment"># 函数的类型是&lt;class 'function'&gt;, 当然这个类Python没有暴露给我们</span>
<span class="token comment"># 当我们调用函数foo的时候, 会从local空间中取出符号&quot;foo&quot;对应的PyFunctionObject对象</span>
<span class="token comment"># 然后根据这个PyFunctionObject对象创建PyFrameObject对象, 也就是为函数创建一个栈帧 (命名空间)</span>
<span class="token comment"># 然后将执行权交给新创建的栈帧, 在新创建的栈帧中执行字节码</span>
<span class="token comment"># PyFrameObject是动态可变的，其包含两层含义:</span>
<span class="token comment">#	1&gt;对同一个函数的每一次调用,都会生成一个新的PyFrameObject;</span>
<span class="token comment"># 2&gt;每个PyFrameObject在其生命周期内是不断发生变化的,PyFrameObject承载着函数执行时所需要的所有动态信息.</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">locals</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># {......, 'foo': &lt;function foo at 0x000001B299FAF3A0&gt;}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><hr> <h3 id="传统函数-vs-闭包"><a href="#传统函数-vs-闭包" class="header-anchor">#</a> 传统函数 vs 闭包</h3> <blockquote><p>不严谨的解释( <strong>最</strong> 常见的闭包): 函数嵌套, 内部函数引用了外部函数的参数或变量, 并将这个内部函数返回. 返回的内部函数就称为闭包函数!</p> <p><strong>&quot;闭&quot;代表函数是内部的,&quot;包&quot;代表函数外’包裹’着对外层作用域的引用..</strong><br> <strong>因而无论在何处调用闭包函数,使用的仍然是包裹在其外层的变量!</strong></p></blockquote> <p>闭包不是传统意义上定义的函数,我们所认识的函数大概是这样的:</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token number">1</span><span class="token operator">&gt;</span> 程序被加载到内存执行时<span class="token punctuation">,</span>函数定义的代码被存放在代码段中
<span class="token number">2</span><span class="token operator">&gt;</span> 函数被调用时<span class="token punctuation">,</span>会在栈上创建其执行环境<span class="token punctuation">,</span>初始化其中定义的变量和外部传入的形参 <span class="token operator">-</span><span class="token operator">-</span> scope 栈区
<span class="token number">3</span><span class="token operator">&gt;</span> 当函数执行完成并返回函数结果后 <span class="token operator">-</span><span class="token operator">-</span> <span class="token keyword">return</span>
	 函数栈帧便会被销毁掉<span class="token punctuation">,</span>函数中的临时变量以及存储的中间计算结果都不会保留 <span class="token operator">-</span><span class="token operator">-</span> 内存回收
<span class="token number">4</span><span class="token operator">&gt;</span> 下次调用时唯一发生变化的就是函数传入的形参可能会不一样<span class="token punctuation">,</span>函数栈帧会重新初始化函数的执行环境
<span class="token keyword">def</span> <span class="token function">func</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">:</span>
  	b <span class="token operator">=</span> <span class="token number">1</span>
    <span class="token keyword">return</span> a<span class="token operator">+</span>b

func<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>维基百科中对闭包的解释:<br> <font color="gray">&quot;一个函数定义中引用了函数外定义的变量, 该函数可以在其定义环境外被执行.&quot;</font><br>
        俺斗胆举个栗子辅助分析下,<font color="blue">A嵌套B. B引用A的局部变量, <strong>在A的生命周期结束后</strong>, 该变量才称作自由变量,内部函数B才称作闭包函数; B函数 <strong>可以</strong> 在外部函数A之外运行.</font></p> <p>成为闭包函数的 <font color="green">两个前提条件</font>:<br>
          1&gt; 函数嵌套;     2&gt; 内部函数引用外部函数( <font color="gray">E 内嵌作用域</font> )中的参数或变量..<br>
成为闭包函数的 <font color="green">必要触发条件</font>:<br>
          外部函数执行完成,生命周期结束..内部函数才可称为闭包函数.<br>
成为闭包函数的 <font color="green">不必要条件</font>:<br>
          一旦外部函数将内部函数作为函数结果返回..闭包函数就可以在外部函数之外运行</p> <h3 id="闭包初探"><a href="#闭包初探" class="header-anchor">#</a> 闭包初探</h3> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment"># -- demo.py</span>
<span class="token keyword">def</span> <span class="token function">outer_func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    my_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

    <span class="token keyword">def</span> <span class="token function">inner_func</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">:</span>
        my_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>my_list<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'%s my_list = %s'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>name<span class="token punctuation">,</span> my_list<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> inner_func


closure_1 <span class="token operator">=</span> outer_func<span class="token punctuation">(</span><span class="token punctuation">)</span>
closure_1<span class="token punctuation">(</span><span class="token string">'cls1_instance_1'</span><span class="token punctuation">)</span>  <span class="token comment"># -- cls1_instance_1 my_list = [1]</span>
closure_1<span class="token punctuation">(</span><span class="token string">'cls1_instance_2'</span><span class="token punctuation">)</span>  <span class="token comment"># -- cls1_instance_2 my_list = [1, 2]</span>
closure_1<span class="token punctuation">(</span><span class="token string">'cls1_instance_3'</span><span class="token punctuation">)</span>  <span class="token comment"># -- cls1_instance_3 my_list = [1, 2, 3]</span>
closure_2 <span class="token operator">=</span> outer_func<span class="token punctuation">(</span><span class="token punctuation">)</span>
closure_2<span class="token punctuation">(</span><span class="token string">'cls2_instance_1'</span><span class="token punctuation">)</span>  <span class="token comment"># -- cls2_instance_1 my_list = [1]</span>
closure_1<span class="token punctuation">(</span><span class="token string">'cls1_instance_4'</span><span class="token punctuation">)</span>  <span class="token comment"># -- cls1_instance_4 my_list = [1, 2, 3, 4]</span>
closure_2<span class="token punctuation">(</span><span class="token string">'cls2_instance_2'</span><span class="token punctuation">)</span>  <span class="token comment"># -- cls2_instance_2 my_list = [1, 2]</span>

<span class="token triple-quoted-string string">&quot;&quot;&quot;
调用两次outer_func,分别return返回了closure_1和closure_2两个闭包函数.
闭包函数跟普通函数的调用没啥区别,可以对闭包函数多次调用.
1&gt; 观察闭包函数closure_1的多次调用,my_list在变化:
   对同一个闭包函数多次调用,每次调用对其自由变量的修改会被传递到下一次的调用.(有点默认参数那味)
2&gt; 可以观察闭包函数closure_1的调用和闭包函数closure_2的调用,并不会互相干扰.
   闭包中引用的自由变量只和具体的闭包有关联.
&quot;&quot;&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><p>函数开始执行,会先扫描函数体的代码,包括内部函数inner_func的代码,记录inner_func中的引用变量.<br> <font color="gray">记录的引用变量应满足两点,其一,在inner_func里未定义,其二,在outer_func中是可见的.</font>
当outer_func函数结束,inner_func从内部函数进化成为闭包函数.. my_list从局部变量变为自由变量.<br> <font color="gray">闭包中引用的父函数中的局部变量是一个自由变量, 自由变量存到inner_func的cell对象中</font></p> <h5 id="自由变量的存储"><a href="#自由变量的存储" class="header-anchor">#</a> 自由变量的存储</h5> <p><font size="5">Q: </font>函数inner如何存储变量var呢?<br> <font size="5">A: </font><font color="brown"><code>inner.__code__.co_freevars</code></font> 记录了自由变量的名字<br>
在函数编译过程中内部函数会有一个闭包的特殊属性<font color="brown"><code>__closure__</code></font>, 若内部函数中不包含对外部函数变量的引用,<code>__closure__</code>属性是不存在的, 该属性记录了自由变量的值,它是一个由cell对象组成的元组</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code>g_var <span class="token operator">=</span> <span class="token number">1</span>


<span class="token keyword">def</span> <span class="token function">outer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    e_var_x <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    e_var_y <span class="token operator">=</span> <span class="token number">6</span>

    <span class="token keyword">def</span> <span class="token function">inner</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        e_var_x<span class="token punctuation">.</span>append<span class="token punctuation">(</span>g_var <span class="token operator">+</span> e_var_y<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>e_var_x<span class="token punctuation">,</span> e_var_y<span class="token punctuation">)</span>

    <span class="token keyword">return</span> inner


a <span class="token operator">=</span> outer<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># ('e_var_x', 'e_var_y') -- inner引用了全局变量g_var,但g_var不算作自由变量!</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>__code__<span class="token punctuation">.</span>co_freevars<span class="token punctuation">)</span>
<span class="token comment"># (&lt;cell at 0x7fe0a0e7cac0: list object at 0x7fe0a0e8b940&gt;, &lt;cell at 0x7fe0a0e7c6a0: int object at 0x100aceb60&gt;)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>__closure__<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>__closure__<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>cell_contents<span class="token punctuation">)</span>  <span class="token comment"># [] -- 此时闭包还没运行,自由变量的值最初状态</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>__closure__<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>cell_contents<span class="token punctuation">)</span>  <span class="token comment"># 6</span>
a<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># [7] 6</span>
g_var <span class="token operator">=</span> <span class="token number">8</span>
a<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># [7, 14] 6 -- 同一个闭包函数多次运行,对自由变量的修改会传递 [7]-&gt;[7, 14]</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>__closure__<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>cell_contents<span class="token punctuation">)</span>  <span class="token comment"># [7,14]</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>__closure__<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>cell_contents<span class="token punctuation">)</span>  <span class="token comment"># 6</span>
g_var <span class="token operator">=</span> <span class="token number">11</span>
b <span class="token operator">=</span> outer<span class="token punctuation">(</span><span class="token punctuation">)</span>
b<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># [17] 6 -- 闭包a、b引用的自由变量互不干扰</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><h5 id="id不同缘由"><a href="#id不同缘由" class="header-anchor">#</a> id不同缘由</h5> <p><strong>补充:</strong> 请解释下面的id相同与不同的缘由.. <font color="gray">这个问题纠结了我一天!!!(∩_∩) 堆区水太深,道行太浅,勿涉</font></p> <div class="language-python line-numbers-mode"><pre class="language-python"><code>`Two objects <span class="token keyword">with</span> non<span class="token operator">-</span>overlapping lifetimes may have the same <span class="token builtin">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span> value<span class="token punctuation">.</span>`
两个生存周期不相交的不同对象<span class="token punctuation">,</span>可能有一个地址<span class="token punctuation">.</span>
判断对象相同与否用<span class="token keyword">is</span><span class="token punctuation">,</span>不要用<span class="token builtin">id</span>去比较<span class="token punctuation">,</span><span class="token keyword">is</span>由于不能被重载<span class="token punctuation">,</span>因此不用查哈希表<span class="token punctuation">,</span>会更快一些!!!
<span class="token triple-quoted-string string">&quot;&quot;&quot;
1&gt; 每次执行def语句,都会生成一个不同的PyFunctionObjec对象
   每次调用执行函数,都会生成一个不同的PyFrameObjec对象,也就是命名空间
2&gt; outer函数执行完后,命名空间里的变量名会与具体的对象断开连接 释放命名空间 
   若堆区的对象引用计数为0,会进行gc回收
   也就是说,outer函数执行完,inner函数/变量名与PyFunctionObject断开连接了

`print(id(a), id(b))` 值相同
   返回了PyFunctionObject对象并赋值给了某个全局变量
   So,堆区中的PyFunctionObject对象得以保存,引用计数为1,不会被gc回收
   调用执行两次outer函数,在outer函数的函数体里执行了两次相同的def语句
   def语句相同,但都会生成一个不同的PyFunctionObjec对象
	 
`print(id(outer()), id(outer()))` 值不同
   你会发现,这里同样调用执行了两次outer函数,在outer函数的函数体里执行了两次相同的def语句
   为啥id相同呢？因为第一次的PyFunctionObjec对象的引用计数为0,优化机制,第二次的def直接拿来用
&quot;&quot;&quot;</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">id</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">id</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 140650857597392 140650857597248</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">id</span><span class="token punctuation">(</span>outer<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">id</span><span class="token punctuation">(</span>outer<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 140650857596672 140650857596672</span>


<span class="token comment"># -- 举个简单例子辅助理解 模拟`def inner`生成PyFunctionObjec对象</span>
<span class="token keyword">def</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">pass</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">id</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 140402907130320</span>
<span class="token keyword">del</span> func
<span class="token keyword">def</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">pass</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">id</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 140402907130320</span>


<span class="token keyword">def</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">pass</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">id</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 140690837776848</span>
temp <span class="token operator">=</span> func			 <span class="token comment"># !!!!!!</span>
<span class="token keyword">del</span> func
<span class="token keyword">def</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">pass</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">id</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 140690837776704</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br></div></div><h3 id="闭包陷阱"><a href="#闭包陷阱" class="header-anchor">#</a> 闭包陷阱</h3> <blockquote><p><font color="brown">返回闭包中不要引用任何循环变量, 或者后续会发生变化的变量 </font><br>
因为在返回闭包前,闭包中引用的父函数中定义变量的值可能会发生不是我们期望的变化</p></blockquote> <p><font color="brown">自由变量的名称解析发生于运行时而不是编译时</font></p> <div class="language-python line-numbers-mode"><pre class="language-python"><code>i <span class="token operator">=</span> <span class="token number">10</span>
<span class="token keyword">def</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
i <span class="token operator">=</span> <span class="token number">42</span>
f<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>程序的结果并不是我们想象的结果0,1,4. 实际结果全部是4. 为啥？</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token triple-quoted-string string">&quot;&quot;&quot;
在函数outer返回前其内部定义的函数并不是闭包函数,只是一个内部定义的函数
这个内部函数引用的父函数中定义的变量也不是自由变量,而只是当前block中的一个local variable
在返回闭包列表clo_list之前for循环的变量的值已经发生改变了,而且这个改变会影响到所有引用它的内部定义的函数
函数outer一旦返回,其内部定义的函数inner便是一个闭包,其中引用的变量i成为一个只和具体闭包相关的自由变量..
&quot;&quot;&quot;</span>
<span class="token keyword">def</span> <span class="token function">outer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    clo_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># -- 等同于inner = lambda : i * i</span>
        <span class="token keyword">def</span> <span class="token function">inner</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> i <span class="token operator">*</span> i
        clo_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>inner<span class="token punctuation">)</span>
    <span class="token keyword">return</span> clo_list

clo1<span class="token punctuation">,</span> clo2<span class="token punctuation">,</span> clo3 <span class="token operator">=</span> outer<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>clo1<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 4</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>clo2<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 4</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>clo3<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 4</span>


<span class="token comment"># -- 该代码与上面的分析逻辑是一样的</span>
<span class="token keyword">def</span> <span class="token function">outer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    clo_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    m <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">def</span> <span class="token function">inner</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> m <span class="token operator">*</span> m
        clo_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>inner<span class="token punctuation">)</span>
    m <span class="token operator">=</span> <span class="token number">3</span>
    <span class="token keyword">return</span> clo_list

clo1<span class="token punctuation">,</span> clo2<span class="token punctuation">,</span> clo3 <span class="token operator">=</span> outer<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>clo1<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>clo2<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>clo3<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># 9 9 9</span>

<span class="token comment"># -- 正解</span>
<span class="token comment">#    outer结束,自由变量i会作为一个cell对象存储在inner函数的__closure__属性里</span>
<span class="token comment">#    不使用自由变量即可,使用默认参数解决 默认形参保存了当前的i值,在对应闭包中以局部变量体现</span>
<span class="token keyword">def</span> <span class="token function">outer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    clo_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># -- 添加一个默认函数,其值设置为每次循环的i值</span>
        <span class="token comment">#    对形参的不同赋值会保留在当前函数定义中,不会对其他函数有影响</span>
				inner <span class="token operator">=</span> <span class="token keyword">lambda</span> _i <span class="token operator">=</span> i <span class="token punctuation">:</span> _i <span class="token operator">*</span> _i
        clo_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>inner<span class="token punctuation">)</span>
    <span class="token keyword">return</span> clo_list
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br></div></div><h3 id="nonlocal"><a href="#nonlocal" class="header-anchor">#</a> nonlocal</h3> <blockquote><p>nonlocal关键字 实现在对自由变量的引用同时,修改自由变量</p></blockquote> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment"># -- 计算平均值</span>
<span class="token keyword">def</span> <span class="token function">make_averager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    total <span class="token operator">=</span> <span class="token number">0</span>  <span class="token comment"># -- 元素值总计</span>
    count <span class="token operator">=</span> <span class="token number">0</span>  <span class="token comment"># -- 共多少元素参与</span>

    <span class="token triple-quoted-string string">&quot;&quot;&quot;
    `nonlocal count, total`语句,指明averager中使用的count和total变量是在引用make_averager中的变量          
     count = count + 1 右侧引用内嵌作用域的count,左侧对内嵌作用域中的count重新赋值(绑定对象)
     这样的话有效的避免了UnboundLocalError报错
     当make_averager返回后,count和total变量就变成了自由变量!
     注意前面案例里提到过的一点:同一个闭包函数的多次调用可以将自由变量的修改进行传递!
  	 
  	 自由变量若是可变类型,eg:列表 闭包函数可以通过append等内置函数修改
     若自由变量是不可变类型
        eg:数字 闭包函数使用赋值语句来改变 相当于在闭包函数内部创建个同名的局部变量,就不会使用自由变量啦、  
        nonlocal关键字可以 实现在对自由变量的引用同时,修改自由变量
  	&quot;&quot;&quot;</span>
    <span class="token keyword">def</span> <span class="token function">averager</span><span class="token punctuation">(</span>new_value<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">nonlocal</span> count<span class="token punctuation">,</span> total
        count <span class="token operator">+=</span> <span class="token number">1</span>
        total <span class="token operator">+=</span> new_value
        <span class="token keyword">return</span> total <span class="token operator">/</span> count

    <span class="token keyword">return</span> averager


avg <span class="token operator">=</span> make_averager<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>avg<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;---:&gt; &quot;</span><span class="token punctuation">,</span> avg<span class="token punctuation">.</span>__closure__<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>cell_contents<span class="token punctuation">,</span> avg<span class="token punctuation">.</span>__closure__<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>cell_contents<span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>avg<span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;---:&gt; &quot;</span><span class="token punctuation">,</span> avg<span class="token punctuation">.</span>__closure__<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>cell_contents<span class="token punctuation">,</span> avg<span class="token punctuation">.</span>__closure__<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>cell_contents<span class="token punctuation">)</span>

<span class="token triple-quoted-string string">&quot;&quot;&quot;
10.0
---:&gt; 1 10
10.5
---:&gt; 2 21
&quot;&quot;&quot;</span>

<span class="token comment"># --- --- ---</span>

<span class="token keyword">def</span> <span class="token function">outer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    x <span class="token operator">=</span> <span class="token number">5</span>
    <span class="token keyword">def</span> <span class="token function">inner</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">nonlocal</span> x
        x <span class="token operator">+=</span> <span class="token number">1</span>
        <span class="token keyword">return</span> x 
    <span class="token keyword">return</span> inner<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># -- 返回的是一个确定的值,不是函数!!</span>

a <span class="token operator">=</span> outer<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>    <span class="token comment"># 6</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>    <span class="token comment"># 6</span>
b <span class="token operator">=</span> outer<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span>    <span class="token comment"># 6</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span>    <span class="token comment"># 6</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br></div></div><h3 id="为函数体传值"><a href="#为函数体传值" class="header-anchor">#</a> 为函数体传值</h3> <h5 id="参数形式"><a href="#参数形式" class="header-anchor">#</a> 参数形式</h5> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> requests

<span class="token triple-quoted-string string">&quot;&quot;&quot;
★ --使用参数的形式
&quot;&quot;&quot;</span>
<span class="token keyword">def</span> <span class="token function">get</span><span class="token punctuation">(</span>url<span class="token operator">=</span><span class="token string">'https://www.baidu.com/'</span><span class="token punctuation">)</span><span class="token punctuation">:</span> 
  	res <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span>
    <span class="token keyword">if</span> res<span class="token punctuation">.</span>status_code <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">:</span>
      	<span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>text<span class="token punctuation">)</span>
  

<span class="token comment"># -- 多次调用,每次都写url很麻烦</span>
get<span class="token punctuation">(</span><span class="token string">'https://www.python.org'</span><span class="token punctuation">)</span> 
get<span class="token punctuation">(</span><span class="token string">'https://www.python.org'</span><span class="token punctuation">)</span> 
<span class="token comment"># -- 默认参数应用场景:绝大多数情况下都是这个值</span>
get<span class="token punctuation">(</span><span class="token punctuation">)</span>
get<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h5 id="包给函数-惰性计算"><a href="#包给函数-惰性计算" class="header-anchor">#</a> 包给函数/惰性计算</h5> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token triple-quoted-string string">&quot;&quot;&quot;
★ --包给函数 应用领域:延迟计算
&quot;&quot;&quot;</span>
<span class="token keyword">def</span> <span class="token function">outer</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">:</span>
		<span class="token keyword">def</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    		res <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span>
    		<span class="token keyword">if</span> res<span class="token punctuation">.</span>status_code <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">:</span>
      			<span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>text<span class="token punctuation">)</span>
    <span class="token keyword">return</span> get

baidu <span class="token operator">=</span> outer<span class="token punctuation">(</span><span class="token string">'https://www.baidu.com/'</span><span class="token punctuation">)</span>  <span class="token comment"># -- 将指定的url地址包给了函数</span>
python <span class="token operator">=</span> outer<span class="token punctuation">(</span><span class="token string">'https://www.python.org'</span><span class="token punctuation">)</span>

baidu<span class="token punctuation">(</span><span class="token punctuation">)</span>
baidu<span class="token punctuation">(</span><span class="token punctuation">)</span>
python<span class="token punctuation">(</span><span class="token punctuation">)</span>
python<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><hr> <h2 id="函数装饰器"><a href="#函数装饰器" class="header-anchor">#</a> 函数装饰器</h2> <blockquote><p>装饰器是用来为被装饰对象添加额外功能的工具/函数<br> <strong>装饰器和被装饰者都可以是任意可调用的对象.</strong></p></blockquote> <h3 id="开放封闭原则"><a href="#开放封闭原则" class="header-anchor">#</a> 开放封闭原则</h3> <p>软件的维护应该遵循 <font color="red"><strong>开放封闭</strong></font> 原则！即软件一旦上线之后对修改源代码是封闭的,对扩展功能是开放的.<br>
因而装饰器的实现必须遵循两大原则: (在遵循1和2的前提下为被装饰对象添加新功能)<br>
     1.不修改被装饰对象的源代码<br>
     2.不修改被装饰对象的调用方式</p> <p>需求: 给index函数加上统计运行时间的功能..</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> time

<span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'welcome to index!'</span><span class="token punctuation">)</span>
    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>

<span class="token triple-quoted-string string">&quot;&quot;&quot;
★ --方案一: 改变了源代码
&quot;&quot;&quot;</span>
<span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    start <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'welcome to index!'</span><span class="token punctuation">)</span>
    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
    stop <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'run time is </span><span class="token interpolation"><span class="token punctuation">{</span>stop<span class="token operator">-</span>start<span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>
index<span class="token punctuation">(</span><span class="token punctuation">)</span>


<span class="token triple-quoted-string string">&quot;&quot;&quot;
★ --方案二: 不具备通用性,给其他函数添加此功能会重复写代码
&quot;&quot;&quot;</span>
<span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'welcome to index!'</span><span class="token punctuation">)</span>
    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
start <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
index<span class="token punctuation">(</span><span class="token punctuation">)</span>
stop <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'run time is </span><span class="token interpolation"><span class="token punctuation">{</span>stop<span class="token operator">-</span>start<span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>


<span class="token triple-quoted-string string">&quot;&quot;&quot;
★ --方案三: 解决了重复写,但改变了被装饰对象的调用方式
&quot;&quot;&quot;</span>
<span class="token keyword">def</span> <span class="token function">timmer</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span><span class="token punctuation">:</span>
    start <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
    func<span class="token punctuation">(</span><span class="token punctuation">)</span>
    stop <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'run time is </span><span class="token interpolation"><span class="token punctuation">{</span>stop<span class="token operator">-</span>start<span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>
timmer<span class="token punctuation">(</span>index<span class="token punctuation">)</span>

<span class="token triple-quoted-string string">&quot;&quot;&quot;
★ --方案四: 使用装饰器
&quot;&quot;&quot;</span>
<span class="token keyword">def</span> <span class="token function">timmer</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">wrapper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        start <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
        func<span class="token punctuation">(</span><span class="token punctuation">)</span>
        stop <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'run time is </span><span class="token interpolation"><span class="token punctuation">{</span>stop<span class="token operator">-</span>start<span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> wrapper

index <span class="token operator">=</span> timmer<span class="token punctuation">(</span>index<span class="token punctuation">)</span>  <span class="token comment"># -- index = wrapper</span>
index<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br></div></div><h3 id="无参装饰器"><a href="#无参装饰器" class="header-anchor">#</a> 无参装饰器</h3> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> functools
<span class="token keyword">def</span> <span class="token function">dec</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token decorator annotation punctuation">@functools<span class="token punctuation">.</span>wraps</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span>  <span class="token comment"># -- 保留被装饰函数的文档和函数名属性</span>
    <span class="token keyword">def</span> <span class="token function">wrapper</span><span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span><span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># -- *args,**kwargs 接收传给被装饰函数的实参</span>
        <span class="token keyword">return</span> func<span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span><span class="token operator">**</span>kwargs<span class="token punctuation">)</span>  <span class="token comment"># -- 注意哦,不写return 返回的是None</span>
    <span class="token comment"># wrapper.__doc__ = func.__doc__</span>
    <span class="token comment"># wrapper.__name__ = func.__name__</span>
    <span class="token keyword">return</span> wrapper

<span class="token triple-quoted-string string">&quot;&quot;&quot;
@dec 等同于 func = dec(func)
dec(func) -- wrapper	So,func = wrapper 
&quot;&quot;&quot;</span>
<span class="token decorator annotation punctuation">@dec</span>
<span class="token keyword">def</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token keyword">pass</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h3 id="有参装饰器"><a href="#有参装饰器" class="header-anchor">#</a> 有参装饰器</h3> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> functools
<span class="token keyword">def</span> <span class="token function">func_name</span><span class="token punctuation">(</span>param1<span class="token punctuation">,</span>param2<span class="token punctuation">)</span>
    <span class="token keyword">def</span> <span class="token function">dec</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token decorator annotation punctuation">@functools<span class="token punctuation">.</span>wraps</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span>
        <span class="token keyword">def</span> <span class="token function">wrapper</span><span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span><span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token comment"># -- param1、param2、func都是wrapper函数的自由变量!</span>
            res <span class="token operator">=</span> func<span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span><span class="token operator">**</span>kwargs<span class="token punctuation">)</span>
            <span class="token keyword">return</span> res
        <span class="token keyword">return</span> wrapper
    <span class="token keyword">return</span> dec

<span class="token triple-quoted-string string">&quot;&quot;&quot;
在handler函数定义完后,开始执行@func_name(&quot;&quot;,&quot;&quot;) 
@func_name(&quot;&quot;,&quot;&quot;)等同于执行语句 handler = func_name(&quot;&quot;,&quot;&quot;)(handler) 
func_name(&quot;&quot;,&quot;&quot;)(handler) -- deco(handler) -- wrapper
So,handler = wrapper

handler()语句调用执行时,是在调用wrapper()
是这么回事:一开始`def handler`生成的PyFunctionObject对象,
         也与闭包函数wrapper的自由变量func进行了绑定
         然后将闭包函数wrapper的内存地址传递给全局变量handler,进行了覆盖
&quot;&quot;&quot;</span>
<span class="token decorator annotation punctuation">@func_name</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span> 
<span class="token keyword">def</span> <span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token keyword">pass</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><h5 id="计时程序"><a href="#计时程序" class="header-anchor">#</a> 计时程序</h5> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> time


<span class="token keyword">def</span> <span class="token function">timing</span><span class="token punctuation">(</span>status<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">dec</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">def</span> <span class="token function">wrapper</span><span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
            start <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
            res <span class="token operator">=</span> func<span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;[</span><span class="token interpolation"><span class="token punctuation">{</span>status<span class="token punctuation">}</span></span><span class="token string">] use time:</span><span class="token interpolation"><span class="token punctuation">{</span>time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> start<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> res
        <span class="token keyword">return</span> wrapper
    <span class="token keyword">return</span> dec

<span class="token comment"># -- 训练</span>
<span class="token decorator annotation punctuation">@timing</span><span class="token punctuation">(</span><span class="token string">'train'</span><span class="token punctuation">)</span> 
<span class="token keyword">def</span> <span class="token function">training</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>

<span class="token comment"># -- c测试</span>
<span class="token decorator annotation punctuation">@timing</span><span class="token punctuation">(</span><span class="token string">'test'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">testing</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>

training<span class="token punctuation">(</span><span class="token punctuation">)</span>
testing<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><h5 id="登录用户认证"><a href="#登录用户认证" class="header-anchor">#</a> 登录用户认证</h5> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> time 


current_user <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'user'</span><span class="token punctuation">:</span><span class="token boolean">None</span><span class="token punctuation">}</span>   <span class="token comment"># -- 当前登录用户</span>

<span class="token keyword">def</span> <span class="token function">auth</span><span class="token punctuation">(</span>way<span class="token operator">=</span><span class="token string">'file'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">dec</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">def</span> <span class="token function">wrapper</span><span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span><span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> current_user<span class="token punctuation">[</span><span class="token string">'user'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                <span class="token keyword">return</span> func<span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span><span class="token operator">**</span>kwargs<span class="token punctuation">)</span>
            user <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">'请输入用户名&gt;&gt;:'</span><span class="token punctuation">)</span>
            pwd <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">'请输入密码&gt;&gt;:'</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> way <span class="token operator">==</span> <span class="token string">&quot;file&quot;</span><span class="token punctuation">:</span>  <span class="token comment"># -- 基于文件的验证</span>
                <span class="token keyword">if</span> user <span class="token operator">==</span> <span class="token string">'egon'</span> <span class="token keyword">and</span> pwd <span class="token operator">==</span> <span class="token string">'123'</span><span class="token punctuation">:</span>  <span class="token comment"># -- 模拟从文件中取数据</span>
                    current_user<span class="token punctuation">[</span><span class="token string">'user'</span><span class="token punctuation">]</span> <span class="token operator">=</span> user
                    <span class="token keyword">return</span> func<span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span><span class="token operator">**</span>kwargs<span class="token punctuation">)</span>
                <span class="token keyword">else</span><span class="token punctuation">:</span>
                    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;login fail&quot;</span><span class="token punctuation">)</span>
            <span class="token keyword">elif</span> way <span class="token operator">==</span> <span class="token string">&quot;ldap&quot;</span><span class="token punctuation">:</span>
                <span class="token keyword">pass</span> <span class="token comment"># -- 基于ldap的认证</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'无法识别验证来源'</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> wrapper 
    <span class="token keyword">return</span> dec


<span class="token decorator annotation punctuation">@auth</span><span class="token punctuation">(</span><span class="token string">'file'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;welcome to index&quot;</span></span><span class="token punctuation">)</span>
    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

<span class="token decorator annotation punctuation">@auth</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">home</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;welcome home,</span><span class="token interpolation"><span class="token punctuation">{</span>name<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">)</span>

index<span class="token punctuation">(</span><span class="token punctuation">)</span>
home<span class="token punctuation">(</span><span class="token string">'dc'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>index<span class="token punctuation">.</span>__code__<span class="token punctuation">.</span>co_freevars<span class="token punctuation">)</span>  <span class="token comment"># ('func', 'way')</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br></div></div><h5 id="将函数装到字典中"><a href="#将函数装到字典中" class="header-anchor">#</a> 将函数装到字典中</h5> <blockquote><p>灵活使用语法糖@</p></blockquote> <div class="language-python line-numbers-mode"><pre class="language-python"><code>func_dic <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token keyword">def</span> <span class="token function">make_route</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">:</span>

    <span class="token keyword">def</span> <span class="token function">dec</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># -- 通常是要再嵌套一层 def wrapper(*args,**kwargs)用于被装饰函数的运行以及加额外功能</span>
        <span class="token comment"># -- 但这里不需要被装饰函数的运行.. 但需要将函数名对应的pyfunctionobject装在字典中</span>
        func_dic<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> func
        <span class="token keyword">return</span> func  <span class="token comment"># -- 添加后,就不会影响被装饰函数原来的运行啦</span>
                     <span class="token comment">#    若不写这行语句 全局变量f1 = None</span>
    <span class="token keyword">return</span> dec

<span class="token decorator annotation punctuation">@make_route</span><span class="token punctuation">(</span><span class="token string">'select'</span><span class="token punctuation">)</span>    <span class="token comment"># -- f1 = dec(f1) dec内部执行语句func_dic['select'] = f1</span>
<span class="token keyword">def</span> <span class="token function">f1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'This is select func.'</span><span class="token punctuation">)</span>

<span class="token decorator annotation punctuation">@make_route</span><span class="token punctuation">(</span><span class="token string">'update'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">f2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'This is update func.'</span><span class="token punctuation">)</span>

<span class="token comment"># {'select': &lt;function f1 at 0x7fe14c72d9d0&gt;, 'update': &lt;function f2 at 0x7fe14c72db80&gt;}</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>func_dic<span class="token punctuation">)</span> 
func_dic<span class="token punctuation">[</span><span class="token string">'update'</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># This is update func. -- 可通过字典调用函数</span>
f2<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># This is update func. -- 原函数的调用没有影响</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><h3 id="多个装饰器"><a href="#多个装饰器" class="header-anchor">#</a> 多个装饰器</h3> <blockquote><p>多个@语法糖<br>
被装饰函数定义阶段, 从下到上调用装饰器函数<br>
被装饰函数调用阶段, 从上到下执行装饰器里的闭包函数 (特别要注意 fun是啥!! <strong>fun是下一次要调用的闭包函数对象,若接下来没有闭包函数调用了,就是fun定义时生成的PyFunctionObject对象！</strong>)</p></blockquote> <p>实验验证证明上方的结论!!!  <font color="gray">鲁迅先生说过,实践是检验真理的唯一办法.</font></p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> functools
<span class="token keyword">import</span> time

<span class="token keyword">def</span> <span class="token function">timing</span><span class="token punctuation">(</span>status<span class="token operator">=</span><span class="token string">'train'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'this is timing'</span><span class="token punctuation">)</span>                   <span class="token comment"># -- 0</span>
    <span class="token keyword">def</span> <span class="token function">dec3</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'this is dec3 in timing'</span><span class="token punctuation">)</span>       <span class="token comment"># -- 1</span>
        <span class="token decorator annotation punctuation">@functools<span class="token punctuation">.</span>wraps</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span>
        <span class="token keyword">def</span> <span class="token function">wrapper3</span><span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span><span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
            start <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
            res <span class="token operator">=</span> func<span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span><span class="token operator">**</span>kwargs<span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'[%s] time: %.3f s '</span><span class="token operator">%</span><span class="token punctuation">(</span>status<span class="token punctuation">,</span>time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span>start<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment"># -- 6</span>
            <span class="token keyword">return</span> res
        <span class="token keyword">return</span> wrapper3
    <span class="token keyword">return</span> dec3


<span class="token keyword">def</span> <span class="token function">dec1</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'this is dec1'</span><span class="token punctuation">)</span>                     <span class="token comment"># -- 3</span>
    <span class="token decorator annotation punctuation">@functools<span class="token punctuation">.</span>wraps</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span>
    <span class="token keyword">def</span> <span class="token function">wrapper1</span><span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span><span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'The wrapper in dec1'</span><span class="token punctuation">)</span>          <span class="token comment"># -- 4</span>
        <span class="token keyword">return</span> func<span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span><span class="token operator">**</span>kwargs<span class="token punctuation">)</span>
    <span class="token keyword">return</span> wrapper1


<span class="token keyword">def</span> <span class="token function">dec2</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'this is dec2'</span><span class="token punctuation">)</span>                     <span class="token comment"># -- 2</span>
    <span class="token decorator annotation punctuation">@functools<span class="token punctuation">.</span>wraps</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span>
    <span class="token keyword">def</span> <span class="token function">wrapper2</span><span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span><span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'The wrapper in dec2'</span><span class="token punctuation">)</span>          <span class="token comment"># -- 5</span>
        <span class="token keyword">return</span> func<span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span><span class="token operator">**</span>kwargs<span class="token punctuation">)</span>
    <span class="token keyword">return</span> wrapper2
  
<span class="token decorator annotation punctuation">@dec1</span>
<span class="token decorator annotation punctuation">@dec2</span>
<span class="token decorator annotation punctuation">@timing</span><span class="token punctuation">(</span>status<span class="token operator">=</span><span class="token string">'test'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">fun</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token keyword">pass</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br></div></div><p><img src="/assets/img/many_decorator.df05258e.png" alt=""></p> <h5 id="被装饰函数定义阶段"><a href="#被装饰函数定义阶段" class="header-anchor">#</a> 被装饰函数定义阶段</h5> <p>注意三个装饰器的形参都是func!<br>
第一步执行<code>timing('Test')(fun)</code><br>
        该语句里的func就是<code>def fun</code> 定义时全局变量fun绑定的PyFunctionObject对象;
第一步执行完后返回闭包函数wrapper3, wrapper3作为第二步装饰器函数dec2调用时的形参.<br>
同理,第二步执行完后返回的闭包函数wrapper2作为第三步装饰器函数dec1调用时的形参.<br>
第三步完成后,返回了闭包函数wrapper1.. 赋值给了全局变量fun (全局变量fun重新进行了绑定!)</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment"># -- fun = dec1(dec2(timing('Test')(fun)))  先运行里层括号的内容</span>
<span class="token comment">#    类似于 str(3+1) '4'  会将括号里的内容先进行运算,将结果作为实参传给str函数的行参</span>
<span class="token comment">#    根据结果,dec1(dec2(timing('Test')(fun)))从里到外/从下到上依次调用执行了dec3、dec2、dec1装饰器</span>
<span class="token comment">#    返回的结果依次为wrapper3、wrapper2、wrapper1</span>
<span class="token comment">#    全局命名空间里的fun变量被覆盖了,重新指向了闭包函数wrapper1的内存地址</span>
<span class="token decorator annotation punctuation">@dec1</span>
<span class="token decorator annotation punctuation">@dec2</span>
<span class="token decorator annotation punctuation">@timing</span><span class="token punctuation">(</span>status<span class="token operator">=</span><span class="token string">'test'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">fun</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>

<span class="token triple-quoted-string string">&quot;&quot;&quot;
this is timing
this is dec3 in timing
this is dec2
this is dec1
&quot;&quot;&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h5 id="被装饰函数调用阶段"><a href="#被装饰函数调用阶段" class="header-anchor">#</a> 被装饰函数调用阶段</h5> <p>调用时,要注意!! <font color="brown">在最外层(全局作用域里),<code>fun=wrapper1</code> ; 在<code>wrapper1</code>的作用域内 <code>fun=wrapper2</code> ;  在<code>wrapper2</code>的作用域内<code>fun=wrapper3</code></font></p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token decorator annotation punctuation">@dec1</span>
<span class="token decorator annotation punctuation">@dec2</span>
<span class="token decorator annotation punctuation">@timing</span><span class="token punctuation">(</span>status<span class="token operator">=</span><span class="token string">'test'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">fun</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>

<span class="token comment"># -- 实验结果能充分表明</span>
<span class="token comment">#    先执行的闭包函数wrapper1,里面遇到func()时,实则调用的是闭包函数wrapper2..以此类推.</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;--- 我是分隔符 ---&quot;</span><span class="token punctuation">)</span>
fun<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token triple-quoted-string string">&quot;&quot;&quot;
this is timing
this is dec3 in timing
this is dec2
this is dec1
--- 我是分隔符 ---
The wrapper in dec1
The wrapper in dec2
[test] time: 2.001 s 
&quot;&quot;&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><hr></div></div> <!----> <div class="page-edit"><!----> <!----> <!----></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/17fb72/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">函数基础</div></a> <a href="/pages/1654ca/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">函数进阶</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/17fb72/" class="prev">函数基础</a></span> <span class="next"><a href="/pages/1654ca/">函数进阶</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/pages/8sk2b3/"><div>
            搜索相关
            <!----></div></a> <span class="date">03-22</span></dt></dl><dl><dd>02</dd> <dt><a href="/pages/2kn2p2/"><div>
            CURD
            <!----></div></a> <span class="date">03-20</span></dt></dl><dl><dd>03</dd> <dt><a href="/pages/1kn1m1/"><div>
            自动生成
            <!----></div></a> <span class="date">03-15</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="https://github.com/OnePieceDC" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://www.cnblogs.com/DC0307/" title="博客园" target="_blank" class="iconfont icon-bokeyuan"></a><a href="https://music.163.com/#/song?id=1854188649" title="听音乐" target="_blank" class="iconfont icon-erji"></a><a href="https://www.jianshu.com/u/5310eb537315" title="简书" target="_blank" class="iconfont icon-jianshu"></a><a href="mailto:1415806497@qq.com" title="QQ" target="_blank" class="iconfont icon-youjian"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2023-2024
    <span>DC | One Piece</span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <div class="body-bg" style="background:url() center center / cover no-repeat;opacity:0.5;"></div> <!----> <!----></div><div class="global-ui"><!----><div id="goTop" class="hide-cat" data-v-8ccb5928></div><div></div><canvas id="vuepress-canvas-cursor"></canvas><div></div><div></div></div></div>
    <script src="/assets/js/app.ac54adc6.js" defer></script><script src="/assets/js/4.7ddc74e3.js" defer></script><script src="/assets/js/1.a0c4ff1b.js" defer></script><script src="/assets/js/3.8b03321d.js" defer></script><script src="/assets/js/90.630f62d3.js" defer></script><script src="/assets/js/104.cae2d944.js" defer></script><script src="/assets/js/184.46eabf07.js" defer></script>
  </body>
</html>
