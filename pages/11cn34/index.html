<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>博客练习 | DC&#39;s blog</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="icon" href="/img/favicon.ico">
    <link rel="stylesheet" href="/fonts/iconfont.css">
    <meta name="description" content="人类终将毁灭,世界属于三体!">
    <meta name="keywords" content="DC的个人博客.">
    
    <link rel="preload" href="/assets/css/0.styles.66b92039.css" as="style"><link rel="preload" href="/assets/js/app.ac54adc6.js" as="script"><link rel="preload" href="/assets/js/4.7ddc74e3.js" as="script"><link rel="preload" href="/assets/js/1.a0c4ff1b.js" as="script"><link rel="preload" href="/assets/js/3.8b03321d.js" as="script"><link rel="preload" href="/assets/js/38.637afaf8.js" as="script"><link rel="preload" href="/assets/js/104.cae2d944.js" as="script"><link rel="preload" href="/assets/js/184.46eabf07.js" as="script"><link rel="prefetch" href="/assets/js/10.a91ae011.js"><link rel="prefetch" href="/assets/js/100.2e8ea472.js"><link rel="prefetch" href="/assets/js/101.46f57a02.js"><link rel="prefetch" href="/assets/js/102.f51bcd80.js"><link rel="prefetch" href="/assets/js/103.3f003e0e.js"><link rel="prefetch" href="/assets/js/105.6c6ebc28.js"><link rel="prefetch" href="/assets/js/106.47dc8889.js"><link rel="prefetch" href="/assets/js/107.6b5602b4.js"><link rel="prefetch" href="/assets/js/108.46f0c21d.js"><link rel="prefetch" href="/assets/js/109.0f1168a5.js"><link rel="prefetch" href="/assets/js/11.e6a94228.js"><link rel="prefetch" href="/assets/js/110.6a961498.js"><link rel="prefetch" href="/assets/js/111.c6f27c88.js"><link rel="prefetch" href="/assets/js/112.9ee3d3bb.js"><link rel="prefetch" href="/assets/js/113.82b72aa0.js"><link rel="prefetch" href="/assets/js/114.7487460e.js"><link rel="prefetch" href="/assets/js/115.cd079d0a.js"><link rel="prefetch" href="/assets/js/116.b6b829eb.js"><link rel="prefetch" href="/assets/js/117.89d9336c.js"><link rel="prefetch" href="/assets/js/118.467c4437.js"><link rel="prefetch" href="/assets/js/119.c4b2ac40.js"><link rel="prefetch" href="/assets/js/12.9d3501e4.js"><link rel="prefetch" href="/assets/js/120.5ff31c09.js"><link rel="prefetch" href="/assets/js/121.2e59c3a5.js"><link rel="prefetch" href="/assets/js/122.a66096cf.js"><link rel="prefetch" href="/assets/js/123.4885ba5f.js"><link rel="prefetch" href="/assets/js/124.cacc66be.js"><link rel="prefetch" href="/assets/js/125.dc5b30fe.js"><link rel="prefetch" href="/assets/js/126.4e21eb5e.js"><link rel="prefetch" href="/assets/js/127.cb36a9bf.js"><link rel="prefetch" href="/assets/js/128.ce38358e.js"><link rel="prefetch" href="/assets/js/129.e5f414eb.js"><link rel="prefetch" href="/assets/js/13.ca017a68.js"><link rel="prefetch" href="/assets/js/130.17b597f0.js"><link rel="prefetch" href="/assets/js/131.e1ded2dc.js"><link rel="prefetch" href="/assets/js/132.aae1c627.js"><link rel="prefetch" href="/assets/js/133.73cecdb3.js"><link rel="prefetch" href="/assets/js/134.80cf38a0.js"><link rel="prefetch" href="/assets/js/135.735ed588.js"><link rel="prefetch" href="/assets/js/136.91f8db08.js"><link rel="prefetch" href="/assets/js/137.d6fb8bda.js"><link rel="prefetch" href="/assets/js/138.75cafe73.js"><link rel="prefetch" href="/assets/js/139.b01bf0db.js"><link rel="prefetch" href="/assets/js/14.ee2605b5.js"><link rel="prefetch" href="/assets/js/140.ff0a7911.js"><link rel="prefetch" href="/assets/js/141.c69e7f54.js"><link rel="prefetch" href="/assets/js/142.997b03ac.js"><link rel="prefetch" href="/assets/js/143.e40faea8.js"><link rel="prefetch" href="/assets/js/144.369f23e5.js"><link rel="prefetch" href="/assets/js/145.1268424d.js"><link rel="prefetch" href="/assets/js/146.94c65c4a.js"><link rel="prefetch" href="/assets/js/147.05fe6a36.js"><link rel="prefetch" href="/assets/js/148.327cc29d.js"><link rel="prefetch" href="/assets/js/149.90068676.js"><link rel="prefetch" href="/assets/js/15.42e0a0e4.js"><link rel="prefetch" href="/assets/js/150.b4b780bb.js"><link rel="prefetch" href="/assets/js/151.b4611012.js"><link rel="prefetch" href="/assets/js/152.4d2c8246.js"><link rel="prefetch" href="/assets/js/153.f32dfa58.js"><link rel="prefetch" href="/assets/js/154.b79a78fb.js"><link rel="prefetch" href="/assets/js/155.6ad2865c.js"><link rel="prefetch" href="/assets/js/156.fd49a1af.js"><link rel="prefetch" href="/assets/js/157.55113800.js"><link rel="prefetch" href="/assets/js/158.af321bc9.js"><link rel="prefetch" href="/assets/js/159.37d9c659.js"><link rel="prefetch" href="/assets/js/16.007f45b3.js"><link rel="prefetch" href="/assets/js/160.7a3b5a9a.js"><link rel="prefetch" href="/assets/js/161.fc1fbea8.js"><link rel="prefetch" href="/assets/js/162.2f8d3d1c.js"><link rel="prefetch" href="/assets/js/163.aa889940.js"><link rel="prefetch" href="/assets/js/164.5d8b2cb7.js"><link rel="prefetch" href="/assets/js/165.44d4a9b5.js"><link rel="prefetch" href="/assets/js/166.c1b4c4d4.js"><link rel="prefetch" href="/assets/js/167.0c39929e.js"><link rel="prefetch" href="/assets/js/168.fede035a.js"><link rel="prefetch" href="/assets/js/169.ff940d50.js"><link rel="prefetch" href="/assets/js/17.7395c644.js"><link rel="prefetch" href="/assets/js/170.b6fcb3bf.js"><link rel="prefetch" href="/assets/js/171.2b927a7c.js"><link rel="prefetch" href="/assets/js/172.b07a90a1.js"><link rel="prefetch" href="/assets/js/173.367352bf.js"><link rel="prefetch" href="/assets/js/174.4ea4e20f.js"><link rel="prefetch" href="/assets/js/175.d9679b61.js"><link rel="prefetch" href="/assets/js/176.f7804143.js"><link rel="prefetch" href="/assets/js/177.c5d1e680.js"><link rel="prefetch" href="/assets/js/178.808293fa.js"><link rel="prefetch" href="/assets/js/179.2acf6b3c.js"><link rel="prefetch" href="/assets/js/18.46f9153d.js"><link rel="prefetch" href="/assets/js/180.ddf3ecf7.js"><link rel="prefetch" href="/assets/js/181.4da0855c.js"><link rel="prefetch" href="/assets/js/182.591d135a.js"><link rel="prefetch" href="/assets/js/183.9d08f9fe.js"><link rel="prefetch" href="/assets/js/185.ee1c8428.js"><link rel="prefetch" href="/assets/js/186.c7b19133.js"><link rel="prefetch" href="/assets/js/187.52945990.js"><link rel="prefetch" href="/assets/js/188.a1d395c5.js"><link rel="prefetch" href="/assets/js/189.5b66165e.js"><link rel="prefetch" href="/assets/js/19.2db19edb.js"><link rel="prefetch" href="/assets/js/190.265a75de.js"><link rel="prefetch" href="/assets/js/191.b4c65143.js"><link rel="prefetch" href="/assets/js/192.cc4d4115.js"><link rel="prefetch" href="/assets/js/193.fa02ecc5.js"><link rel="prefetch" href="/assets/js/194.b0c9ad53.js"><link rel="prefetch" href="/assets/js/195.eda8cd34.js"><link rel="prefetch" href="/assets/js/196.cbae4dc6.js"><link rel="prefetch" href="/assets/js/197.693b1b85.js"><link rel="prefetch" href="/assets/js/198.8213665b.js"><link rel="prefetch" href="/assets/js/199.ddf0036d.js"><link rel="prefetch" href="/assets/js/2.4c15b693.js"><link rel="prefetch" href="/assets/js/20.6742e8ae.js"><link rel="prefetch" href="/assets/js/200.340df508.js"><link rel="prefetch" href="/assets/js/201.7431c15b.js"><link rel="prefetch" href="/assets/js/202.217b2b38.js"><link rel="prefetch" href="/assets/js/203.06c6a93d.js"><link rel="prefetch" href="/assets/js/204.a068a898.js"><link rel="prefetch" href="/assets/js/205.9361d3f5.js"><link rel="prefetch" href="/assets/js/206.886beca0.js"><link rel="prefetch" href="/assets/js/207.2278bda8.js"><link rel="prefetch" href="/assets/js/208.db0acc0d.js"><link rel="prefetch" href="/assets/js/209.0e05b204.js"><link rel="prefetch" href="/assets/js/21.fd552a4e.js"><link rel="prefetch" href="/assets/js/210.4c730041.js"><link rel="prefetch" href="/assets/js/211.417dbee1.js"><link rel="prefetch" href="/assets/js/212.eef4f4a3.js"><link rel="prefetch" href="/assets/js/213.ab742b0b.js"><link rel="prefetch" href="/assets/js/214.a57228de.js"><link rel="prefetch" href="/assets/js/215.37f52459.js"><link rel="prefetch" href="/assets/js/216.2f110f92.js"><link rel="prefetch" href="/assets/js/217.09654311.js"><link rel="prefetch" href="/assets/js/218.a7568950.js"><link rel="prefetch" href="/assets/js/219.628ee193.js"><link rel="prefetch" href="/assets/js/22.465a76d2.js"><link rel="prefetch" href="/assets/js/220.c5df9186.js"><link rel="prefetch" href="/assets/js/221.101ddb09.js"><link rel="prefetch" href="/assets/js/222.db210e3c.js"><link rel="prefetch" href="/assets/js/223.429cbf14.js"><link rel="prefetch" href="/assets/js/224.aa002868.js"><link rel="prefetch" href="/assets/js/225.79a40017.js"><link rel="prefetch" href="/assets/js/226.3e08228b.js"><link rel="prefetch" href="/assets/js/227.a09dd4b4.js"><link rel="prefetch" href="/assets/js/228.f930c492.js"><link rel="prefetch" href="/assets/js/229.f639a9e4.js"><link rel="prefetch" href="/assets/js/23.df6831af.js"><link rel="prefetch" href="/assets/js/230.e8ac7aad.js"><link rel="prefetch" href="/assets/js/231.99501214.js"><link rel="prefetch" href="/assets/js/232.e2932792.js"><link rel="prefetch" href="/assets/js/233.43dfa689.js"><link rel="prefetch" href="/assets/js/234.7951f9c4.js"><link rel="prefetch" href="/assets/js/235.1dc96b6c.js"><link rel="prefetch" href="/assets/js/236.40b8d4e4.js"><link rel="prefetch" href="/assets/js/237.75a692de.js"><link rel="prefetch" href="/assets/js/238.cc9d9ac1.js"><link rel="prefetch" href="/assets/js/239.4616a566.js"><link rel="prefetch" href="/assets/js/24.b68dc734.js"><link rel="prefetch" href="/assets/js/240.dd825147.js"><link rel="prefetch" href="/assets/js/241.85e3219b.js"><link rel="prefetch" href="/assets/js/242.bf4123c4.js"><link rel="prefetch" href="/assets/js/243.ce68f4f0.js"><link rel="prefetch" href="/assets/js/244.e2598d4d.js"><link rel="prefetch" href="/assets/js/245.2c696827.js"><link rel="prefetch" href="/assets/js/246.2c44a497.js"><link rel="prefetch" href="/assets/js/247.02405fce.js"><link rel="prefetch" href="/assets/js/248.6727bdf6.js"><link rel="prefetch" href="/assets/js/249.4901f575.js"><link rel="prefetch" href="/assets/js/25.d639c65c.js"><link rel="prefetch" href="/assets/js/250.c922c9ea.js"><link rel="prefetch" href="/assets/js/251.b1350ead.js"><link rel="prefetch" href="/assets/js/252.8295c5ea.js"><link rel="prefetch" href="/assets/js/253.b0a9ba20.js"><link rel="prefetch" href="/assets/js/254.d208b848.js"><link rel="prefetch" href="/assets/js/255.2cfb6ad3.js"><link rel="prefetch" href="/assets/js/256.e7687a81.js"><link rel="prefetch" href="/assets/js/257.db329d54.js"><link rel="prefetch" href="/assets/js/258.be75b1f9.js"><link rel="prefetch" href="/assets/js/259.67500f7e.js"><link rel="prefetch" href="/assets/js/26.9db429a9.js"><link rel="prefetch" href="/assets/js/260.73609cfa.js"><link rel="prefetch" href="/assets/js/261.22fc7c08.js"><link rel="prefetch" href="/assets/js/262.2c620ccd.js"><link rel="prefetch" href="/assets/js/263.e0ce1454.js"><link rel="prefetch" href="/assets/js/264.7fe82318.js"><link rel="prefetch" href="/assets/js/265.537d06c5.js"><link rel="prefetch" href="/assets/js/266.901695a7.js"><link rel="prefetch" href="/assets/js/267.8eb24590.js"><link rel="prefetch" href="/assets/js/268.a21e44dc.js"><link rel="prefetch" href="/assets/js/269.33e6ce5d.js"><link rel="prefetch" href="/assets/js/27.2296e284.js"><link rel="prefetch" href="/assets/js/270.31507ac3.js"><link rel="prefetch" href="/assets/js/271.b9406b42.js"><link rel="prefetch" href="/assets/js/272.0acaba6f.js"><link rel="prefetch" href="/assets/js/273.c2e359b0.js"><link rel="prefetch" href="/assets/js/274.a80428a6.js"><link rel="prefetch" href="/assets/js/28.7e4f4dc1.js"><link rel="prefetch" href="/assets/js/29.ba75f79a.js"><link rel="prefetch" href="/assets/js/30.16cd3622.js"><link rel="prefetch" href="/assets/js/31.54ed5bc1.js"><link rel="prefetch" href="/assets/js/32.b2fbba6a.js"><link rel="prefetch" href="/assets/js/33.f7ff0107.js"><link rel="prefetch" href="/assets/js/34.4b2cea7d.js"><link rel="prefetch" href="/assets/js/35.1159e74c.js"><link rel="prefetch" href="/assets/js/36.0b6296f3.js"><link rel="prefetch" href="/assets/js/37.fc67879e.js"><link rel="prefetch" href="/assets/js/39.748a78f3.js"><link rel="prefetch" href="/assets/js/40.4fede9bb.js"><link rel="prefetch" href="/assets/js/41.c7f0b087.js"><link rel="prefetch" href="/assets/js/42.5b1a487d.js"><link rel="prefetch" href="/assets/js/43.59275b93.js"><link rel="prefetch" href="/assets/js/44.b18a4c94.js"><link rel="prefetch" href="/assets/js/45.bc8f7cb3.js"><link rel="prefetch" href="/assets/js/46.6a4ec89f.js"><link rel="prefetch" href="/assets/js/47.e1e129e6.js"><link rel="prefetch" href="/assets/js/48.c284ce23.js"><link rel="prefetch" href="/assets/js/49.17e5dd65.js"><link rel="prefetch" href="/assets/js/5.e3d12916.js"><link rel="prefetch" href="/assets/js/50.34c3ac45.js"><link rel="prefetch" href="/assets/js/51.035f7031.js"><link rel="prefetch" href="/assets/js/52.e9ef227a.js"><link rel="prefetch" href="/assets/js/53.ecbb032d.js"><link rel="prefetch" href="/assets/js/54.e9af4cfe.js"><link rel="prefetch" href="/assets/js/55.7e71402b.js"><link rel="prefetch" href="/assets/js/56.511071fe.js"><link rel="prefetch" href="/assets/js/57.13b7fe79.js"><link rel="prefetch" href="/assets/js/58.e51f8b0e.js"><link rel="prefetch" href="/assets/js/59.a1b8bdb7.js"><link rel="prefetch" href="/assets/js/6.5fc3f358.js"><link rel="prefetch" href="/assets/js/60.fd7e1c08.js"><link rel="prefetch" href="/assets/js/61.0daf2361.js"><link rel="prefetch" href="/assets/js/62.04632944.js"><link rel="prefetch" href="/assets/js/63.f0dd5615.js"><link rel="prefetch" href="/assets/js/64.89a4b562.js"><link rel="prefetch" href="/assets/js/65.6764ff0c.js"><link rel="prefetch" href="/assets/js/66.049bdee1.js"><link rel="prefetch" href="/assets/js/67.b0d4ec16.js"><link rel="prefetch" href="/assets/js/68.46d97067.js"><link rel="prefetch" href="/assets/js/69.f540f0da.js"><link rel="prefetch" href="/assets/js/7.ce17dd73.js"><link rel="prefetch" href="/assets/js/70.17d8f857.js"><link rel="prefetch" href="/assets/js/71.b2a166a0.js"><link rel="prefetch" href="/assets/js/72.1c17a875.js"><link rel="prefetch" href="/assets/js/73.dac8984b.js"><link rel="prefetch" href="/assets/js/74.5bbc33ac.js"><link rel="prefetch" href="/assets/js/75.483644c7.js"><link rel="prefetch" href="/assets/js/76.de5461ab.js"><link rel="prefetch" href="/assets/js/77.7fa90702.js"><link rel="prefetch" href="/assets/js/78.f41853b8.js"><link rel="prefetch" href="/assets/js/79.598b50e6.js"><link rel="prefetch" href="/assets/js/80.61d2d23a.js"><link rel="prefetch" href="/assets/js/81.d310c6e4.js"><link rel="prefetch" href="/assets/js/82.22aa814c.js"><link rel="prefetch" href="/assets/js/83.f493eba4.js"><link rel="prefetch" href="/assets/js/84.3a32a1eb.js"><link rel="prefetch" href="/assets/js/85.2f47134e.js"><link rel="prefetch" href="/assets/js/86.74e65a77.js"><link rel="prefetch" href="/assets/js/87.e87bff96.js"><link rel="prefetch" href="/assets/js/88.aabc97af.js"><link rel="prefetch" href="/assets/js/89.b0945d87.js"><link rel="prefetch" href="/assets/js/90.630f62d3.js"><link rel="prefetch" href="/assets/js/91.ed816647.js"><link rel="prefetch" href="/assets/js/92.19065457.js"><link rel="prefetch" href="/assets/js/93.a0fe1919.js"><link rel="prefetch" href="/assets/js/94.51e48580.js"><link rel="prefetch" href="/assets/js/95.e591bede.js"><link rel="prefetch" href="/assets/js/96.1723f1d6.js"><link rel="prefetch" href="/assets/js/97.02bbb7d4.js"><link rel="prefetch" href="/assets/js/98.a3625ba6.js"><link rel="prefetch" href="/assets/js/99.1accbf48.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.5959bfd2.js">
    <link rel="stylesheet" href="/assets/css/0.styles.66b92039.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu have-body-img"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/nav-logo.png" alt="DC's blog" class="logo"> <span class="site-name can-hide">DC's blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="IT必备" class="dropdown-title"><a href="/IT/" class="link-title">IT必备</a> <span class="title" style="display:none;">IT必备</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/IT/basis/" class="nav-link">计算机基础</a></li><li class="dropdown-item"><!----> <a href="/IT/linux/" class="nav-link">linux基础</a></li><li class="dropdown-item"><!----> <a href="/IT/mysql/" class="nav-link">mysql</a></li><li class="dropdown-item"><!----> <a href="/IT/git/" class="nav-link">git</a></li><li class="dropdown-item"><!----> <a href="/IT/structure/" class="nav-link">数据结构与算法</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Python" class="dropdown-title"><a href="/python/" class="link-title">Python</a> <span class="title" style="display:none;">Python</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/python/basis/" class="nav-link">opp</a></li><li class="dropdown-item"><!----> <a href="/python/oop/" class="nav-link">oop</a></li><li class="dropdown-item"><!----> <a href="/python/Network_concurrency/" class="nav-link">网络并发编程</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><a href="/front_end/" class="link-title">前端</a> <span class="title" style="display:none;">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/front_end/html/" class="nav-link">html</a></li><li class="dropdown-item"><!----> <a href="/front_end/css/" class="nav-link">css</a></li><li class="dropdown-item"><!----> <a href="/front_end/js/" class="nav-link">javascript</a></li><li class="dropdown-item"><!----> <a href="/front_end/jquery/" class="nav-link">jquery</a></li><li class="dropdown-item"><!----> <a href="/front_end/ui/" class="nav-link">UI</a></li><li class="dropdown-item"><!----> <a href="/front_end/vue/" class="nav-link">vue</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="后端" class="dropdown-title"><a href="/python_web/" class="link-title">后端</a> <span class="title" style="display:none;">后端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/python_web/django/" class="nav-link">Django</a></li><li class="dropdown-item"><!----> <a href="/python_web/drf/" class="nav-link">drf</a></li><li class="dropdown-item"><!----> <a href="/python_web/drf_re/" class="nav-link">drf_re</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="实战" class="dropdown-title"><a href="/project/" class="link-title">实战</a> <span class="title" style="display:none;">实战</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>前后端不分离</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/project/bbs/" class="nav-link">BBS</a></li><li class="dropdown-subitem"><a href="/project/order/" class="nav-link">订单系统</a></li><li class="dropdown-subitem"><a href="/project/crm/" class="nav-link">CRM</a></li></ul></li><li class="dropdown-item"><h4>前后端分离</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/project/supply/" class="nav-link">供应链系统</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其他" class="dropdown-title"><a href="/other/" class="link-title">其他</a> <span class="title" style="display:none;">其他</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/other/essays/" class="nav-link">杂文</a></li><li class="dropdown-item"><h4>关于我</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/about/" class="nav-link">me</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><!----> <span class="title" style="display:;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/OnePieceDC/" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="/img/avatar.gif"> <div class="blogger-info"><h3>DC</h3> <span>愿我一生欢喜,不为世俗所及.</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="IT必备" class="dropdown-title"><a href="/IT/" class="link-title">IT必备</a> <span class="title" style="display:none;">IT必备</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/IT/basis/" class="nav-link">计算机基础</a></li><li class="dropdown-item"><!----> <a href="/IT/linux/" class="nav-link">linux基础</a></li><li class="dropdown-item"><!----> <a href="/IT/mysql/" class="nav-link">mysql</a></li><li class="dropdown-item"><!----> <a href="/IT/git/" class="nav-link">git</a></li><li class="dropdown-item"><!----> <a href="/IT/structure/" class="nav-link">数据结构与算法</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Python" class="dropdown-title"><a href="/python/" class="link-title">Python</a> <span class="title" style="display:none;">Python</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/python/basis/" class="nav-link">opp</a></li><li class="dropdown-item"><!----> <a href="/python/oop/" class="nav-link">oop</a></li><li class="dropdown-item"><!----> <a href="/python/Network_concurrency/" class="nav-link">网络并发编程</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><a href="/front_end/" class="link-title">前端</a> <span class="title" style="display:none;">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/front_end/html/" class="nav-link">html</a></li><li class="dropdown-item"><!----> <a href="/front_end/css/" class="nav-link">css</a></li><li class="dropdown-item"><!----> <a href="/front_end/js/" class="nav-link">javascript</a></li><li class="dropdown-item"><!----> <a href="/front_end/jquery/" class="nav-link">jquery</a></li><li class="dropdown-item"><!----> <a href="/front_end/ui/" class="nav-link">UI</a></li><li class="dropdown-item"><!----> <a href="/front_end/vue/" class="nav-link">vue</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="后端" class="dropdown-title"><a href="/python_web/" class="link-title">后端</a> <span class="title" style="display:none;">后端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/python_web/django/" class="nav-link">Django</a></li><li class="dropdown-item"><!----> <a href="/python_web/drf/" class="nav-link">drf</a></li><li class="dropdown-item"><!----> <a href="/python_web/drf_re/" class="nav-link">drf_re</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="实战" class="dropdown-title"><a href="/project/" class="link-title">实战</a> <span class="title" style="display:none;">实战</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>前后端不分离</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/project/bbs/" class="nav-link">BBS</a></li><li class="dropdown-subitem"><a href="/project/order/" class="nav-link">订单系统</a></li><li class="dropdown-subitem"><a href="/project/crm/" class="nav-link">CRM</a></li></ul></li><li class="dropdown-item"><h4>前后端分离</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/project/supply/" class="nav-link">供应链系统</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其他" class="dropdown-title"><a href="/other/" class="link-title">其他</a> <span class="title" style="display:none;">其他</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/other/essays/" class="nav-link">杂文</a></li><li class="dropdown-item"><h4>关于我</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/about/" class="nav-link">me</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><!----> <span class="title" style="display:;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/OnePieceDC/" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Django</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>第一次学drf</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>第二次学drf</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/4a4d04/" class="sidebar-link">drfCBV</a></li><li><a href="/pages/48a122/" class="sidebar-link">认证</a></li><li><a href="/pages/8ac3ca/" class="sidebar-link">权限</a></li><li><a href="/pages/722e87/" class="sidebar-link">限流</a></li><li><a href="/pages/c28915/" class="sidebar-link">版本</a></li><li><a href="/pages/3d8f05/" class="sidebar-link">解析器</a></li><li><a href="/pages/129619/" class="sidebar-link">元类</a></li><li><a href="/pages/e9b8af/" class="sidebar-link">序列化使用</a></li><li><a href="/pages/8da366/" class="sidebar-link">序列化源码</a></li><li><a href="/pages/42f109/" class="sidebar-link">验证&amp;源码</a></li><li><a href="/pages/7c6d75/" class="sidebar-link">序列化+验证</a></li><li><a href="/pages/24ce79/" class="sidebar-link">Serializer案例</a></li><li><a href="/pages/b465f3/" class="sidebar-link">Serializer总结</a></li><li><a href="/pages/bee1e2/" class="sidebar-link">分页</a></li><li><a href="/pages/73b064/" class="sidebar-link">视图+路由+过滤</a></li><li><a href="/pages/13c024/" class="sidebar-link">练习+跨域问题</a></li><li><a href="/pages/11cn34/" aria-current="page" class="active sidebar-link">博客练习</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/pages/11cn34/#数据表设计" class="sidebar-link">数据表设计</a></li><li class="sidebar-sub-header level2"><a href="/pages/11cn34/#注意事项" class="sidebar-link">注意事项</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/11cn34/#路由编写" class="sidebar-link">路由编写</a></li><li class="sidebar-sub-header level3"><a href="/pages/11cn34/#版本" class="sidebar-link">版本</a></li><li class="sidebar-sub-header level3"><a href="/pages/11cn34/#全局认证" class="sidebar-link">全局认证</a></li><li class="sidebar-sub-header level3"><a href="/pages/11cn34/#全局分页" class="sidebar-link">全局分页</a></li><li class="sidebar-sub-header level3"><a href="/pages/11cn34/#★序列化" class="sidebar-link">★序列化!</a></li><li class="sidebar-sub-header level5"><a href="/pages/11cn34/#≧▽≦-drf的视图类" class="sidebar-link">\(≧▽≦)/ drf的视图类</a></li><li class="sidebar-sub-header level5"><a href="/pages/11cn34/#思考步骤" class="sidebar-link">思考步骤</a></li><li class="sidebar-sub-header level5"><a href="/pages/11cn34/#设置只读只写的技巧" class="sidebar-link">设置只读只写的技巧</a></li><li class="sidebar-sub-header level5"><a href="/pages/11cn34/#一些小锦囊" class="sidebar-link">一些小锦囊</a></li><li class="sidebar-sub-header level5"><a href="/pages/11cn34/#错误信息" class="sidebar-link">错误信息</a></li><li class="sidebar-sub-header level5"><a href="/pages/11cn34/#何时serializer" class="sidebar-link">何时Serializer</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/11cn34/#account" class="sidebar-link">account</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/11cn34/#注册" class="sidebar-link">注册</a></li><li class="sidebar-sub-header level3"><a href="/pages/11cn34/#登陆" class="sidebar-link">登陆</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/11cn34/#topic" class="sidebar-link">topic</a></li><li class="sidebar-sub-header level2"><a href="/pages/11cn34/#news" class="sidebar-link">news</a></li><li class="sidebar-sub-header level2"><a href="/pages/11cn34/#index" class="sidebar-link">index</a></li><li class="sidebar-sub-header level2"><a href="/pages/11cn34/#collect" class="sidebar-link">collect</a></li><li class="sidebar-sub-header level2"><a href="/pages/11cn34/#recommend" class="sidebar-link">recommend</a></li><li class="sidebar-sub-header level2"><a href="/pages/11cn34/#comment" class="sidebar-link">comment</a></li></ul></li></ul></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-91157402><div class="articleInfo" data-v-91157402><ul class="breadcrumbs" data-v-91157402><li data-v-91157402><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-91157402></a></li> <li data-v-91157402><a href="/categories/?category=%E5%90%8E%E7%AB%AF" title="分类" data-v-91157402>后端</a></li><li data-v-91157402><a href="/categories/?category=%E7%AC%AC%E4%BA%8C%E6%AC%A1%E5%AD%A6drf" title="分类" data-v-91157402>第二次学drf</a></li></ul> <div class="info" data-v-91157402><div title="作者" class="author iconfont icon-touxiang" data-v-91157402><a href="https://github.com/OnePieceDC" target="_blank" title="作者" class="beLink" data-v-91157402>DC</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-91157402><a href="javascript:;" data-v-91157402>2023-11-20</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABGpJREFUSA3tVVtoXFUU3fvOI53UlmCaKIFmwEhsE7QK0ipFEdHEKpXaZGrp15SINsXUWvBDpBgQRKi0+KKoFeJHfZA+ED9KKoIU2gYD9UejTW4rVIzm0VSTziPzuNu1z507dibTTjL4U/DAzLn3nL3X2o91ziX6f9wMFdh6Jvbm9nNSV0msViVO6tN1Rm7NMu2OpeJ9lWBUTDxrJbYTS0hInuwciu9eLHlFxCLCZEk3MegsJmZ5K/JD6t7FkFdEvGUo1g7qJoG3MHImqRIn8/nzY1K9UPKKiJmtnUqHVE3Gbuay6vJE/N2FEmuxFjW2nUuE0yQXRRxLiTUAzs36zhZvOXJPdX850EVnnLZkB8prodQoM5JGj7Xk2mvC7JB8tG04Ef5PiXtG0UtxupRQSfTnBoCy554x18yJHI6I+G5Eru4LHmPJZEQsrvPUbMiA8G/WgMK7w7I+ez7++o2ANfbrjvaOl1tFMs+htG3IrZH9/hDX1Pr8Tc0UvH8tcX29KzAgIGcEkINyW5BF9x891hw6VYqgJHEk0huccS7vh3C6gTiODL+26huuBtbct8eZnqLML8PkxGYpuPZBqtqwkSjgc4mB5gbgig5i+y0UDK35LMxXisn9xQtK+nd26gTIHsHe/oblK/b29fUmN/8Y+9jAQrnBp56m1LcDlDp9irKTExSKduXJVWSqdBMA08pEJnEIOB3FPPMybu/oeV8zFeYN3xx576Q6RH+VmplE4ncQV5v+5rzSoyOU7PuEAg8g803PwBJ0CExno/jcMbN8tONYeOmHiuUNryvm3fRUy4tMPVLdAGkUhNWuggGrJcXPv+ouCjz0MKUHz1J2/E8IC9nqTabcxgaBYM0hPhD5Y65FsbxRQKxCQrDjDctW7PUM3HuZunFyifSAqEfuzCp48Il24luWUWZoyJCaPR82jE0+kFA643wRFVni4RYSq3ohJO2pZ7B5dO4xkDWbEpossJPLSrPjYID8rS2UHTlvyNxqIGsg674XJJ7vnh5L7PNwC4hh2sjCI96mzszOTpxLF0T7l88Yz7lAuK6OnL8gXLOnTvpzSb22YG8W7us3jSebFHeeqnXRG1vt+MoUM84LQIBmMsCTAcOauTh0T0l0neQK7m2bLMt2mGxU3HYssS0J2cdv5wljlPsrIuZLAG/2DOZIXgCYT8uMGZN+e2kSirfxZOPCsC0f24nTZzspnVn9VePS1Z5vubmAGGXG8ZFno9Hel0yfA5ZPhF7Dh972BQJ2qCpgH67lmWtBYbvk6sz02wjky2vXyz0XErP/kFB619js1BtwfOV4OPRqOQBjy3Qbk18vigUPPSD5ceHnwck7W9bhAqZdd7SuG7w4/P2F/GaJh8c7e9qgow+Q7cGBo+98WsLkuktFqiZabtXuQTu/Y5ETbR0v7tNSFnvrmu6pjdoan2KjMu8q/Hmj1EfCO2ZGfEIbIXKUlw8qaX9/b2oeSJmFksSeT/Fn0V3nSypChh4Gjh74ybO9aeZ/AN2dwciu2/MhAAAAAElFTkSuQmCC">博客练习<!----></h1> <!----> <div class="theme-vdoing-content content__default"><h2 id="数据表设计"><a href="#数据表设计" class="header-anchor">#</a> 数据表设计</h2> <blockquote><p>结合学习的drf知识开发 简易版的&quot;抽屉新热榜&quot;   <code>https://dig.chouti.com/</code></p></blockquote> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">from</span> django<span class="token punctuation">.</span>db <span class="token keyword">import</span> models


<span class="token keyword">class</span> <span class="token class-name">DeletedModel</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># deleted 是否已删除 -- 做逻辑删除用的,逻辑删除时其值为true </span>
    deleted <span class="token operator">=</span> models<span class="token punctuation">.</span>BooleanField<span class="token punctuation">(</span>verbose_name<span class="token operator">=</span><span class="token string">&quot;已删除&quot;</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>

    <span class="token comment"># 提取出来作为父类,做逻辑删除的表都会继承它 但注意不要让它生成表 只是为其他表提供公共字段 abstract=True</span>
    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span>
        abstract <span class="token operator">=</span> <span class="token boolean">True</span>


<span class="token keyword">class</span> <span class="token class-name">UserInfo</span><span class="token punctuation">(</span>DeletedModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot; 用户表 &quot;&quot;&quot;</span>
    username <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>verbose_name<span class="token operator">=</span><span class="token string">&quot;用户名&quot;</span><span class="token punctuation">,</span> max_length<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">)</span>
    phone <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>verbose_name<span class="token operator">=</span><span class="token string">&quot;手机号&quot;</span><span class="token punctuation">,</span> max_length<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">,</span> db_index<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    password <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>verbose_name<span class="token operator">=</span><span class="token string">&quot;密码&quot;</span><span class="token punctuation">,</span> max_length<span class="token operator">=</span><span class="token number">64</span><span class="token punctuation">)</span>

    token <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>verbose_name<span class="token operator">=</span><span class="token string">&quot;token&quot;</span><span class="token punctuation">,</span> max_length<span class="token operator">=</span><span class="token number">64</span><span class="token punctuation">,</span> null<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> blank<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> db_index<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    token_expiry_date <span class="token operator">=</span> models<span class="token punctuation">.</span>DateTimeField<span class="token punctuation">(</span>verbose_name<span class="token operator">=</span><span class="token string">&quot;token有效期&quot;</span><span class="token punctuation">,</span> null<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> blank<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>

    status_choice <span class="token operator">=</span> <span class="token punctuation">(</span>
        <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&quot;激活&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">&quot;禁用&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span>
    status <span class="token operator">=</span> models<span class="token punctuation">.</span>IntegerField<span class="token punctuation">(</span>verbose_name<span class="token operator">=</span><span class="token string">&quot;状态&quot;</span><span class="token punctuation">,</span> choices<span class="token operator">=</span>status_choice<span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
    create_datetime <span class="token operator">=</span> models<span class="token punctuation">.</span>DateTimeField<span class="token punctuation">(</span>verbose_name<span class="token operator">=</span><span class="token string">&quot;创建时间&quot;</span><span class="token punctuation">,</span> auto_now_add<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>

    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span>
        <span class="token comment"># Meta里联合索引,建议3.2后用index,而不是index_togeter</span>
        indexes <span class="token operator">=</span> <span class="token punctuation">[</span>
            models<span class="token punctuation">.</span>Index<span class="token punctuation">(</span>fields<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'username'</span><span class="token punctuation">,</span> <span class="token string">&quot;password&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'idx_name_pwd'</span><span class="token punctuation">)</span>
        <span class="token punctuation">]</span>


<span class="token keyword">class</span> <span class="token class-name">Topic</span><span class="token punctuation">(</span>DeletedModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot; 话题 &quot;&quot;&quot;</span>
    title <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>verbose_name<span class="token operator">=</span><span class="token string">&quot;话题&quot;</span><span class="token punctuation">,</span> max_length<span class="token operator">=</span><span class="token number">16</span><span class="token punctuation">,</span> db_index<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    <span class="token comment"># is_hot 这个话题是不是热门话题 这样前端在发布话题时,可以选择数据库里的那些热门话题(管理员设置哪些是热门话题)</span>
    is_hot <span class="token operator">=</span> models<span class="token punctuation">.</span>BooleanField<span class="token punctuation">(</span>verbose_name<span class="token operator">=</span><span class="token string">&quot;热门话题&quot;</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
    user <span class="token operator">=</span> models<span class="token punctuation">.</span>ForeignKey<span class="token punctuation">(</span>verbose_name<span class="token operator">=</span><span class="token string">&quot;用户&quot;</span><span class="token punctuation">,</span> to<span class="token operator">=</span><span class="token string">&quot;UserInfo&quot;</span><span class="token punctuation">,</span> on_delete<span class="token operator">=</span>models<span class="token punctuation">.</span>CASCADE<span class="token punctuation">)</span>
    create_datetime <span class="token operator">=</span> models<span class="token punctuation">.</span>DateTimeField<span class="token punctuation">(</span>verbose_name<span class="token operator">=</span><span class="token string">&quot;创建时间&quot;</span><span class="token punctuation">,</span> auto_now_add<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>


<span class="token keyword">class</span> <span class="token class-name">News</span><span class="token punctuation">(</span>DeletedModel<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot; 新闻资讯 &quot;&quot;&quot;</span>
    title <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>verbose_name<span class="token operator">=</span><span class="token string">&quot;文字&quot;</span><span class="token punctuation">,</span> max_length<span class="token operator">=</span><span class="token number">150</span><span class="token punctuation">)</span>

    url <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>verbose_name<span class="token operator">=</span><span class="token string">&quot;链接&quot;</span><span class="token punctuation">,</span> max_length<span class="token operator">=</span><span class="token number">200</span><span class="token punctuation">,</span> null<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> blank<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    image <span class="token operator">=</span> models<span class="token punctuation">.</span>TextField<span class="token punctuation">(</span>verbose_name<span class="token operator">=</span><span class="token string">&quot;图片地址&quot;</span><span class="token punctuation">,</span> help_text<span class="token operator">=</span><span class="token string">&quot;逗号分割&quot;</span><span class="token punctuation">,</span> null<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> blank<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    topic <span class="token operator">=</span> models<span class="token punctuation">.</span>ForeignKey<span class="token punctuation">(</span>verbose_name<span class="token operator">=</span><span class="token string">&quot;话题&quot;</span><span class="token punctuation">,</span> to<span class="token operator">=</span><span class="token string">&quot;Topic&quot;</span><span class="token punctuation">,</span> on_delete<span class="token operator">=</span>models<span class="token punctuation">.</span>CASCADE<span class="token punctuation">,</span> null<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> blank<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>

    zone_choices <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&quot;42区&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">&quot;段子&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">&quot;图片&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token string">&quot;挨踢1024&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token string">&quot;你问我答&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    zone <span class="token operator">=</span> models<span class="token punctuation">.</span>IntegerField<span class="token punctuation">(</span>verbose_name<span class="token operator">=</span><span class="token string">&quot;专区&quot;</span><span class="token punctuation">,</span> choices<span class="token operator">=</span>zone_choices<span class="token punctuation">)</span>

    user <span class="token operator">=</span> models<span class="token punctuation">.</span>ForeignKey<span class="token punctuation">(</span>verbose_name<span class="token operator">=</span><span class="token string">&quot;用户&quot;</span><span class="token punctuation">,</span> to<span class="token operator">=</span><span class="token string">&quot;UserInfo&quot;</span><span class="token punctuation">,</span> on_delete<span class="token operator">=</span>models<span class="token punctuation">.</span>CASCADE<span class="token punctuation">)</span>

    create_datetime <span class="token operator">=</span> models<span class="token punctuation">.</span>DateTimeField<span class="token punctuation">(</span>verbose_name<span class="token operator">=</span><span class="token string">&quot;创建时间&quot;</span><span class="token punctuation">,</span> auto_now_add<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    status_choice <span class="token operator">=</span> <span class="token punctuation">(</span>
        <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&quot;待审核&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">&quot;已通过&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">&quot;未通过&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span>
    status <span class="token operator">=</span> models<span class="token punctuation">.</span>IntegerField<span class="token punctuation">(</span>verbose_name<span class="token operator">=</span><span class="token string">&quot;状态&quot;</span><span class="token punctuation">,</span> choices<span class="token operator">=</span>status_choice<span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>

    collect_count <span class="token operator">=</span> models<span class="token punctuation">.</span>IntegerField<span class="token punctuation">(</span>verbose_name<span class="token operator">=</span><span class="token string">&quot;收藏数&quot;</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
    recommend_count <span class="token operator">=</span> models<span class="token punctuation">.</span>IntegerField<span class="token punctuation">(</span>verbose_name<span class="token operator">=</span><span class="token string">&quot;推荐数&quot;</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
    comment_count <span class="token operator">=</span> models<span class="token punctuation">.</span>IntegerField<span class="token punctuation">(</span>verbose_name<span class="token operator">=</span><span class="token string">&quot;评论数&quot;</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>


<span class="token keyword">class</span> <span class="token class-name">Collect</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot; 收藏 &quot;&quot;&quot;</span>
    news <span class="token operator">=</span> models<span class="token punctuation">.</span>ForeignKey<span class="token punctuation">(</span>verbose_name<span class="token operator">=</span><span class="token string">&quot;资讯&quot;</span><span class="token punctuation">,</span> to<span class="token operator">=</span><span class="token string">&quot;News&quot;</span><span class="token punctuation">,</span> on_delete<span class="token operator">=</span>models<span class="token punctuation">.</span>CASCADE<span class="token punctuation">)</span>
    user <span class="token operator">=</span> models<span class="token punctuation">.</span>ForeignKey<span class="token punctuation">(</span>verbose_name<span class="token operator">=</span><span class="token string">&quot;用户&quot;</span><span class="token punctuation">,</span> to<span class="token operator">=</span><span class="token string">&quot;UserInfo&quot;</span><span class="token punctuation">,</span> on_delete<span class="token operator">=</span>models<span class="token punctuation">.</span>CASCADE<span class="token punctuation">)</span>
    create_datetime <span class="token operator">=</span> models<span class="token punctuation">.</span>DateTimeField<span class="token punctuation">(</span>verbose_name<span class="token operator">=</span><span class="token string">&quot;创建时间&quot;</span><span class="token punctuation">,</span> auto_now_add<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>

    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span>
        <span class="token comment"># unique_together = [['news', 'user']]</span>
        constraints <span class="token operator">=</span> <span class="token punctuation">[</span>
            models<span class="token punctuation">.</span>UniqueConstraint<span class="token punctuation">(</span>fields<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'news'</span><span class="token punctuation">,</span> <span class="token string">'user'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'uni_collect_news_user'</span><span class="token punctuation">)</span>
        <span class="token punctuation">]</span>


<span class="token keyword">class</span> <span class="token class-name">Recommend</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot; 推荐 &quot;&quot;&quot;</span>
    news <span class="token operator">=</span> models<span class="token punctuation">.</span>ForeignKey<span class="token punctuation">(</span>verbose_name<span class="token operator">=</span><span class="token string">&quot;资讯&quot;</span><span class="token punctuation">,</span> to<span class="token operator">=</span><span class="token string">&quot;News&quot;</span><span class="token punctuation">,</span> on_delete<span class="token operator">=</span>models<span class="token punctuation">.</span>CASCADE<span class="token punctuation">)</span>
    user <span class="token operator">=</span> models<span class="token punctuation">.</span>ForeignKey<span class="token punctuation">(</span>verbose_name<span class="token operator">=</span><span class="token string">&quot;用户&quot;</span><span class="token punctuation">,</span> to<span class="token operator">=</span><span class="token string">&quot;UserInfo&quot;</span><span class="token punctuation">,</span> on_delete<span class="token operator">=</span>models<span class="token punctuation">.</span>CASCADE<span class="token punctuation">)</span>
    create_datetime <span class="token operator">=</span> models<span class="token punctuation">.</span>DateTimeField<span class="token punctuation">(</span>verbose_name<span class="token operator">=</span><span class="token string">&quot;创建时间&quot;</span><span class="token punctuation">,</span> auto_now_add<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>

    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span>
        constraints <span class="token operator">=</span> <span class="token punctuation">[</span>
            models<span class="token punctuation">.</span>UniqueConstraint<span class="token punctuation">(</span>fields<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'news'</span><span class="token punctuation">,</span> <span class="token string">'user'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'uni_recommend_news_user'</span><span class="token punctuation">)</span>
        <span class="token punctuation">]</span>


<span class="token keyword">class</span> <span class="token class-name">Comment</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot; 评论表 &quot;&quot;&quot;</span>
    news <span class="token operator">=</span> models<span class="token punctuation">.</span>ForeignKey<span class="token punctuation">(</span>verbose_name<span class="token operator">=</span><span class="token string">&quot;资讯&quot;</span><span class="token punctuation">,</span> to<span class="token operator">=</span><span class="token string">&quot;News&quot;</span><span class="token punctuation">,</span> on_delete<span class="token operator">=</span>models<span class="token punctuation">.</span>CASCADE<span class="token punctuation">)</span>
    user <span class="token operator">=</span> models<span class="token punctuation">.</span>ForeignKey<span class="token punctuation">(</span>verbose_name<span class="token operator">=</span><span class="token string">&quot;用户&quot;</span><span class="token punctuation">,</span> to<span class="token operator">=</span><span class="token string">&quot;UserInfo&quot;</span><span class="token punctuation">,</span> on_delete<span class="token operator">=</span>models<span class="token punctuation">.</span>CASCADE<span class="token punctuation">)</span>
    content <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>verbose_name<span class="token operator">=</span><span class="token string">&quot;内容&quot;</span><span class="token punctuation">,</span> max_length<span class="token operator">=</span><span class="token number">150</span><span class="token punctuation">)</span>

    depth <span class="token operator">=</span> models<span class="token punctuation">.</span>IntegerField<span class="token punctuation">(</span>verbose_name<span class="token operator">=</span><span class="token string">&quot;深度&quot;</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>

    root <span class="token operator">=</span> models<span class="token punctuation">.</span>ForeignKey<span class="token punctuation">(</span>
      verbose_name<span class="token operator">=</span><span class="token string">&quot;根评论&quot;</span><span class="token punctuation">,</span> to<span class="token operator">=</span><span class="token string">&quot;Comment&quot;</span><span class="token punctuation">,</span> related_name<span class="token operator">=</span><span class="token string">&quot;descendant&quot;</span><span class="token punctuation">,</span>
      on_delete<span class="token operator">=</span>models<span class="token punctuation">.</span>CASCADE<span class="token punctuation">,</span> null<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> blank<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>

    reply <span class="token operator">=</span> models<span class="token punctuation">.</span>ForeignKey<span class="token punctuation">(</span>
      verbose_name<span class="token operator">=</span><span class="token string">&quot;回复&quot;</span><span class="token punctuation">,</span> to<span class="token operator">=</span><span class="token string">&quot;Comment&quot;</span><span class="token punctuation">,</span> related_name<span class="token operator">=</span><span class="token string">&quot;reply_list&quot;</span><span class="token punctuation">,</span> 
      on_delete<span class="token operator">=</span>models<span class="token punctuation">.</span>CASCADE<span class="token punctuation">,</span> null<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> blank<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>

    create_datetime <span class="token operator">=</span> models<span class="token punctuation">.</span>DateTimeField<span class="token punctuation">(</span>verbose_name<span class="token operator">=</span><span class="token string">&quot;创建时间&quot;</span><span class="token punctuation">,</span> auto_now_add<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>

    <span class="token comment"># 针对根评论</span>
    descendant_update_datetime <span class="token operator">=</span> models<span class="token punctuation">.</span>DateTimeField<span class="token punctuation">(</span>verbose_name<span class="token operator">=</span><span class="token string">&quot;后代更新时间&quot;</span><span class="token punctuation">,</span> auto_now_add<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br></div></div><hr> <h2 id="注意事项"><a href="#注意事项" class="header-anchor">#</a> 注意事项</h2> <blockquote><p>一些小小的注意事项</p></blockquote> <h3 id="路由编写"><a href="#路由编写" class="header-anchor">#</a> 路由编写</h3> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token operator">-</span> 直接写自己写对应关系<span class="token punctuation">,</span>注<span class="token punctuation">:</span>得继承ViewSetMixin
urlpatterns <span class="token operator">=</span> <span class="token punctuation">[</span>
    path<span class="token punctuation">(</span><span class="token string">'register/'</span><span class="token punctuation">,</span> account<span class="token punctuation">.</span>RegisterView<span class="token punctuation">.</span>as_view<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&quot;post&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;create&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>

<span class="token operator">-</span> 自动生成路由<span class="token punctuation">,</span>注<span class="token punctuation">:</span>得继承ViewSetMixin
router <span class="token operator">=</span> routers<span class="token punctuation">.</span>SimpleRouter<span class="token punctuation">(</span><span class="token punctuation">)</span>
router<span class="token punctuation">.</span>register<span class="token punctuation">(</span><span class="token string">r'register'</span><span class="token punctuation">,</span> account<span class="token punctuation">.</span>RegisterView<span class="token punctuation">)</span>
urlpatterns <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
urlpatterns <span class="token operator">+=</span> router<span class="token punctuation">.</span>urls
<span class="token operator">==</span><span class="token operator">&gt;</span> ★ 查看下源码便知
  <span class="token operator">-</span> 不写name<span class="token punctuation">,</span>相应的视图类需要写类变量 queryset! 因为需要利用该值自动生成name值<span class="token punctuation">.</span>
  <span class="token operator">-</span> 写了name<span class="token punctuation">,</span>假如name<span class="token operator">=</span><span class="token string">&quot;xxx&quot;</span> 那么新增时<span class="token string">&quot;xxx-create&quot;</span>、查询时<span class="token string">&quot;xxx-list&quot;</span>  
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h3 id="版本"><a href="#版本" class="header-anchor">#</a> 版本</h3> <div class="language-python line-numbers-mode"><pre class="language-python"><code>体现API的标识 <span class="token operator">-</span><span class="token operator">-</span> 版本!!
<span class="token operator">-</span> settings<span class="token punctuation">.</span>py文件中
REST_FRAMEWORK <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token comment"># 版本配置</span>
    <span class="token string">&quot;DEFAULT_VERSIONING_CLASS&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;rest_framework.versioning.QueryParameterVersioning&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;DEFAULT_VERSION&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;v1&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;ALLOWED_VERSIONS&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;v1&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">&quot;VERSION_PARAM&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;version&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
<span class="token operator">-</span> 在视图函数中<span class="token punctuation">,</span>可以通过 self<span class="token punctuation">.</span>request<span class="token punctuation">.</span>version 拿到当前的版本号!然后做不同的处理!!
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="全局认证"><a href="#全局认证" class="header-anchor">#</a> 全局认证</h3> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token operator">-</span> settings<span class="token punctuation">.</span>py文件中
REST_FRAMEWORK <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token comment"># 认证配置</span>
    <span class="token string">&quot;DEFAULT_AUTHENTICATION_CLASSES&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;api.extension.auth.TokenAuthentication&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string">&quot;UNAUTHENTICATED_USER&quot;</span><span class="token punctuation">:</span> <span class="token keyword">lambda</span><span class="token punctuation">:</span> <span class="token boolean">None</span><span class="token punctuation">,</span>
    <span class="token string">&quot;UNAUTHENTICATED_TOKEN&quot;</span><span class="token punctuation">:</span> <span class="token keyword">lambda</span><span class="token punctuation">:</span> <span class="token boolean">None</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
<span class="token operator">-</span> api<span class="token punctuation">.</span>extension<span class="token punctuation">.</span>auth<span class="token punctuation">.</span>TokenAuthentication
<span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>authentication <span class="token keyword">import</span> BaseAuthentication
<span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>exceptions <span class="token keyword">import</span> AuthenticationFailed
<span class="token keyword">from</span> api <span class="token keyword">import</span> models
<span class="token keyword">from</span> api<span class="token punctuation">.</span>extension <span class="token keyword">import</span> return_code

<span class="token keyword">class</span> <span class="token class-name">TokenAuthentication</span><span class="token punctuation">(</span>BaseAuthentication<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;必须认证成功之后才能访问 认证失败压根走不到视图,因为认证失败直接抛出异常了&quot;&quot;&quot;</span>
    <span class="token keyword">def</span> <span class="token function">authenticate</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">)</span><span class="token punctuation">:</span>
        token <span class="token operator">=</span> request<span class="token punctuation">.</span>query_params<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&quot;token&quot;</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> token<span class="token punctuation">:</span>
            <span class="token keyword">raise</span> AuthenticationFailed<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&quot;code&quot;</span><span class="token punctuation">:</span> return_code<span class="token punctuation">.</span>AUTH_FAILED<span class="token punctuation">,</span> <span class="token string">&quot;error&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;未传token,认证失败&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
        user_object <span class="token operator">=</span> models<span class="token punctuation">.</span>UserInfo<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>token<span class="token operator">=</span>token<span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> user_object<span class="token punctuation">:</span>
            <span class="token keyword">raise</span> AuthenticationFailed<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&quot;code&quot;</span><span class="token punctuation">:</span> return_code<span class="token punctuation">.</span>AUTH_FAILED<span class="token punctuation">,</span> <span class="token string">&quot;error&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;没有该token,认证失败&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> datetime<span class="token punctuation">.</span>datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> user_object<span class="token punctuation">.</span>token_expiry_date<span class="token punctuation">:</span>
            <span class="token keyword">raise</span> AuthenticationFailed<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&quot;code&quot;</span><span class="token punctuation">:</span> return_code<span class="token punctuation">.</span>AUTH_OVERDUE<span class="token punctuation">,</span> <span class="token string">&quot;error&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;认证过期&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

        <span class="token keyword">return</span> user_object<span class="token punctuation">,</span> token

    <span class="token keyword">def</span> <span class="token function">authenticate_header</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">'Bearer realm=&quot;API&quot;'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><h3 id="全局分页"><a href="#全局分页" class="header-anchor">#</a> 全局分页</h3> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token operator">-</span> settings<span class="token punctuation">.</span>py文件中
REST_FRAMEWORK <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token comment"># 分页配置</span>
    <span class="token string">&quot;DEFAULT_PAGINATION_CLASS&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;api.extension.page.DigLimitOffsetPagination&quot;</span>
<span class="token punctuation">}</span>
<span class="token operator">-</span> api<span class="token punctuation">.</span>extension<span class="token punctuation">.</span>page<span class="token punctuation">.</span>DigLimitOffsetPagination
<span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>pagination <span class="token keyword">import</span> LimitOffsetPagination
<span class="token keyword">class</span> <span class="token class-name">DigLimitOffsetPagination</span><span class="token punctuation">(</span>LimitOffsetPagination<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># xxx?limit=2 limit不传默认是10,最大只能传100</span>
    default_limit <span class="token operator">=</span> <span class="token number">10</span>
    max_limit <span class="token operator">=</span> <span class="token number">100</span>
    <span class="token comment"># 印象中的偏移分页是这样的 xxx?limit=5&amp;offset=2 从第2个位置往后读5条数据</span>
    <span class="token comment"># 但在该项目中的分页用不到offset,哪怕传了也没意义.. 因为我们用到了latest_id</span>
    offset_query_param <span class="token operator">=</span> <span class="token boolean">None</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h3 id="★序列化"><a href="#★序列化" class="header-anchor">#</a> ★序列化!</h3> <h5 id="≧▽≦-drf的视图类"><a href="#≧▽≦-drf的视图类" class="header-anchor">#</a> (≧▽≦)/ drf的视图类</h5> <div class="language-python line-numbers-mode"><pre class="language-python"><code>Q ★ 什么时候用自动生成路由<span class="token punctuation">,</span>用drf提供的那些视图类<span class="token punctuation">;</span>什么时候自己写直接用APIView呢?
A ★ 标准在于<span class="token punctuation">,</span>需求的实现逻辑 与 drf提供的那些视图类的源码逻辑 有多少是重合的!!关联性强不强<span class="token punctuation">.</span>  <span class="token operator">==</span><span class="token operator">&gt;</span> eg<span class="token punctuation">:</span>登陆
  
  （¯﹃¯） 首先得清楚<span class="token punctuation">,</span>源码中self<span class="token punctuation">.</span>get_object干了四件事<span class="token punctuation">,</span>获取数据集、过滤、pk值、细粒度的权限 
          类似于 <span class="token string">&quot;Publish.objects.all()&quot;</span><span class="token punctuation">.</span><span class="token string">&quot;filter()&quot;</span><span class="token punctuation">.</span><span class="token string">&quot;filter(pk=kwargs['pk'])&quot;</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token operator">-</span> CreateModelMixin <span class="token operator">==</span><span class="token operator">&gt;</span>  <span class="token string">&quot;序列化器类(data=request.data)&quot;</span>
    实例化 <span class="token operator">-</span> 验证 <span class="token operator">-</span> 存储 <span class="token operator">-</span> 序列化返回    
  <span class="token operator">-</span> DestroyModelMixin <span class="token operator">==</span><span class="token operator">&gt;</span> <span class="token string">&quot;序列化器类(instance=instance)&quot;</span>
    instance <span class="token operator">=</span> self<span class="token punctuation">.</span>get_object <span class="token operator">-</span> 实例化 <span class="token operator">-</span> 删除
  <span class="token operator">-</span> UpdateModelMixin <span class="token operator">==</span><span class="token operator">&gt;</span>  <span class="token string">&quot;序列化器类(instance=instance,data=request.data,partial=partial)&quot;</span>
    instance <span class="token operator">=</span> self<span class="token punctuation">.</span>get_object <span class="token operator">-</span> 实例化 <span class="token operator">-</span> 验证 <span class="token operator">-</span> 更新 <span class="token operator">-</span> 返回
  <span class="token operator">-</span> ListModelMixin <span class="token operator">==</span><span class="token operator">&gt;</span>    <span class="token string">&quot;序列化器类(instance=p_list,many=True)&quot;</span>
    获取数据集、过滤 <span class="token punctuation">(</span>就是get_object的前两件事<span class="token punctuation">)</span> <span class="token operator">-</span> 分页得到p_list <span class="token operator">-</span> 实例化 <span class="token operator">-</span> 返回
  <span class="token operator">-</span> RetrieveModelMixin <span class="token operator">==</span><span class="token operator">&gt;</span> <span class="token string">&quot;序列化器类(instance=instance)&quot;</span>
    instance <span class="token operator">=</span> self<span class="token punctuation">.</span>get_object <span class="token operator">-</span> 实例化 <span class="token operator">-</span> 返回
  
  
★【小口诀】
POST   增 create    data<span class="token operator">=</span>request<span class="token punctuation">.</span>data                                   <span class="token operator">==</span><span class="token operator">&gt;</span> 实 验 增 返
DELETE 删 destroy   instance<span class="token operator">=</span>instance                                   <span class="token operator">==</span><span class="token operator">&gt;</span> 集过pk 实 删
PUT    更 update    instance<span class="token operator">=</span>instance<span class="token punctuation">,</span>data<span class="token operator">=</span>request<span class="token punctuation">.</span>data<span class="token punctuation">,</span>partial<span class="token operator">=</span>partial <span class="token operator">==</span><span class="token operator">&gt;</span> 集过pk 实 验 更 返
GET    多 <span class="token builtin">list</span>      instance<span class="token operator">=</span>p_list<span class="token punctuation">,</span>many<span class="token operator">=</span><span class="token boolean">True</span>                           <span class="token operator">==</span><span class="token operator">&gt;</span> 集过 分 实 返  
GET    单 retrieve  instance<span class="token operator">=</span>instance                                   <span class="token operator">==</span><span class="token operator">&gt;</span> 集过pk 实 返 

<span class="token operator">-</span> <span class="token string">&quot;实例化时传递了data参数&quot;</span> 证明该接口的请求体中需传递一些数据<span class="token punctuation">,</span>有些字段数据是前端必传的
<span class="token operator">-</span> <span class="token string">&quot;验&quot;</span>    正是因为实例化时传递了data参数<span class="token operator">/</span>前端传递了一些数据<span class="token punctuation">,</span>所以需要对这些数据进行验证! <span class="token string">&quot;验&quot;</span>涉及到 增加和更新<span class="token punctuation">.</span>
<span class="token operator">-</span> <span class="token string">&quot;pk&quot;</span>    证明该接口的url中需携带ID参数
<span class="token operator">-</span> <span class="token string">&quot;返&quot;</span>    排除序列化器类中write_only<span class="token operator">=</span><span class="token boolean">True</span>的字段<span class="token punctuation">,</span>剩下的字段返回<span class="token punctuation">(</span>换个说法<span class="token punctuation">,</span>read_only<span class="token operator">=</span><span class="token boolean">True</span>的字段<span class="token operator">+</span>既能读也能写的字段<span class="token punctuation">)</span>
<span class="token operator">-</span> <span class="token string">&quot;增&quot;</span>    必定会使用钩子函数perform_create<span class="token punctuation">,</span>若在该函数中调用了save<span class="token punctuation">,</span>会去序列化器类中找create方法执行!!
<span class="token operator">-</span> <span class="token string">&quot;更&quot;</span>    必定会使用钩子函数perform_update<span class="token punctuation">,</span>若在该函数中调用了save<span class="token punctuation">,</span>会去序列化器类中找update方法执行!!
<span class="token operator">-</span> <span class="token string">&quot;删&quot;</span>    必定会使用钩子函数perform_destroy<span class="token punctuation">,</span>可根据需求进行物理删除和逻辑删除!
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><h5 id="思考步骤"><a href="#思考步骤" class="header-anchor">#</a> 思考步骤</h5> <div class="language-python line-numbers-mode"><pre class="language-python"><code>第一步<span class="token punctuation">:</span> 看需求是什么<span class="token punctuation">,</span>是新增?是删除?是更新?是查找? 明确后<span class="token punctuation">,</span>以<span class="token string">&quot;小口诀&quot;</span>为标准开始编写代码!
第二步<span class="token punctuation">:</span> 当进行到<span class="token string">&quot;验证阶段&quot;</span>以及<span class="token string">&quot;返回序列化数据阶段&quot;</span>时<span class="token punctuation">,</span>需观察序列化器类<span class="token punctuation">,</span>分析出序列化器类中有哪些字段对象<span class="token punctuation">.</span>
       <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>字段类型的类变量<span class="token punctuation">}</span> <span class="token operator">|</span> <span class="token punctuation">{</span>ORM表中的字段名<span class="token punctuation">}</span> 这两者取并集<span class="token punctuation">,</span>前者的优先级高于后者!后者优先级低的会db匹配自动创建<span class="token punctuation">.</span>
第三步<span class="token punctuation">:</span> 对序列化器类中的字段对象进行分类<span class="token punctuation">,</span> 可写<span class="token operator">/</span>可验证、可写<span class="token operator">/</span>可序列化、可读可写<span class="token operator">/</span>即可验证也可序列化<span class="token punctuation">.</span>
       <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">&gt;</span> 换个说法就是 <span class="token keyword">not</span> read_only<span class="token operator">=</span><span class="token boolean">True</span>的字段对象<span class="token string">&quot;可验证的字段对象&quot;</span> 、<span class="token keyword">not</span> write_only<span class="token operator">=</span><span class="token boolean">True</span>的字段对象<span class="token punctuation">.</span><span class="token string">&quot;可序列化的字段对象&quot;</span>
第四步<span class="token punctuation">:</span> 开始产生分支
  <span class="token number">4.1</span> <span class="token string">&quot;验证阶段&quot;</span> 不难分析出<span class="token punctuation">,</span>只有新增和更新才会进行验证<span class="token punctuation">.</span>
      <span class="token number">4.1</span><span class="token number">.1</span>  看序列化器中<span class="token string">&quot;可验证的字段对象&quot;</span>的属性<span class="token punctuation">,</span>判断出哪些是前端必须传的字段!! <span class="token punctuation">(</span>注<span class="token punctuation">:</span>可验证的字段对象
             有默认值和允许为空以及自动生成的字段<span class="token punctuation">,</span>其属性都是不必填的<span class="token punctuation">,</span>即required<span class="token operator">=</span><span class="token boolean">False</span>
             ★ required<span class="token operator">=</span><span class="token boolean">True</span> <span class="token operator">+</span> 可验证的字段 <span class="token operator">==</span> 前端必须传递的字段
      <span class="token number">4.1</span><span class="token number">.2</span>  这些可验证的字段对象验证通过后 与 save有关!!
             <span class="token number">1</span><span class="token operator">&gt;</span> ★ 验证时<span class="token punctuation">,</span>会获取request<span class="token punctuation">.</span>data中 与可序列化字段的字段名对应的值<span class="token punctuation">;</span>
             <span class="token number">2</span><span class="token operator">&gt;</span> ★ save时<span class="token punctuation">,</span>用的是验证通过后的 validated_data<span class="token punctuation">,</span> 得特别注意其键名是source_attrs!
             <span class="token operator">-</span> 新增
               ORM表中的字段除了默认值和允许为空以及自动生成的字段<span class="token punctuation">,</span>前端都必须提供!! <span class="token punctuation">(</span>这个与<span class="token number">4.1</span><span class="token number">.1</span>相辅相成
               在save时<span class="token punctuation">,</span>ORM表里面的字段应该一个不多一个不少!!
             <span class="token operator">-</span> 更新 
               肯定得先表明是对哪个instance进行更新 <span class="token punctuation">(</span>在序列化器类实例化时就已经表明了
               <span class="token operator">-</span> 全局更新PUT   前端必须传递的字段都必须得传
                              除了必传的<span class="token punctuation">,</span>只要Meta的fields中写了的可验证的字段<span class="token punctuation">,</span>传进去都可进行更新！<span class="token punctuation">(</span>前提是可验证的字段哦!
               <span class="token operator">-</span> 局部更新PATCH 前端必须传递的字段变成可选的<span class="token punctuation">,</span>没选上也就不会进行校验 
                              只要Meta的fields中写了的可验证的字段<span class="token punctuation">,</span>传进去都可进行更新！<span class="token punctuation">(</span>前提是可验证的字段哦!
               ▲ 注<span class="token punctuation">:</span>PATCH 还可以不传值<span class="token punctuation">,</span>返回的就是该条记录<span class="token punctuation">,</span>变相的相当于查询该条记录
               ▲ 特别特别注意<span class="token punctuation">,</span>更新时<span class="token punctuation">,</span>只要有字段是ORM表中的字段即可!! 像下面的例子<span class="token punctuation">,</span>Company表中有mobile字段<span class="token punctuation">,</span>并没有old字段!!
                 <span class="token keyword">from</span> apps<span class="token punctuation">.</span>repository <span class="token keyword">import</span> models
                 obj <span class="token operator">=</span> models<span class="token punctuation">.</span>Company<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>mobile<span class="token operator">=</span><span class="token number">13888888881</span><span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>
                 <span class="token keyword">if</span> obj<span class="token punctuation">:</span>
                     <span class="token keyword">print</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>mobile<span class="token punctuation">)</span>  <span class="token comment"># 13888888881</span>
                     obj<span class="token punctuation">.</span>old <span class="token operator">=</span> <span class="token number">13888888881</span>
                     obj<span class="token punctuation">.</span>mobile <span class="token operator">=</span> <span class="token number">13888888882</span>
                     obj<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span>
                 <span class="token keyword">print</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>mobile<span class="token punctuation">)</span>  <span class="token comment"># 13888888882</span>
                 <span class="token keyword">print</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>old<span class="token punctuation">)</span>  <span class="token comment"># 13888888881</span>
  <span class="token number">4.2</span> <span class="token string">&quot;返回序列化数据阶段&quot;</span>
      本质就是对 <span class="token string">&quot;可序列化的字段对象&quot;</span> 进行序列化返回!!         
      <span class="token operator">-</span> 无论save是新增还是更新 save<span class="token punctuation">(</span><span class="token punctuation">)</span>返回的instance都会提供给ser<span class="token punctuation">.</span>data使用! 
        进行序列化返回时<span class="token punctuation">,</span>执行的是 <span class="token string">&quot;instance.字段对象的source_attr&quot;</span> 的操作!!       
      <span class="token operator">-</span> 若验证后没有save直接序列化<span class="token punctuation">,</span>序列化的数据是ser<span class="token punctuation">.</span>validated_data 
        ▽ 但要注意<span class="token punctuation">,</span>这并不意味着序列化的结果就是ser<span class="token punctuation">.</span>validated_data中的那些字段  <span class="token punctuation">(</span>看序列化过程的源码就明白的<span class="token punctuation">.</span>
          有时<span class="token punctuation">,</span>序列化器类中有的字段只读<span class="token punctuation">,</span>但它允许为空<span class="token punctuation">,</span>也会被序列化出来!! 所以啊<span class="token punctuation">,</span>要抓住重点<span class="token punctuation">,</span>是序列化器类中的那些可读字段!!
      <span class="token operator">-</span> 如果是纯粹的序列化<span class="token punctuation">,</span>就是序列化器类实例化时传进来的instance进行序列化 <span class="token punctuation">(</span>可参考纯序列化的那篇博文<span class="token punctuation">)</span>
                                                                 
PS<span class="token punctuation">:</span>开发过程中<span class="token punctuation">,</span>遇到了一个很有趣的现象
   <span class="token operator">-</span> 我在perform_create中这样写<span class="token punctuation">.</span>进行测试<span class="token punctuation">,</span>是通的<span class="token punctuation">.</span>
   <span class="token keyword">def</span> <span class="token function">perform_create</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> serializer<span class="token punctuation">)</span><span class="token punctuation">:</span>
       <span class="token keyword">print</span><span class="token punctuation">(</span>serializer<span class="token punctuation">.</span>data<span class="token punctuation">)</span>  <span class="token comment"># 虽说,这里序列化用的数据是ser.validated_data,但结果是序列化器类中可读的字段哦.</span>
       <span class="token keyword">return</span> Response<span class="token punctuation">(</span><span class="token string">&quot;ok&quot;</span><span class="token punctuation">)</span>
   <span class="token operator">-</span> 但在perform_create中先serializer<span class="token punctuation">.</span>data<span class="token punctuation">,</span>在serializer<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span>是会报错的!!
     究其原因<span class="token punctuation">,</span>serializer<span class="token punctuation">.</span>data后序列化器类的self<span class="token punctuation">.</span>_data就有值了
     在进行serializer<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span>时<span class="token punctuation">,</span>会断言<span class="token keyword">assert</span> <span class="token keyword">not</span> <span class="token builtin">hasattr</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token string">'_data'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>  
     这样的操作是不被允许的<span class="token punctuation">,</span>别问为啥!源码里这么规定的<span class="token punctuation">,</span>不要纠结!!
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br></div></div><h5 id="设置只读只写的技巧"><a href="#设置只读只写的技巧" class="header-anchor">#</a> 设置只读只写的技巧</h5> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token operator">-</span> 在ORM表中的字段若设置了属性choices<span class="token punctuation">,</span>那么在序列化器类中<span class="token punctuation">,</span>一般会写额外字段让其返回前端中文<span class="token punctuation">.</span>
  <span class="token operator">-</span> 这些额外的字段往往都会设置 read_only<span class="token operator">=</span><span class="token boolean">True</span> !!
  <span class="token operator">-</span> 这些额外的字段<span class="token punctuation">,</span>也可分两种情况 
    命名为 topic <span class="token operator">-</span><span class="token operator">&gt;</span> topic_title 、或者说就用ORM表中的字段名 status <span class="token operator">-</span><span class="token operator">&gt;</span> status <span class="token punctuation">(</span>这种情况准确点说是重写<span class="token punctuation">)</span>
    <span class="token operator">-</span> 像这里的topic往往会对其设置 write_only<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> 因为有topic_title了<span class="token punctuation">,</span>无需重复返回含义相同的数据
    <span class="token operator">-</span> 像这里关于状态的status就单纯的返回给前端用户<span class="token punctuation">,</span>因为分析需求可明确前端不用传status
<span class="token operator">-</span> 尽管序列化器类用到了某张ORM表
  但某个业务的开发<span class="token punctuation">(</span>比如某业务包含资讯的创建和返回列表数据<span class="token punctuation">)</span>
  是不需要前端传递某些字段数据的<span class="token punctuation">,</span>只需返回前端
  <span class="token punctuation">(</span>eg<span class="token punctuation">:</span>News表中的collect_count收藏数<span class="token punctuation">,</span> recommend_count推荐数<span class="token punctuation">,</span> comment_count点赞数<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> 单纯为了减少查询设计的!!
  那么就给这些字段设置 read_only<span class="token operator">=</span><span class="token boolean">True</span> !!
  

⚠️ 注意!! 别一味的使用read_only_fields、write_only_fields
https<span class="token punctuation">:</span><span class="token operator">//</span>stackoverflow<span class="token punctuation">.</span>com<span class="token operator">/</span>questions<span class="token operator">/</span><span class="token number">68946823</span><span class="token operator">/</span>django<span class="token operator">-</span>drf<span class="token operator">-</span>read<span class="token operator">-</span>only<span class="token operator">-</span>fields<span class="token operator">-</span><span class="token keyword">not</span><span class="token operator">-</span>working<span class="token operator">-</span>properly
验证代码<span class="token punctuation">:</span>
  serializer <span class="token operator">=</span> self<span class="token punctuation">.</span>get_serializer<span class="token punctuation">(</span>data<span class="token operator">=</span>request<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
  <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;****&quot;</span><span class="token punctuation">,</span> <span class="token builtin">repr</span><span class="token punctuation">(</span>serializer<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;****&quot;</span><span class="token punctuation">,</span> serializer<span class="token punctuation">.</span>_declared_fields<span class="token punctuation">)</span>
  <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;****&quot;</span><span class="token punctuation">,</span> serializer<span class="token punctuation">.</span>get_extra_kwargs<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
☆ 简单来说<span class="token punctuation">,</span>序列化器类中字段类型的类变量别用read_only_fields、write_only_fields<span class="token punctuation">,</span>用了也不会生效!!
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><h5 id="一些小锦囊"><a href="#一些小锦囊" class="header-anchor">#</a> 一些小锦囊</h5> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token operator">-</span> write_only 跟验证、save有关 <span class="token punctuation">;</span> read_only 跟序列化返回有关!!
<span class="token operator">-</span> ser<span class="token punctuation">.</span>validated_data验证通过后才会有、那么在验证过程中使用self<span class="token punctuation">.</span>initial_data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'password'</span><span class="token punctuation">)</span>
<span class="token operator">-</span> 视图类中的方法<span class="token string">&quot;皆&quot;</span>可以通过 self<span class="token punctuation">.</span>request 拿到请求相关数据
  源码出处<span class="token punctuation">:</span> dispatch方法
    request <span class="token operator">=</span> self<span class="token punctuation">.</span>initialize_request<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>  <span class="token comment"># 二次封装的request</span>
    self<span class="token punctuation">.</span>request <span class="token operator">=</span> request     
<span class="token operator">-</span> 序列化器类中的方法<span class="token string">&quot;皆&quot;</span>可以通过 self<span class="token punctuation">.</span>context<span class="token punctuation">[</span><span class="token string">&quot;request&quot;</span><span class="token punctuation">]</span> 拿到请求相关的数据
  源码出处<span class="token punctuation">:</span> 
  <span class="token number">1</span><span class="token operator">&gt;</span> 第一步先看<span class="token punctuation">:</span> drf的GenericAPIView类中关于序列化器类实例化的方法get_serializerg
  <span class="token keyword">def</span> <span class="token function">get_serializer</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
      serializer_class <span class="token operator">=</span> self<span class="token punctuation">.</span>get_serializer_class<span class="token punctuation">(</span><span class="token punctuation">)</span>
      kwargs<span class="token punctuation">.</span>setdefault<span class="token punctuation">(</span><span class="token string">'context'</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>get_serializer_context<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token keyword">return</span> serializer_class<span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>           
  <span class="token keyword">def</span> <span class="token function">get_serializer_context</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>
          <span class="token string">'request'</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>request<span class="token punctuation">,</span>
          <span class="token string">'format'</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>format_kwarg<span class="token punctuation">,</span>
          <span class="token string">'view'</span><span class="token punctuation">:</span> self
      <span class="token punctuation">}</span>      
  <span class="token number">2</span><span class="token operator">&gt;</span> 第二步<span class="token punctuation">,</span>看序列化器类在实例化时<span class="token punctuation">,</span>触发的__init__ 根据继承关系<span class="token punctuation">,</span>在BaseSerializer里
  self<span class="token punctuation">.</span>_context <span class="token operator">=</span> kwargs<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token string">'context'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token number">3</span><span class="token operator">&gt;</span> 第三步<span class="token punctuation">,</span>找context方法!! 在BaseSerializer的父类Field里
  <span class="token decorator annotation punctuation">@property</span>
  <span class="token keyword">def</span> <span class="token function">context</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
      <span class="token keyword">return</span> <span class="token builtin">getattr</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>root<span class="token punctuation">,</span> <span class="token string">'_context'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>  
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><h5 id="错误信息"><a href="#错误信息" class="header-anchor">#</a> 错误信息</h5> <div class="language-python line-numbers-mode"><pre class="language-python"><code>★ 关于错误信息<span class="token punctuation">,</span>我们习惯于这样
<span class="token operator">-</span> 详细的<span class="token punctuation">,</span>具体的错误信息 code <span class="token operator">+</span> detail    detail类似于<span class="token punctuation">{</span><span class="token string">'username'</span><span class="token punctuation">:</span><span class="token punctuation">[</span>错误信息<span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'phone'</span><span class="token punctuation">:</span><span class="token punctuation">[</span>xxxx<span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">}</span>
<span class="token operator">-</span> 整体的错误信息 code <span class="token operator">+</span> error
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h5 id="何时serializer"><a href="#何时serializer" class="header-anchor">#</a> 何时Serializer</h5> <div class="language-python line-numbers-mode"><pre class="language-python"><code>Q ★ 什么时候使用serializers<span class="token punctuation">.</span>ModelSerializer 什么时候使用serializers<span class="token punctuation">.</span>Serializer?  <span class="token operator">==</span><span class="token operator">&gt;</span> eg<span class="token punctuation">:</span>登陆
A ★ 其实没啥标准<span class="token punctuation">,</span>只需要知道
    <span class="token number">1.</span> ModelSerializer可以帮我们自动生成字段对象
    <span class="token number">2.</span> ModelSerializer可以自动save<span class="token punctuation">,</span>若使用serializers<span class="token punctuation">.</span>Serializer时save<span class="token punctuation">,</span>需重写create和update
    这两点都不需要<span class="token punctuation">,</span>那么我们就直接用serializers<span class="token punctuation">.</span>Serializer也是无碍的!!
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><hr> <h2 id="account"><a href="#account" class="header-anchor">#</a> account</h2> <blockquote><p>用户表相关 登陆、注册</p></blockquote> <h3 id="注册"><a href="#注册" class="header-anchor">#</a> 注册</h3> <blockquote><p>细节还是蛮多的</p></blockquote> <p><img src="/assets/img/image-20240112160726067.b45cf47a.png" alt="image-20240112160726067"></p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token operator">==</span> 需求 <span class="token operator">==</span>
<span class="token number">1</span><span class="token operator">&gt;</span> 用户输入 用户名、手机号、密码、重复密码<span class="token punctuation">.</span>  <span class="token operator">-</span><span class="token operator">-</span>  ORM表中没有重复密码字段<span class="token punctuation">,</span> confirm_password是自己写的额外字段!!  
<span class="token number">2</span><span class="token operator">&gt;</span> 用户名、手机号都是唯一的并且是未删除的<span class="token punctuation">(</span>即所有未删除的用户用户名、手机号都未重复<span class="token punctuation">)</span>
   输入的密码得一致!  
       <span class="token operator">-</span><span class="token operator">-</span> 看字段的钩子<span class="token punctuation">.</span>其中注意查询语句条件 <span class="token builtin">filter</span><span class="token punctuation">(</span>phone<span class="token operator">=</span>value<span class="token punctuation">,</span> deleted<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
<span class="token number">3</span><span class="token operator">&gt;</span> 返回给前端的数据中<span class="token punctuation">,</span> 不能返回密码相关的信息<span class="token punctuation">.</span>  <span class="token operator">-</span><span class="token operator">-</span> password、confirm_password 都是write_only<span class="token operator">=</span><span class="token boolean">True</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="登陆"><a href="#登陆" class="header-anchor">#</a> 登陆</h3> <blockquote><p>很好的阐述了啥时候直接用APIView, 啥时候直接使用serializers.Serializer</p></blockquote> <p><img src="/assets/img/image-20240112174554332.e193d11c.png" alt="image-20240112174554332"></p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token operator">==</span> 需求 <span class="token operator">==</span>
输入<span class="token punctuation">:</span> <span class="token punctuation">[</span>手机号 或 用户名<span class="token punctuation">]</span> <span class="token operator">+</span> 密码
注意<span class="token punctuation">:</span> 登录成功后给用户返回token<span class="token punctuation">,</span>后续请求需要在url参数中携带token值用于后端认证组件的校验 <span class="token punctuation">(</span>默认设置有效期为<span class="token number">2</span>周<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><hr> <h2 id="topic"><a href="#topic" class="header-anchor">#</a> topic</h2> <blockquote><p>关于话题的四个接口!! 创建、删除、更新某一条、查看多条   值得细品!!  (查看单条的接口该话题示例中没有)</p></blockquote> <p><img src="/assets/img/image-20240112200011410.4090f99b.png" alt="image-20240112200011410"></p> <p><font color="gray">Ps: 其实你细品, TopicSeralizer的fields里的is_hot和extra_kwargs里的is_hot不写, 没有任何的影响!!</font><br> <font color="gray">Ps: 获取多条数据是用到了分页的, 该分页的配置是全局的!! 注-没有用到offset,因为该偏移会使用latest_id!!</font></p> <p><img src="/assets/img/image-20240112200459468.2924ba58.png" alt="image-20240112200459468"></p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token operator">-</span> 创建
http<span class="token punctuation">:</span><span class="token operator">//</span><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token punctuation">:</span><span class="token number">8000</span><span class="token operator">/</span>api<span class="token operator">/</span>topic?token<span class="token operator">=</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>  POST <span class="token punctuation">{</span><span class="token string">&quot;title&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;树胶&quot;</span><span class="token punctuation">}</span>
<span class="token operator">-</span> 删除 !!逻辑删除
http<span class="token punctuation">:</span><span class="token operator">//</span><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token punctuation">:</span><span class="token number">8000</span><span class="token operator">/</span>api<span class="token operator">/</span>topic<span class="token operator">/</span><span class="token number">7</span>?token<span class="token operator">=</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> DELETE
<span class="token operator">-</span> 更新
http<span class="token punctuation">:</span><span class="token operator">//</span><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token punctuation">:</span><span class="token number">8000</span><span class="token operator">/</span>api<span class="token operator">/</span>topic<span class="token operator">/</span><span class="token number">10</span>?token<span class="token operator">=</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> PUT <span class="token punctuation">{</span><span class="token string">&quot;title&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;啊哈哈&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;is_hot&quot;</span><span class="token punctuation">:</span>true<span class="token punctuation">}</span> is_hot传过去没用!!
<span class="token operator">-</span> 查找多条 limit获取几条数据<span class="token punctuation">,</span>全局分页里的配置是默认获取<span class="token number">10</span>条
前端先发送  GET <span class="token operator">/</span>api<span class="token operator">/</span>topic<span class="token operator">/</span>?token<span class="token operator">=</span>1d390bae<span class="token operator">-</span>a4c1<span class="token operator">-</span><span class="token number">41e4</span><span class="token operator">&amp;</span>limit<span class="token operator">=</span><span class="token number">1</span> 前端得到的最后一条数据<span class="token builtin">id</span>值为<span class="token number">7</span>
前端再发送  GET <span class="token operator">/</span>api<span class="token operator">/</span>topic<span class="token operator">/</span>?token<span class="token operator">=</span>1d390bae<span class="token operator">-</span>a4c1<span class="token operator">-</span><span class="token number">41e4</span><span class="token operator">&amp;</span>limit<span class="token operator">=</span><span class="token number">1</span><span class="token operator">&amp;</span>latest_id<span class="token operator">=</span><span class="token number">7</span>

Ps<span class="token punctuation">:</span> is_hot是表明该话题是否是热门话题<span class="token punctuation">,</span>应该由管理员来设置!!
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><hr> <h2 id="news"><a href="#news" class="header-anchor">#</a> news</h2> <blockquote><p>资讯相关接口.   新增资讯、查看用户自己的资讯列表 -- 注意哦,这两个接口是经历了全局认证组件的.
★ 这里对限流组件的源码进行了重写以满足需求.</p></blockquote> <p><img src="/assets/img/image-20240116225003151.c66dc22f.png" alt="image-20240116225003151"></p> <p>PS: 使用限流组件,记得进行redis的配置!!</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token punctuation">[</span>需求<span class="token number">1</span><span class="token punctuation">]</span> 创建资讯
<span class="token number">1</span><span class="token operator">&gt;</span> 用户在创建资讯有三个选择按钮 文字、图片、链接
   <span class="token operator">-</span> 文字   title必填、分区必选<span class="token punctuation">(</span>但无图片选项<span class="token punctuation">)</span>、话题可选
   <span class="token operator">-</span> 图片   title必填、img图片地址必传、分区必选、话题可选
   <span class="token operator">-</span> 链接   title必填、url链接地址必传、分区必选、话题可选
   PS<span class="token punctuation">:</span>分区<span class="token operator">&gt;</span> 图片、你问我答、<span class="token number">42</span>区、挨踢<span class="token number">1024</span>、段子
   需求解析 <span class="token operator">==</span><span class="token operator">&gt;</span> 
     在title的勾子里判断<span class="token punctuation">,</span>img和url肯定不能同时传、img和url都没有的话<span class="token punctuation">,</span>则分区的选项不能是图片<span class="token punctuation">.</span>
     在topic的勾子里判断<span class="token punctuation">,</span>选择的话题得是用户自己创建的话题<span class="token punctuation">,</span>或者是管理员设置的热门话题<span class="token punctuation">.</span> <span class="token punctuation">(</span>管理员设置的热门话题这个暂时未实现<span class="token punctuation">)</span>
<span class="token number">2</span><span class="token operator">&gt;</span> 用户在新增资讯时<span class="token punctuation">,</span>默认给自己一个推荐!!
   需求解析 <span class="token operator">==</span><span class="token operator">&gt;</span>
     需要完成两个功能
     <span class="token operator">-</span> 其<span class="token number">1</span> <span class="token operator">-</span> News表新增一条记录<span class="token punctuation">,</span>新增时<span class="token punctuation">,</span>recommend_count推荐数等于<span class="token number">1</span>
     <span class="token operator">-</span> 其<span class="token number">2</span> <span class="token operator">-</span> Recommend推荐表<span class="token punctuation">,</span>新增一条推荐记录!! <span class="token punctuation">(</span>当然取消推荐时<span class="token punctuation">,</span>该条记录要删除<span class="token punctuation">.</span><span class="token punctuation">)</span>
     在何处编写上述两点<span class="token punctuation">,</span> 在perform_create新增勾子里<span class="token punctuation">.</span>
     方案<span class="token number">1</span><span class="token punctuation">:</span> 两个功能点全部写在perform_create勾子里<span class="token punctuation">.</span>
     方案<span class="token number">2</span><span class="token punctuation">:</span> 在相对应的序列化器类中重写create方法里完成这两个功能
           perform_create勾子里执行save方法时会调用优先调用这个重写的create方法<span class="token punctuation">.</span>而不是ModelSerializer里的create<span class="token punctuation">.</span>
<span class="token number">3</span><span class="token operator">&gt;</span> 用户创建资讯<span class="token punctuation">,</span>需要进行限流!!
   使用drf的默认的限流组件<span class="token punctuation">,</span>要解决两个问题<span class="token punctuation">:</span> <span class="token punctuation">(</span>需修改限流组件的源码!!<span class="token punctuation">)</span>
   <span class="token number">1</span><span class="token operator">&gt;</span> drf的限流组件默认不支持 <span class="token number">2</span><span class="token operator">/</span>5min<span class="token punctuation">;</span> 只支持 <span class="token number">2</span><span class="token operator">/</span>m、<span class="token number">5</span><span class="token operator">/</span>h
   <span class="token number">2</span><span class="token operator">&gt;</span> 资讯创建成功后<span class="token punctuation">,</span>下一次创建才限流<span class="token punctuation">;</span>若该次资讯创建失败了<span class="token punctuation">,</span>是可以接着创建的!!
   <span class="token number">3</span><span class="token operator">&gt;</span> <span class="token punctuation">(</span>´･Д･<span class="token punctuation">)</span>」限流只对创建有效<span class="token punctuation">,</span>查询多条是不需要限流的!!
<span class="token operator">-</span> 创建
  成功的情况 <span class="token operator">/</span>api<span class="token operator">/</span>news<span class="token operator">/</span>?token<span class="token operator">=</span>1d390bae<span class="token operator">-</span>a4c1<span class="token operator">-</span><span class="token number">41e4</span>  POST  <span class="token punctuation">{</span><span class="token string">&quot;title&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;1121&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;zone&quot;</span><span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">}</span>
  失败的情况 <span class="token operator">/</span>api<span class="token operator">/</span>news<span class="token operator">/</span>?token<span class="token operator">=</span>1d390bae<span class="token operator">-</span>a4c1<span class="token operator">-</span><span class="token number">41e4</span>  POST  <span class="token punctuation">{</span><span class="token string">&quot;title&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;1131&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;zone&quot;</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">}</span>
      <span class="token operator">-</span> 返回 <span class="token punctuation">{</span><span class="token string">&quot;code&quot;</span><span class="token punctuation">:</span><span class="token number">1001</span><span class="token punctuation">,</span><span class="token string">&quot;detail&quot;</span><span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token string">&quot;title&quot;</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">&quot;分区选择错误&quot;</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
  限流 <span class="token operator">/</span>api<span class="token operator">/</span>news<span class="token operator">/</span>?token<span class="token operator">=</span>1d390bae<span class="token operator">-</span>a4c1<span class="token operator">-</span><span class="token number">41e4</span>  POST  <span class="token punctuation">{</span><span class="token string">&quot;title&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;1131&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;zone&quot;</span><span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">}</span>
      <span class="token operator">-</span> 返回 <span class="token punctuation">{</span><span class="token string">&quot;code&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;4000&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;data&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;访问频率限制&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;detail&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;需等待221秒后才能访问&quot;</span><span class="token punctuation">}</span>

<span class="token punctuation">[</span>需求<span class="token number">2</span><span class="token punctuation">]</span> 用户自己的资讯列表
   PS<span class="token punctuation">:</span>与上面的话题的创建并无二样<span class="token punctuation">.</span>
<span class="token operator">-</span> 获取资讯列表 limit获取几条数据<span class="token punctuation">,</span>全局分页里的配置是默认获取<span class="token number">10</span>条
  前端先发送  GET <span class="token operator">/</span>api<span class="token operator">/</span>news<span class="token operator">/</span>?token<span class="token operator">=</span>1d390bae<span class="token operator">-</span>a4c1<span class="token operator">-</span><span class="token number">41e4</span><span class="token operator">&amp;</span>limit<span class="token operator">=</span><span class="token number">1</span> 前端得到的最后一条数据<span class="token builtin">id</span>值为<span class="token number">7</span> 
  前端再发送  GET <span class="token operator">/</span>api<span class="token operator">/</span>news<span class="token operator">/</span>?token<span class="token operator">=</span>1d390bae<span class="token operator">-</span>a4c1<span class="token operator">-</span><span class="token number">41e4</span><span class="token operator">&amp;</span>limit<span class="token operator">=</span><span class="token number">2</span><span class="token operator">&amp;</span>latest_id<span class="token operator">=</span><span class="token number">7</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><p><strong>特别注意:</strong> 若序列化器类像这么写, 'topic_title', 'zone_title', 'status' 他们仨的read_only=True的设置不会生效!!</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">NewsSerializer</span><span class="token punctuation">(</span>serializers<span class="token punctuation">.</span>ModelSerializer<span class="token punctuation">)</span><span class="token punctuation">:</span>
    image_list <span class="token operator">=</span> serializers<span class="token punctuation">.</span>SerializerMethodField<span class="token punctuation">(</span><span class="token punctuation">)</span>
    topic_title <span class="token operator">=</span> serializers<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>source<span class="token operator">=</span><span class="token string">&quot;topic.title&quot;</span><span class="token punctuation">)</span>
    zone_title <span class="token operator">=</span> serializers<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>source<span class="token operator">=</span><span class="token string">&quot;get_zone_display&quot;</span><span class="token punctuation">)</span>
    status <span class="token operator">=</span> serializers<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>source<span class="token operator">=</span><span class="token string">&quot;get_status_display&quot;</span><span class="token punctuation">)</span>

    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span>
        model <span class="token operator">=</span> models<span class="token punctuation">.</span>News
        fields <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">,</span> <span class="token string">&quot;title&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;url&quot;</span><span class="token punctuation">,</span>
                  <span class="token string">'image'</span><span class="token punctuation">,</span> <span class="token string">'topic'</span><span class="token punctuation">,</span> <span class="token string">&quot;zone&quot;</span><span class="token punctuation">,</span>
                  <span class="token string">'image_list'</span><span class="token punctuation">,</span> <span class="token string">&quot;topic_title&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;zone_title&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;status&quot;</span><span class="token punctuation">,</span>
                  <span class="token string">'collect_count'</span><span class="token punctuation">,</span> <span class="token string">'recommend_count'</span><span class="token punctuation">,</span> <span class="token string">'comment_count'</span><span class="token punctuation">]</span>
        write_only_fields <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'image'</span><span class="token punctuation">,</span> <span class="token string">'topic'</span><span class="token punctuation">,</span> <span class="token string">'zone'</span><span class="token punctuation">]</span>
        read_only_fields <span class="token operator">=</span> <span class="token punctuation">[</span>
            <span class="token string">'topic_title'</span><span class="token punctuation">,</span> <span class="token string">'zone_title'</span><span class="token punctuation">,</span> <span class="token string">'status'</span><span class="token punctuation">,</span>
            <span class="token string">'collect_count'</span><span class="token punctuation">,</span> <span class="token string">'recommend_count'</span><span class="token punctuation">,</span> <span class="token string">'comment_count'</span>
        <span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><hr> <h2 id="index"><a href="#index" class="header-anchor">#</a> index</h2> <blockquote><p>首页 就一个列表展示的接口.</p></blockquote> <div class="language-python line-numbers-mode"><pre class="language-python"><code>资讯首页
	<span class="token operator">-</span><span class="token number">1</span><span class="token operator">-</span> 时间倒序<span class="token punctuation">,</span>读取未删除的已审核通过的资讯
	<span class="token operator">-</span><span class="token number">2</span><span class="token operator">-</span> 加载更多<span class="token punctuation">,</span>分页处理 ?limit<span class="token operator">=</span><span class="token number">2</span><span class="token operator">&amp;</span>latest_id<span class="token operator">=</span><span class="token number">7</span>
	<span class="token operator">-</span><span class="token number">3</span><span class="token operator">-</span> 支持传入参数<span class="token punctuation">,</span>查询各分区资讯<span class="token punctuation">:</span> 图片、你问我答、<span class="token number">42</span>区、挨踢<span class="token number">1024</span>、段子 ?zone<span class="token operator">=</span><span class="token number">2</span>
  <span class="token operator">-</span><span class="token number">4</span><span class="token operator">-</span> 用户登陆和未登录展示的首页有些许不一样
      <span class="token operator">-</span> 首页展示的内容<span class="token punctuation">,</span>无需是自己的<span class="token punctuation">,</span>没有该限制
      <span class="token operator">-</span> 登陆后<span class="token punctuation">,</span>若当前登陆用户对该篇资讯进行了推荐、收藏<span class="token punctuation">,</span>那个图标会点亮 
       （使用认证类<span class="token operator">&lt;</span>该认证类可登陆可不登陆<span class="token punctuation">,</span>登陆request<span class="token punctuation">.</span>user有值<span class="token punctuation">,</span>未登录值为<span class="token boolean">None</span><span class="token operator">&gt;</span>结合字段钩子来实现
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>关键代码如下: 再次提醒几点, 一是可登陆亦可不登陆的认证类,二是嵌套,三是该首页数据的展示无需是自己的..<br>
关于<font color="red">外键字段 按照我们的心意进行展示!</font> 详见 <code>序列化+验证.md</code> 这篇博文!! 里面写了三种方式!</p> <p><img src="/assets/img/image-20240117140512356.255c1040.png" alt="image-20240117140512356"></p> <hr> <h2 id="collect"><a href="#collect" class="header-anchor">#</a> collect</h2> <blockquote><p>收藏</p></blockquote> <p><img src="/assets/img/image-20240117195331270.25190465.png" alt="image-20240117195331270"></p> <p>关于<font color="red">外键字段 按照我们的心意进行展示!</font> 详见 <code>序列化+验证.md</code> 这篇博文!! 里面写了三种方式!</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token punctuation">[</span>需求<span class="token number">1</span><span class="token punctuation">]</span> 收藏、取消收藏 共用一个接口
<span class="token operator">-</span> 不难分析出<span class="token punctuation">,</span>用户只需传news字段<span class="token punctuation">,</span>因为认证通过后<span class="token punctuation">,</span>后端能自己拿到当前登陆的user
  还需对该news字段做校验<span class="token punctuation">,</span>得保证该资讯是未删除的是存在的!!
<span class="token operator">-</span> 在perform_create中判断
  若当前登陆用户未收藏该资讯 <span class="token string">&quot;未收藏 --&gt; 已收藏 即添加一条收藏记录&quot;</span> <span class="token operator">+</span> 该资讯的收藏数加<span class="token number">1</span>
  若当前登陆用户已收藏该资讯 <span class="token string">&quot;已收藏 --&gt; 取消收藏 即删除这条收藏记录&quot;</span> <span class="token operator">+</span> 该资讯的收藏数减<span class="token number">1</span>
  此示例代码在perform_create进行了<span class="token keyword">return</span><span class="token punctuation">,</span>那么返回给前端的数据就使用<span class="token keyword">return</span>的数据!看DigCreateModelMixin类的代码就清楚啦<span class="token punctuation">.</span>
  注<span class="token punctuation">:</span>返回的数据中<span class="token punctuation">,</span>包含active字段<span class="token punctuation">,</span>设计该值是为了告诉前端此次接口是收藏还是取消收藏!!
     若active值为<span class="token boolean">True</span><span class="token punctuation">,</span>那表明此次接口进行的是收藏的操作<span class="token punctuation">,</span>若active的值为<span class="token boolean">False</span><span class="token punctuation">,</span>则表明此次接口进行的是取消收藏的操作!
先收藏    POST  http<span class="token punctuation">:</span><span class="token operator">//</span><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token punctuation">:</span><span class="token number">8000</span><span class="token operator">/</span>api<span class="token operator">/</span>collect<span class="token operator">/</span>  <span class="token punctuation">{</span><span class="token string">&quot;news&quot;</span><span class="token punctuation">:</span><span class="token number">10</span><span class="token punctuation">}</span>  <span class="token operator">-</span><span class="token operator">-</span> <span class="token punctuation">{</span><span class="token string">&quot;code&quot;</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">&quot;data&quot;</span><span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token string">&quot;active&quot;</span><span class="token punctuation">:</span>true<span class="token punctuation">}</span><span class="token punctuation">}</span>
再取消收藏 POST  http<span class="token punctuation">:</span><span class="token operator">//</span><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token punctuation">:</span><span class="token number">8000</span><span class="token operator">/</span>api<span class="token operator">/</span>collect<span class="token operator">/</span>  <span class="token punctuation">{</span><span class="token string">&quot;news&quot;</span><span class="token punctuation">:</span><span class="token number">10</span><span class="token punctuation">}</span>  <span class="token operator">-</span><span class="token operator">-</span> <span class="token punctuation">{</span><span class="token string">&quot;code&quot;</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">&quot;data&quot;</span><span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token string">&quot;active&quot;</span><span class="token punctuation">:</span>false<span class="token punctuation">}</span><span class="token punctuation">}</span>

<span class="token punctuation">[</span>需求<span class="token number">2</span><span class="token punctuation">]</span> 收藏列表
该需求的实现<span class="token punctuation">,</span>跟前面的类似<span class="token punctuation">,</span>就不赘述了<span class="token punctuation">.</span>
注<span class="token punctuation">:</span> 收藏相关的ORM表中有两个外键字段<span class="token punctuation">,</span>news、user<span class="token punctuation">,</span>若想打印外键字段具体的信息<span class="token punctuation">,</span>可以使用嵌套!!
    但若嵌套字段的名字与ORM表中外键字段的名字不一样<span class="token punctuation">,</span>需要给序列化器类中设定的这个嵌套字段设置source值<span class="token punctuation">,</span>
    source值为ORM表中的外键字段名!! 别问为啥<span class="token punctuation">,</span>必须这样设置!
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><hr> <h2 id="recommend"><a href="#recommend" class="header-anchor">#</a> recommend</h2> <blockquote><p>推荐.     代码逻辑跟收藏不能说一样,只能是一模一样!!</p></blockquote> <p><img src="/assets/img/image-20240117200122072.995ade57.png" alt="image-20240117200122072"></p> <hr> <h2 id="comment"><a href="#comment" class="header-anchor">#</a> comment</h2> <blockquote><p>评论.     新增评论、查看评论列表!</p></blockquote> <p><img src="/assets/img/image-20240118200013595.f0deb67a.png" alt="image-20240118200013595"></p> <p>分析如下:</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">Comment</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot; 评论表 &quot;&quot;&quot;</span>
    news <span class="token operator">=</span> models<span class="token punctuation">.</span>ForeignKey<span class="token punctuation">(</span>verbose_name<span class="token operator">=</span><span class="token string">&quot;资讯&quot;</span><span class="token punctuation">,</span> to<span class="token operator">=</span><span class="token string">&quot;News&quot;</span><span class="token punctuation">,</span> on_delete<span class="token operator">=</span>models<span class="token punctuation">.</span>CASCADE<span class="token punctuation">)</span>
    user <span class="token operator">=</span> models<span class="token punctuation">.</span>ForeignKey<span class="token punctuation">(</span>verbose_name<span class="token operator">=</span><span class="token string">&quot;用户&quot;</span><span class="token punctuation">,</span> to<span class="token operator">=</span><span class="token string">&quot;UserInfo&quot;</span><span class="token punctuation">,</span> on_delete<span class="token operator">=</span>models<span class="token punctuation">.</span>CASCADE<span class="token punctuation">)</span>
    content <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>verbose_name<span class="token operator">=</span><span class="token string">&quot;内容&quot;</span><span class="token punctuation">,</span> max_length<span class="token operator">=</span><span class="token number">150</span><span class="token punctuation">)</span>
    <span class="token comment"># 默认值</span>
    depth <span class="token operator">=</span> models<span class="token punctuation">.</span>IntegerField<span class="token punctuation">(</span>verbose_name<span class="token operator">=</span><span class="token string">&quot;深度&quot;</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token comment"># 可为空的</span>
    root <span class="token operator">=</span> models<span class="token punctuation">.</span>ForeignKey<span class="token punctuation">(</span>
      verbose_name<span class="token operator">=</span><span class="token string">&quot;根评论&quot;</span><span class="token punctuation">,</span> to<span class="token operator">=</span><span class="token string">&quot;Comment&quot;</span><span class="token punctuation">,</span> related_name<span class="token operator">=</span><span class="token string">&quot;descendant&quot;</span><span class="token punctuation">,</span> 
      on_delete<span class="token operator">=</span>models<span class="token punctuation">.</span>CASCADE<span class="token punctuation">,</span> null<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> blank<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    reply <span class="token operator">=</span> models<span class="token punctuation">.</span>ForeignKey<span class="token punctuation">(</span>
      verbose_name<span class="token operator">=</span><span class="token string">&quot;回复&quot;</span><span class="token punctuation">,</span> to<span class="token operator">=</span><span class="token string">&quot;Comment&quot;</span><span class="token punctuation">,</span> related_name<span class="token operator">=</span><span class="token string">&quot;reply_list&quot;</span><span class="token punctuation">,</span>
      on_delete<span class="token operator">=</span>models<span class="token punctuation">.</span>CASCADE<span class="token punctuation">,</span> null<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> blank<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    <span class="token comment"># 自动添加的</span>
    create_datetime <span class="token operator">=</span> models<span class="token punctuation">.</span>DateTimeField<span class="token punctuation">(</span>verbose_name<span class="token operator">=</span><span class="token string">&quot;创建时间&quot;</span><span class="token punctuation">,</span> auto_now_add<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    descendant_update_datetime <span class="token operator">=</span> models<span class="token punctuation">.</span>DateTimeField<span class="token punctuation">(</span>verbose_name<span class="token operator">=</span><span class="token string">&quot;后代更新时间&quot;</span><span class="token punctuation">,</span> auto_now_add<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>    
 

注<span class="token punctuation">:</span>创建评论需要认证、查看评论不需要认证   
<span class="token punctuation">[</span>需求<span class="token number">1</span><span class="token punctuation">]</span> 创建评论 <span class="token string">&quot;实验增返&quot;</span>
<span class="token operator">-</span> news    给哪条评论进行评论
<span class="token operator">-</span> reply   给哪个评论进行回复
<span class="token operator">-</span> content 评论的内容
<span class="token operator">-</span> deptch  评论的深度<span class="token punctuation">,</span>它不需要传<span class="token punctuation">,</span>设置read_only<span class="token operator">=</span><span class="token boolean">True</span> 因为内部可找到回复的是<span class="token string">&quot;谁&quot;</span><span class="token punctuation">,</span>将<span class="token string">&quot;谁&quot;</span>的深度加<span class="token number">1</span>就是当前评论的深度<span class="token punctuation">.</span>
<span class="token number">1</span><span class="token operator">&gt;</span> 若发布了一条根评论
   前端传<span class="token punctuation">:</span> 
      news、content、因为是根评论<span class="token punctuation">,</span>该评论是没有给谁回复的<span class="token punctuation">,</span>所以 reply<span class="token operator">=</span>null （默认reply就是null<span class="token punctuation">,</span>也可不传
   存入数据库实现新增时<span class="token punctuation">,</span>还需传递几个字段<span class="token punctuation">:</span>
      user   认证成功后<span class="token punctuation">,</span>后端可自己拿到、
      deptch 因为是根评论<span class="token punctuation">,</span>所以deptch<span class="token operator">=</span><span class="token number">0</span>（默认deptch就是<span class="token number">0</span><span class="token punctuation">,</span>也可不传、
      root   表明该条评论的根评论是谁<span class="token punctuation">,</span>因为发布的评论就是根评论<span class="token punctuation">,</span>所以root<span class="token operator">=</span>null <span class="token punctuation">(</span>默认root就是null<span class="token punctuation">,</span>也可不传
<span class="token number">2</span><span class="token operator">&gt;</span> 若发布了一条子评论<span class="token punctuation">,</span>即给某条评论进行回复
   前端传<span class="token punctuation">:</span>   
      news、content、reply<span class="token operator">=</span>回复的那条评论的ID
   存入数据库实现新增时<span class="token punctuation">,</span>还需传递几个字段<span class="token punctuation">:</span>
      user   认证成功后<span class="token punctuation">,</span>后端可自己拿到、
      deptch 回复的那条评论的深度<span class="token operator">+</span><span class="token number">1</span>、
      root   表明该条评论的根评论是谁<span class="token punctuation">.</span> 这里需要读取回复的那条评论的root或者deptch<span class="token punctuation">,</span>作以下判断
             <span class="token operator">-</span> 若回复的那条评论的root<span class="token operator">=</span>null <span class="token keyword">or</span> deptch<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> 那么root<span class="token operator">=</span>回复的那条评论的ID
             <span class="token operator">-</span> 若回复的那条评论的root不为null <span class="token keyword">or</span> deptch的值不为<span class="token number">0</span><span class="token punctuation">,</span> 那么root<span class="token operator">=</span>回复的那条评论的root
新增后的后续操作                                                    
<span class="token operator">&lt;</span><span class="token number">1</span><span class="token operator">&gt;</span> 若添加的是子评论<span class="token punctuation">,</span>还需在新增后<span class="token punctuation">,</span>更新当前新增的这个子评论所关联的根评论的最新更新时间!!
    也就是根评论下新增了子孙评论<span class="token punctuation">,</span>这个根评论的最新更新时间就得更新下!后续需要根据这个时间进行排序<span class="token punctuation">.</span>                               <span class="token operator">&lt;</span><span class="token number">2</span><span class="token operator">&gt;</span> 对应的资讯的评论个数需<span class="token operator">+</span><span class="token number">1</span>   
<span class="token operator">-</span> 创建根评论
  POST请求 http<span class="token punctuation">:</span><span class="token operator">//</span><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token punctuation">:</span><span class="token number">8000</span><span class="token operator">/</span>api<span class="token operator">/</span>comment<span class="token operator">/</span>?token<span class="token operator">=</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> 请求体 <span class="token punctuation">{</span><span class="token string">&quot;news&quot;</span><span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">&quot;content&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;Hello&quot;</span><span class="token punctuation">}</span>
  返回 <span class="token punctuation">{</span><span class="token string">&quot;code&quot;</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">&quot;data&quot;</span><span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token string">&quot;reply&quot;</span><span class="token punctuation">:</span>null<span class="token punctuation">,</span><span class="token string">&quot;content&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;Hello&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;depth&quot;</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">&quot;create_datetime&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;2024-01-18 20:05:45&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token operator">-</span> 创建子评论
  POST请求 http<span class="token punctuation">:</span><span class="token operator">//</span><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token punctuation">:</span><span class="token number">8000</span><span class="token operator">/</span>api<span class="token operator">/</span>comment<span class="token operator">/</span>?token<span class="token operator">=</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> 请求体 <span class="token punctuation">{</span><span class="token string">&quot;news&quot;</span><span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">&quot;content&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;Hello&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;reply&quot;</span><span class="token punctuation">:</span><span class="token number">9</span><span class="token punctuation">}</span>
  返回 <span class="token punctuation">{</span><span class="token string">&quot;code&quot;</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">&quot;data&quot;</span><span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token string">&quot;reply&quot;</span><span class="token punctuation">:</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token string">&quot;content&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;Hello&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;depth&quot;</span><span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">&quot;create_datetime&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;2024-01-18 20:07:29&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span>         
                                                    
                                                    
<span class="token punctuation">[</span>需求<span class="token number">2</span><span class="token punctuation">]</span> 获取评论列表 <span class="token string">&quot;集过 分实返&quot;</span>
step1<span class="token punctuation">:</span>根据后代的最新更新时间进行排序<span class="token punctuation">,</span>获取所有根评论
step2<span class="token punctuation">:</span>筛选 指定某一条资讯的根评论<span class="token punctuation">,</span>示例代码中的news参数这个必须传 ?news<span class="token operator">=</span><span class="token number">1</span> !    
<span class="token operator">-</span> 前两步<span class="token punctuation">,</span>获取到某条新闻资讯的所有根评论并按照后代的最新更新时间进行了排序
step3<span class="token punctuation">:</span>分页 
      全局分页limit默认设置的是<span class="token number">10</span>条<span class="token punctuation">;</span>latest_id是根据最新更新的时间来的<span class="token punctuation">,</span>有个弊端<span class="token punctuation">,</span>数据不是实时的 
      eg<span class="token punctuation">:</span>第一次取到了 <span class="token number">7</span><span class="token punctuation">:</span><span class="token number">01</span> <span class="token number">6</span><span class="token punctuation">:</span><span class="token number">55</span> <span class="token number">6</span><span class="token punctuation">:</span><span class="token number">51</span> 的三条根评论<span class="token punctuation">,</span>按道理下一次应取小于<span class="token number">6</span><span class="token punctuation">:</span><span class="token number">51</span>时间点的评论
         但此刻<span class="token number">6</span><span class="token punctuation">:</span><span class="token number">45</span>的那条评论有子孙评论进行回复了<span class="token punctuation">,</span>该根评论的最新更新时间变成了<span class="token number">7</span><span class="token punctuation">:</span><span class="token number">05</span> 这次取就取不到它啦!! 所以不是实时的<span class="token punctuation">.</span>         step4<span class="token punctuation">:</span>获取到根评论后<span class="token punctuation">,</span>需要构造数据结构<span class="token punctuation">,</span>将根评论对应的子孙评论放进去!!<span class="token punctuation">(</span>这个数据结构的构建用到了传递可变对象<span class="token punctuation">,</span>传递的是内存地址!!<span class="token punctuation">)</span>         <span class="token operator">-</span> 获取当前这一条根评论的所有的子孙评论（即后代）
    <span class="token operator">-</span> 将子评论挂靠到跟评论上<span class="token punctuation">,</span>最终形成父子关系通过JSON返回给前端<span class="token punctuation">.</span>
<span class="token operator">-</span> GET请求 http<span class="token punctuation">:</span><span class="token operator">//</span><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token punctuation">:</span><span class="token number">8000</span><span class="token operator">/</span>api<span class="token operator">/</span>comment<span class="token operator">/</span>?news<span class="token operator">=</span><span class="token number">1</span> 获取的到是默认的偏移分页<span class="token punctuation">,</span><span class="token number">10</span>条数据<span class="token punctuation">.</span>                                
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br></div></div><hr></div></div> <!----> <div class="page-edit"><!----> <!----> <!----></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/13c024/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">练习+跨域问题</div></a> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/13c024/" class="prev">练习+跨域问题</a></span> <!----></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/pages/8sk2b3/"><div>
            搜索相关
            <!----></div></a> <span class="date">03-22</span></dt></dl><dl><dd>02</dd> <dt><a href="/pages/2kn2p2/"><div>
            CURD
            <!----></div></a> <span class="date">03-20</span></dt></dl><dl><dd>03</dd> <dt><a href="/pages/1kn1m1/"><div>
            自动生成
            <!----></div></a> <span class="date">03-15</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="https://github.com/OnePieceDC" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://www.cnblogs.com/DC0307/" title="博客园" target="_blank" class="iconfont icon-bokeyuan"></a><a href="https://music.163.com/#/song?id=1854188649" title="听音乐" target="_blank" class="iconfont icon-erji"></a><a href="https://www.jianshu.com/u/5310eb537315" title="简书" target="_blank" class="iconfont icon-jianshu"></a><a href="mailto:1415806497@qq.com" title="QQ" target="_blank" class="iconfont icon-youjian"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2023-2024
    <span>DC | One Piece</span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <div class="body-bg" style="background:url() center center / cover no-repeat;opacity:0.5;"></div> <!----> <!----></div><div class="global-ui"><!----><div id="goTop" class="hide-cat" data-v-8ccb5928></div><div></div><canvas id="vuepress-canvas-cursor"></canvas><div></div><div></div></div></div>
    <script src="/assets/js/app.ac54adc6.js" defer></script><script src="/assets/js/4.7ddc74e3.js" defer></script><script src="/assets/js/1.a0c4ff1b.js" defer></script><script src="/assets/js/3.8b03321d.js" defer></script><script src="/assets/js/38.637afaf8.js" defer></script><script src="/assets/js/104.cae2d944.js" defer></script><script src="/assets/js/184.46eabf07.js" defer></script>
  </body>
</html>
