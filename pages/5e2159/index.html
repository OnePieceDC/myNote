<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>ORM查询 | DC&#39;s blog</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="icon" href="/img/favicon.ico">
    <link rel="stylesheet" href="/fonts/iconfont.css">
    <meta name="description" content="人类终将毁灭,世界属于三体!">
    <meta name="keywords" content="DC的个人博客.">
    
    <link rel="preload" href="/assets/css/0.styles.66b92039.css" as="style"><link rel="preload" href="/assets/js/app.ac54adc6.js" as="script"><link rel="preload" href="/assets/js/4.7ddc74e3.js" as="script"><link rel="preload" href="/assets/js/1.a0c4ff1b.js" as="script"><link rel="preload" href="/assets/js/3.8b03321d.js" as="script"><link rel="preload" href="/assets/js/258.be75b1f9.js" as="script"><link rel="preload" href="/assets/js/104.cae2d944.js" as="script"><link rel="preload" href="/assets/js/184.46eabf07.js" as="script"><link rel="prefetch" href="/assets/js/10.a91ae011.js"><link rel="prefetch" href="/assets/js/100.2e8ea472.js"><link rel="prefetch" href="/assets/js/101.46f57a02.js"><link rel="prefetch" href="/assets/js/102.f51bcd80.js"><link rel="prefetch" href="/assets/js/103.3f003e0e.js"><link rel="prefetch" href="/assets/js/105.6c6ebc28.js"><link rel="prefetch" href="/assets/js/106.47dc8889.js"><link rel="prefetch" href="/assets/js/107.6b5602b4.js"><link rel="prefetch" href="/assets/js/108.46f0c21d.js"><link rel="prefetch" href="/assets/js/109.0f1168a5.js"><link rel="prefetch" href="/assets/js/11.e6a94228.js"><link rel="prefetch" href="/assets/js/110.6a961498.js"><link rel="prefetch" href="/assets/js/111.c6f27c88.js"><link rel="prefetch" href="/assets/js/112.9ee3d3bb.js"><link rel="prefetch" href="/assets/js/113.82b72aa0.js"><link rel="prefetch" href="/assets/js/114.7487460e.js"><link rel="prefetch" href="/assets/js/115.cd079d0a.js"><link rel="prefetch" href="/assets/js/116.b6b829eb.js"><link rel="prefetch" href="/assets/js/117.89d9336c.js"><link rel="prefetch" href="/assets/js/118.467c4437.js"><link rel="prefetch" href="/assets/js/119.c4b2ac40.js"><link rel="prefetch" href="/assets/js/12.9d3501e4.js"><link rel="prefetch" href="/assets/js/120.5ff31c09.js"><link rel="prefetch" href="/assets/js/121.2e59c3a5.js"><link rel="prefetch" href="/assets/js/122.a66096cf.js"><link rel="prefetch" href="/assets/js/123.4885ba5f.js"><link rel="prefetch" href="/assets/js/124.cacc66be.js"><link rel="prefetch" href="/assets/js/125.dc5b30fe.js"><link rel="prefetch" href="/assets/js/126.4e21eb5e.js"><link rel="prefetch" href="/assets/js/127.cb36a9bf.js"><link rel="prefetch" href="/assets/js/128.ce38358e.js"><link rel="prefetch" href="/assets/js/129.e5f414eb.js"><link rel="prefetch" href="/assets/js/13.ca017a68.js"><link rel="prefetch" href="/assets/js/130.17b597f0.js"><link rel="prefetch" href="/assets/js/131.e1ded2dc.js"><link rel="prefetch" href="/assets/js/132.aae1c627.js"><link rel="prefetch" href="/assets/js/133.73cecdb3.js"><link rel="prefetch" href="/assets/js/134.80cf38a0.js"><link rel="prefetch" href="/assets/js/135.735ed588.js"><link rel="prefetch" href="/assets/js/136.91f8db08.js"><link rel="prefetch" href="/assets/js/137.d6fb8bda.js"><link rel="prefetch" href="/assets/js/138.75cafe73.js"><link rel="prefetch" href="/assets/js/139.b01bf0db.js"><link rel="prefetch" href="/assets/js/14.ee2605b5.js"><link rel="prefetch" href="/assets/js/140.ff0a7911.js"><link rel="prefetch" href="/assets/js/141.c69e7f54.js"><link rel="prefetch" href="/assets/js/142.997b03ac.js"><link rel="prefetch" href="/assets/js/143.e40faea8.js"><link rel="prefetch" href="/assets/js/144.369f23e5.js"><link rel="prefetch" href="/assets/js/145.1268424d.js"><link rel="prefetch" href="/assets/js/146.94c65c4a.js"><link rel="prefetch" href="/assets/js/147.05fe6a36.js"><link rel="prefetch" href="/assets/js/148.327cc29d.js"><link rel="prefetch" href="/assets/js/149.90068676.js"><link rel="prefetch" href="/assets/js/15.42e0a0e4.js"><link rel="prefetch" href="/assets/js/150.b4b780bb.js"><link rel="prefetch" href="/assets/js/151.b4611012.js"><link rel="prefetch" href="/assets/js/152.4d2c8246.js"><link rel="prefetch" href="/assets/js/153.f32dfa58.js"><link rel="prefetch" href="/assets/js/154.b79a78fb.js"><link rel="prefetch" href="/assets/js/155.6ad2865c.js"><link rel="prefetch" href="/assets/js/156.fd49a1af.js"><link rel="prefetch" href="/assets/js/157.55113800.js"><link rel="prefetch" href="/assets/js/158.af321bc9.js"><link rel="prefetch" href="/assets/js/159.37d9c659.js"><link rel="prefetch" href="/assets/js/16.007f45b3.js"><link rel="prefetch" href="/assets/js/160.7a3b5a9a.js"><link rel="prefetch" href="/assets/js/161.fc1fbea8.js"><link rel="prefetch" href="/assets/js/162.2f8d3d1c.js"><link rel="prefetch" href="/assets/js/163.aa889940.js"><link rel="prefetch" href="/assets/js/164.5d8b2cb7.js"><link rel="prefetch" href="/assets/js/165.44d4a9b5.js"><link rel="prefetch" href="/assets/js/166.c1b4c4d4.js"><link rel="prefetch" href="/assets/js/167.0c39929e.js"><link rel="prefetch" href="/assets/js/168.fede035a.js"><link rel="prefetch" href="/assets/js/169.ff940d50.js"><link rel="prefetch" href="/assets/js/17.7395c644.js"><link rel="prefetch" href="/assets/js/170.b6fcb3bf.js"><link rel="prefetch" href="/assets/js/171.2b927a7c.js"><link rel="prefetch" href="/assets/js/172.b07a90a1.js"><link rel="prefetch" href="/assets/js/173.367352bf.js"><link rel="prefetch" href="/assets/js/174.4ea4e20f.js"><link rel="prefetch" href="/assets/js/175.d9679b61.js"><link rel="prefetch" href="/assets/js/176.f7804143.js"><link rel="prefetch" href="/assets/js/177.c5d1e680.js"><link rel="prefetch" href="/assets/js/178.808293fa.js"><link rel="prefetch" href="/assets/js/179.2acf6b3c.js"><link rel="prefetch" href="/assets/js/18.46f9153d.js"><link rel="prefetch" href="/assets/js/180.ddf3ecf7.js"><link rel="prefetch" href="/assets/js/181.4da0855c.js"><link rel="prefetch" href="/assets/js/182.591d135a.js"><link rel="prefetch" href="/assets/js/183.9d08f9fe.js"><link rel="prefetch" href="/assets/js/185.ee1c8428.js"><link rel="prefetch" href="/assets/js/186.c7b19133.js"><link rel="prefetch" href="/assets/js/187.52945990.js"><link rel="prefetch" href="/assets/js/188.a1d395c5.js"><link rel="prefetch" href="/assets/js/189.5b66165e.js"><link rel="prefetch" href="/assets/js/19.2db19edb.js"><link rel="prefetch" href="/assets/js/190.265a75de.js"><link rel="prefetch" href="/assets/js/191.b4c65143.js"><link rel="prefetch" href="/assets/js/192.cc4d4115.js"><link rel="prefetch" href="/assets/js/193.fa02ecc5.js"><link rel="prefetch" href="/assets/js/194.b0c9ad53.js"><link rel="prefetch" href="/assets/js/195.eda8cd34.js"><link rel="prefetch" href="/assets/js/196.cbae4dc6.js"><link rel="prefetch" href="/assets/js/197.693b1b85.js"><link rel="prefetch" href="/assets/js/198.8213665b.js"><link rel="prefetch" href="/assets/js/199.ddf0036d.js"><link rel="prefetch" href="/assets/js/2.4c15b693.js"><link rel="prefetch" href="/assets/js/20.6742e8ae.js"><link rel="prefetch" href="/assets/js/200.340df508.js"><link rel="prefetch" href="/assets/js/201.7431c15b.js"><link rel="prefetch" href="/assets/js/202.217b2b38.js"><link rel="prefetch" href="/assets/js/203.06c6a93d.js"><link rel="prefetch" href="/assets/js/204.a068a898.js"><link rel="prefetch" href="/assets/js/205.9361d3f5.js"><link rel="prefetch" href="/assets/js/206.886beca0.js"><link rel="prefetch" href="/assets/js/207.2278bda8.js"><link rel="prefetch" href="/assets/js/208.db0acc0d.js"><link rel="prefetch" href="/assets/js/209.0e05b204.js"><link rel="prefetch" href="/assets/js/21.fd552a4e.js"><link rel="prefetch" href="/assets/js/210.4c730041.js"><link rel="prefetch" href="/assets/js/211.417dbee1.js"><link rel="prefetch" href="/assets/js/212.eef4f4a3.js"><link rel="prefetch" href="/assets/js/213.ab742b0b.js"><link rel="prefetch" href="/assets/js/214.a57228de.js"><link rel="prefetch" href="/assets/js/215.37f52459.js"><link rel="prefetch" href="/assets/js/216.2f110f92.js"><link rel="prefetch" href="/assets/js/217.09654311.js"><link rel="prefetch" href="/assets/js/218.a7568950.js"><link rel="prefetch" href="/assets/js/219.628ee193.js"><link rel="prefetch" href="/assets/js/22.465a76d2.js"><link rel="prefetch" href="/assets/js/220.c5df9186.js"><link rel="prefetch" href="/assets/js/221.101ddb09.js"><link rel="prefetch" href="/assets/js/222.db210e3c.js"><link rel="prefetch" href="/assets/js/223.429cbf14.js"><link rel="prefetch" href="/assets/js/224.aa002868.js"><link rel="prefetch" href="/assets/js/225.79a40017.js"><link rel="prefetch" href="/assets/js/226.3e08228b.js"><link rel="prefetch" href="/assets/js/227.a09dd4b4.js"><link rel="prefetch" href="/assets/js/228.f930c492.js"><link rel="prefetch" href="/assets/js/229.f639a9e4.js"><link rel="prefetch" href="/assets/js/23.df6831af.js"><link rel="prefetch" href="/assets/js/230.e8ac7aad.js"><link rel="prefetch" href="/assets/js/231.99501214.js"><link rel="prefetch" href="/assets/js/232.e2932792.js"><link rel="prefetch" href="/assets/js/233.43dfa689.js"><link rel="prefetch" href="/assets/js/234.7951f9c4.js"><link rel="prefetch" href="/assets/js/235.1dc96b6c.js"><link rel="prefetch" href="/assets/js/236.40b8d4e4.js"><link rel="prefetch" href="/assets/js/237.75a692de.js"><link rel="prefetch" href="/assets/js/238.cc9d9ac1.js"><link rel="prefetch" href="/assets/js/239.4616a566.js"><link rel="prefetch" href="/assets/js/24.b68dc734.js"><link rel="prefetch" href="/assets/js/240.dd825147.js"><link rel="prefetch" href="/assets/js/241.85e3219b.js"><link rel="prefetch" href="/assets/js/242.bf4123c4.js"><link rel="prefetch" href="/assets/js/243.ce68f4f0.js"><link rel="prefetch" href="/assets/js/244.e2598d4d.js"><link rel="prefetch" href="/assets/js/245.2c696827.js"><link rel="prefetch" href="/assets/js/246.2c44a497.js"><link rel="prefetch" href="/assets/js/247.02405fce.js"><link rel="prefetch" href="/assets/js/248.6727bdf6.js"><link rel="prefetch" href="/assets/js/249.4901f575.js"><link rel="prefetch" href="/assets/js/25.d639c65c.js"><link rel="prefetch" href="/assets/js/250.c922c9ea.js"><link rel="prefetch" href="/assets/js/251.b1350ead.js"><link rel="prefetch" href="/assets/js/252.8295c5ea.js"><link rel="prefetch" href="/assets/js/253.b0a9ba20.js"><link rel="prefetch" href="/assets/js/254.d208b848.js"><link rel="prefetch" href="/assets/js/255.2cfb6ad3.js"><link rel="prefetch" href="/assets/js/256.e7687a81.js"><link rel="prefetch" href="/assets/js/257.db329d54.js"><link rel="prefetch" href="/assets/js/259.67500f7e.js"><link rel="prefetch" href="/assets/js/26.9db429a9.js"><link rel="prefetch" href="/assets/js/260.73609cfa.js"><link rel="prefetch" href="/assets/js/261.22fc7c08.js"><link rel="prefetch" href="/assets/js/262.2c620ccd.js"><link rel="prefetch" href="/assets/js/263.e0ce1454.js"><link rel="prefetch" href="/assets/js/264.7fe82318.js"><link rel="prefetch" href="/assets/js/265.537d06c5.js"><link rel="prefetch" href="/assets/js/266.901695a7.js"><link rel="prefetch" href="/assets/js/267.8eb24590.js"><link rel="prefetch" href="/assets/js/268.a21e44dc.js"><link rel="prefetch" href="/assets/js/269.33e6ce5d.js"><link rel="prefetch" href="/assets/js/27.2296e284.js"><link rel="prefetch" href="/assets/js/270.31507ac3.js"><link rel="prefetch" href="/assets/js/271.b9406b42.js"><link rel="prefetch" href="/assets/js/272.0acaba6f.js"><link rel="prefetch" href="/assets/js/273.c2e359b0.js"><link rel="prefetch" href="/assets/js/274.a80428a6.js"><link rel="prefetch" href="/assets/js/28.7e4f4dc1.js"><link rel="prefetch" href="/assets/js/29.ba75f79a.js"><link rel="prefetch" href="/assets/js/30.16cd3622.js"><link rel="prefetch" href="/assets/js/31.54ed5bc1.js"><link rel="prefetch" href="/assets/js/32.b2fbba6a.js"><link rel="prefetch" href="/assets/js/33.f7ff0107.js"><link rel="prefetch" href="/assets/js/34.4b2cea7d.js"><link rel="prefetch" href="/assets/js/35.1159e74c.js"><link rel="prefetch" href="/assets/js/36.0b6296f3.js"><link rel="prefetch" href="/assets/js/37.fc67879e.js"><link rel="prefetch" href="/assets/js/38.637afaf8.js"><link rel="prefetch" href="/assets/js/39.748a78f3.js"><link rel="prefetch" href="/assets/js/40.4fede9bb.js"><link rel="prefetch" href="/assets/js/41.c7f0b087.js"><link rel="prefetch" href="/assets/js/42.5b1a487d.js"><link rel="prefetch" href="/assets/js/43.59275b93.js"><link rel="prefetch" href="/assets/js/44.b18a4c94.js"><link rel="prefetch" href="/assets/js/45.bc8f7cb3.js"><link rel="prefetch" href="/assets/js/46.6a4ec89f.js"><link rel="prefetch" href="/assets/js/47.e1e129e6.js"><link rel="prefetch" href="/assets/js/48.c284ce23.js"><link rel="prefetch" href="/assets/js/49.17e5dd65.js"><link rel="prefetch" href="/assets/js/5.e3d12916.js"><link rel="prefetch" href="/assets/js/50.34c3ac45.js"><link rel="prefetch" href="/assets/js/51.035f7031.js"><link rel="prefetch" href="/assets/js/52.e9ef227a.js"><link rel="prefetch" href="/assets/js/53.ecbb032d.js"><link rel="prefetch" href="/assets/js/54.e9af4cfe.js"><link rel="prefetch" href="/assets/js/55.7e71402b.js"><link rel="prefetch" href="/assets/js/56.511071fe.js"><link rel="prefetch" href="/assets/js/57.13b7fe79.js"><link rel="prefetch" href="/assets/js/58.e51f8b0e.js"><link rel="prefetch" href="/assets/js/59.a1b8bdb7.js"><link rel="prefetch" href="/assets/js/6.5fc3f358.js"><link rel="prefetch" href="/assets/js/60.fd7e1c08.js"><link rel="prefetch" href="/assets/js/61.0daf2361.js"><link rel="prefetch" href="/assets/js/62.04632944.js"><link rel="prefetch" href="/assets/js/63.f0dd5615.js"><link rel="prefetch" href="/assets/js/64.89a4b562.js"><link rel="prefetch" href="/assets/js/65.6764ff0c.js"><link rel="prefetch" href="/assets/js/66.049bdee1.js"><link rel="prefetch" href="/assets/js/67.b0d4ec16.js"><link rel="prefetch" href="/assets/js/68.46d97067.js"><link rel="prefetch" href="/assets/js/69.f540f0da.js"><link rel="prefetch" href="/assets/js/7.ce17dd73.js"><link rel="prefetch" href="/assets/js/70.17d8f857.js"><link rel="prefetch" href="/assets/js/71.b2a166a0.js"><link rel="prefetch" href="/assets/js/72.1c17a875.js"><link rel="prefetch" href="/assets/js/73.dac8984b.js"><link rel="prefetch" href="/assets/js/74.5bbc33ac.js"><link rel="prefetch" href="/assets/js/75.483644c7.js"><link rel="prefetch" href="/assets/js/76.de5461ab.js"><link rel="prefetch" href="/assets/js/77.7fa90702.js"><link rel="prefetch" href="/assets/js/78.f41853b8.js"><link rel="prefetch" href="/assets/js/79.598b50e6.js"><link rel="prefetch" href="/assets/js/80.61d2d23a.js"><link rel="prefetch" href="/assets/js/81.d310c6e4.js"><link rel="prefetch" href="/assets/js/82.22aa814c.js"><link rel="prefetch" href="/assets/js/83.f493eba4.js"><link rel="prefetch" href="/assets/js/84.3a32a1eb.js"><link rel="prefetch" href="/assets/js/85.2f47134e.js"><link rel="prefetch" href="/assets/js/86.74e65a77.js"><link rel="prefetch" href="/assets/js/87.e87bff96.js"><link rel="prefetch" href="/assets/js/88.aabc97af.js"><link rel="prefetch" href="/assets/js/89.b0945d87.js"><link rel="prefetch" href="/assets/js/90.630f62d3.js"><link rel="prefetch" href="/assets/js/91.ed816647.js"><link rel="prefetch" href="/assets/js/92.19065457.js"><link rel="prefetch" href="/assets/js/93.a0fe1919.js"><link rel="prefetch" href="/assets/js/94.51e48580.js"><link rel="prefetch" href="/assets/js/95.e591bede.js"><link rel="prefetch" href="/assets/js/96.1723f1d6.js"><link rel="prefetch" href="/assets/js/97.02bbb7d4.js"><link rel="prefetch" href="/assets/js/98.a3625ba6.js"><link rel="prefetch" href="/assets/js/99.1accbf48.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.5959bfd2.js">
    <link rel="stylesheet" href="/assets/css/0.styles.66b92039.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu have-body-img"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/nav-logo.png" alt="DC's blog" class="logo"> <span class="site-name can-hide">DC's blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="IT必备" class="dropdown-title"><a href="/IT/" class="link-title">IT必备</a> <span class="title" style="display:none;">IT必备</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/IT/basis/" class="nav-link">计算机基础</a></li><li class="dropdown-item"><!----> <a href="/IT/linux/" class="nav-link">linux基础</a></li><li class="dropdown-item"><!----> <a href="/IT/mysql/" class="nav-link">mysql</a></li><li class="dropdown-item"><!----> <a href="/IT/git/" class="nav-link">git</a></li><li class="dropdown-item"><!----> <a href="/IT/structure/" class="nav-link">数据结构与算法</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Python" class="dropdown-title"><a href="/python/" class="link-title">Python</a> <span class="title" style="display:none;">Python</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/python/basis/" class="nav-link">opp</a></li><li class="dropdown-item"><!----> <a href="/python/oop/" class="nav-link">oop</a></li><li class="dropdown-item"><!----> <a href="/python/Network_concurrency/" class="nav-link">网络并发编程</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><a href="/front_end/" class="link-title">前端</a> <span class="title" style="display:none;">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/front_end/html/" class="nav-link">html</a></li><li class="dropdown-item"><!----> <a href="/front_end/css/" class="nav-link">css</a></li><li class="dropdown-item"><!----> <a href="/front_end/js/" class="nav-link">javascript</a></li><li class="dropdown-item"><!----> <a href="/front_end/jquery/" class="nav-link">jquery</a></li><li class="dropdown-item"><!----> <a href="/front_end/ui/" class="nav-link">UI</a></li><li class="dropdown-item"><!----> <a href="/front_end/vue/" class="nav-link">vue</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="后端" class="dropdown-title"><a href="/python_web/" class="link-title">后端</a> <span class="title" style="display:none;">后端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/python_web/django/" class="nav-link">Django</a></li><li class="dropdown-item"><!----> <a href="/python_web/drf/" class="nav-link">drf</a></li><li class="dropdown-item"><!----> <a href="/python_web/drf_re/" class="nav-link">drf_re</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="实战" class="dropdown-title"><a href="/project/" class="link-title">实战</a> <span class="title" style="display:none;">实战</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>前后端不分离</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/project/bbs/" class="nav-link">BBS</a></li><li class="dropdown-subitem"><a href="/project/order/" class="nav-link">订单系统</a></li><li class="dropdown-subitem"><a href="/project/crm/" class="nav-link">CRM</a></li></ul></li><li class="dropdown-item"><h4>前后端分离</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/project/supply/" class="nav-link">供应链系统</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其他" class="dropdown-title"><a href="/other/" class="link-title">其他</a> <span class="title" style="display:none;">其他</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/other/essays/" class="nav-link">杂文</a></li><li class="dropdown-item"><h4>关于我</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/about/" class="nav-link">me</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><!----> <span class="title" style="display:;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/OnePieceDC/" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="/img/avatar.gif"> <div class="blogger-info"><h3>DC</h3> <span>愿我一生欢喜,不为世俗所及.</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="IT必备" class="dropdown-title"><a href="/IT/" class="link-title">IT必备</a> <span class="title" style="display:none;">IT必备</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/IT/basis/" class="nav-link">计算机基础</a></li><li class="dropdown-item"><!----> <a href="/IT/linux/" class="nav-link">linux基础</a></li><li class="dropdown-item"><!----> <a href="/IT/mysql/" class="nav-link">mysql</a></li><li class="dropdown-item"><!----> <a href="/IT/git/" class="nav-link">git</a></li><li class="dropdown-item"><!----> <a href="/IT/structure/" class="nav-link">数据结构与算法</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Python" class="dropdown-title"><a href="/python/" class="link-title">Python</a> <span class="title" style="display:none;">Python</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/python/basis/" class="nav-link">opp</a></li><li class="dropdown-item"><!----> <a href="/python/oop/" class="nav-link">oop</a></li><li class="dropdown-item"><!----> <a href="/python/Network_concurrency/" class="nav-link">网络并发编程</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><a href="/front_end/" class="link-title">前端</a> <span class="title" style="display:none;">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/front_end/html/" class="nav-link">html</a></li><li class="dropdown-item"><!----> <a href="/front_end/css/" class="nav-link">css</a></li><li class="dropdown-item"><!----> <a href="/front_end/js/" class="nav-link">javascript</a></li><li class="dropdown-item"><!----> <a href="/front_end/jquery/" class="nav-link">jquery</a></li><li class="dropdown-item"><!----> <a href="/front_end/ui/" class="nav-link">UI</a></li><li class="dropdown-item"><!----> <a href="/front_end/vue/" class="nav-link">vue</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="后端" class="dropdown-title"><a href="/python_web/" class="link-title">后端</a> <span class="title" style="display:none;">后端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/python_web/django/" class="nav-link">Django</a></li><li class="dropdown-item"><!----> <a href="/python_web/drf/" class="nav-link">drf</a></li><li class="dropdown-item"><!----> <a href="/python_web/drf_re/" class="nav-link">drf_re</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="实战" class="dropdown-title"><a href="/project/" class="link-title">实战</a> <span class="title" style="display:none;">实战</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>前后端不分离</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/project/bbs/" class="nav-link">BBS</a></li><li class="dropdown-subitem"><a href="/project/order/" class="nav-link">订单系统</a></li><li class="dropdown-subitem"><a href="/project/crm/" class="nav-link">CRM</a></li></ul></li><li class="dropdown-item"><h4>前后端分离</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/project/supply/" class="nav-link">供应链系统</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其他" class="dropdown-title"><a href="/other/" class="link-title">其他</a> <span class="title" style="display:none;">其他</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/other/essays/" class="nav-link">杂文</a></li><li class="dropdown-item"><h4>关于我</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/about/" class="nav-link">me</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><!----> <span class="title" style="display:;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/OnePieceDC/" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Django</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/8e7af6/" class="sidebar-link">框架引入</a></li><li><a href="/pages/a8cbe5/" class="sidebar-link">基本配置</a></li><li><a href="/pages/c3e4a9/" class="sidebar-link">单表记录CURD</a></li><li><a href="/pages/824fa8/" class="sidebar-link">路由和视图层</a></li><li><a href="/pages/c8216c/" class="sidebar-link">模版层</a></li><li><a href="/pages/5e2159/" aria-current="page" class="active sidebar-link">ORM查询</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/pages/5e2159/#测试环境的搭建" class="sidebar-link">测试环境的搭建</a></li><li class="sidebar-sub-header level2"><a href="/pages/5e2159/#orm单表常用方法" class="sidebar-link">ORM单表常用方法</a></li><li class="sidebar-sub-header level2"><a href="/pages/5e2159/#数据准备" class="sidebar-link">数据准备</a></li><li class="sidebar-sub-header level2"><a href="/pages/5e2159/#基于双下划线查询" class="sidebar-link">基于双下划线查询</a></li><li class="sidebar-sub-header level2"><a href="/pages/5e2159/#外键查询" class="sidebar-link">外键查询</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/5e2159/#一对多外键cud" class="sidebar-link">一对多外键CUD</a></li><li class="sidebar-sub-header level3"><a href="/pages/5e2159/#多对多外键cud" class="sidebar-link">多对多外键CUD</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/5e2159/#orm多表查询" class="sidebar-link">ORM多表查询!!</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/5e2159/#正反向概念" class="sidebar-link">正反向概念</a></li><li class="sidebar-sub-header level3"><a href="/pages/5e2159/#子查询" class="sidebar-link">子查询</a></li><li class="sidebar-sub-header level5"><a href="/pages/5e2159/#正向查询" class="sidebar-link">正向查询</a></li><li class="sidebar-sub-header level5"><a href="/pages/5e2159/#反向查询" class="sidebar-link">反向查询</a></li><li class="sidebar-sub-header level3"><a href="/pages/5e2159/#联表查询" class="sidebar-link">联表查询</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/5e2159/#聚合查询" class="sidebar-link">聚合查询</a></li><li class="sidebar-sub-header level2"><a href="/pages/5e2159/#分组查询" class="sidebar-link">分组查询</a></li><li class="sidebar-sub-header level2"><a href="/pages/5e2159/#f与q查询" class="sidebar-link">F与Q查询</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/5e2159/#f查询" class="sidebar-link">F查询</a></li><li class="sidebar-sub-header level3"><a href="/pages/5e2159/#q查询" class="sidebar-link">Q查询</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/5e2159/#补充" class="sidebar-link">补充</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/5e2159/#一对多-正向" class="sidebar-link">一对多 正向</a></li><li class="sidebar-sub-header level3"><a href="/pages/5e2159/#一对多-反向" class="sidebar-link">一对多  反向</a></li><li class="sidebar-sub-header level3"><a href="/pages/5e2159/#多对多" class="sidebar-link">多对多</a></li><li class="sidebar-sub-header level3"><a href="/pages/5e2159/#一对一" class="sidebar-link">一对一</a></li></ul></li></ul></li><li><a href="/pages/e54fbe/" class="sidebar-link">ORM字段</a></li><li><a href="/pages/b9913f/" class="sidebar-link">Ajax+layer</a></li><li><a href="/pages/c76e85/" class="sidebar-link">自定义分页器</a></li><li><a href="/pages/b689b7/" class="sidebar-link">cookie与session</a></li><li><a href="/pages/6198e9/" class="sidebar-link">中间件和csrf</a></li><li><a href="/pages/a72e4b/" class="sidebar-link">Auth认证模块</a></li><li><a href="/pages/30b5cd/" class="sidebar-link">ORM复习</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>第一次学drf</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>第二次学drf</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-91157402><div class="articleInfo" data-v-91157402><ul class="breadcrumbs" data-v-91157402><li data-v-91157402><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-91157402></a></li> <li data-v-91157402><a href="/categories/?category=%E5%90%8E%E7%AB%AF" title="分类" data-v-91157402>后端</a></li><li data-v-91157402><a href="/categories/?category=Django" title="分类" data-v-91157402>Django</a></li></ul> <div class="info" data-v-91157402><div title="作者" class="author iconfont icon-touxiang" data-v-91157402><a href="https://github.com/OnePieceDC" target="_blank" title="作者" class="beLink" data-v-91157402>DC</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-91157402><a href="javascript:;" data-v-91157402>2023-10-30</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABGpJREFUSA3tVVtoXFUU3fvOI53UlmCaKIFmwEhsE7QK0ipFEdHEKpXaZGrp15SINsXUWvBDpBgQRKi0+KKoFeJHfZA+ED9KKoIU2gYD9UejTW4rVIzm0VSTziPzuNu1z507dibTTjL4U/DAzLn3nL3X2o91ziX6f9wMFdh6Jvbm9nNSV0msViVO6tN1Rm7NMu2OpeJ9lWBUTDxrJbYTS0hInuwciu9eLHlFxCLCZEk3MegsJmZ5K/JD6t7FkFdEvGUo1g7qJoG3MHImqRIn8/nzY1K9UPKKiJmtnUqHVE3Gbuay6vJE/N2FEmuxFjW2nUuE0yQXRRxLiTUAzs36zhZvOXJPdX850EVnnLZkB8prodQoM5JGj7Xk2mvC7JB8tG04Ef5PiXtG0UtxupRQSfTnBoCy554x18yJHI6I+G5Eru4LHmPJZEQsrvPUbMiA8G/WgMK7w7I+ez7++o2ANfbrjvaOl1tFMs+htG3IrZH9/hDX1Pr8Tc0UvH8tcX29KzAgIGcEkINyW5BF9x891hw6VYqgJHEk0huccS7vh3C6gTiODL+26huuBtbct8eZnqLML8PkxGYpuPZBqtqwkSjgc4mB5gbgig5i+y0UDK35LMxXisn9xQtK+nd26gTIHsHe/oblK/b29fUmN/8Y+9jAQrnBp56m1LcDlDp9irKTExSKduXJVWSqdBMA08pEJnEIOB3FPPMybu/oeV8zFeYN3xx576Q6RH+VmplE4ncQV5v+5rzSoyOU7PuEAg8g803PwBJ0CExno/jcMbN8tONYeOmHiuUNryvm3fRUy4tMPVLdAGkUhNWuggGrJcXPv+ouCjz0MKUHz1J2/E8IC9nqTabcxgaBYM0hPhD5Y65FsbxRQKxCQrDjDctW7PUM3HuZunFyifSAqEfuzCp48Il24luWUWZoyJCaPR82jE0+kFA643wRFVni4RYSq3ohJO2pZ7B5dO4xkDWbEpossJPLSrPjYID8rS2UHTlvyNxqIGsg674XJJ7vnh5L7PNwC4hh2sjCI96mzszOTpxLF0T7l88Yz7lAuK6OnL8gXLOnTvpzSb22YG8W7us3jSebFHeeqnXRG1vt+MoUM84LQIBmMsCTAcOauTh0T0l0neQK7m2bLMt2mGxU3HYssS0J2cdv5wljlPsrIuZLAG/2DOZIXgCYT8uMGZN+e2kSirfxZOPCsC0f24nTZzspnVn9VePS1Z5vubmAGGXG8ZFno9Hel0yfA5ZPhF7Dh972BQJ2qCpgH67lmWtBYbvk6sz02wjky2vXyz0XErP/kFB619js1BtwfOV4OPRqOQBjy3Qbk18vigUPPSD5ceHnwck7W9bhAqZdd7SuG7w4/P2F/GaJh8c7e9qgow+Q7cGBo+98WsLkuktFqiZabtXuQTu/Y5ETbR0v7tNSFnvrmu6pjdoan2KjMu8q/Hmj1EfCO2ZGfEIbIXKUlw8qaX9/b2oeSJmFksSeT/Fn0V3nSypChh4Gjh74ybO9aeZ/AN2dwciu2/MhAAAAAElFTkSuQmCC">ORM查询<!----></h1> <!----> <div class="theme-vdoing-content content__default"><p><strong>Django ORM 使用的一些优化.</strong><br> <code>https://pythondjango.cn/django/advanced/6-queryset-advanced/</code><br> <code>https://blog.csdn.net/zy010101/article/details/120816954</code><br> <code>https://www.cnblogs.com/aaronthon/p/9435185.html</code></p> <hr> <h2 id="测试环境的搭建"><a href="#测试环境的搭建" class="header-anchor">#</a> 测试环境的搭建</h2> <blockquote><p>若只想测试Django中某个py文件的内容,不想书写前后端交互的形式,就需要用到测试脚本!<br>
脚本代码无论是写在应用下的test.py中,还是自己单独开设py文件都可以!<br>
可以在Django项目中右键直接运行该tests.py文件</p></blockquote> <p><font color="#01a3a4" size="4">app01下的tests.py</font></p> <blockquote><p>测试环境的准备: 去manage.py中拷贝前四行代码!然后自己再写两行!</p></blockquote> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">from</span> django<span class="token punctuation">.</span>test <span class="token keyword">import</span> TestCase

<span class="token keyword">import</span> os
<span class="token keyword">import</span> sys

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">&quot;__main__&quot;</span><span class="token punctuation">:</span>
    <span class="token comment"># -- 通过环境变量DJANGO_SETTINGS_MODULE来告知Django使用哪个配置</span>
    os<span class="token punctuation">.</span>environ<span class="token punctuation">.</span>setdefault<span class="token punctuation">(</span><span class="token string">&quot;DJANGO_SETTINGS_MODULE&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;tem.settings&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">import</span> django

    <span class="token comment"># -- 若独立运行的python脚本是需要依赖django中的一些配置,那么就需要用到django.setup()</span>
    <span class="token comment">#    运行到django.setup()该行代码才表明测试环境已经准备好了!!</span>
    django<span class="token punctuation">.</span>setup<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment"># -- !!所有的测试代码必须都写在测试环境准备好后,否则不生效!</span>
    <span class="token comment">#    也就是写在django.setup()这行代码之后呗!</span>
    
    <span class="token comment"># ... ... ...</span>
    <span class="token comment"># ... ... ...</span>
    <span class="token comment"># ... ... ...</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><hr> <h2 id="orm单表常用方法"><a href="#orm单表常用方法" class="header-anchor">#</a> ORM单表常用方法</h2> <blockquote><p>filter     all    first     last    get<br>
values、values_list、distinct、order_by、reverse、count、exclude<br>
只要是queryset对象,就可以通过<code>.</code>query查看内部的sql语句!!</p> <p><font color="brown">这里主要是对单表的操作!!!</font></p></blockquote> <p><font color="#01a3a4" size="4">app01下的models.py</font><br>
注意,需要执行两条命令进行数据库的迁移!!</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">from</span> django<span class="token punctuation">.</span>db <span class="token keyword">import</span> models


<span class="token keyword">class</span> <span class="token class-name">User</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    name <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">,</span> verbose_name<span class="token operator">=</span><span class="token string">'姓名'</span><span class="token punctuation">)</span>
    age <span class="token operator">=</span> models<span class="token punctuation">.</span>IntegerField<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># create_time = models.DateField(auto_now=True, auto_now_add=True)</span>
    create_time <span class="token operator">=</span> models<span class="token punctuation">.</span>DateField<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># -- 这里我们不传参,自己指定时间</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;
    models.DateTimeField -- 年月日 时分秒
    models.DateField     -- 年月日
        auto_now :     若值为True,只要本条数据有修改,就会将该字段的值更新
        auto_now_add : 若值为True,会自动帮忙添加本条数据的入库时间,若后续想要更改,需要手动
    &quot;&quot;&quot;</span>

    <span class="token keyword">def</span> <span class="token function">__str__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>name
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p><font color="gray">Ps: 在pychrm查看sqlite数据库时,下载对应的驱动可能失败,换一个低点版本试试!!</font></p> <p><font color="#01a3a4" size="4">app01下的tests.py</font></p> <p>先来回顾下前面已经学习了的单表的CURD!!</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">from</span> django<span class="token punctuation">.</span>test <span class="token keyword">import</span> TestCase

<span class="token keyword">import</span> os
<span class="token keyword">import</span> sys

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">&quot;__main__&quot;</span><span class="token punctuation">:</span>
    os<span class="token punctuation">.</span>environ<span class="token punctuation">.</span>setdefault<span class="token punctuation">(</span><span class="token string">&quot;DJANGO_SETTINGS_MODULE&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;tem.settings&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">import</span> django
    django<span class="token punctuation">.</span>setup<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">from</span> app01 <span class="token keyword">import</span> models
    <span class="token comment"># -- 增加</span>
    <span class="token comment"># models.User.objects.create(name='egon', age=18, create_time='2021-08-13')</span>
    <span class="token comment"># models.User.objects.create(name='egon2', age=20, create_time='2021-09-13')</span>
    <span class="token comment"># user_obj = models.User(name='egon1', age=19, create_time='2022-02-22')</span>
    <span class="token comment"># user_obj.save()</span>

    <span class="token comment"># -- 修改</span>
    <span class="token comment"># models.User.objects.update(name='EGON') # -- 这样就全改了!!一定要注意!</span>
    <span class="token comment"># -- pk --&gt; primary key --&gt; 1</span>
    models<span class="token punctuation">.</span>User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>pk<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>update<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'EGON'</span><span class="token punctuation">)</span>
    user_obj <span class="token operator">=</span> models<span class="token punctuation">.</span>User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>pk<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>
    user_obj<span class="token punctuation">.</span>age <span class="token operator">=</span> <span class="token number">25</span>
    user_obj<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment"># -- 删除</span>
    <span class="token comment"># -- 这里是物理删除,我们往往使用的是软删除</span>
    <span class="token comment"># models.User.objects.filter(pk=1).delete()</span>

    <span class="token comment"># -- 查询</span>
    models<span class="token punctuation">.</span>User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># &lt;QuerySet [&lt;User: EGON&gt;, &lt;User: egon1&gt;, &lt;User: egon2&gt;]&gt;</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment"># -- print打印对象,触发了对象的__str__方法!</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>last<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>   <span class="token comment"># egon2</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># EGON</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>pk<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>   <span class="token comment"># &lt;QuerySet [&lt;User: EGON&gt;]&gt;</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>pk<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># &lt;QuerySet []&gt;</span>
    <span class="token comment"># -- 这里models.User.objects.filter(pk=2).get()一样的效果</span>
    <span class="token comment">#    get和first的区别,若QuerySet对象为空,前者报错,后者返回None</span>
    <span class="token comment">#    所以get不建议用,非要用,需要try..except捕捉异常!</span>
    res <span class="token operator">=</span> models<span class="token punctuation">.</span>User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>pk<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>       <span class="token comment"># egon1</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>name<span class="token punctuation">)</span>  <span class="token comment"># egon1</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>age<span class="token punctuation">)</span>   <span class="token comment"># 19</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>create_time<span class="token punctuation">)</span>  <span class="token comment"># 2022-02-22</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br></div></div><p><font color="#01a3a4" size="4">ORM的其它方法</font></p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">from</span> django<span class="token punctuation">.</span>test <span class="token keyword">import</span> TestCase

<span class="token keyword">import</span> os
<span class="token keyword">import</span> sys

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">&quot;__main__&quot;</span><span class="token punctuation">:</span>
    os<span class="token punctuation">.</span>environ<span class="token punctuation">.</span>setdefault<span class="token punctuation">(</span><span class="token string">&quot;DJANGO_SETTINGS_MODULE&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;tem.settings&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">import</span> django

    django<span class="token punctuation">.</span>setup<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">from</span> app01 <span class="token keyword">import</span> models

    <span class="token comment"># -- values ==&gt; 指定查询字段!结果是列表套字典.</span>
    <span class="token comment">#    select name,age from user</span>
    <span class="token comment">#    字段、数据量少的时候可以all&quot;否则内存会爆&quot;,字段多or数据量大的时候用value!!</span>
    res <span class="token operator">=</span> models<span class="token punctuation">.</span>User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token string">'age'</span><span class="token punctuation">)</span>
    <span class="token comment"># &lt;QuerySet [{'name': 'EGON', 'age': 25}, {'name': 'egon1', 'age': 19}, {'name': 'egon2', 'age': 20}]&gt;</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
    <span class="token comment"># SELECT &quot;app01_user&quot;.&quot;name&quot;, &quot;app01_user&quot;.&quot;age&quot; FROM &quot;app01_user&quot;</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>query<span class="token punctuation">)</span>

    <span class="token comment"># -- values_list ==&gt; 指定查询字段!结果是列表套元祖.</span>
    res <span class="token operator">=</span> models<span class="token punctuation">.</span>User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>values_list<span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token string">'age'</span><span class="token punctuation">)</span>
    <span class="token comment"># &lt;QuerySet [('EGON', 25), ('egon1', 19), ('egon2', 20)]&gt;</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>

    <span class="token comment">#  -- distinct 去重查询!</span>
    <span class="token comment">#  强调,去重的前提的是数据一摸一样!千万别加id!</span>
    <span class="token comment">#  若需要去重的查询数据中带有主键,去重就没有意义啦!所以我们要指定字段去重!</span>
    res <span class="token operator">=</span> models<span class="token punctuation">.</span>User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>distinct<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>

    <span class="token comment"># -- order_by 排序</span>
    <span class="token comment">#    select * from user order by age asc</span>
    models<span class="token punctuation">.</span>User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>order_by<span class="token punctuation">(</span><span class="token string">'age'</span><span class="token punctuation">)</span>  <span class="token comment"># -- 默认升序</span>
    <span class="token comment">#    先按照age倒序,age相同的情况按照create_time正序排.</span>
    <span class="token comment">#    select name,age from user order by age desc,create_time asc</span>
    res <span class="token operator">=</span> models<span class="token punctuation">.</span>User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>values_list<span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token string">'age'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>order_by<span class="token punctuation">(</span><span class="token string">'-age'</span><span class="token punctuation">,</span> <span class="token string">'create_time'</span><span class="token punctuation">)</span>
    <span class="token comment"># &lt;QuerySet [('EGON', 25), ('egon2', 20), ('egon1', 19)]&gt;</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>

    <span class="token comment"># -- reverse 翻转</span>
    <span class="token comment">#    强调!reverse反转有个前提,必须先排序!!</span>
    res <span class="token operator">=</span> models<span class="token punctuation">.</span>User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>order_by<span class="token punctuation">(</span><span class="token string">'age'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>reverse<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>

    <span class="token comment"># -- count 数量,统计当前数据的个数</span>
    <span class="token comment">#    当然可以结合filter先进行筛选,然后再统计数量!</span>
    res <span class="token operator">=</span> models<span class="token punctuation">.</span>User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>count<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>  <span class="token comment"># 3</span>
    
    <span class="token comment"># -- exclude 排除在外</span>
    res <span class="token operator">=</span> models<span class="token punctuation">.</span>User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>exclude<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'egon1'</span><span class="token punctuation">)</span>
    <span class="token comment"># &lt;QuerySet [&lt;User: EGON&gt;, &lt;User: egon2&gt;]&gt;</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br></div></div><hr> <h2 id="数据准备"><a href="#数据准备" class="header-anchor">#</a> 数据准备</h2> <p><font color="#01a3a4" size="4">app01下的models.py</font><br>
注意,需要执行两条命令进行数据库的迁移!!并在数据库可视化界面添加模拟数据!!</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token triple-quoted-string string">&quot;&quot;&quot;
book 书籍表 -- id  title  price  &quot;publish_id&quot; &quot;authors_id&quot;  maichu  kucun
     1,西游记,600,1,1,1000,50
     2,红楼梦,700,2,1,1000,2000
     3,水浒传,300,1,2,1000,3000
     4,三国演义,610,1,3,1000,60
publish 出版社表 -- id  title  addr
     1,南京出版社,南京
     2,东京出版社,东京
author 作者表 -- id  name  &quot;detail_id&quot;  age  create_time
     1,egon,1,32,2020-10-01
     2,jason,2,18,2021-09-01
     3,kevin,3,40,2020-09-01
author_detail 作者详情表 -- id  phone  email
     1,110,123@qq.com
     2,120,1.@qq.com
     3,130,2.@qq.com

★ 分析表与表之间的关系:
    book:publish = n:1
    book:author = n:n 
    author:author_detail = 1:1
&quot;&quot;&quot;</span>
<span class="token keyword">from</span> django<span class="token punctuation">.</span>db <span class="token keyword">import</span> models


<span class="token keyword">class</span> <span class="token class-name">Book</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    title <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">)</span>
    price <span class="token operator">=</span> models<span class="token punctuation">.</span>DecimalField<span class="token punctuation">(</span>max_digits<span class="token operator">=</span><span class="token number">8</span><span class="token punctuation">,</span> decimal_places<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
    publish <span class="token operator">=</span> models<span class="token punctuation">.</span>ForeignKey<span class="token punctuation">(</span>to<span class="token operator">=</span><span class="token string">'Publish'</span><span class="token punctuation">)</span>
    authors <span class="token operator">=</span> models<span class="token punctuation">.</span>ManyToManyField<span class="token punctuation">(</span>to<span class="token operator">=</span><span class="token string">'Author'</span><span class="token punctuation">)</span>
    maichu <span class="token operator">=</span> models<span class="token punctuation">.</span>IntegerField<span class="token punctuation">(</span>default<span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">)</span>  <span class="token comment"># -- 卖出图书数</span>
    kucun <span class="token operator">=</span> models<span class="token punctuation">.</span>IntegerField<span class="token punctuation">(</span>default<span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">)</span>   <span class="token comment"># -- 库存图书数</span>

    <span class="token keyword">def</span> <span class="token function">__str__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>title


<span class="token keyword">class</span> <span class="token class-name">Publish</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    title <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">)</span>
    addr <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">__str__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>title


<span class="token keyword">class</span> <span class="token class-name">Author</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    name <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">)</span>
    detail <span class="token operator">=</span> models<span class="token punctuation">.</span>OneToOneField<span class="token punctuation">(</span>to<span class="token operator">=</span><span class="token string">'AuthorDetail'</span><span class="token punctuation">)</span>
    age <span class="token operator">=</span> models<span class="token punctuation">.</span>IntegerField<span class="token punctuation">(</span>default<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
    create_time <span class="token operator">=</span> models<span class="token punctuation">.</span>DateField<span class="token punctuation">(</span>null<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">__str__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>name


<span class="token keyword">class</span> <span class="token class-name">AuthorDetail</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    phone <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">)</span>
    email <span class="token operator">=</span> models<span class="token punctuation">.</span>EmailField<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">__str__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>phone
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br></div></div><hr> <h2 id="基于双下划线查询"><a href="#基于双下划线查询" class="header-anchor">#</a> 基于双下划线查询</h2> <blockquote><p>age_ _gt、age_ _lt、age_ _gte、age_ _lte<br>
age_ _in<br>
age_ _range<br>
name_ _contains、name_ _icontains<br>
name_ _startswith、name_ _endswith<br>
create_time_ _month、create_time_ _year</p></blockquote> <p><font color="#01a3a4" size="4">app01下的tests.py</font></p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">from</span> django<span class="token punctuation">.</span>test <span class="token keyword">import</span> TestCase

<span class="token keyword">import</span> os
<span class="token keyword">import</span> sys

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">&quot;__main__&quot;</span><span class="token punctuation">:</span>
    os<span class="token punctuation">.</span>environ<span class="token punctuation">.</span>setdefault<span class="token punctuation">(</span><span class="token string">&quot;DJANGO_SETTINGS_MODULE&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;tem.settings&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">import</span> django

    django<span class="token punctuation">.</span>setup<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">from</span> app01 <span class="token keyword">import</span> models

    <span class="token comment"># -- ■ age__gt、age__lt、age__gte、age__lte</span>
    <span class="token comment">#    gte --&gt; greater than equal; lte --&gt; less than equal.</span>
    <span class="token comment"># -- 年龄大于35岁的数据</span>
    <span class="token comment">#    select * from table where age &gt; 35</span>
    res <span class="token operator">=</span> models<span class="token punctuation">.</span>Author<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>age__gt<span class="token operator">=</span><span class="token number">35</span><span class="token punctuation">)</span>
    <span class="token comment"># &lt;QuerySet [&lt;Author: kevin&gt;]&gt;</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
    <span class="token comment"># -- 同理.小于、大于等于、小于等于</span>
    models<span class="token punctuation">.</span>Author<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>age__lt<span class="token operator">=</span><span class="token number">35</span><span class="token punctuation">)</span>
    models<span class="token punctuation">.</span>Author<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>age__gte<span class="token operator">=</span><span class="token number">35</span><span class="token punctuation">)</span>
    models<span class="token punctuation">.</span>Author<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>age__lte<span class="token operator">=</span><span class="token number">35</span><span class="token punctuation">)</span>

    <span class="token comment"># -- ■ age__in、</span>
    <span class="token comment"># -- 查询年龄是32 18的数据</span>
    <span class="token comment">#    select * from table where age in (32,18);  </span>
    <span class="token comment">#    in可以理解成or  age=1 or age=3 or age=5, not in不走索引</span>
    models<span class="token punctuation">.</span>Author<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>age__in<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

    <span class="token comment"># -- ■ age__range</span>
    <span class="token comment"># -- 查询年龄在18到40之间的数据,闭区间首尾都要</span>
    <span class="token comment">#    select * from table where age between in 18 and 40;</span>
    models<span class="token punctuation">.</span>Author<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>age__range<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">18</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

    <span class="token comment"># -- ■ name__contains、name__icontains</span>
    <span class="token comment"># -- 查询出名字中含有s的数据,&lt;模糊查询&gt;</span>
    <span class="token comment">#    select * from table where name like '%s%';</span>
    models<span class="token punctuation">.</span>Author<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>name__contains<span class="token operator">=</span><span class="token string">'s'</span><span class="token punctuation">)</span>   <span class="token comment"># -- 区分大小写</span>
    models<span class="token punctuation">.</span>Author<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>name__icontains<span class="token operator">=</span><span class="token string">'S'</span><span class="token punctuation">)</span>  <span class="token comment"># -- 忽略大小写</span>

    <span class="token comment"># -- ■ name__startswith、name__endswith</span>
    <span class="token comment"># -- 查询表中以t开头的名字</span>
    models<span class="token punctuation">.</span>Author<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>name__startswith<span class="token operator">=</span><span class="token string">'t'</span><span class="token punctuation">)</span>
    <span class="token comment"># -- 查询表中以t结尾的名字</span>
    models<span class="token punctuation">.</span>Author<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>name__endswith<span class="token operator">=</span><span class="token string">'t'</span><span class="token punctuation">)</span>

    <span class="token comment"># -- ■ create_time__month、create_time__year、create_time__day</span>
    <span class="token comment">#    在sqlite数据库添加字段类型为DateField的数据时会转成时间戳,这可能是个bug.</span>
    <span class="token comment">#    这里我们用命令添加.</span>
    models<span class="token punctuation">.</span>Author<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>pk<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>update<span class="token punctuation">(</span>create_time<span class="token operator">=</span><span class="token string">'2020-10-01'</span><span class="token punctuation">)</span>
    models<span class="token punctuation">.</span>Author<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>pk<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span>update<span class="token punctuation">(</span>create_time<span class="token operator">=</span><span class="token string">'2021-09-01'</span><span class="token punctuation">)</span>
    models<span class="token punctuation">.</span>Author<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>pk<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span>update<span class="token punctuation">(</span>create_time<span class="token operator">=</span><span class="token string">'2020-09-01'</span><span class="token punctuation">)</span>
    <span class="token comment">#  -- 查询9月份的数据! (该需求很常见!)</span>
    <span class="token comment">#     原生sql需要用到data_format方法!!具体的可以查查.</span>
    models<span class="token punctuation">.</span>Author<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>create_time__month<span class="token operator">=</span><span class="token string">'09'</span><span class="token punctuation">)</span>
    <span class="token comment">#  -- 查询2020年的数据!</span>
    models<span class="token punctuation">.</span>Author<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>create_time__year<span class="token operator">=</span><span class="token string">'2020'</span><span class="token punctuation">)</span>
    <span class="token comment">#  -- 查询2020年9月份的数据!</span>
    models<span class="token punctuation">.</span>Author<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>create_time__year<span class="token operator">=</span><span class="token string">'2020'</span><span class="token punctuation">,</span>create_time__month<span class="token operator">=</span><span class="token string">'09'</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br></div></div><hr> <h2 id="外键查询"><a href="#外键查询" class="header-anchor">#</a> 外键查询</h2> <blockquote><p>操作表中的外键,CUD操作<br>
R查的操作暂且不管,它涉及到后文的正反向概念..</p> <p>1&gt; 一对多的外键 -- 推荐直接对外键赋值(一般来说,外键关联的是另一张表的主键)<br>
2&gt; 多对多的外键 -- 拿到表的对象,<code>obj.外键虚拟字段.指定方法()</code> .</p></blockquote> <h3 id="一对多外键cud"><a href="#一对多外键cud" class="header-anchor">#</a> 一对多外键CUD</h3> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">from</span> django<span class="token punctuation">.</span>test <span class="token keyword">import</span> TestCase

<span class="token keyword">import</span> os
<span class="token keyword">import</span> sys

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">&quot;__main__&quot;</span><span class="token punctuation">:</span>
    os<span class="token punctuation">.</span>environ<span class="token punctuation">.</span>setdefault<span class="token punctuation">(</span><span class="token string">&quot;DJANGO_SETTINGS_MODULE&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;tem.settings&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">import</span> django

    django<span class="token punctuation">.</span>setup<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">from</span> app01 <span class="token keyword">import</span> models

    <span class="token triple-quoted-string string">&quot;&quot;&quot;
    一对多的增删改查
    书:出版社 = n:1  --  操作书表中的外键!!
    &quot;&quot;&quot;</span>
    <span class="token comment"># -- ■ 查</span>
    <span class="token comment">#    牵扯到正反向概念!详看后文!</span>

    <span class="token comment"># -- ■ 添加 create</span>
    <span class="token comment">#    添加一本书!</span>
    <span class="token comment"># -- 方式一(推荐) 里面是publish_id～</span>
    <span class="token comment">#    注意:publish_id必须存在!!</span>
    models<span class="token punctuation">.</span>Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>create<span class="token punctuation">(</span>title<span class="token operator">=</span><span class="token string">'水浒传'</span><span class="token punctuation">,</span> price<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">,</span> publish_id<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token comment"># -- 方式二 里面是publish～</span>
    <span class="token comment">#    publish的值为Publish的实例对象</span>
    publish_obj <span class="token operator">=</span> models<span class="token punctuation">.</span>Publish<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>pk<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># -- 拿到出版社对象</span>
    models<span class="token punctuation">.</span>Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>create<span class="token punctuation">(</span>title<span class="token operator">=</span><span class="token string">'三国演义'</span><span class="token punctuation">,</span> price<span class="token operator">=</span><span class="token number">110</span><span class="token punctuation">,</span> publish<span class="token operator">=</span>publish_obj<span class="token punctuation">)</span>

    <span class="token comment"># -- ■ 修改 update</span>
    <span class="token comment"># -- 方式一(推荐)</span>
    models<span class="token punctuation">.</span>Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>pk<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>update<span class="token punctuation">(</span>title<span class="token operator">=</span><span class="token string">'水浒传1'</span><span class="token punctuation">,</span> publish_id<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
    <span class="token comment"># -- 方式二</span>
    publish_obj <span class="token operator">=</span> models<span class="token punctuation">.</span>Publish<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>pk<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>
    models<span class="token punctuation">.</span>Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>pk<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>update<span class="token punctuation">(</span>title<span class="token operator">=</span><span class="token string">'水浒传2'</span><span class="token punctuation">,</span> publish<span class="token operator">=</span>publish_obj<span class="token punctuation">)</span>

    <span class="token comment"># -- ■ 删除 delete </span>
    <span class="token comment">#    默认是级联删除的!也就是该出版社对应的book数据也会在Book表中删除!!</span>
    models<span class="token punctuation">.</span>Publish<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>pk<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>delete<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br></div></div><h3 id="多对多外键cud"><a href="#多对多外键cud" class="header-anchor">#</a> 多对多外键CUD</h3> <blockquote><p>add()、set([])、remove()、all()、clear()</p></blockquote> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">from</span> django<span class="token punctuation">.</span>test <span class="token keyword">import</span> TestCase

<span class="token keyword">import</span> os
<span class="token keyword">import</span> sys

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">&quot;__main__&quot;</span><span class="token punctuation">:</span>
    os<span class="token punctuation">.</span>environ<span class="token punctuation">.</span>setdefault<span class="token punctuation">(</span><span class="token string">&quot;DJANGO_SETTINGS_MODULE&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;tem.settings&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">import</span> django

    django<span class="token punctuation">.</span>setup<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">from</span> app01 <span class="token keyword">import</span> models

    <span class="token triple-quoted-string string">&quot;&quot;&quot;
    多对多的增删改查
    书:作者 = n:n  --  操作书表中的虚拟外键字段authors
    &quot;&quot;&quot;</span>
    <span class="token comment"># -- 添加 add =&gt; 原来就有的不会重复添加!</span>
    <span class="token comment"># -- 给id为1的书添加一个作者</span>
    book_obj <span class="token operator">=</span> models<span class="token punctuation">.</span>Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>pk<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># app01.Author.None -- 该结果就表明可以通过虚拟字段authors跨到第三张表!</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>book_obj<span class="token punctuation">.</span>authors<span class="token punctuation">)</span>  <span class="token comment"># -- 跨到第三张表</span>
    <span class="token comment"># -- ★ 给id为1的book添加一个id为1的作者</span>
    book_obj<span class="token punctuation">.</span>authors<span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token comment"># -- ★ 给id为1的book添加两个作者,id为1和id为2的作者</span>
    book_obj<span class="token punctuation">.</span>authors<span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
    <span class="token comment"># Ps:当然也可以在add里写作者对象!!但不推荐这样做,因为要先查找一遍.数据量一多,效率很低.</span>
    <span class="token comment">#    book_obj.authors.add(author_obj0, author_obj1)</span>

    <span class="token comment"># -- 修改 set =&gt; 没有也不碍事</span>
    <span class="token comment">#    同理,set里的可迭代对象的元素可以放对象,但不推荐!</span>
    book_obj <span class="token operator">=</span> models<span class="token punctuation">.</span>Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>pk<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>
    book_obj<span class="token punctuation">.</span>authors<span class="token punctuation">.</span><span class="token builtin">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment"># -- 用元祖也可以,就一点,必须为可迭代对象!</span>
    <span class="token comment">#    Django会先比对id为1的book,有没有对应的id为2、3的author</span>
    <span class="token comment">#    若有,不动,没有就添加 -- 有查找比对的过程</span>
    <span class="token comment">#    -- 这种方式不一定有先删除id为1的book对应的所有author,然后再添加的效率高</span>
    book_obj<span class="token punctuation">.</span>authors<span class="token punctuation">.</span><span class="token builtin">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

    <span class="token comment"># -- 删除 remove =&gt; 没有也不碍事</span>
    book_obj <span class="token operator">=</span> models<span class="token punctuation">.</span>Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>pk<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># -- 在第三张表中,将id为1的书对应的id为2的作者的这条记录删除..</span>
    book_obj<span class="token punctuation">.</span>authors<span class="token punctuation">.</span>remove<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
    <span class="token comment"># -- 也可以删除多个 若没有对应id为2的作者的记录删除,不会管,不碍事,不会报错</span>
    book_obj<span class="token punctuation">.</span>authors<span class="token punctuation">.</span>remove<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>

    <span class="token comment"># -- 查询 all 涉及到正反向概念,详见后文!!</span>
    <span class="token comment">#    查询id为2的书的所有作者</span>
    book_obj <span class="token operator">=</span> models<span class="token punctuation">.</span>Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>pk<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>
    res <span class="token operator">=</span> book_obj<span class="token punctuation">.</span>authors<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># &lt;QuerySet [&lt;Author: egon&gt;, &lt;Author: jason&gt;, &lt;Author: kevin&gt;]&gt;</span>
    <span class="token comment"># 若没有,值为&lt;QuerySet []&gt;</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>

    <span class="token comment"># -- 清空 clear</span>
    <span class="token comment">#    在第三张表中清空某个书籍与作者的绑定关系!</span>
    book_obj <span class="token operator">=</span> models<span class="token punctuation">.</span>Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>pk<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>
    res <span class="token operator">=</span> book_obj<span class="token punctuation">.</span>authors<span class="token punctuation">.</span>clear<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br></div></div><hr> <h2 id="orm多表查询"><a href="#orm多表查询" class="header-anchor">#</a> ORM多表查询!!</h2> <blockquote><p>想拿到 [对象], 想到 [子查询]; 想拿到包含 &lt;跨表字段&gt; 的一条条记录,想到 &lt;联表查询&gt;..</p> <p><font color="brown"><strong>子查询</strong></font> -- 用对象来跨<br>
先拿到对象obj, obj = models.表名.objects.filter(条件).first()<br>
1&gt; 正向     正1 <code>obj.外键字段</code> ; 正n <code>obj.外键字段.all()</code><br>
2&gt; 反向     反1 <code>obj.另一张表表名小写</code> ; 反n <code>obj.另一张表表名小写_set.all()</code><br>
无论正向还是反向, 正/反1拿到都是另一张表的一个 实例对象/记录;正/反n拿到的都是QuerySet对象.<br>
Ps: QuerySet对象可以简单理解成一个列表,这里的QuerySet对象包含的是一个个实例/一条条记录.<br>
eg: &lt;QuerySet [&lt;Author: egon&gt;, &lt;Author: jason&gt;]&gt;</p> <p><font color="brown"><strong>联表查询</strong></font> -- 用字段来跨<br> <font color="blue">核心重点是根据基表精准指定跨表字段!</font> <font color="green">所以别那么死板,像子查询里等其它地方都可以指定跨表字段..</font><br>
1&gt; 正向查询涉及到另一张表的某个字段, <code>外键__另一张表的字段</code><br>
2&gt; 反向查询涉及到另一张表的某个字段, <code>另一张表的表名小写__另一张表的字段</code><br>
Ps:外键到另一张表,另一张表的表名小写也到另一张表,可以连续跨多张表<br> <code>正向的外键/反向的需跨到表的小写__正向的外键/反向的需跨到表的小写__最后跨到的那张表的字段</code><br>
res = model.表名.objects.filter(条件).values('字段1','字段2')<br>
无论正向还是反向,res的结果都是QuerySet对象<br>
eg: &lt;QuerySet [{'name': 'egon', 'phone': 110},{'name': 'phone', 'phone': 120}]&gt;</p></blockquote> <h3 id="正反向概念"><a href="#正反向概念" class="header-anchor">#</a> 正反向概念</h3> <blockquote><p>正向: 外键字段在我手上,我查你,那就是正向查询<br>
    eg -- <font color="blue">书:出版社 = n:1 外键字段在书表中,书查出版社就是正向!!</font>
反向: 反之,外键字段在我手上,你查我,那就是反向查询<br>
     eg -- 出版社查书就是反向!!</p></blockquote> <p><strong>step1: <font color="green">判断是正向还是反向!</font></strong><br> <strong>step2: <font color="green">判断查的是多的那方还是少的那方!</font></strong></p> <h3 id="子查询"><a href="#子查询" class="header-anchor">#</a> 子查询</h3> <blockquote><p><strong>子查询: 基于对象的跨表查询!</strong><br> <font color="red">正向查询按字段;</font><br> <font color="red">反向查询按 <code>表名小写</code> <code>表名小写_set.all()</code>.</font></p></blockquote> <h5 id="正向查询"><a href="#正向查询" class="header-anchor">#</a> 正向查询</h5> <blockquote><p><font color="brown">正向查询按字段;当返回的结果可能为多个时,要加.all()!!</font><br> <font color="red">★ 简单来说,正向查询 多对多/无论查哪方都是多的那方 要加.all()!! </font><br>
其余情况,正向查询的一对多,一对一不加.all()</p></blockquote> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">from</span> django<span class="token punctuation">.</span>test <span class="token keyword">import</span> TestCase

<span class="token keyword">import</span> os
<span class="token keyword">import</span> sys

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">&quot;__main__&quot;</span><span class="token punctuation">:</span>
    os<span class="token punctuation">.</span>environ<span class="token punctuation">.</span>setdefault<span class="token punctuation">(</span><span class="token string">&quot;DJANGO_SETTINGS_MODULE&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;tem.settings&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">import</span> django

    django<span class="token punctuation">.</span>setup<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">from</span> app01 <span class="token keyword">import</span> models

    <span class="token comment"># -- 查询主键为1的书籍的出版社 (即查该书所关联的出版社对象)</span>
    <span class="token comment">#    书:出版社 = n:1</span>
    <span class="token comment">#    书查出版社=&gt;正向</span>
    book_obj <span class="token operator">=</span> models<span class="token punctuation">.</span>Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>pk<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>book_obj<span class="token punctuation">.</span>publish<span class="token punctuation">)</span>  <span class="token comment"># 南京出版社</span>

    <span class="token comment"># -- 查询主键为2的书籍的作者 (即查该书所关联的作者对象)</span>
    <span class="token comment">#    书:作者 = n:n 设计表时外键在书这</span>
    <span class="token comment">#    So,书查作者=&gt;正向</span>
    book_obj <span class="token operator">=</span> models<span class="token punctuation">.</span>Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>pk<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>book_obj<span class="token punctuation">.</span>authors<span class="token punctuation">)</span>  <span class="token comment"># app01.Author.None</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>book_obj<span class="token punctuation">.</span>authors<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># &lt;QuerySet [&lt;Author: egon&gt;, &lt;Author: jason&gt;]&gt;</span>

    <span class="token comment"># -- 查询作者jason的电话号码 (即查该作者所关联的作者详情对象,通过作者详情对象拿到电话号码)</span>
    <span class="token comment">#    作者:作者详情 = 1:1 设计表时外键在作者这</span>
    <span class="token comment">#    作者查作者详情=&gt;正向</span>
    author_obj <span class="token operator">=</span> models<span class="token punctuation">.</span>Author<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'egon'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>author_obj<span class="token punctuation">.</span>detail<span class="token punctuation">.</span>phone<span class="token punctuation">)</span>  <span class="token comment"># 110</span>
    <span class="token comment"># Ps: 对字段的跨表!!联表查询里有涉及到! ※※※※※※</span>
    <span class="token comment"># ad_obj = models.AuthorDetail.objects.filter(author__name='egon').first()</span>
    <span class="token comment"># print(ad_obj.phone)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><h5 id="反向查询"><a href="#反向查询" class="header-anchor">#</a> 反向查询</h5> <blockquote><p><font color="brown">反向查询按 <code>表名小写</code> <code>表名小写_set.all()</code>.</font><br> <font color="red">简单来说,反向查询 查多的那方n <code>表名小写_set.all()</code>; 查少的那方1 <code>表名小写</code></font></p></blockquote> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">from</span> django<span class="token punctuation">.</span>test <span class="token keyword">import</span> TestCase

<span class="token keyword">import</span> os
<span class="token keyword">import</span> sys

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">&quot;__main__&quot;</span><span class="token punctuation">:</span>
    os<span class="token punctuation">.</span>environ<span class="token punctuation">.</span>setdefault<span class="token punctuation">(</span><span class="token string">&quot;DJANGO_SETTINGS_MODULE&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;tem.settings&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">import</span> django

    django<span class="token punctuation">.</span>setup<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">from</span> app01 <span class="token keyword">import</span> models

    <span class="token comment"># -- 查询出版社是南京出版社出版的书</span>
    <span class="token comment">#    书:出版社 = n:1 外键字段在书那</span>
    <span class="token comment">#    出版社查书=&gt;反向</span>
    publish_obj <span class="token operator">=</span> models<span class="token punctuation">.</span>Publish<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>title<span class="token operator">=</span><span class="token string">'南京出版社'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>publish_obj<span class="token punctuation">.</span>book_set<span class="token punctuation">)</span>  <span class="token comment"># -- app01.Book.None</span>
    res <span class="token operator">=</span> publish_obj<span class="token punctuation">.</span>book_set<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>

    <span class="token comment"># -- 查询作者jason写过的书</span>
    <span class="token comment">#    作者:书 = n:n 设计表时外键在书这</span>
    <span class="token comment">#    作者查书=&gt;反向</span>
    author_obj <span class="token operator">=</span> models<span class="token punctuation">.</span>Author<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'jason'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>author_obj<span class="token punctuation">.</span>book_set<span class="token punctuation">)</span>  <span class="token comment"># -- app01.Book.None</span>
    res <span class="token operator">=</span> author_obj<span class="token punctuation">.</span>book_set<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>

    <span class="token comment"># -- 查询手机号是110的作者的姓名 “这里有误,懒得改了.”</span>
    <span class="token comment">#    作者:作者详情 = 1：1 设计表时外键在作者详情这</span>
    <span class="token comment">#    作者详情查作者=&gt;反向</span>
    ad_obj <span class="token operator">=</span> models<span class="token punctuation">.</span>AuthorDetail<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>phone<span class="token operator">=</span><span class="token string">'110'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>ad_obj<span class="token punctuation">.</span>author<span class="token punctuation">)</span>  <span class="token comment"># egon</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><h3 id="联表查询"><a href="#联表查询" class="header-anchor">#</a> 联表查询</h3> <blockquote><p><strong>联表查询: 基于 双下划线 的跨表查询</strong></p> <p><em>查询过程中,正反向的概念同样适用!!</em></p></blockquote> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">from</span> django<span class="token punctuation">.</span>test <span class="token keyword">import</span> TestCase

<span class="token keyword">import</span> os
<span class="token keyword">import</span> sys

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">&quot;__main__&quot;</span><span class="token punctuation">:</span>
    os<span class="token punctuation">.</span>environ<span class="token punctuation">.</span>setdefault<span class="token punctuation">(</span><span class="token string">&quot;DJANGO_SETTINGS_MODULE&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;tem.settings&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">import</span> django

    django<span class="token punctuation">.</span>setup<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">from</span> app01 <span class="token keyword">import</span> models

    <span class="token comment"># -- 查询egon的年龄和手机号</span>
    <span class="token comment">#    作者:作者详情 = 1:1</span>
    <span class="token comment"># 1&gt; 方式一</span>
    <span class="token comment">#    外键在作者表那,作者查作者详情=&gt;正向 (基表是作者表)</span>
    <span class="token comment">#    ★★★ 正向查询涉及到另一张表的某个字段, `外键__另一张表的字段`</span>
    res <span class="token operator">=</span> models<span class="token punctuation">.</span>Author<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'egon'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token string">'age'</span><span class="token punctuation">,</span> <span class="token string">'detail__phone'</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>  <span class="token comment"># &lt;QuerySet [{'age': 32, 'detail__phone': '110'}]&gt;</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>query<span class="token punctuation">)</span>
    <span class="token comment"># 2&gt; 方式二</span>
    <span class="token comment">#    外键在作者表那,作者详情查作者=&gt;反向 (基表是作者详情表)</span>
    <span class="token comment">#    ★★★ 反向查询涉及到另一张表的某个字段, `另一张表的表名小写__另一张表的字段`</span>
    res <span class="token operator">=</span> models<span class="token punctuation">.</span>AuthorDetail<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>author__name<span class="token operator">=</span><span class="token string">'egon'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token string">'author__age'</span><span class="token punctuation">,</span> <span class="token string">'phone'</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>  <span class="token comment"># &lt;QuerySet [{'author__age': 32, 'phone': '110'}]&gt;</span>

    <span class="token comment"># -- 查询主键为1的书的名称和该书对应的出版社名字</span>
    <span class="token comment">#    书:出版社 = n:1</span>
    <span class="token comment"># 1&gt; 方式一</span>
    <span class="token comment">#    外键字段在书那,书查出版社=&gt;正向</span>
    res <span class="token operator">=</span> models<span class="token punctuation">.</span>Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>pk<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token string">'title'</span><span class="token punctuation">,</span> <span class="token string">'publish__title'</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>  <span class="token comment"># &lt;QuerySet [{'title': '西游记', 'publish__title': '南京出版社'}]&gt;</span>
    <span class="token comment"># 2&gt; 方式二</span>
    <span class="token comment">#    外键在书那,出版社查书=&gt;反向 (基表是出版社表)</span>
    res <span class="token operator">=</span> models<span class="token punctuation">.</span>Publish<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>book__pk<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token string">'book__title'</span><span class="token punctuation">,</span> <span class="token string">'title'</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>  <span class="token comment"># &lt;QuerySet [{'book__title': '西游记', 'title': '南京出版社'}]&gt;</span>

    <span class="token comment"># -- 查询主键为2的书籍的作者姓名</span>
    <span class="token comment">#    书:作者 = n:n</span>
    <span class="token comment"># 1&gt; 方式一</span>
    <span class="token comment">#    外键字段在书那,书查作者=&gt;正向</span>
    res <span class="token operator">=</span> models<span class="token punctuation">.</span>Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>pk<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token string">'authors__name'</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>  <span class="token comment"># &lt;QuerySet [{'authors__name': 'egon'}, {'authors__name': 'jason'}]&gt;</span>
    <span class="token comment"># 2&gt; 方式二</span>
    <span class="token comment">#    作者查书=&gt;反向</span>
    res <span class="token operator">=</span> models<span class="token punctuation">.</span>Author<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>book__pk<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>  <span class="token comment"># &lt;QuerySet [{'name': 'egon'}, {'name': 'jason'}]&gt;</span>

    <span class="token comment"># -- ** 查询主键为2的书籍的作者的手机号! **</span>
    <span class="token comment">#    牵扯了三张表!! 书:作者 = n:n  作者:作者详情表 = 1:1</span>
    <span class="token comment">#    ★★★ 书表中的authors外键跨到作者表__作者表中的detail外键跨到作者详情表__作者详情表的某个字段</span>
    res <span class="token operator">=</span> models<span class="token punctuation">.</span>Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>pk<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token string">'authors__detail__phone'</span><span class="token punctuation">)</span>
    <span class="token comment"># &lt; QuerySet[{'authors__detail__phone': '110'}, {'authors__detail__phone': '120'}] &gt;</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
    
<span class="token triple-quoted-string string">&quot;&quot;&quot; 查询egon的年龄和手机号
SELECT
&quot;app01_author&quot;.&quot;age&quot;,
&quot;app01_authordetail&quot;.&quot;phone&quot; 
FROM
&quot;app01_author&quot;
INNER JOIN 
&quot;app01_authordetail&quot; 
ON 
( &quot;app01_author&quot;.&quot;detail_id&quot; = &quot;app01_authordetail&quot;.&quot;id&quot; ) 
WHERE
&quot;app01_author&quot;.&quot;name&quot; = egon
&quot;&quot;&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br></div></div><hr> <h2 id="聚合查询"><a href="#聚合查询" class="header-anchor">#</a> 聚合查询</h2> <blockquote><p><font color="blue">聚合查询通常情况下是配合着分组一起使用的</font><br>
只要跟数据库相关的模块:<br>
     基本上都在<code>django.db.models</code>里面;<br>
     如果上述没有,那么应该在django.db里面.</p> <p>聚合查询需要加 <font color="brown"><strong>aggregate</strong></font> !!!</p></blockquote> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">from</span> django<span class="token punctuation">.</span>test <span class="token keyword">import</span> TestCase

<span class="token keyword">import</span> os
<span class="token keyword">import</span> sys

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">&quot;__main__&quot;</span><span class="token punctuation">:</span>
    os<span class="token punctuation">.</span>environ<span class="token punctuation">.</span>setdefault<span class="token punctuation">(</span><span class="token string">&quot;DJANGO_SETTINGS_MODULE&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;tem.settings&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">import</span> django

    django<span class="token punctuation">.</span>setup<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">from</span> app01 <span class="token keyword">import</span> models
    <span class="token keyword">from</span> django<span class="token punctuation">.</span>db<span class="token punctuation">.</span>models <span class="token keyword">import</span> Max<span class="token punctuation">,</span> Min<span class="token punctuation">,</span> Sum<span class="token punctuation">,</span> Count<span class="token punctuation">,</span> Avg

    <span class="token comment"># -- 查询所有书的平均价格、最高价格、最低价格、数量</span>
    <span class="token comment">#    select avg(price) from book;</span>
    res <span class="token operator">=</span> models<span class="token punctuation">.</span>Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>aggregate<span class="token punctuation">(</span>Avg<span class="token punctuation">(</span><span class="token string">'price'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Max<span class="token punctuation">(</span><span class="token string">'price'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>  <span class="token comment"># {'price__avg': 127.5, 'price__max': Decimal('200.00')}</span>
    <span class="token comment"># -- 起个别名</span>
    res <span class="token operator">=</span> models<span class="token punctuation">.</span>Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>aggregate<span class="token punctuation">(</span>age<span class="token operator">=</span>Avg<span class="token punctuation">(</span><span class="token string">'price'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">max</span><span class="token operator">=</span>Max<span class="token punctuation">(</span><span class="token string">'price'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>  <span class="token comment"># {'age': 127.5, 'max': Decimal('200.00')}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><hr> <h2 id="分组查询"><a href="#分组查询" class="header-anchor">#</a> 分组查询</h2> <blockquote><p>也就是sql中的group by!!</p> <p>分组查询需要加 <font color="brown"><strong>annotate</strong></font> !!!</p></blockquote> <p>指定分组的字段可以理解成是通过 笛卡尔积/联表 的字段!!<br> <font color="brown">看这篇博文!!很详细!★★★<code>https://www.freecodecamp.org/chinese/news/introduction-to-django-group/</code></font></p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">from</span> django<span class="token punctuation">.</span>test <span class="token keyword">import</span> TestCase

<span class="token keyword">import</span> os
<span class="token keyword">import</span> sys

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">&quot;__main__&quot;</span><span class="token punctuation">:</span>
    os<span class="token punctuation">.</span>environ<span class="token punctuation">.</span>setdefault<span class="token punctuation">(</span><span class="token string">&quot;DJANGO_SETTINGS_MODULE&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;tem.settings&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">import</span> django

    django<span class="token punctuation">.</span>setup<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">from</span> app01 <span class="token keyword">import</span> models
    <span class="token keyword">from</span> django<span class="token punctuation">.</span>db<span class="token punctuation">.</span>models <span class="token keyword">import</span> Max<span class="token punctuation">,</span> Min<span class="token punctuation">,</span> Sum<span class="token punctuation">,</span> Count<span class="token punctuation">,</span> Avg

    res <span class="token operator">=</span> models<span class="token punctuation">.</span>Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>annotate<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># -- ★不指定分组依据,默认按照表的主键进行分组</span>
    <span class="token comment"># &lt;QuerySet [&lt;Book: 西游记&gt;, &lt;Book: 红楼梦&gt;, &lt;Book: 水浒传&gt;, &lt;Book: 三国演义&gt;]&gt;</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>

    <span class="token comment"># -- 统计每一本书的作者个数</span>
    <span class="token comment">#    count起别名=Count(&quot;authors__pk&quot;正向查询))</span>
    <span class="token comment"># 1 &lt;QuerySet [&lt;Book: 西游记&gt;, &lt;Book: 水浒传&gt;, &lt;Book: 三国演义&gt;, &lt;Book: 红楼梦&gt;]&gt;</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'1'</span><span class="token punctuation">,</span> models<span class="token punctuation">.</span>Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>annotate<span class="token punctuation">(</span>count<span class="token operator">=</span>Count<span class="token punctuation">(</span><span class="token string">&quot;authors__pk&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment"># ★ 分组结合聚合!!</span>
    res <span class="token operator">=</span> models<span class="token punctuation">.</span>Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>annotate<span class="token punctuation">(</span>count<span class="token operator">=</span>Count<span class="token punctuation">(</span><span class="token string">&quot;authors__pk&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token string">&quot;count&quot;</span><span class="token punctuation">)</span>
    <span class="token comment"># &lt;QuerySet [{'count': 0}, {'count': 0}, {'count': 0}, {'count': 2}]&gt;</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>

    <span class="token comment"># -- 统计每个出版社卖的最便宜的书的价格</span>
    <span class="token comment">#    书:出版社 = n:1 出版社查书=&gt;反向查询</span>
    res <span class="token operator">=</span> models<span class="token punctuation">.</span>Publish<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>annotate<span class="token punctuation">(</span>price_min<span class="token operator">=</span>Min<span class="token punctuation">(</span><span class="token string">&quot;book__price&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token string">&quot;title&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;price_min&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>

    <span class="token comment"># -- 统计不止一个作者的图书</span>
    <span class="token comment">#    step1:先按照图书分组,求每一本书对应的作者个数.</span>
    <span class="token comment">#          Count('authors__pk')  Count('authors')  都是一样的效果.</span>
    <span class="token comment">#    models.Book.objects.annotate(author_num=Count('authors__pk')).values('title', 'author_num')</span>
    <span class="token comment">#    step2:过滤出不止一个作者的图书/筛选出大于1的.</span>
    res <span class="token operator">=</span> models<span class="token punctuation">.</span>Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>annotate<span class="token punctuation">(</span>author_num<span class="token operator">=</span>Count<span class="token punctuation">(</span><span class="token string">'authors__pk'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span> \
        <span class="token builtin">filter</span><span class="token punctuation">(</span>author_num__gt<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token string">'title'</span><span class="token punctuation">,</span> <span class="token string">'author_num'</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>  <span class="token comment"># -- &lt;QuerySet [{'title': '红楼梦', 'author_num': 2}]&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br></div></div><hr> <h2 id="f与q查询"><a href="#f与q查询" class="header-anchor">#</a> F与Q查询</h2> <h3 id="f查询"><a href="#f查询" class="header-anchor">#</a> F查询</h3> <blockquote><p>要清楚表中的数据实时都是在改变的..  F('字段名') 拿到该字段在这一刻/这一瞬间的值!!</p></blockquote> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">from</span> django<span class="token punctuation">.</span>test <span class="token keyword">import</span> TestCase

<span class="token keyword">import</span> os
<span class="token keyword">import</span> sys

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">&quot;__main__&quot;</span><span class="token punctuation">:</span>
    os<span class="token punctuation">.</span>environ<span class="token punctuation">.</span>setdefault<span class="token punctuation">(</span><span class="token string">&quot;DJANGO_SETTINGS_MODULE&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;tem.settings&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">import</span> django

    django<span class="token punctuation">.</span>setup<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">from</span> app01 <span class="token keyword">import</span> models
    <span class="token keyword">from</span> django<span class="token punctuation">.</span>db<span class="token punctuation">.</span>models <span class="token keyword">import</span> F
    <span class="token keyword">from</span> django<span class="token punctuation">.</span>db<span class="token punctuation">.</span>models <span class="token keyword">import</span> Value
    <span class="token keyword">from</span> django<span class="token punctuation">.</span>db<span class="token punctuation">.</span>models<span class="token punctuation">.</span>functions <span class="token keyword">import</span> Concat  <span class="token comment"># -- 拼接</span>

    <span class="token comment"># -- 查出卖出数大于库存数的书籍!</span>
    <span class="token comment"># sql -- select * from book where maichu &gt; kucun;</span>
    res <span class="token operator">=</span> models<span class="token punctuation">.</span>Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>maichu__gt<span class="token operator">=</span>F<span class="token punctuation">(</span><span class="token string">'kucun'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>  <span class="token comment"># &lt;QuerySet [&lt;Book: 红楼梦&gt;, &lt;Book: 水浒传&gt;]&gt;</span>

    <span class="token comment"># -- 将&lt;所有&gt;书籍的价格提升500块!</span>
    <span class="token comment"># sql -- update book set price = price + 500; # -- 是涉及到mysql的行锁和表锁的!!</span>
    models<span class="token punctuation">.</span>Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>update<span class="token punctuation">(</span>price<span class="token operator">=</span>F<span class="token punctuation">(</span><span class="token string">'price'</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">500</span><span class="token punctuation">)</span>

    <span class="token comment"># -- 将&lt;所有&gt;书籍的名称后面加上爆款两个字!</span>
    <span class="token comment">#    Ps: 当然可以筛选一部分书籍,models.Book.objects.filter().update()</span>
    <span class="token comment">#    注意:必须这样写,不然就会导致要操作的数据的值变为0..</span>
    models<span class="token punctuation">.</span>Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>update<span class="token punctuation">(</span>title<span class="token operator">=</span>Concat<span class="token punctuation">(</span>F<span class="token punctuation">(</span><span class="token string">'title'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Value<span class="token punctuation">(</span><span class="token string">'爆款'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><h3 id="q查询"><a href="#q查询" class="header-anchor">#</a> Q查询</h3> <blockquote><p>涉及到 not、and、or</p></blockquote> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">from</span> django<span class="token punctuation">.</span>test <span class="token keyword">import</span> TestCase

<span class="token keyword">import</span> os
<span class="token keyword">import</span> sys

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">&quot;__main__&quot;</span><span class="token punctuation">:</span>
    os<span class="token punctuation">.</span>environ<span class="token punctuation">.</span>setdefault<span class="token punctuation">(</span><span class="token string">&quot;DJANGO_SETTINGS_MODULE&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;tem.settings&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">import</span> django

    django<span class="token punctuation">.</span>setup<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">from</span> app01 <span class="token keyword">import</span> models
    <span class="token keyword">from</span> django<span class="token punctuation">.</span>db<span class="token punctuation">.</span>models <span class="token keyword">import</span> Q

    <span class="token comment"># -- 查询卖出数大于100以及价格小于600的书籍 </span>
    <span class="token comment">#    and关系! =&gt; ,</span>
    res <span class="token operator">=</span> models<span class="token punctuation">.</span>Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>maichu__gt<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">,</span> price__lt<span class="token operator">=</span><span class="token number">600</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>

    <span class="token comment"># -- 查询卖出数大于100或者价格小于600的书籍 </span>
    <span class="token comment">#    or关系! =&gt; Q |</span>
    res <span class="token operator">=</span> models<span class="token punctuation">.</span>Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>Q<span class="token punctuation">(</span>maichu__gt<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token operator">|</span> Q<span class="token punctuation">(</span>price__lt<span class="token operator">=</span><span class="token number">600</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>

    <span class="token comment"># -- 查询卖出数不大于100或者价格不小于600的书籍</span>
    <span class="token comment">#    not+or关系! =&gt; ~ Q |</span>
    res <span class="token operator">=</span> models<span class="token punctuation">.</span>Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span><span class="token operator">~</span>Q<span class="token punctuation">(</span>maichu__gt<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token operator">~</span>Q<span class="token punctuation">(</span>price__lt<span class="token operator">=</span><span class="token number">600</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><hr> <h2 id="补充"><a href="#补充" class="header-anchor">#</a> 补充</h2> <blockquote><p>正向, 无论表之间是什么关系, filter、value、value_list里使用双下划线、select_related里写入外键字段在底层都会实现联表!!</p></blockquote> <h3 id="一对多-正向"><a href="#一对多-正向" class="header-anchor">#</a> 一对多 正向</h3> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token triple-quoted-string string">&quot;&quot;&quot;
from django.db import models
class Publish(models.Model):
    title = models.CharField(verbose_name=&quot;出版社名&quot;, max_length=32)

class Book(models.Model):
    name = models.CharField(verbose_name=&quot;书名&quot;, max_length=32)
    price = models.DecimalField(max_digits=8, decimal_places=2)

    publish = models.ForeignKey(to=&quot;Publish&quot;, on_delete=models.CASCADE)
&quot;&quot;&quot;</span>


<span class="token keyword">from</span> django<span class="token punctuation">.</span>test <span class="token keyword">import</span> TestCase

<span class="token keyword">import</span> os

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">&quot;__main__&quot;</span><span class="token punctuation">:</span>
    os<span class="token punctuation">.</span>environ<span class="token punctuation">.</span>setdefault<span class="token punctuation">(</span><span class="token string">'DJANGO_SETTINGS_MODULE'</span><span class="token punctuation">,</span> <span class="token string">'day05.settings'</span><span class="token punctuation">)</span>
    <span class="token keyword">import</span> django

    django<span class="token punctuation">.</span>setup<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">from</span> apps<span class="token punctuation">.</span>app01 <span class="token keyword">import</span> models

    <span class="token comment"># -- 往Publish表加数据</span>
    models<span class="token punctuation">.</span>Publish<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>create<span class="token punctuation">(</span>title<span class="token operator">=</span><span class="token string">&quot;四川&quot;</span><span class="token punctuation">)</span>
    models<span class="token punctuation">.</span>Publish<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>create<span class="token punctuation">(</span>title<span class="token operator">=</span><span class="token string">&quot;重庆&quot;</span><span class="token punctuation">)</span>
    models<span class="token punctuation">.</span>Publish<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>create<span class="token punctuation">(</span>title<span class="token operator">=</span><span class="token string">&quot;上海&quot;</span><span class="token punctuation">)</span>
    models<span class="token punctuation">.</span>Publish<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>create<span class="token punctuation">(</span>title<span class="token operator">=</span><span class="token string">&quot;北京&quot;</span><span class="token punctuation">)</span>

    <span class="token comment"># -- 往Book表加数据</span>
    models<span class="token punctuation">.</span>Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>create<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">&quot;ABC1&quot;</span><span class="token punctuation">,</span> price<span class="token operator">=</span><span class="token string">&quot;25&quot;</span><span class="token punctuation">,</span> publish_id<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>  <span class="token comment"># 若publish_id的值不存在,因为外键约束,报错</span>
    obj <span class="token operator">=</span> models<span class="token punctuation">.</span>Publish<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>title<span class="token operator">=</span><span class="token string">&quot;重庆&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>
    models<span class="token punctuation">.</span>Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>create<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">&quot;ABC2&quot;</span><span class="token punctuation">,</span> price<span class="token operator">=</span><span class="token string">&quot;30&quot;</span><span class="token punctuation">,</span> publish<span class="token operator">=</span>obj<span class="token punctuation">)</span>   <span class="token comment"># 若obj为None,报错</span>
    models<span class="token punctuation">.</span>Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>create<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">&quot;ABC3&quot;</span><span class="token punctuation">,</span> price<span class="token operator">=</span><span class="token string">&quot;50&quot;</span><span class="token punctuation">,</span> publish_id<span class="token operator">=</span>obj<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">)</span>
    models<span class="token punctuation">.</span>Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>create<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">&quot;ABC4&quot;</span><span class="token punctuation">,</span> price<span class="token operator">=</span><span class="token string">&quot;60&quot;</span><span class="token punctuation">,</span> publish_id<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span>
    models<span class="token punctuation">.</span>Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>create<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">&quot;ABC5&quot;</span><span class="token punctuation">,</span> price<span class="token operator">=</span><span class="token string">&quot;20&quot;</span><span class="token punctuation">,</span> publish_id<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span>

    <span class="token comment"># -- 删除Book表的某条数据</span>
    models<span class="token punctuation">.</span>Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>pk<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span>delete<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># -- 删除Publish表的某条数据,特别注意:会级联删除</span>
    models<span class="token punctuation">.</span>Publish<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>pk<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>delete<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 会级联删除</span>
    <span class="token comment"># -- 删除id为2的出版社的所有书籍 (id为2的出版社是不删除的!)</span>
    models<span class="token punctuation">.</span>Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>publish_id<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span>delete<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># -- 删除上海出版社的所有书籍  该方式要写两个sql</span>
    obj <span class="token operator">=</span> models<span class="token punctuation">.</span>Publish<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>title<span class="token operator">=</span><span class="token string">&quot;上海&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># 下面这一行语句等同于 models.Book.objects.filter(publish_id=obj.id).delete()</span>
    models<span class="token punctuation">.</span>Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>publish<span class="token operator">=</span>obj<span class="token punctuation">)</span><span class="token punctuation">.</span>delete<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># -- 删除北京出版社的所有书籍  外键__外籍所关联表里的字段,查看sql使用inner join进行了连表</span>
    models<span class="token punctuation">.</span>Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>publish__title<span class="token operator">=</span><span class="token string">&quot;北京&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>delete<span class="token punctuation">(</span><span class="token punctuation">)</span>

    models<span class="token punctuation">.</span>Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>create<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">&quot;ABC6&quot;</span><span class="token punctuation">,</span> price<span class="token operator">=</span><span class="token string">&quot;20&quot;</span><span class="token punctuation">,</span> publish_id<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span>
    models<span class="token punctuation">.</span>Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>create<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">&quot;ABC7&quot;</span><span class="token punctuation">,</span> price<span class="token operator">=</span><span class="token string">&quot;20&quot;</span><span class="token punctuation">,</span> publish_id<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span>
    
    <span class="token comment"># -- 若查询的结果是一个对象,而该对象对应的表是有外键的.. 简单探究下</span>
    obj <span class="token operator">=</span> models<span class="token punctuation">.</span>Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>pk<span class="token operator">=</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span>  <span class="token comment"># Book object (6)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>publish<span class="token punctuation">)</span>        <span class="token comment"># Publish object (4)  意味着book对象.外键字段得到了book对象所关联的publish对象</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>publish<span class="token punctuation">.</span>title<span class="token punctuation">)</span>  <span class="token comment"># 北京  So,可以通过点语法查看所关联的publish对象里的内容,但注意此时又查询了一次数据库</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>publish_id<span class="token punctuation">)</span>     <span class="token comment"># 4  这就是外键神奇的地点,还可以.publish_id</span>
    <span class="token comment"># -- 查询的结果是queryset对象</span>
    <span class="token comment">#    借助values或values_list通过双下划线的跨表操作,能拿到当前记录以及当前记录的外键所关联的记录的所有字段的值</span>
    <span class="token comment">#    思考,1:n 外键在多的那方,尽管queryset对象里可有多条记录,但每条记录的外键所关联的记录只有一条!!</span>
    <span class="token comment">#    共四种情况!!</span>
    <span class="token comment">#    1&gt; 指定列,连表</span>
    res <span class="token operator">=</span> models<span class="token punctuation">.</span>Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>pk__gte<span class="token operator">=</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;publish&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>  <span class="token comment"># &lt;QuerySet [{'name': 'ABC6', 'publish': 4}, {'name': 'ABC7', 'publish': 4}]&gt;</span>
    res <span class="token operator">=</span> models<span class="token punctuation">.</span>Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>pk__gte<span class="token operator">=</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;publish_id&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>  <span class="token comment"># &lt;QuerySet [{'name': 'ABC6', 'publish_id': 4}, {'name': 'ABC7', 'publish_id': 4}]&gt;</span>
    res <span class="token operator">=</span> models<span class="token punctuation">.</span>Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>pk__gte<span class="token operator">=</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;publish__id&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>  <span class="token comment"># &lt;QuerySet [{'name': 'ABC6', 'publish__id': 4}, {'name': 'ABC7', 'publish__id': 4}]&gt;</span>
    res <span class="token operator">=</span> models<span class="token punctuation">.</span>Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>pk__gte<span class="token operator">=</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;publish__title&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>  <span class="token comment"># &lt;QuerySet[{'name':'ABC6','publish__title':'北京'},{'name':'ABC7','publish__title':'北京'}]&gt;</span>
    <span class="token comment">#    2&gt; 指定列,连表</span>
    res <span class="token operator">=</span> models<span class="token punctuation">.</span>Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>pk__gte<span class="token operator">=</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">.</span>values_list<span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;publish__title&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>  <span class="token comment"># &lt;QuerySet [('ABC6', '北京'), ('ABC7', '北京')]&gt;</span>
    <span class="token comment">#    3&gt; 所有列</span>
    <span class="token comment"># 很明显,先查询Book拿到Book表所有记录,然后循环,通过对象.外键.外键字段又进行了两次对Publish表的查询,共3次单表查询</span>
    <span class="token comment"># 而通过&quot;publish__title&quot;的连表查询,只查了一次!!!</span>
    res <span class="token operator">=</span> models<span class="token punctuation">.</span>Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>pk__gte<span class="token operator">=</span><span class="token number">6</span><span class="token punctuation">)</span>  <span class="token comment"># 只是一个单表查询的sql</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>  <span class="token comment"># &lt;QuerySet [&lt;Book: Book object (6)&gt;, &lt;Book: Book object (7)&gt;]&gt;</span>
    <span class="token keyword">for</span> obj <span class="token keyword">in</span> res<span class="token punctuation">:</span>
        <span class="token comment"># ABC6 北京</span>
        <span class="token comment"># ABC7 北京</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>name<span class="token punctuation">,</span> obj<span class="token punctuation">.</span>publish<span class="token punctuation">.</span>title<span class="token punctuation">)</span>  <span class="token comment"># 此时不推荐进行obj.publish.title操作</span>
    <span class="token comment">#    4&gt; 所有列,连表</span>
    <span class="token comment"># 若很想 通过对象.外键.外键字段 进行跨表查询. 使用select_related进行优化!!</span>
    res <span class="token operator">=</span> models<span class="token punctuation">.</span>Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>pk__gte<span class="token operator">=</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">.</span>select_related<span class="token punctuation">(</span><span class="token string">&quot;publish&quot;</span><span class="token punctuation">)</span>  <span class="token comment"># 是一个联表查询的sql,将两张表关联了起来</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>  <span class="token comment"># &lt;QuerySet [&lt;Book: Book object (6)&gt;, &lt;Book: Book object (7)&gt;]&gt;</span>
    <span class="token keyword">for</span> obj <span class="token keyword">in</span> res<span class="token punctuation">:</span>
        <span class="token comment"># 此处的obj.publish.title就不会进行数据库查询啦.</span>
        <span class="token comment"># 因为数据在select_related进行inner join时就封装到对象里了.</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>name<span class="token punctuation">,</span> obj<span class="token punctuation">.</span>publish<span class="token punctuation">.</span>title<span class="token punctuation">)</span>

    <span class="token comment"># -- 更新</span>
    models<span class="token punctuation">.</span>Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">.</span>update<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">&quot;CCC6&quot;</span><span class="token punctuation">)</span>
    <span class="token comment"># !!连表只能支持做查询功能,其它操作(添加、删除、修改)是不支持的. 添加、删除、修改只能改变当前表的数据!!!跨不了一点.</span>
    <span class="token comment"># 想通过Book表的外键字段修改Publish表,直接报错!!</span>
    <span class="token comment"># models.Book.objects.filter(id=6).update(publish__title=&quot;广州&quot;)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br></div></div><h3 id="一对多-反向"><a href="#一对多-反向" class="header-anchor">#</a> 一对多  反向</h3> <p><strong>情况一</strong></p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token triple-quoted-string string">&quot;&quot;&quot;
from django.db import models
class Publish(models.Model):
    title = models.CharField(verbose_name=&quot;出版社名&quot;, max_length=32)

class Book(models.Model):
    name = models.CharField(verbose_name=&quot;书名&quot;, max_length=32)
    price = models.DecimalField(max_digits=8, decimal_places=2)

    publish = models.ForeignKey(to=&quot;Publish&quot;, on_delete=models.CASCADE)
&quot;&quot;&quot;</span>

<span class="token keyword">from</span> django<span class="token punctuation">.</span>test <span class="token keyword">import</span> TestCase

<span class="token keyword">import</span> os

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">&quot;__main__&quot;</span><span class="token punctuation">:</span>
    os<span class="token punctuation">.</span>environ<span class="token punctuation">.</span>setdefault<span class="token punctuation">(</span><span class="token string">'DJANGO_SETTINGS_MODULE'</span><span class="token punctuation">,</span> <span class="token string">'day05.settings'</span><span class="token punctuation">)</span>
    <span class="token keyword">import</span> django

    django<span class="token punctuation">.</span>setup<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">from</span> apps<span class="token punctuation">.</span>app01 <span class="token keyword">import</span> models

    <span class="token comment"># -- 单表查询</span>
    res <span class="token operator">=</span> models<span class="token punctuation">.</span>Publish<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>title<span class="token operator">=</span><span class="token string">&quot;北京&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;title&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>  <span class="token comment"># &lt;QuerySet [{'id': 4, 'title': '北京'}]&gt;</span>
    
    <span class="token comment"># 需求:查询北京出版社的所有书籍,字段包括出版社id、出版社名字、书籍名字</span>
    <span class="token comment"># -- 反向</span>
    res <span class="token operator">=</span> models<span class="token punctuation">.</span>Publish<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>title<span class="token operator">=</span><span class="token string">&quot;北京&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;title&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;book&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>  <span class="token comment"># &lt;QuerySet [{'id': 4, 'title': '北京', 'book': 6}, {'id': 4, 'title': '北京', 'book': 7}]&gt;</span>
    res <span class="token operator">=</span> models<span class="token punctuation">.</span>Publish<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>title<span class="token operator">=</span><span class="token string">&quot;北京&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;title&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;book__name&quot;</span><span class="token punctuation">)</span>
    <span class="token comment"># &lt;QuerySet [</span>
    <span class="token comment">#        {'id': 4, 'title': '北京', 'book__name': 'ABC6'},</span>
    <span class="token comment">#        {'id': 4, 'title': '北京', 'book__name': 'ABC7'}</span>
    <span class="token comment"># ]&gt;</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>

    <span class="token comment"># -- 正向</span>
    res <span class="token operator">=</span> models<span class="token punctuation">.</span>Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>publish__title<span class="token operator">=</span><span class="token string">&quot;北京&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token string">&quot;publish__id&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;publish__title&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span>
    <span class="token comment"># &lt;QuerySet [</span>
    <span class="token comment">#        {'publish__id': 4, 'publish__title': '北京', 'name': 'ABC6'},</span>
    <span class="token comment">#        {'publish__id': 4, 'publish__title': '北京', 'name': 'ABC7'}</span>
    <span class="token comment"># ]&gt;</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br></div></div><p><strong>情况二</strong><br>
Book表中有两个外键都是与Publish表关联的.. 那就需要给外键设置related_name参数, 以便于在反向查询时用哪个外键!!!</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token triple-quoted-string string">&quot;&quot;&quot;
from django.db import models


class Publish(models.Model):
    title = models.CharField(verbose_name=&quot;出版社名&quot;, max_length=32)


class Book(models.Model):
    name = models.CharField(verbose_name=&quot;书名&quot;, max_length=32)
    price = models.DecimalField(max_digits=8, decimal_places=2)

    publish = models.ForeignKey(to=&quot;Publish&quot;, on_delete=models.CASCADE, related_name='b1')
    new_publish = models.ForeignKey(to=&quot;Publish&quot;, on_delete=models.CASCADE, default=5, related_name='b2')
&quot;&quot;&quot;</span>

<span class="token keyword">from</span> django<span class="token punctuation">.</span>test <span class="token keyword">import</span> TestCase

<span class="token keyword">import</span> os

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">&quot;__main__&quot;</span><span class="token punctuation">:</span>
    os<span class="token punctuation">.</span>environ<span class="token punctuation">.</span>setdefault<span class="token punctuation">(</span><span class="token string">'DJANGO_SETTINGS_MODULE'</span><span class="token punctuation">,</span> <span class="token string">'day05.settings'</span><span class="token punctuation">)</span>
    <span class="token keyword">import</span> django

    django<span class="token punctuation">.</span>setup<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">from</span> apps<span class="token punctuation">.</span>app01 <span class="token keyword">import</span> models

    <span class="token comment"># -- 单表查询</span>
    res <span class="token operator">=</span> models<span class="token punctuation">.</span>Publish<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>title<span class="token operator">=</span><span class="token string">&quot;北京&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;title&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>  <span class="token comment"># &lt;QuerySet [{'id': 4, 'title': '北京'}]&gt;</span>
    <span class="token comment"># -- 反向</span>
    res <span class="token operator">=</span> models<span class="token punctuation">.</span>Publish<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>title<span class="token operator">=</span><span class="token string">&quot;北京&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;title&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;b1&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>  <span class="token comment"># &lt;QuerySet [{'id': 4, 'title': '北京', 'b1': 6}, {'id': 4, 'title': '北京', 'b1': 7}]&gt;</span>
    res <span class="token operator">=</span> models<span class="token punctuation">.</span>Publish<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>title<span class="token operator">=</span><span class="token string">&quot;北京&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;title&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;b1__name&quot;</span><span class="token punctuation">)</span>
    <span class="token comment"># &lt;QuerySet [</span>
    <span class="token comment">#        {'id': 4, 'title': '北京', 'b1__name': 'ABC6'},</span>
    <span class="token comment">#        {'id': 4, 'title': '北京', 'b1__name': 'ABC7'}</span>
    <span class="token comment"># ]&gt;</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>

    <span class="token comment"># -- 正向</span>
    res <span class="token operator">=</span> models<span class="token punctuation">.</span>Book<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>publish__title<span class="token operator">=</span><span class="token string">&quot;北京&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token string">&quot;publish__id&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;publish__title&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span>
    <span class="token comment"># &lt;QuerySet [</span>
    <span class="token comment">#        {'publish__id': 4, 'publish__title': '北京', 'name': 'ABC6'},</span>
    <span class="token comment">#        {'publish__id': 4, 'publish__title': '北京', 'name': 'ABC7'}</span>
    <span class="token comment"># ]&gt;</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br></div></div><h3 id="多对多"><a href="#多对多" class="header-anchor">#</a> 多对多</h3> <blockquote><p>通常情况下, 我们会手动创建第三张表, 通过第三张表正向进行查询, 这样比较清晰些!!</p></blockquote> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token triple-quoted-string string">&quot;&quot;&quot;
from django.db import models
class Boy(models.Model):
    name = models.CharField(max_length=32)

class Girl(models.Model):
    name = models.CharField(max_length=32)

class B2G(models.Model):
    bid = models.ForeignKey(to=&quot;Boy&quot;, on_delete=models.CASCADE)
    gid = models.ForeignKey(to=&quot;Girl&quot;, on_delete=models.CASCADE)
    addr = models.CharField(max_length=200)
&quot;&quot;&quot;</span>
<span class="token keyword">from</span> django<span class="token punctuation">.</span>test <span class="token keyword">import</span> TestCase

<span class="token keyword">import</span> os

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">&quot;__main__&quot;</span><span class="token punctuation">:</span>
    os<span class="token punctuation">.</span>environ<span class="token punctuation">.</span>setdefault<span class="token punctuation">(</span><span class="token string">'DJANGO_SETTINGS_MODULE'</span><span class="token punctuation">,</span> <span class="token string">'day05.settings'</span><span class="token punctuation">)</span>
    <span class="token keyword">import</span> django

    django<span class="token punctuation">.</span>setup<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">from</span> apps<span class="token punctuation">.</span>app01 <span class="token keyword">import</span> models

    <span class="token comment"># # -- 添加Boy表数据</span>
    <span class="token comment"># models.Boy.objects.create(name='张三')</span>
    <span class="token comment"># models.Boy.objects.create(name='李四')</span>
    <span class="token comment"># models.Boy.objects.create(name='王五')</span>
    <span class="token comment">#</span>
    <span class="token comment"># # -- 添加Girl表数据</span>
    <span class="token comment"># models.Girl.objects.bulk_create(</span>
    <span class="token comment">#     objs=[models.Girl(name=&quot;小红&quot;), models.Girl(name=&quot;小紫&quot;), models.Girl(name=&quot;小粉&quot;)],</span>
    <span class="token comment">#     batch_size=2,  # 共需查询数据库的次数: len(objs) / batch_size</span>
    <span class="token comment"># )</span>
    <span class="token comment">#</span>
    <span class="token comment"># # -- 添加B2G表的数据</span>
    <span class="token comment"># models.B2G.objects.create(bid_id=1, gid_id=1, addr=&quot;北京&quot;)</span>
    <span class="token comment"># models.B2G.objects.create(bid_id=1, gid_id=2, addr=&quot;上海&quot;)</span>
    <span class="token comment"># models.B2G.objects.create(bid_id=2, gid_id=2, addr=&quot;广州&quot;)</span>
    <span class="token comment"># b_obj = models.Boy.objects.filter(name=&quot;李四&quot;).first()</span>
    <span class="token comment"># g_obj = models.Girl.objects.filter(name=&quot;小粉&quot;).first()</span>
    <span class="token comment"># models.B2G.objects.create(bid=b_obj, gid=g_obj, addr=&quot;深圳&quot;)</span>

    <span class="token comment"># -- 查询所有人的约会记录</span>
    qs <span class="token operator">=</span> models<span class="token punctuation">.</span>B2G<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>select_related<span class="token punctuation">(</span><span class="token string">'bid'</span><span class="token punctuation">,</span> <span class="token string">'gid'</span><span class="token punctuation">)</span>  <span class="token comment"># B2G &amp; Boy &amp; Girl</span>
    <span class="token comment"># &lt;QuerySet [&lt;B2G: B2G object (1)&gt;, &lt;B2G: B2G object (2)&gt;, &lt;B2G: B2G object (3)&gt;, &lt;B2G: B2G object (4)&gt;]&gt;</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>qs<span class="token punctuation">)</span>  
    <span class="token keyword">for</span> item <span class="token keyword">in</span> qs<span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;
        1 张三 小红 北京
        2 张三 小紫 上海
        3 李四 小紫 广州
        4 李四 小粉 深圳
        &quot;&quot;&quot;</span>
        <span class="token comment"># 注:因为使用了select_related 所以这里的item.bid.name不会做格外的跨表的查询操作.</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">,</span> item<span class="token punctuation">.</span>bid<span class="token punctuation">.</span>name<span class="token punctuation">,</span> item<span class="token punctuation">.</span>gid<span class="token punctuation">.</span>name<span class="token punctuation">,</span> item<span class="token punctuation">.</span>addr<span class="token punctuation">)</span>  
        
    <span class="token comment"># -- 查询李四的所有约会记录</span>
    qs <span class="token operator">=</span> models<span class="token punctuation">.</span>B2G<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>bid__name<span class="token operator">=</span><span class="token string">&quot;李四&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>select_related<span class="token punctuation">(</span><span class="token string">'gid'</span><span class="token punctuation">)</span>  <span class="token comment"># B2G &amp; Boy &amp; Girl</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>qs<span class="token punctuation">)</span>  <span class="token comment"># &lt;QuerySet [&lt;B2G: B2G object (3)&gt;, &lt;B2G: B2G object (4)&gt;]&gt;</span>
    <span class="token keyword">for</span> item <span class="token keyword">in</span> qs<span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;
        3 李四 小紫 广州
        4 李四 小粉 深圳
        &quot;&quot;&quot;</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">,</span> item<span class="token punctuation">.</span>bid<span class="token punctuation">.</span>name<span class="token punctuation">,</span> item<span class="token punctuation">.</span>gid<span class="token punctuation">.</span>name<span class="token punctuation">,</span> item<span class="token punctuation">.</span>addr<span class="token punctuation">)</span>
    
    <span class="token comment"># -- 查询李四的所有约会记录,需要指定字段</span>
    <span class="token comment">#    value_list同理.</span>
    qs <span class="token operator">=</span> models<span class="token punctuation">.</span>B2G<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>bid__name<span class="token operator">=</span><span class="token string">&quot;李四&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;bid__name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;gid__name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;addr&quot;</span><span class="token punctuation">)</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;
    &lt;QuerySet [
        {'id': 3, 'bid__name': '李四', 'gid__name': '小紫', 'addr': '广州'}, 
        {'id': 4, 'bid__name': '李四', 'gid__name': '小粉', 'addr': '深圳'}
    ]&gt;
    &quot;&quot;&quot;</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>qs<span class="token punctuation">)</span>

    <span class="token comment"># 若想通过Girl表来查李四的所有约会记录呢?? 反向正向都会涉及,不清晰</span>
    <span class="token comment"># b2g反向到了第三张表B2G,b2g__bid拿到了第三张表的bid字段,该字段是外键,b2g__bid__name正向查询到了Boy表的name字段..</span>
    qs <span class="token operator">=</span> models<span class="token punctuation">.</span>Girl<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>b2g__bid__name<span class="token operator">=</span><span class="token string">&quot;李四&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span> \
        values<span class="token punctuation">(</span><span class="token string">&quot;b2g__id&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;b2g__bid__name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;b2g__gid__name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;b2g__addr&quot;</span><span class="token punctuation">)</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;
    &lt;QuerySet [
        {'b2g__id': 3, 'b2g__bid__name': '李四', 'b2g__gid__name': '小紫', 'b2g__addr': '广州'},
        {'b2g__id': 4, 'b2g__bid__name': '李四', 'b2g__gid__name': '小粉', 'b2g__addr': '深圳'}
    ]&gt;
    &quot;&quot;&quot;</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>qs<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br></div></div><h3 id="一对一"><a href="#一对一" class="header-anchor">#</a> 一对一</h3> <blockquote><p>一对一的本质就是一对多+unique</p></blockquote> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token triple-quoted-string string">&quot;&quot;&quot;
from django.db import models
class User(models.Model):
    name = models.CharField(max_length=32)

class UserDetail(models.Model):
    user = models.OneToOneField(to=User, on_delete=models.CASCADE)
    phone = models.CharField(max_length=200)
&quot;&quot;&quot;</span>
<span class="token keyword">from</span> django<span class="token punctuation">.</span>test <span class="token keyword">import</span> TestCase

<span class="token keyword">import</span> os

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">&quot;__main__&quot;</span><span class="token punctuation">:</span>
    os<span class="token punctuation">.</span>environ<span class="token punctuation">.</span>setdefault<span class="token punctuation">(</span><span class="token string">'DJANGO_SETTINGS_MODULE'</span><span class="token punctuation">,</span> <span class="token string">'day05.settings'</span><span class="token punctuation">)</span>
    <span class="token keyword">import</span> django

    django<span class="token punctuation">.</span>setup<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">from</span> apps<span class="token punctuation">.</span>app01 <span class="token keyword">import</span> models

    models<span class="token punctuation">.</span>User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>create<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">&quot;张三&quot;</span><span class="token punctuation">)</span>
    models<span class="token punctuation">.</span>User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>create<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">&quot;李四&quot;</span><span class="token punctuation">)</span>

    models<span class="token punctuation">.</span>UserDetail<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>create<span class="token punctuation">(</span>phone<span class="token operator">=</span><span class="token string">&quot;123456&quot;</span><span class="token punctuation">,</span> user_id<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
    obj <span class="token operator">=</span> models<span class="token punctuation">.</span>User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">&quot;李四&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>
    models<span class="token punctuation">.</span>UserDetail<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>create<span class="token punctuation">(</span>phone<span class="token operator">=</span><span class="token string">&quot;123456&quot;</span><span class="token punctuation">,</span> user<span class="token operator">=</span>obj<span class="token punctuation">)</span>

    <span class="token comment"># -- 正向</span>
    obj <span class="token operator">=</span> models<span class="token punctuation">.</span>UserDetail<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span>select_related<span class="token punctuation">(</span><span class="token string">&quot;user&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>user<span class="token punctuation">.</span>name<span class="token punctuation">)</span>  <span class="token comment"># 李四</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span>  <span class="token comment"># UserDetail object (2)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>phone<span class="token punctuation">)</span>  <span class="token comment"># 123456</span>
    res <span class="token operator">=</span> models<span class="token punctuation">.</span>UserDetail<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token string">&quot;user__name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;phone&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>  <span class="token comment"># &lt;QuerySet [{'user__name': '李四', 'phone': '123456'}]&gt;</span>

    <span class="token comment"># -- 反向</span>
    <span class="token comment"># select_related主动联表,在反向查询时提高效率.</span>
    obj <span class="token operator">=</span> models<span class="token punctuation">.</span>User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">&quot;李四&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>select_related<span class="token punctuation">(</span><span class="token string">'userdetail'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># 对象.与对象所在表有一对一外键关联的表的表名小写 --&gt; 得到关联关系表的对象</span>
    <span class="token comment"># !!! 注:除了1:1,其它的1:n、n:n,`对象.`的反向关联操作 会报错!!!</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>name<span class="token punctuation">)</span>  <span class="token comment"># 李四</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>userdetail<span class="token punctuation">)</span>  <span class="token comment"># UserDetail object (2)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>userdetail<span class="token punctuation">.</span>phone<span class="token punctuation">)</span>  <span class="token comment"># 123456</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br></div></div></div></div> <!----> <div class="page-edit"><!----> <!----> <!----></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/c8216c/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">模版层</div></a> <a href="/pages/e54fbe/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">ORM字段</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/c8216c/" class="prev">模版层</a></span> <span class="next"><a href="/pages/e54fbe/">ORM字段</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/pages/8sk2b3/"><div>
            搜索相关
            <!----></div></a> <span class="date">03-22</span></dt></dl><dl><dd>02</dd> <dt><a href="/pages/2kn2p2/"><div>
            CURD
            <!----></div></a> <span class="date">03-20</span></dt></dl><dl><dd>03</dd> <dt><a href="/pages/1kn1m1/"><div>
            自动生成
            <!----></div></a> <span class="date">03-15</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="https://github.com/OnePieceDC" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://www.cnblogs.com/DC0307/" title="博客园" target="_blank" class="iconfont icon-bokeyuan"></a><a href="https://music.163.com/#/song?id=1854188649" title="听音乐" target="_blank" class="iconfont icon-erji"></a><a href="https://www.jianshu.com/u/5310eb537315" title="简书" target="_blank" class="iconfont icon-jianshu"></a><a href="mailto:1415806497@qq.com" title="QQ" target="_blank" class="iconfont icon-youjian"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2023-2024
    <span>DC | One Piece</span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <div class="body-bg" style="background:url() center center / cover no-repeat;opacity:0.5;"></div> <!----> <!----></div><div class="global-ui"><!----><div id="goTop" class="hide-cat" data-v-8ccb5928></div><div></div><canvas id="vuepress-canvas-cursor"></canvas><div></div><div></div></div></div>
    <script src="/assets/js/app.ac54adc6.js" defer></script><script src="/assets/js/4.7ddc74e3.js" defer></script><script src="/assets/js/1.a0c4ff1b.js" defer></script><script src="/assets/js/3.8b03321d.js" defer></script><script src="/assets/js/258.be75b1f9.js" defer></script><script src="/assets/js/104.cae2d944.js" defer></script><script src="/assets/js/184.46eabf07.js" defer></script>
  </body>
</html>
