<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>元类 | DC&#39;s blog</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="icon" href="/img/favicon.ico">
    <link rel="stylesheet" href="/fonts/iconfont.css">
    <meta name="description" content="人类终将毁灭,世界属于三体!">
    <meta name="keywords" content="DC的个人博客.">
    
    <link rel="preload" href="/assets/css/0.styles.66b92039.css" as="style"><link rel="preload" href="/assets/js/app.ac54adc6.js" as="script"><link rel="preload" href="/assets/js/4.7ddc74e3.js" as="script"><link rel="preload" href="/assets/js/1.a0c4ff1b.js" as="script"><link rel="preload" href="/assets/js/3.8b03321d.js" as="script"><link rel="preload" href="/assets/js/159.37d9c659.js" as="script"><link rel="preload" href="/assets/js/104.cae2d944.js" as="script"><link rel="preload" href="/assets/js/184.46eabf07.js" as="script"><link rel="prefetch" href="/assets/js/10.a91ae011.js"><link rel="prefetch" href="/assets/js/100.2e8ea472.js"><link rel="prefetch" href="/assets/js/101.46f57a02.js"><link rel="prefetch" href="/assets/js/102.f51bcd80.js"><link rel="prefetch" href="/assets/js/103.3f003e0e.js"><link rel="prefetch" href="/assets/js/105.6c6ebc28.js"><link rel="prefetch" href="/assets/js/106.47dc8889.js"><link rel="prefetch" href="/assets/js/107.6b5602b4.js"><link rel="prefetch" href="/assets/js/108.46f0c21d.js"><link rel="prefetch" href="/assets/js/109.0f1168a5.js"><link rel="prefetch" href="/assets/js/11.e6a94228.js"><link rel="prefetch" href="/assets/js/110.6a961498.js"><link rel="prefetch" href="/assets/js/111.c6f27c88.js"><link rel="prefetch" href="/assets/js/112.9ee3d3bb.js"><link rel="prefetch" href="/assets/js/113.82b72aa0.js"><link rel="prefetch" href="/assets/js/114.7487460e.js"><link rel="prefetch" href="/assets/js/115.cd079d0a.js"><link rel="prefetch" href="/assets/js/116.b6b829eb.js"><link rel="prefetch" href="/assets/js/117.89d9336c.js"><link rel="prefetch" href="/assets/js/118.467c4437.js"><link rel="prefetch" href="/assets/js/119.c4b2ac40.js"><link rel="prefetch" href="/assets/js/12.9d3501e4.js"><link rel="prefetch" href="/assets/js/120.5ff31c09.js"><link rel="prefetch" href="/assets/js/121.2e59c3a5.js"><link rel="prefetch" href="/assets/js/122.a66096cf.js"><link rel="prefetch" href="/assets/js/123.4885ba5f.js"><link rel="prefetch" href="/assets/js/124.cacc66be.js"><link rel="prefetch" href="/assets/js/125.dc5b30fe.js"><link rel="prefetch" href="/assets/js/126.4e21eb5e.js"><link rel="prefetch" href="/assets/js/127.cb36a9bf.js"><link rel="prefetch" href="/assets/js/128.ce38358e.js"><link rel="prefetch" href="/assets/js/129.e5f414eb.js"><link rel="prefetch" href="/assets/js/13.ca017a68.js"><link rel="prefetch" href="/assets/js/130.17b597f0.js"><link rel="prefetch" href="/assets/js/131.e1ded2dc.js"><link rel="prefetch" href="/assets/js/132.aae1c627.js"><link rel="prefetch" href="/assets/js/133.73cecdb3.js"><link rel="prefetch" href="/assets/js/134.80cf38a0.js"><link rel="prefetch" href="/assets/js/135.735ed588.js"><link rel="prefetch" href="/assets/js/136.91f8db08.js"><link rel="prefetch" href="/assets/js/137.d6fb8bda.js"><link rel="prefetch" href="/assets/js/138.75cafe73.js"><link rel="prefetch" href="/assets/js/139.b01bf0db.js"><link rel="prefetch" href="/assets/js/14.ee2605b5.js"><link rel="prefetch" href="/assets/js/140.ff0a7911.js"><link rel="prefetch" href="/assets/js/141.c69e7f54.js"><link rel="prefetch" href="/assets/js/142.997b03ac.js"><link rel="prefetch" href="/assets/js/143.e40faea8.js"><link rel="prefetch" href="/assets/js/144.369f23e5.js"><link rel="prefetch" href="/assets/js/145.1268424d.js"><link rel="prefetch" href="/assets/js/146.94c65c4a.js"><link rel="prefetch" href="/assets/js/147.05fe6a36.js"><link rel="prefetch" href="/assets/js/148.327cc29d.js"><link rel="prefetch" href="/assets/js/149.90068676.js"><link rel="prefetch" href="/assets/js/15.42e0a0e4.js"><link rel="prefetch" href="/assets/js/150.b4b780bb.js"><link rel="prefetch" href="/assets/js/151.b4611012.js"><link rel="prefetch" href="/assets/js/152.4d2c8246.js"><link rel="prefetch" href="/assets/js/153.f32dfa58.js"><link rel="prefetch" href="/assets/js/154.b79a78fb.js"><link rel="prefetch" href="/assets/js/155.6ad2865c.js"><link rel="prefetch" href="/assets/js/156.fd49a1af.js"><link rel="prefetch" href="/assets/js/157.55113800.js"><link rel="prefetch" href="/assets/js/158.af321bc9.js"><link rel="prefetch" href="/assets/js/16.007f45b3.js"><link rel="prefetch" href="/assets/js/160.7a3b5a9a.js"><link rel="prefetch" href="/assets/js/161.fc1fbea8.js"><link rel="prefetch" href="/assets/js/162.2f8d3d1c.js"><link rel="prefetch" href="/assets/js/163.aa889940.js"><link rel="prefetch" href="/assets/js/164.5d8b2cb7.js"><link rel="prefetch" href="/assets/js/165.44d4a9b5.js"><link rel="prefetch" href="/assets/js/166.c1b4c4d4.js"><link rel="prefetch" href="/assets/js/167.0c39929e.js"><link rel="prefetch" href="/assets/js/168.fede035a.js"><link rel="prefetch" href="/assets/js/169.ff940d50.js"><link rel="prefetch" href="/assets/js/17.7395c644.js"><link rel="prefetch" href="/assets/js/170.b6fcb3bf.js"><link rel="prefetch" href="/assets/js/171.2b927a7c.js"><link rel="prefetch" href="/assets/js/172.b07a90a1.js"><link rel="prefetch" href="/assets/js/173.367352bf.js"><link rel="prefetch" href="/assets/js/174.4ea4e20f.js"><link rel="prefetch" href="/assets/js/175.d9679b61.js"><link rel="prefetch" href="/assets/js/176.f7804143.js"><link rel="prefetch" href="/assets/js/177.c5d1e680.js"><link rel="prefetch" href="/assets/js/178.808293fa.js"><link rel="prefetch" href="/assets/js/179.2acf6b3c.js"><link rel="prefetch" href="/assets/js/18.46f9153d.js"><link rel="prefetch" href="/assets/js/180.ddf3ecf7.js"><link rel="prefetch" href="/assets/js/181.4da0855c.js"><link rel="prefetch" href="/assets/js/182.591d135a.js"><link rel="prefetch" href="/assets/js/183.9d08f9fe.js"><link rel="prefetch" href="/assets/js/185.ee1c8428.js"><link rel="prefetch" href="/assets/js/186.c7b19133.js"><link rel="prefetch" href="/assets/js/187.52945990.js"><link rel="prefetch" href="/assets/js/188.a1d395c5.js"><link rel="prefetch" href="/assets/js/189.5b66165e.js"><link rel="prefetch" href="/assets/js/19.2db19edb.js"><link rel="prefetch" href="/assets/js/190.265a75de.js"><link rel="prefetch" href="/assets/js/191.b4c65143.js"><link rel="prefetch" href="/assets/js/192.cc4d4115.js"><link rel="prefetch" href="/assets/js/193.fa02ecc5.js"><link rel="prefetch" href="/assets/js/194.b0c9ad53.js"><link rel="prefetch" href="/assets/js/195.eda8cd34.js"><link rel="prefetch" href="/assets/js/196.cbae4dc6.js"><link rel="prefetch" href="/assets/js/197.693b1b85.js"><link rel="prefetch" href="/assets/js/198.8213665b.js"><link rel="prefetch" href="/assets/js/199.ddf0036d.js"><link rel="prefetch" href="/assets/js/2.4c15b693.js"><link rel="prefetch" href="/assets/js/20.6742e8ae.js"><link rel="prefetch" href="/assets/js/200.340df508.js"><link rel="prefetch" href="/assets/js/201.7431c15b.js"><link rel="prefetch" href="/assets/js/202.217b2b38.js"><link rel="prefetch" href="/assets/js/203.06c6a93d.js"><link rel="prefetch" href="/assets/js/204.a068a898.js"><link rel="prefetch" href="/assets/js/205.9361d3f5.js"><link rel="prefetch" href="/assets/js/206.886beca0.js"><link rel="prefetch" href="/assets/js/207.2278bda8.js"><link rel="prefetch" href="/assets/js/208.db0acc0d.js"><link rel="prefetch" href="/assets/js/209.0e05b204.js"><link rel="prefetch" href="/assets/js/21.fd552a4e.js"><link rel="prefetch" href="/assets/js/210.4c730041.js"><link rel="prefetch" href="/assets/js/211.417dbee1.js"><link rel="prefetch" href="/assets/js/212.eef4f4a3.js"><link rel="prefetch" href="/assets/js/213.ab742b0b.js"><link rel="prefetch" href="/assets/js/214.a57228de.js"><link rel="prefetch" href="/assets/js/215.37f52459.js"><link rel="prefetch" href="/assets/js/216.2f110f92.js"><link rel="prefetch" href="/assets/js/217.09654311.js"><link rel="prefetch" href="/assets/js/218.a7568950.js"><link rel="prefetch" href="/assets/js/219.628ee193.js"><link rel="prefetch" href="/assets/js/22.465a76d2.js"><link rel="prefetch" href="/assets/js/220.c5df9186.js"><link rel="prefetch" href="/assets/js/221.101ddb09.js"><link rel="prefetch" href="/assets/js/222.db210e3c.js"><link rel="prefetch" href="/assets/js/223.429cbf14.js"><link rel="prefetch" href="/assets/js/224.aa002868.js"><link rel="prefetch" href="/assets/js/225.79a40017.js"><link rel="prefetch" href="/assets/js/226.3e08228b.js"><link rel="prefetch" href="/assets/js/227.a09dd4b4.js"><link rel="prefetch" href="/assets/js/228.f930c492.js"><link rel="prefetch" href="/assets/js/229.f639a9e4.js"><link rel="prefetch" href="/assets/js/23.df6831af.js"><link rel="prefetch" href="/assets/js/230.e8ac7aad.js"><link rel="prefetch" href="/assets/js/231.99501214.js"><link rel="prefetch" href="/assets/js/232.e2932792.js"><link rel="prefetch" href="/assets/js/233.43dfa689.js"><link rel="prefetch" href="/assets/js/234.7951f9c4.js"><link rel="prefetch" href="/assets/js/235.1dc96b6c.js"><link rel="prefetch" href="/assets/js/236.40b8d4e4.js"><link rel="prefetch" href="/assets/js/237.75a692de.js"><link rel="prefetch" href="/assets/js/238.cc9d9ac1.js"><link rel="prefetch" href="/assets/js/239.4616a566.js"><link rel="prefetch" href="/assets/js/24.b68dc734.js"><link rel="prefetch" href="/assets/js/240.dd825147.js"><link rel="prefetch" href="/assets/js/241.85e3219b.js"><link rel="prefetch" href="/assets/js/242.bf4123c4.js"><link rel="prefetch" href="/assets/js/243.ce68f4f0.js"><link rel="prefetch" href="/assets/js/244.e2598d4d.js"><link rel="prefetch" href="/assets/js/245.2c696827.js"><link rel="prefetch" href="/assets/js/246.2c44a497.js"><link rel="prefetch" href="/assets/js/247.02405fce.js"><link rel="prefetch" href="/assets/js/248.6727bdf6.js"><link rel="prefetch" href="/assets/js/249.4901f575.js"><link rel="prefetch" href="/assets/js/25.d639c65c.js"><link rel="prefetch" href="/assets/js/250.c922c9ea.js"><link rel="prefetch" href="/assets/js/251.b1350ead.js"><link rel="prefetch" href="/assets/js/252.8295c5ea.js"><link rel="prefetch" href="/assets/js/253.b0a9ba20.js"><link rel="prefetch" href="/assets/js/254.d208b848.js"><link rel="prefetch" href="/assets/js/255.2cfb6ad3.js"><link rel="prefetch" href="/assets/js/256.e7687a81.js"><link rel="prefetch" href="/assets/js/257.db329d54.js"><link rel="prefetch" href="/assets/js/258.be75b1f9.js"><link rel="prefetch" href="/assets/js/259.67500f7e.js"><link rel="prefetch" href="/assets/js/26.9db429a9.js"><link rel="prefetch" href="/assets/js/260.73609cfa.js"><link rel="prefetch" href="/assets/js/261.22fc7c08.js"><link rel="prefetch" href="/assets/js/262.2c620ccd.js"><link rel="prefetch" href="/assets/js/263.e0ce1454.js"><link rel="prefetch" href="/assets/js/264.7fe82318.js"><link rel="prefetch" href="/assets/js/265.537d06c5.js"><link rel="prefetch" href="/assets/js/266.901695a7.js"><link rel="prefetch" href="/assets/js/267.8eb24590.js"><link rel="prefetch" href="/assets/js/268.a21e44dc.js"><link rel="prefetch" href="/assets/js/269.33e6ce5d.js"><link rel="prefetch" href="/assets/js/27.2296e284.js"><link rel="prefetch" href="/assets/js/270.31507ac3.js"><link rel="prefetch" href="/assets/js/271.b9406b42.js"><link rel="prefetch" href="/assets/js/272.0acaba6f.js"><link rel="prefetch" href="/assets/js/273.c2e359b0.js"><link rel="prefetch" href="/assets/js/274.a80428a6.js"><link rel="prefetch" href="/assets/js/28.7e4f4dc1.js"><link rel="prefetch" href="/assets/js/29.ba75f79a.js"><link rel="prefetch" href="/assets/js/30.16cd3622.js"><link rel="prefetch" href="/assets/js/31.54ed5bc1.js"><link rel="prefetch" href="/assets/js/32.b2fbba6a.js"><link rel="prefetch" href="/assets/js/33.f7ff0107.js"><link rel="prefetch" href="/assets/js/34.4b2cea7d.js"><link rel="prefetch" href="/assets/js/35.1159e74c.js"><link rel="prefetch" href="/assets/js/36.0b6296f3.js"><link rel="prefetch" href="/assets/js/37.fc67879e.js"><link rel="prefetch" href="/assets/js/38.637afaf8.js"><link rel="prefetch" href="/assets/js/39.748a78f3.js"><link rel="prefetch" href="/assets/js/40.4fede9bb.js"><link rel="prefetch" href="/assets/js/41.c7f0b087.js"><link rel="prefetch" href="/assets/js/42.5b1a487d.js"><link rel="prefetch" href="/assets/js/43.59275b93.js"><link rel="prefetch" href="/assets/js/44.b18a4c94.js"><link rel="prefetch" href="/assets/js/45.bc8f7cb3.js"><link rel="prefetch" href="/assets/js/46.6a4ec89f.js"><link rel="prefetch" href="/assets/js/47.e1e129e6.js"><link rel="prefetch" href="/assets/js/48.c284ce23.js"><link rel="prefetch" href="/assets/js/49.17e5dd65.js"><link rel="prefetch" href="/assets/js/5.e3d12916.js"><link rel="prefetch" href="/assets/js/50.34c3ac45.js"><link rel="prefetch" href="/assets/js/51.035f7031.js"><link rel="prefetch" href="/assets/js/52.e9ef227a.js"><link rel="prefetch" href="/assets/js/53.ecbb032d.js"><link rel="prefetch" href="/assets/js/54.e9af4cfe.js"><link rel="prefetch" href="/assets/js/55.7e71402b.js"><link rel="prefetch" href="/assets/js/56.511071fe.js"><link rel="prefetch" href="/assets/js/57.13b7fe79.js"><link rel="prefetch" href="/assets/js/58.e51f8b0e.js"><link rel="prefetch" href="/assets/js/59.a1b8bdb7.js"><link rel="prefetch" href="/assets/js/6.5fc3f358.js"><link rel="prefetch" href="/assets/js/60.fd7e1c08.js"><link rel="prefetch" href="/assets/js/61.0daf2361.js"><link rel="prefetch" href="/assets/js/62.04632944.js"><link rel="prefetch" href="/assets/js/63.f0dd5615.js"><link rel="prefetch" href="/assets/js/64.89a4b562.js"><link rel="prefetch" href="/assets/js/65.6764ff0c.js"><link rel="prefetch" href="/assets/js/66.049bdee1.js"><link rel="prefetch" href="/assets/js/67.b0d4ec16.js"><link rel="prefetch" href="/assets/js/68.46d97067.js"><link rel="prefetch" href="/assets/js/69.f540f0da.js"><link rel="prefetch" href="/assets/js/7.ce17dd73.js"><link rel="prefetch" href="/assets/js/70.17d8f857.js"><link rel="prefetch" href="/assets/js/71.b2a166a0.js"><link rel="prefetch" href="/assets/js/72.1c17a875.js"><link rel="prefetch" href="/assets/js/73.dac8984b.js"><link rel="prefetch" href="/assets/js/74.5bbc33ac.js"><link rel="prefetch" href="/assets/js/75.483644c7.js"><link rel="prefetch" href="/assets/js/76.de5461ab.js"><link rel="prefetch" href="/assets/js/77.7fa90702.js"><link rel="prefetch" href="/assets/js/78.f41853b8.js"><link rel="prefetch" href="/assets/js/79.598b50e6.js"><link rel="prefetch" href="/assets/js/80.61d2d23a.js"><link rel="prefetch" href="/assets/js/81.d310c6e4.js"><link rel="prefetch" href="/assets/js/82.22aa814c.js"><link rel="prefetch" href="/assets/js/83.f493eba4.js"><link rel="prefetch" href="/assets/js/84.3a32a1eb.js"><link rel="prefetch" href="/assets/js/85.2f47134e.js"><link rel="prefetch" href="/assets/js/86.74e65a77.js"><link rel="prefetch" href="/assets/js/87.e87bff96.js"><link rel="prefetch" href="/assets/js/88.aabc97af.js"><link rel="prefetch" href="/assets/js/89.b0945d87.js"><link rel="prefetch" href="/assets/js/90.630f62d3.js"><link rel="prefetch" href="/assets/js/91.ed816647.js"><link rel="prefetch" href="/assets/js/92.19065457.js"><link rel="prefetch" href="/assets/js/93.a0fe1919.js"><link rel="prefetch" href="/assets/js/94.51e48580.js"><link rel="prefetch" href="/assets/js/95.e591bede.js"><link rel="prefetch" href="/assets/js/96.1723f1d6.js"><link rel="prefetch" href="/assets/js/97.02bbb7d4.js"><link rel="prefetch" href="/assets/js/98.a3625ba6.js"><link rel="prefetch" href="/assets/js/99.1accbf48.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.5959bfd2.js">
    <link rel="stylesheet" href="/assets/css/0.styles.66b92039.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu have-body-img"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/nav-logo.png" alt="DC's blog" class="logo"> <span class="site-name can-hide">DC's blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="IT必备" class="dropdown-title"><a href="/IT/" class="link-title">IT必备</a> <span class="title" style="display:none;">IT必备</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/IT/basis/" class="nav-link">计算机基础</a></li><li class="dropdown-item"><!----> <a href="/IT/linux/" class="nav-link">linux基础</a></li><li class="dropdown-item"><!----> <a href="/IT/mysql/" class="nav-link">mysql</a></li><li class="dropdown-item"><!----> <a href="/IT/git/" class="nav-link">git</a></li><li class="dropdown-item"><!----> <a href="/IT/structure/" class="nav-link">数据结构与算法</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Python" class="dropdown-title"><a href="/python/" class="link-title">Python</a> <span class="title" style="display:none;">Python</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/python/basis/" class="nav-link">opp</a></li><li class="dropdown-item"><!----> <a href="/python/oop/" class="nav-link">oop</a></li><li class="dropdown-item"><!----> <a href="/python/Network_concurrency/" class="nav-link">网络并发编程</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><a href="/front_end/" class="link-title">前端</a> <span class="title" style="display:none;">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/front_end/html/" class="nav-link">html</a></li><li class="dropdown-item"><!----> <a href="/front_end/css/" class="nav-link">css</a></li><li class="dropdown-item"><!----> <a href="/front_end/js/" class="nav-link">javascript</a></li><li class="dropdown-item"><!----> <a href="/front_end/jquery/" class="nav-link">jquery</a></li><li class="dropdown-item"><!----> <a href="/front_end/ui/" class="nav-link">UI</a></li><li class="dropdown-item"><!----> <a href="/front_end/vue/" class="nav-link">vue</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="后端" class="dropdown-title"><a href="/python_web/" class="link-title">后端</a> <span class="title" style="display:none;">后端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/python_web/django/" class="nav-link">Django</a></li><li class="dropdown-item"><!----> <a href="/python_web/drf/" class="nav-link">drf</a></li><li class="dropdown-item"><!----> <a href="/python_web/drf_re/" class="nav-link">drf_re</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="实战" class="dropdown-title"><a href="/project/" class="link-title">实战</a> <span class="title" style="display:none;">实战</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>前后端不分离</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/project/bbs/" class="nav-link">BBS</a></li><li class="dropdown-subitem"><a href="/project/order/" class="nav-link">订单系统</a></li><li class="dropdown-subitem"><a href="/project/crm/" class="nav-link">CRM</a></li></ul></li><li class="dropdown-item"><h4>前后端分离</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/project/supply/" class="nav-link">供应链系统</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其他" class="dropdown-title"><a href="/other/" class="link-title">其他</a> <span class="title" style="display:none;">其他</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/other/essays/" class="nav-link">杂文</a></li><li class="dropdown-item"><h4>关于我</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/about/" class="nav-link">me</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><!----> <span class="title" style="display:;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/OnePieceDC/" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="/img/avatar.gif"> <div class="blogger-info"><h3>DC</h3> <span>愿我一生欢喜,不为世俗所及.</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="IT必备" class="dropdown-title"><a href="/IT/" class="link-title">IT必备</a> <span class="title" style="display:none;">IT必备</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/IT/basis/" class="nav-link">计算机基础</a></li><li class="dropdown-item"><!----> <a href="/IT/linux/" class="nav-link">linux基础</a></li><li class="dropdown-item"><!----> <a href="/IT/mysql/" class="nav-link">mysql</a></li><li class="dropdown-item"><!----> <a href="/IT/git/" class="nav-link">git</a></li><li class="dropdown-item"><!----> <a href="/IT/structure/" class="nav-link">数据结构与算法</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Python" class="dropdown-title"><a href="/python/" class="link-title">Python</a> <span class="title" style="display:none;">Python</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/python/basis/" class="nav-link">opp</a></li><li class="dropdown-item"><!----> <a href="/python/oop/" class="nav-link">oop</a></li><li class="dropdown-item"><!----> <a href="/python/Network_concurrency/" class="nav-link">网络并发编程</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><a href="/front_end/" class="link-title">前端</a> <span class="title" style="display:none;">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/front_end/html/" class="nav-link">html</a></li><li class="dropdown-item"><!----> <a href="/front_end/css/" class="nav-link">css</a></li><li class="dropdown-item"><!----> <a href="/front_end/js/" class="nav-link">javascript</a></li><li class="dropdown-item"><!----> <a href="/front_end/jquery/" class="nav-link">jquery</a></li><li class="dropdown-item"><!----> <a href="/front_end/ui/" class="nav-link">UI</a></li><li class="dropdown-item"><!----> <a href="/front_end/vue/" class="nav-link">vue</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="后端" class="dropdown-title"><a href="/python_web/" class="link-title">后端</a> <span class="title" style="display:none;">后端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/python_web/django/" class="nav-link">Django</a></li><li class="dropdown-item"><!----> <a href="/python_web/drf/" class="nav-link">drf</a></li><li class="dropdown-item"><!----> <a href="/python_web/drf_re/" class="nav-link">drf_re</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="实战" class="dropdown-title"><a href="/project/" class="link-title">实战</a> <span class="title" style="display:none;">实战</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>前后端不分离</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/project/bbs/" class="nav-link">BBS</a></li><li class="dropdown-subitem"><a href="/project/order/" class="nav-link">订单系统</a></li><li class="dropdown-subitem"><a href="/project/crm/" class="nav-link">CRM</a></li></ul></li><li class="dropdown-item"><h4>前后端分离</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/project/supply/" class="nav-link">供应链系统</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其他" class="dropdown-title"><a href="/other/" class="link-title">其他</a> <span class="title" style="display:none;">其他</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/other/essays/" class="nav-link">杂文</a></li><li class="dropdown-item"><h4>关于我</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/about/" class="nav-link">me</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><!----> <span class="title" style="display:;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/OnePieceDC/" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>python面向过程</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>python面向对象</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/3794a8/" class="sidebar-link">OOP基本</a></li><li><a href="/pages/11e8a5/" class="sidebar-link">继承和组合</a></li><li><a href="/pages/deb9fb/" class="sidebar-link">多态与多态性</a></li><li><a href="/pages/5aee16/" class="sidebar-link">封装与接口</a></li><li><a href="/pages/6856b1/" class="sidebar-link">绑定与非绑定方法</a></li><li><a href="/pages/6c8de0/" class="sidebar-link">简单总结</a></li><li><a href="/pages/247946/" class="sidebar-link">反射、内置方法</a></li><li><a href="/pages/22257b/" aria-current="page" class="active sidebar-link">元类</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/pages/22257b/#元类介绍" class="sidebar-link">元类介绍</a></li><li class="sidebar-sub-header level2"><a href="/pages/22257b/#创建类的两种方式" class="sidebar-link">创建类的两种方式</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/22257b/#用默认元类type" class="sidebar-link">用默认元类type</a></li><li class="sidebar-sub-header level5"><a href="/pages/22257b/#内置函数exec" class="sidebar-link">内置函数exec</a></li><li class="sidebar-sub-header level5"><a href="/pages/22257b/#创建类的三要素" class="sidebar-link">创建类的三要素</a></li><li class="sidebar-sub-header level3"><a href="/pages/22257b/#自定义的元类" class="sidebar-link">自定义的元类</a></li><li class="sidebar-sub-header level5"><a href="/pages/22257b/#class创建类的流程" class="sidebar-link">class创建类的流程</a></li><li class="sidebar-sub-header level5"><a href="/pages/22257b/#添加一些判断" class="sidebar-link">添加一些判断</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/22257b/#自定义类的实例化" class="sidebar-link">自定义类的实例化</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/22257b/#call" class="sidebar-link">__call__</a></li><li class="sidebar-sub-header level5"><a href="/pages/22257b/#原理" class="sidebar-link">原理</a></li><li class="sidebar-sub-header level5"><a href="/pages/22257b/#元类中的-call" class="sidebar-link">元类中的__call__</a></li><li class="sidebar-sub-header level5"><a href="/pages/22257b/#调用元类产生的类" class="sidebar-link">调用元类产生的类</a></li><li class="sidebar-sub-header level3"><a href="/pages/22257b/#属性查找" class="sidebar-link">属性查找</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/22257b/#实践" class="sidebar-link">实践</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/22257b/#模版分析" class="sidebar-link"></a></li><li class="sidebar-sub-header level3"><a href="/pages/22257b/#小试身手" class="sidebar-link">小试身手</a></li><li class="sidebar-sub-header level3"><a href="/pages/22257b/#单例模式" class="sidebar-link">单例模式</a></li><li class="sidebar-sub-header level5"><a href="/pages/22257b/#方式一-类方法" class="sidebar-link">方式一:类方法</a></li><li class="sidebar-sub-header level5"><a href="/pages/22257b/#方式二-装饰器" class="sidebar-link">方式二:装饰器</a></li><li class="sidebar-sub-header level5"><a href="/pages/22257b/#方式三-元类" class="sidebar-link">方式三:元类</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/22257b/#补充" class="sidebar-link">补充</a></li></ul></li><li><a href="/pages/cf4ca9/" class="sidebar-link">异常处理</a></li><li><a href="/pages/bd16de/" class="sidebar-link">小项目之course_select</a></li><li><a href="/pages/06b8f4/" class="sidebar-link">复习</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>网络并发编程</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-91157402><div class="articleInfo" data-v-91157402><ul class="breadcrumbs" data-v-91157402><li data-v-91157402><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-91157402></a></li> <li data-v-91157402><a href="/categories/?category=python_Need" title="分类" data-v-91157402>python_Need</a></li><li data-v-91157402><a href="/categories/?category=python%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1" title="分类" data-v-91157402>python面向对象</a></li></ul> <div class="info" data-v-91157402><div title="作者" class="author iconfont icon-touxiang" data-v-91157402><a href="https://github.com/OnePieceDC" target="_blank" title="作者" class="beLink" data-v-91157402>DC</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-91157402><a href="javascript:;" data-v-91157402>2023-08-16</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABH1JREFUSA3tVl1oHFUUPmdmd2ltklqbpJDiNnXFmgbFktho7YMPNiJSSZM0+CAYSkUELVhM6YuwIPpgoOKDqOBDC0XE2CQoNtQXBUFTTcCi+Wlh1V2TQExsUzcltd3M9Tt3ZjZzZ2fT+OJTL8yeM+eee757fmeJbq//KQL8X3DUSFOcfr7cRsRtxNQMWueeVzOkaITIGqQHNg5y8+jNW9ldM7A6nTpAjuolUikAwq7CE3WcM2RRDz+XGVgN3FptU/aUSlvq9Pa3iZ1+sgAqJyyAFqkipd9dqiwHF3P65YycLWc/6sqGrvoEoIp6DOFaX5h6+dnfjkWprwqsPk0dUGq5vySwDImC10KxFHgGL1SWoc92O3eVht09qdXNH11I2SsTsJYqMWzihqGMi+A+Garf3BAuuLI5oGlULyNfyB/HYNujwktOfRrMr5t77NmevqaUopx0grnKAyvVpmwUDB4x6FPXuGvYLTDwWsejwgtgkYKPqRJg8SV6xaiZ3ZTppGneS4yfH5/66fZSDHv+QZci/+h5c5UHtpy67JUqGppM0sh0Nc1dW6/N1W5Yoqat8/TU/VnadmdeW2PLLSyh0cvxBs3KbqTmwYPpxN4do/mzE8nEpvX/UMu2Wbp74zUAK5q6WkHns7V0eWkdPbPzd3rxkTGybadYySumVzhcaJFbs5UrEkQ/+CK8gF5dnh/6ciIZ73gwQ927L1IitoxKLXYP3SjYdOrHHfTZhRRlFyrorafPk20B3HPD1y2G3qKZME5Jcf3t/HUC13/8tSd++vqFveMUTwAUxSUFI1QekR1+bIze3D9MF2aq6cPvG72CgnldWCFqyRw3lwH8ZMerjTD9ElRO7Gv44wNpC90aASqGfVlz/Rx17srQ57/UU26hkhQqUB7dBR71WmzQhHUnblGmVOEw0jhbV1n9OlXUDCIRGaNV5Jp43N516fN7JmnTHdfp7Hgy0luO4aMhtkLL8Bi3bUWYvzh5Mn1dTxrL6QmGuRhGL/TiTTxRoEdTszSaq9GR0NGA3KdkOz3hqSV3MIDhQ5IVX/Ivx3umBti2es2h4eZby7x8br1rkf7Mo90AqC8aQ3sJeNzqFRu+vSANAQe3PL7l0HGOAdwDCeZYvNKeoZp1Qfs6Aipndh86HmFRi0LAnEO47wsqM6cdfjh3jBPUzhZy7nvlUfFsamED1VQt6aISHVymXZ/B2aCtIG8AI8xfobj2d3en1wWVhOeHELKmLQ1s211s88comkv4UCwWyF787mJdYXtNfhKAXVqnKTq8QZvGAGGOfaTo5pGZ/PwbUCr5+DPr/1J92JNHr9aOl/F3iI5+O1nfybsGxoimvZ3ViWSluDITw3P37mypheDIPY0tw7+O/5ApbkYw+zpfaUVu32Pi98+defdUhEpZkRFq0aqyNh9FuL9hpYbEm6iwi0z2REd09ZmyENEbuhjDWzKvZXTqKYaBIr3tt5kuPtQBZFvEUwHt60vfCNu41XsksH9Ij1BMMz1Y0OOunHNShFIP5868g5zeXmuLwL9T4b6Q2+KejgAAAABJRU5ErkJggg==">元类<!----></h1> <!----> <div class="theme-vdoing-content content__default"><h2 id="元类介绍"><a href="#元类介绍" class="header-anchor">#</a> 元类介绍</h2> <blockquote><p>在python中一切皆对象,则我们用class关键字定义的类本身也是一个对象.<br>
负责产生该对象的类称之为元类, 即 <font color="brown">元类是我们自定义类的类</font>.<br> <font color="blue">换个说法, 我们用class定义的类本质就是在实例化元类.</font></p></blockquote> <p>元类是负责产生类的,我们学习元类/自定义元类的 <font color="red"><strong>目的</strong></font> 在于:<br>
1&gt; <font color="green">控制class定义类的过程;</font>    2&gt; <font color="lighblue">控制 调用类(该类是class定义的)产生实例化对象的过程. </font><br>
元类里的 <code>__init__</code> 控制元类产生的实例化对象 (即类) 初始化的过程 ;
元类里的 <code>__call__</code> 控制实例化对象&quot;实例化/调用&quot;产生实例的过程.</p> <hr> <h2 id="创建类的两种方式"><a href="#创建类的两种方式" class="header-anchor">#</a> 创建类的两种方式</h2> <blockquote><p><strong>大前提:</strong> <font color="brown">Python一切皆对象,那么类也是一个对象.则用class关键字去创建类的过程也是一个实例化的过程;</font><br> <font color="brown">该实例化的过程是为了得到一个类,调用的是元类..</font></p></blockquote> <p>1&gt; 默认的元类type;     2&gt; 自定义的元类.</p> <h3 id="用默认元类type"><a href="#用默认元类type" class="header-anchor">#</a> 用默认元类type</h3> <blockquote><p>即用关键字class 进行创建.</p></blockquote> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment"># -- 方式一: 用的默认的元类type</span>
<span class="token keyword">class</span> <span class="token class-name">People</span><span class="token punctuation">:</span>  <span class="token comment"># -- People = type('People',..,..)</span>
    country <span class="token operator">=</span> <span class="token string">&quot;China&quot;</span>

    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">,</span> age<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>name <span class="token operator">=</span> name
        self<span class="token punctuation">.</span>age <span class="token operator">=</span> age

    <span class="token keyword">def</span> <span class="token function">eat</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;%s is eating.&quot;</span> <span class="token operator">%</span> self<span class="token punctuation">.</span>name<span class="token punctuation">)</span>


obj <span class="token operator">=</span> People<span class="token punctuation">(</span><span class="token string">'dc'</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">)</span>     <span class="token comment"># &lt;class '__main__.People'&gt; -- obj对象是通过People类实例化得到的!!</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span>People<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># &lt;class 'type'&gt; -- 所有用class关键字创建的类都默认是type类实例化得到的!!</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span>           <span class="token comment"># &lt;__main__.People object at 0x7f91cde7eac0&gt;</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>People<span class="token punctuation">)</span>        <span class="token comment"># &lt;class '__main__.People'&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h5 id="内置函数exec"><a href="#内置函数exec" class="header-anchor">#</a> 内置函数exec</h5> <p><code>exec(object[, globals[, locals]])</code> :<br>
     参数一: <font color="blue">包含一系列python代码的 <strong>字符串</strong></font><br>
     参数二: 全局作用域(字典形式), 如果不指定, 默认为globals()<br>
     参数三: 局部作用域(字典形式), 如果不指定, 默认为locals()</p> <p><font color="blue">可以把exec命令的执行当成是一个函数的执行,会将执行期间产生的名字存放于局部名称空间中.</font></p> <div class="language-python line-numbers-mode"><pre class="language-python"><code>g_dic <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'x'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'y'</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">}</span>
l_dic <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'m'</span><span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">'n'</span><span class="token punctuation">:</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token string">'x'</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token string">'y'</span><span class="token punctuation">:</span> <span class="token number">6</span><span class="token punctuation">}</span>
x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> m<span class="token punctuation">,</span> n <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">40</span>

<span class="token keyword">exec</span><span class="token punctuation">(</span>
    <span class="token triple-quoted-string string">'''
global x,z
x=100
z=200
m=300
print(m,n,x,y) # 300 4 100 6
               # -- x的值为100,而不是l_dic中的5,是因为global关键字
               #    它已经告诉python解释器,函数里但凡对x变量的引用,都会解析成全局变量.. 
               #    它还使得对x变量的赋值也是在对全局变量进行操作
'''</span><span class="token punctuation">,</span> g_dic<span class="token punctuation">,</span> l_dic<span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>g_dic<span class="token punctuation">)</span>  <span class="token comment"># {'x': 100, 'y': 2,'z':200,...}</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>l_dic<span class="token punctuation">)</span>  <span class="token comment"># {'m': 300, 'n': 4, 'x': 5, 'y': 6} -- 可以看到m变量的值被覆盖了</span>

<span class="token comment"># --- --- ---</span>

cmd <span class="token operator">=</span> <span class="token triple-quoted-string string">&quot;&quot;&quot;
x = 1
y = 2
print('&gt;&gt;&gt;&gt;:')
&quot;&quot;&quot;</span>
local_dic <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">exec</span><span class="token punctuation">(</span>cmd<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> local_dic<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>local_dic<span class="token punctuation">)</span>  <span class="token comment"># -- 将执行过程中产生的名字都丢到local_dic里面去啦！</span>
<span class="token triple-quoted-string string">&quot;&quot;&quot;运行结果如下:
&gt;&gt;&gt;&gt;:
{'x': 1, 'y': 2}
&quot;&quot;&quot;</span>

<span class="token comment"># --- --- --- 模拟类定义阶段,开辟命名空间,将类体执行过程中产生的名字放到命名空间里的过程.</span>
<span class="token keyword">class</span> <span class="token class-name">Foo</span><span class="token punctuation">:</span>
    x <span class="token operator">=</span> <span class="token number">1</span>
    <span class="token keyword">def</span> <span class="token function">fun</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token keyword">pass</span>
    
cmd <span class="token operator">=</span> <span class="token triple-quoted-string string">&quot;&quot;&quot;
x = 1
def fun(self):pass
&quot;&quot;&quot;</span>
class_dic <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>  <span class="token comment"># -- 定义类的局部命名空间</span>
<span class="token keyword">exec</span><span class="token punctuation">(</span>cmd<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> class_dic<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>class_dic<span class="token punctuation">)</span>  <span class="token comment"># {'x': 1, 'fun': &lt;function fun at 0x7fcfdfe799d0&gt;}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br></div></div><h5 id="创建类的三要素"><a href="#创建类的三要素" class="header-anchor">#</a> 创建类的三要素</h5> <blockquote><p>创建类的3个要素: 类名、基类、类的名称空间.</p></blockquote> <div class="language-python line-numbers-mode"><pre class="language-python"><code>class_name <span class="token operator">=</span> <span class="token string">'People'</span>
class_bases <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">,</span> <span class="token punctuation">)</span>
class_dic <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
class_body <span class="token operator">=</span> <span class="token triple-quoted-string string">&quot;&quot;&quot;
country = &quot;China&quot;

def __init__(self, name, age):
    self.name = name
    self.age = age

def eat(self):
    print(&quot;%s is eating.&quot; % self.name)
&quot;&quot;&quot;</span>
<span class="token keyword">exec</span><span class="token punctuation">(</span>class_body<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> class_dic<span class="token punctuation">)</span>

<span class="token comment"># -- 准备好创建类的三个要素</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>class_name<span class="token punctuation">)</span>   <span class="token comment"># People</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>class_bases<span class="token punctuation">)</span>  <span class="token comment"># (&lt;class 'object'&gt;,)</span>
<span class="token comment"># {</span>
<span class="token comment">#   'country': 'China',</span>
<span class="token comment">#   '__init__': &lt;function __init__ at 0x7fb7b45799d0&gt;,</span>
<span class="token comment">#   'eat': &lt;function eat at 0x7fb7b4579940&gt;</span>
<span class="token comment"># }</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>class_dic<span class="token punctuation">)</span>

<span class="token comment"># -- type(类名,基类,类的名称空间)</span>
<span class="token comment">#    Ps:一般会将type赋值给的变量的名字,命名的跟class_name一样</span>
Peo <span class="token operator">=</span> <span class="token builtin">type</span><span class="token punctuation">(</span>class_name<span class="token punctuation">,</span> class_bases<span class="token punctuation">,</span> class_dic<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>Peo<span class="token punctuation">)</span>  <span class="token comment"># &lt;class '__main__.People'&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><h3 id="自定义的元类"><a href="#自定义的元类" class="header-anchor">#</a> 自定义的元类</h3> <h5 id="class创建类的流程"><a href="#class创建类的流程" class="header-anchor">#</a> class创建类的流程</h5> <p>在用默认元类type创建类的方式中, 我们可以分析出 <font color="red"><strong>class的运行原理:</strong></font>(而非元类的运行原理)<br>
1&gt; 拿到一个字符串格式的类名 <code>class_name = &quot;People&quot;</code><br>
2&gt; 拿到一个类的基类们 <code>class_bases = (object, )</code><br>
3&gt; 执行类体代码, 拿到一个类的名称空间 <code>class_dic = {...}</code><br>
4&gt; 调用 <code>People = type(class_name, class_bases, class_dic)</code><br> <font color="brown">class关键字是上述四个步骤的封装.</font></p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">Mymeta</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># -- 只有继承了type类才能称之为一个元类,否则就是一个普通的自定义类</span>

    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> class_name<span class="token punctuation">,</span> class_bases<span class="token punctuation">,</span> class_dic<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span>         <span class="token comment"># &lt;class '__main__.People'&gt; 注意哦,Mymeta实例化出的是一个类</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>class_name<span class="token punctuation">)</span>   <span class="token comment"># People</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>class_bases<span class="token punctuation">)</span>  <span class="token comment"># (&lt;class 'object'&gt;,)</span>
        <span class="token comment"># {</span>
        <span class="token comment">#     '__module__': '__main__',</span>
        <span class="token comment">#     '__qualname__': 'People',</span>
        <span class="token comment">#     'country': 'China',</span>
        <span class="token comment">#     '__init__': &lt;function People.__init__ at 0x7f9ce3555700&gt;,</span>
        <span class="token comment">#     'eat': &lt;function People.eat at 0x7f9ce3555a60&gt;</span>
        <span class="token comment"># }</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>class_dic<span class="token punctuation">)</span>
        <span class="token comment"># (&lt;class '__main__.Mymeta'&gt;, &lt;class 'type'&gt;, &lt;class 'object'&gt;)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>Mymeta<span class="token punctuation">.</span>__mro__<span class="token punctuation">)</span>  
        <span class="token comment"># -- People = Mymeta(...)  self是People,其所在类是Mymeta,看Mymeta类的mro链</span>
        <span class="token comment">#    super()会得到一个特殊对象,此处是绑定方法,所以不用写self.</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span>Mymeta<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>class_name<span class="token punctuation">,</span> class_bases<span class="token punctuation">,</span> class_dic<span class="token punctuation">)</span>  <span class="token comment"># -- 重用父类功能</span>


<span class="token comment"># -- People默认继承object类,metaclass默认值为type.</span>
<span class="token comment">#    class的运行原理第4步是用type实例化出People对象.</span>
<span class="token comment">#    在这里,我们不使用type,使用自定义的元类Mymeta实例化出People对象.</span>
<span class="token comment">#    People = Mymeta(类名,基类们,类的名称空间)</span>
<span class="token comment">#        调用Mymeta类创建了一个空对象'即空的名称空间{}'后;</span>
<span class="token comment">#        空对象People会连同Mymeta括号内的参数一起传给Mymeta下的__init__方法,完成初始化</span>
<span class="token keyword">class</span> <span class="token class-name">People</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">,</span> metaclass<span class="token operator">=</span>Mymeta<span class="token punctuation">)</span><span class="token punctuation">:</span>
    country <span class="token operator">=</span> <span class="token string">&quot;China&quot;</span>

    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">,</span> age<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>name <span class="token operator">=</span> name
        self<span class="token punctuation">.</span>age <span class="token operator">=</span> age

    <span class="token keyword">def</span> <span class="token function">eat</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;%s is eating.&quot;</span> <span class="token operator">%</span> self<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br></div></div><h5 id="添加一些判断"><a href="#添加一些判断" class="header-anchor">#</a> 添加一些判断</h5> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment"># -- 应用:自定义元类控制类的产生过程,类的产生过程其实就是元类的调用过程</span>
<span class="token keyword">class</span> <span class="token class-name">Mymeta</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">)</span><span class="token punctuation">:</span>

    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> class_name<span class="token punctuation">,</span> class_bases<span class="token punctuation">,</span> class_dic<span class="token punctuation">)</span><span class="token punctuation">:</span>
        temp <span class="token operator">=</span> class_dic<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">&quot;__doc__&quot;</span><span class="token punctuation">)</span>
        <span class="token comment"># -- or左侧条件成立的话,or右侧就不会执行啦!!也就保证or右侧执行时,temp一定不为None.</span>
        <span class="token keyword">if</span> temp <span class="token keyword">is</span> <span class="token boolean">None</span> <span class="token keyword">or</span> <span class="token builtin">len</span><span class="token punctuation">(</span>temp<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
            <span class="token keyword">raise</span> TypeError<span class="token punctuation">(</span><span class="token string">&quot;类中必须有文档注释,并且不为空.&quot;</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> class_name<span class="token punctuation">.</span>istitle<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">raise</span> TypeError<span class="token punctuation">(</span><span class="token string">&quot;类名首字母必须大写.&quot;</span><span class="token punctuation">)</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span>Mymeta<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>class_name<span class="token punctuation">,</span> class_bases<span class="token punctuation">,</span> class_dic<span class="token punctuation">)</span>


<span class="token keyword">class</span> <span class="token class-name">People</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">,</span> metaclass<span class="token operator">=</span>Mymeta<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;这是一个People类!&quot;&quot;&quot;</span>
    country <span class="token operator">=</span> <span class="token string">&quot;China&quot;</span>

    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">,</span> age<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>name <span class="token operator">=</span> name
        self<span class="token punctuation">.</span>age <span class="token operator">=</span> age

    <span class="token keyword">def</span> <span class="token function">eat</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;%s is eating.&quot;</span> <span class="token operator">%</span> self<span class="token punctuation">.</span>name<span class="token punctuation">)</span>


<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">getattr</span><span class="token punctuation">(</span>People<span class="token punctuation">,</span> <span class="token string">&quot;__doc__&quot;</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><hr> <h2 id="自定义类的实例化"><a href="#自定义类的实例化" class="header-anchor">#</a> 自定义类的实例化</h2> <blockquote><p>自定义元类来控制类的调用过程, 即类的实例化过程</p></blockquote> <h3 id="call"><a href="#call" class="header-anchor">#</a> __call__</h3> <h5 id="原理"><a href="#原理" class="header-anchor">#</a> 原理</h5> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">Foo</span><span class="token punctuation">:</span>

    <span class="token keyword">def</span> <span class="token function">__call__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span>    <span class="token comment"># &lt;__main__.Foo object at 0x7fa1f868cac0&gt;</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span>    <span class="token comment"># (1, 2, 3)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>kwargs<span class="token punctuation">)</span>  <span class="token comment"># {'x': 4, 'y': 5}</span>
        <span class="token keyword">return</span> <span class="token string">&quot;返回值123&quot;</span>


obj <span class="token operator">=</span> Foo<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># -- 要想让obj这个实例化对象变成一个可调用的对象,需要在该对象的类中定义一个__call__方法</span>
<span class="token comment">#    该方法会在调用实例化对象obj时自动触发,调用obj的返回值就是__call__方法的返回值</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>obj<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> x<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">,</span> y<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 返回值123  --  obj的调用会触发Foo中__call__方法的执行</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>由此得知, <font color="brown">调用一个对象, 就是触发对象所在类中的__call__方法的执行!</font><br>
Python处处皆对象, People也是一个对象, 并且People它是可以调用的!<br>
那么在实例化得到People对象的Mymeta类中也必然存在一个__call__方法!!!</p> <h5 id="元类中的-call"><a href="#元类中的-call" class="header-anchor">#</a> 元类中的__call__</h5> <p><font color="blue">Mymeta ---(实例化)--- People ---(实例化)--- obj</font><br>
People实例化得到obj会对People进行调用,则Mymeta中一定会有__call__方法.</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment"># -- 应用:自定义元类控制类的产生过程,类的产生过程其实就是元类的调用过程</span>
<span class="token keyword">class</span> <span class="token class-name">Mymeta</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">)</span><span class="token punctuation">:</span>

    <span class="token keyword">def</span> <span class="token function">__call__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span>    <span class="token comment"># &lt;class '__main__.People'&gt;</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span>    <span class="token comment"># ('dc',)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>kwargs<span class="token punctuation">)</span>  <span class="token comment"># {'age': 18}</span>


<span class="token keyword">class</span> <span class="token class-name">People</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">,</span> metaclass<span class="token operator">=</span>Mymeta<span class="token punctuation">)</span><span class="token punctuation">:</span>
    country <span class="token operator">=</span> <span class="token string">&quot;China&quot;</span>

    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">,</span> age<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>name <span class="token operator">=</span> name
        self<span class="token punctuation">.</span>age <span class="token operator">=</span> age

    <span class="token keyword">def</span> <span class="token function">eat</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;%s is eating.&quot;</span> <span class="token operator">%</span> self<span class="token punctuation">.</span>name<span class="token punctuation">)</span>


<span class="token comment"># -- 调用People就是在调用Mymeta类中的__call__方法</span>
<span class="token comment">#    然后将People传给self,溢出的位置参数传给*,溢出的关键字参数传给**</span>
<span class="token comment">#    调用People的返回值就是调用__call__的返回值</span>
obj <span class="token operator">=</span> People<span class="token punctuation">(</span><span class="token string">'dc'</span><span class="token punctuation">,</span> age<span class="token operator">=</span><span class="token number">18</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span>  <span class="token comment"># None</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p>回顾一下,抛开元类的知识不谈, 就单纯的People('dc', 18)得到一个类的实例化对象obj, 这一过程经历了什么？<br> <strong>step1:</strong> 调用类创建了一个空对象 <strong>'空的名称空间'</strong> {}<br> <strong>step2:</strong> 自动触发类中__init__功能的执行, 将空对象传给self参数</p> <h5 id="调用元类产生的类"><a href="#调用元类产生的类" class="header-anchor">#</a> 调用元类产生的类</h5> <p><font color="blue">那么,自定义的元类Mymeta在__call__方法中一定会实现这三件事:</font><br> <font color="brown">1&gt; 产生一个People的空对象obj</font><br> <font color="brown">2&gt; 调用__init__方法初始化对象obj</font><br> <font color="brown">3&gt; 返回初始化好的obj</font></p> <p><font color="green"><strong>接下来,我们将默认元类type干的事情进行还原.</strong></font></p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment"># -- 应用:自定义元类控制类的产生过程,类的产生过程其实就是元类的调用过程</span>
<span class="token keyword">class</span> <span class="token class-name">Mymeta</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">)</span><span class="token punctuation">:</span>

    <span class="token keyword">def</span> <span class="token function">__call__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># -- !!!必须写self参数,代表创建的是该self的空对象 固定用法!!</span>
        <span class="token comment">#    此处是self指代的是类People</span>
        <span class="token comment">#    要找__new__这个属性,若People的namespace中没有,依次再去object、Mymeta、type中找</span>
        obj <span class="token operator">=</span> self<span class="token punctuation">.</span>__new__<span class="token punctuation">(</span>self<span class="token punctuation">)</span>  <span class="token comment"># -- 【1】.通过__new__方法先造一个People的空对象</span>
        <span class="token comment"># -- 这里也涉及到属性查找,该self(即People)中有__init__方法,就直接使用它</span>
        <span class="token comment">#    抛开元类不谈,类的实例化对象自动调用__init__绑定方法时,不用传self.. 就是因为在这里帮忙传啦</span>
        self<span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>  <span class="token comment"># -- 【2】.调用__init__为该空对象初始化独有的属性</span>
        <span class="token keyword">return</span> obj  <span class="token comment"># -- 【3】.返回一个初始化好的对象obj</span>


<span class="token comment"># -- People = Mymeta(People,...,...) 是在创建类,主要操作的是Mymeta中的__init__</span>
<span class="token comment"># -- People()是在调用Mymeta中的__call__创建实例化对象</span>
<span class="token keyword">class</span> <span class="token class-name">People</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">,</span> metaclass<span class="token operator">=</span>Mymeta<span class="token punctuation">)</span><span class="token punctuation">:</span>
    country <span class="token operator">=</span> <span class="token string">&quot;China&quot;</span>

    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">,</span> age<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>name <span class="token operator">=</span> name
        self<span class="token punctuation">.</span>age <span class="token operator">=</span> age

    <span class="token keyword">def</span> <span class="token function">eat</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;%s is eating.&quot;</span> <span class="token operator">%</span> self<span class="token punctuation">.</span>name<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">__new__</span><span class="token punctuation">(</span>cls<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># print(cls)  # &lt;class '__main__.People'&gt;</span>
        <span class="token comment"># cls.__new__(cls)  # -- 直接报错,递归死循环</span>
        <span class="token comment"># print(cls.__mro__)  # -- (&lt;class '__main__.People'&gt;, &lt;class 'object'&gt;)</span>
        obj <span class="token operator">=</span> <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__new__<span class="token punctuation">(</span>cls<span class="token punctuation">)</span>  <span class="token comment"># -- 完整写法为: super(People,cls)</span>
        <span class="token keyword">return</span> obj


obj <span class="token operator">=</span> People<span class="token punctuation">(</span><span class="token string">'dc'</span><span class="token punctuation">,</span> age<span class="token operator">=</span><span class="token number">18</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>__dict__<span class="token punctuation">)</span>  <span class="token comment"># {'name': 'dc', 'age': 18}</span>
obj<span class="token punctuation">.</span>eat<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># dc is eating.</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br></div></div><h3 id="属性查找"><a href="#属性查找" class="header-anchor">#</a> 属性查找</h3> <blockquote><p>结合 python继承的实现原理+元类 重新看属性的查找应该是什么样子呢???</p></blockquote> <p>在学习完元类后, 更进一步理解了&quot;python处处皆对象&quot;,提一点,用class自定义的类全都是对象<br> <font color="gray">包括object类本身也是元类type的 一个实例,可以用<code>type(object)</code>验证.</font></p> <p>继承的实现原理 + 将类当成对象.下述继承应该说成是:<br>
对象StanfordTeacher继承对象Foo, 对象Foo继承对象Bar, 对象Bar继承对象object</p> <p>于是属性查找应该分成 <strong>两层</strong> :<br> <font color="brown">一层是对象层 (基于c3算法的MRO) 的查找, 另外一个层则是类层(即元类层)的查找!!</font><br> <strong>Ps:</strong> 若StanfordTeacher实例化出obj对象,obj通过 <code>.</code> 进行属性引用时,会先在自己的namespace中查找独有属性.</p> <p><img src="/assets/img/attribute_search.64b73c55.jpeg" alt=""></p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">Mymeta</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    n <span class="token operator">=</span> <span class="token number">520</span>
    <span class="token keyword">def</span> <span class="token function">__call__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>  
      	<span class="token comment"># print(self)  # &lt;class '__main__.StanfordTeacher'&gt;</span>
        <span class="token comment"># -- __new__的查找顺序为StanfordTeacher-&gt;Foo-&gt;Bar-&gt;object-&gt;Mymeta-&gt;type</span>
        obj <span class="token operator">=</span> self<span class="token punctuation">.</span>__new__<span class="token punctuation">(</span>self<span class="token punctuation">)</span>
        <span class="token comment"># print(self.__new__ is object.__new__)  # True</span>
        <span class="token comment"># -- !!下方这条注释的语句,也可以创建空对象,但会直接跳过StanfordTeacher-&gt;Foo-&gt;Bar这三个类的检索</span>
        <span class="token comment">#  obj = object.__new__(self)</span>
        self<span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>
        <span class="token keyword">return</span> obj

<span class="token keyword">class</span> <span class="token class-name">Bar</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    n <span class="token operator">=</span> <span class="token number">333</span>

<span class="token keyword">class</span> <span class="token class-name">Foo</span><span class="token punctuation">(</span>Bar<span class="token punctuation">)</span><span class="token punctuation">:</span>
    n <span class="token operator">=</span> <span class="token number">222</span>

<span class="token keyword">class</span> <span class="token class-name">StanfordTeacher</span><span class="token punctuation">(</span>Foo<span class="token punctuation">,</span> metaclass<span class="token operator">=</span>Mymeta<span class="token punctuation">)</span><span class="token punctuation">:</span>
    n <span class="token operator">=</span> <span class="token number">111</span>
    school <span class="token operator">=</span> <span class="token string">'Stanford'</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">,</span> age<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>name <span class="token operator">=</span> name
        self<span class="token punctuation">.</span>age <span class="token operator">=</span> age
    <span class="token keyword">def</span> <span class="token function">say</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'%s says welcome to the Stanford to learn Python'</span> <span class="token operator">%</span> self<span class="token punctuation">.</span>name<span class="token punctuation">)</span>

<span class="token comment"># -- n的查找顺序为StanfordTeacher-&gt;Foo-&gt;Bar-&gt;object-&gt;Mymeta-&gt;type</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>StanfordTeacher<span class="token punctuation">.</span>n<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><p><font color="red"><code>obj = object.__new__(self)</code> 也可以创建空对象,但会直接跳过StanfordTeacher-&gt;Foo-&gt;Bar这三个类的检索</font></p> <p><strong>提一嘴:</strong> <code>StanfordTeacher = Mymeta('StanfordTeacher','...','...')</code> 产生类StanfordTeacher的过程就是在调用Mymeta, 而Mymeta也是type类的一个对象, 那么Mymeta之所以可以调用, 是因为在元类type中也有一个 __call__方法!!! 该方法中也会实现那三件事!!</p> <hr> <h2 id="实践"><a href="#实践" class="header-anchor">#</a> 实践</h2> <h3 id="模版分析"><a href="#模版分析" class="header-anchor">#</a> <font color="red">模版分析</font></h3> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token number">1</span>     <span class="token comment"># class type:</span>
<span class="token number">2</span>     <span class="token comment">#     def __call__(self, *args, **kwargs):  # -- self为Mymeta对象 args是三要素 15</span>
<span class="token number">3</span>     <span class="token comment">#         obj = self.__new__(self, *args, **kwargs)</span>
<span class="token number">4</span>     <span class="token comment">#         self.__init__(obj, *args, **kwargs)</span>
<span class="token number">5</span>     <span class="token comment">#         return obj</span>

<span class="token number">6</span>     <span class="token keyword">class</span> <span class="token class-name">Mymeta</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token number">7</span>        <span class="token keyword">def</span> <span class="token function">__new__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>   <span class="token comment"># -- self为Mymeta对象 args是三要素 15</span>
<span class="token number">8</span>             <span class="token keyword">return</span> <span class="token builtin">super</span><span class="token punctuation">(</span>Mymeta<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__new__<span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>

<span class="token number">9</span>        <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> class_name<span class="token punctuation">,</span> class_bases<span class="token punctuation">,</span> class_dic<span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># -- self为People对象 15</span>
<span class="token number">10</span>            <span class="token builtin">super</span><span class="token punctuation">(</span>Mymeta<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>class_name<span class="token punctuation">,</span> class_bases<span class="token punctuation">,</span> class_dic<span class="token punctuation">)</span>

<span class="token number">11</span>       <span class="token keyword">def</span> <span class="token function">__call__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># -- self为People对象 args是('dc',18) 21</span>
<span class="token number">12</span>            obj <span class="token operator">=</span> self<span class="token punctuation">.</span>__new__<span class="token punctuation">(</span>self<span class="token punctuation">)</span>  <span class="token comment"># -- 这里调用的是19行的代码</span>
<span class="token number">13</span>            self<span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>  <span class="token comment"># -- 调用的是16的代码 *args解包以位置参数传递</span>
<span class="token number">14</span>            <span class="token keyword">return</span> obj

<span class="token number">15</span>    <span class="token keyword">class</span> <span class="token class-name">People</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">,</span> metaclass<span class="token operator">=</span>Mymeta<span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token number">16</span>        <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">,</span> age<span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token number">17</span>            self<span class="token punctuation">.</span>name <span class="token operator">=</span> name
<span class="token number">18</span>            self<span class="token punctuation">.</span>age <span class="token operator">=</span> age

          <span class="token comment"># -- 第19、20行的代码不写也是可以的</span>
<span class="token number">19</span>        <span class="token keyword">def</span> <span class="token function">__new__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token number">20</span>            <span class="token keyword">return</span> <span class="token builtin">super</span><span class="token punctuation">(</span>People<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__new__<span class="token punctuation">(</span>self<span class="token punctuation">)</span>  <span class="token comment"># -- 最后调用的是object里的__new__</span>
                                                        <span class="token comment">#    注意,object的__new__只有一个参数</span>

<span class="token number">21</span>    p <span class="token operator">=</span> People<span class="token punctuation">(</span><span class="token string">'dc'</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">)</span>

先说一点<span class="token punctuation">:</span>
  python处处皆对象<span class="token punctuation">,</span>类也是一个对象<span class="token punctuation">.</span> 调用对象就会触发实例化该对象的类中的__call__方法<span class="token punctuation">.</span>
  以本模版为例<span class="token punctuation">,</span> Mymeta<span class="token punctuation">(</span><span class="token punctuation">)</span>、People<span class="token punctuation">(</span><span class="token punctuation">)</span>会分别触发<span class="token builtin">type</span>类和Mymeta类中的call方法<span class="token punctuation">;</span>

<span class="token operator">&lt;</span>在第<span class="token number">15</span>行打个断点<span class="token punctuation">,</span>就知道执行顺序啦!!从上到下<span class="token punctuation">,</span><span class="token keyword">class</span>和<span class="token keyword">def</span>语句都会先执行<span class="token punctuation">,</span>但函数体代码是没有马上执行的<span class="token punctuation">.</span><span class="token operator">&gt;</span>
第<span class="token number">1</span><span class="token operator">-</span><span class="token number">5</span>行代码是<span class="token builtin">type</span>类的伪代码<span class="token punctuation">.</span>
<span class="token number">1</span><span class="token operator">&gt;</span> 从第<span class="token number">15</span>行代码开始分析<span class="token punctuation">.</span> 
   <span class="token keyword">class</span>关键字会收集创建类的三要素<span class="token punctuation">,</span>类名People、基类们<span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">,</span><span class="token punctuation">)</span>、执行类体代码得到的名称字典<span class="token punctuation">.</span>
   注意一点<span class="token punctuation">:</span>能收集到名称字典是因为第<span class="token number">16</span>行、第<span class="token number">19</span>行代码执行了<span class="token punctuation">,</span>但是函数体代码并没有执行!!
<span class="token number">2</span><span class="token operator">&gt;</span> 收集完成后<span class="token punctuation">,</span>在背后会执行语句<span class="token punctuation">,</span>People <span class="token operator">=</span> Mymate<span class="token punctuation">(</span><span class="token string">'People'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
   Mymate对象的调用会触发<span class="token builtin">type</span>中__call__方法的运行<span class="token punctuation">.</span>
<span class="token number">3</span><span class="token operator">&gt;</span> 看第<span class="token number">2</span>行的伪代码<span class="token punctuation">,</span>self是Mymeta对象<span class="token punctuation">.</span> <span class="token operator">-</span><span class="token operator">-</span> 因为对象调用绑定方法会自动将自己传递给方法的第一个参数<span class="token punctuation">.</span>
   创建类的三要素会被<span class="token operator">*</span>args以元祖形式接收<span class="token punctuation">.</span>
<span class="token number">4</span><span class="token operator">&gt;</span> 第<span class="token number">3</span>行的伪代码<span class="token punctuation">,</span>开始实例化Mymeta对象<span class="token punctuation">,</span>创建出一个空对象<span class="token punctuation">.</span><span class="token punctuation">.</span>这里涉及到__new__属性的查找<span class="token punctuation">.</span>
   Mymeta对象中有__new__属性<span class="token punctuation">,</span>跳转到第<span class="token number">7</span>行代码<span class="token punctuation">.</span>该行代码中的self也是Mymeta对象<span class="token punctuation">.</span>
   打印一下<span class="token punctuation">,</span>会发现args元组里是创建类的三要素<span class="token punctuation">,</span>kwargs是空字典<span class="token punctuation">.</span><span class="token punctuation">.</span>
   第<span class="token number">8</span>行代码使用了<span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>此行代码等价于 `<span class="token keyword">return</span> <span class="token builtin">type</span><span class="token punctuation">.</span>__new__<span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>`
   注意一点！<span class="token operator">*</span>args相当于将args元祖进行了拆包<span class="token punctuation">,</span>以位置参数的形式进行了传递!!!
   ok<span class="token punctuation">,</span>将空对象 <span class="token keyword">return</span>回了 第<span class="token number">3</span>行的伪代码<span class="token punctuation">,</span> 并赋值给了obj对象<span class="token punctuation">.</span> 实则此obj就是 People对象!
<span class="token number">5</span><span class="token operator">&gt;</span> 执行第<span class="token number">4</span>行的伪代码<span class="token punctuation">,</span>为People对象进行初始化操作<span class="token punctuation">,</span>同理<span class="token punctuation">,</span>涉及__init__属性的查找<span class="token punctuation">.</span>
   跳转到第<span class="token number">9</span>行代码<span class="token punctuation">.</span><span class="token punctuation">.</span> 接着执行第<span class="token number">10</span>行<span class="token punctuation">,</span>再回到第<span class="token number">4</span>行<span class="token punctuation">,</span>执行第<span class="token number">5</span>行的<span class="token keyword">return</span>语句
<span class="token number">6</span><span class="token operator">&gt;</span> 就此<span class="token punctuation">,</span>第<span class="token number">15</span>行代码 People <span class="token operator">=</span> Mymate<span class="token punctuation">(</span><span class="token string">'People'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span><span class="token punctuation">)</span>的路途结束!!
<span class="token number">7</span><span class="token operator">&gt;</span> 第<span class="token number">21</span>行代码的执行<span class="token punctuation">,</span>会执行第<span class="token number">12</span>行代码<span class="token punctuation">,</span>再执行第<span class="token number">20</span>行代码<span class="token punctuation">;</span> 第<span class="token number">13</span>行代码的执行会执行第<span class="token number">17</span>行代码<span class="token punctuation">.</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br></div></div><p><strong>清爽版</strong></p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">Mymeta</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># -- 控制自定义类的创建过程 People = Mymeta('People',..,..)</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> class_name<span class="token punctuation">,</span> class_bases<span class="token punctuation">,</span> class_dic<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span>Mymeta<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>class_name<span class="token punctuation">,</span> class_bases<span class="token punctuation">,</span> class_dic<span class="token punctuation">)</span>

    <span class="token comment"># -- 控制自定义类的调用 p = People('dc',18) </span>
    <span class="token keyword">def</span> <span class="token function">__call__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        obj <span class="token operator">=</span> self<span class="token punctuation">.</span>__new__<span class="token punctuation">(</span>self<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>
        <span class="token keyword">return</span> obj

<span class="token keyword">class</span> <span class="token class-name">People</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">,</span> metaclass<span class="token operator">=</span>Mymeta<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">,</span> age<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>name <span class="token operator">=</span> name
        self<span class="token punctuation">.</span>age <span class="token operator">=</span> age
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h3 id="小试身手"><a href="#小试身手" class="header-anchor">#</a> 小试身手</h3> <p>1&gt; 在自定义元类Mymeta中把自定义类People的数据属性都变成大写<br>
2&gt; 在自定义元类Mymeta中完成People实例对象p独有属性的定制,自定义类People无需使用__init__方法</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token triple-quoted-string string">&quot;&quot;&quot;
class type:
    def __call__(self, *args, **kwargs):
        # print(self)  # &lt;class '__main__.Mymeta'&gt;
        obj = self.__new__(self, *args, **kwargs)  # -- 产生Mymeta的一个对象People
        self.__init__(obj, *args, **kwargs)
        return obj
&quot;&quot;&quot;</span>
<span class="token keyword">class</span> <span class="token class-name">Mymeta</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__new__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> class_name<span class="token punctuation">,</span> class_bases<span class="token punctuation">,</span> class_dic<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span>  <span class="token comment"># &lt;class '__main__.Mymeta'&gt; !!!!!!</span>
        update_dic <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token keyword">for</span> k<span class="token punctuation">,</span> v <span class="token keyword">in</span> class_dic<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> <span class="token keyword">not</span> <span class="token builtin">callable</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token keyword">and</span> <span class="token keyword">not</span> k<span class="token punctuation">.</span>startswith<span class="token punctuation">(</span><span class="token string">&quot;__&quot;</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                update_dic<span class="token punctuation">[</span>k<span class="token punctuation">.</span>upper<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> v
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                update_dic<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> v
        <span class="token comment"># -- 这里是创建一个Mymeta的空的实例化对象People</span>
        <span class="token comment">#    等同于 return type.__new__(self, class_name, class_bases, update_dic)</span>
        <span class="token keyword">return</span> <span class="token builtin">super</span><span class="token punctuation">(</span>Mymeta<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__new__<span class="token punctuation">(</span>self<span class="token punctuation">,</span> class_name<span class="token punctuation">,</span> class_bases<span class="token punctuation">,</span> update_dic<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">__call__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span>  <span class="token comment"># -- &lt;class '__main__.People'&gt; !!!!!!</span>
        <span class="token comment"># -- 要求实例化时传参必须为关键字形式</span>
        <span class="token keyword">if</span> args<span class="token punctuation">:</span>
            <span class="token keyword">raise</span> TypeError<span class="token punctuation">(</span><span class="token string">&quot;must use keyword argument for key function!&quot;</span><span class="token punctuation">)</span>
        obj <span class="token operator">=</span> self<span class="token punctuation">.</span>__new__<span class="token punctuation">(</span>self<span class="token punctuation">)</span>
        <span class="token keyword">for</span> k<span class="token punctuation">,</span> v <span class="token keyword">in</span> kwargs<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            obj<span class="token punctuation">.</span>__dict__<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> v
        <span class="token keyword">return</span> obj


<span class="token keyword">class</span> <span class="token class-name">People</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">,</span> metaclass<span class="token operator">=</span>Mymeta<span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># -- People = Mymeta(People,..,..)</span>
    country <span class="token operator">=</span> <span class="token string">&quot;china&quot;</span>

    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">,</span> age<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>name <span class="token operator">=</span> name
        self<span class="token punctuation">.</span>age <span class="token operator">=</span> age


<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">getattr</span><span class="token punctuation">(</span>People<span class="token punctuation">,</span> <span class="token string">'COUNTRY'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># china</span>
p <span class="token operator">=</span> People<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'dc'</span><span class="token punctuation">,</span> age<span class="token operator">=</span><span class="token number">18</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span>__dict__<span class="token punctuation">)</span>  <span class="token comment"># {'name': 'dc', 'age': 18}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br></div></div><p>3&gt; 在元类Mymeta中控制自定义的类People产生的对象p相关的独有属性全部为隐藏属性</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">Mymeta</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">)</span><span class="token punctuation">:</span>

    <span class="token keyword">def</span> <span class="token function">__call__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        obj <span class="token operator">=</span> <span class="token builtin">object</span><span class="token punctuation">.</span>__new__<span class="token punctuation">(</span>self<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>
        obj<span class="token punctuation">.</span>__dict__ <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string-interpolation"><span class="token string">f'_</span><span class="token interpolation"><span class="token punctuation">{</span>self<span class="token punctuation">.</span>__name__<span class="token punctuation">}</span></span><span class="token string">__</span><span class="token interpolation"><span class="token punctuation">{</span>k<span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">:</span> v <span class="token keyword">for</span> k<span class="token punctuation">,</span> v <span class="token keyword">in</span> obj<span class="token punctuation">.</span>__dict__<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
        <span class="token keyword">return</span> obj


<span class="token keyword">class</span> <span class="token class-name">People</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">,</span> metaclass<span class="token operator">=</span>Mymeta<span class="token punctuation">)</span><span class="token punctuation">:</span>

    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">,</span> age<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>name <span class="token operator">=</span> name
        self<span class="token punctuation">.</span>age <span class="token operator">=</span> age


p <span class="token operator">=</span> People<span class="token punctuation">(</span><span class="token string">'dc'</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span>__dict__<span class="token punctuation">)</span>  <span class="token comment"># {'_People__name': 'dc', '_People__age': 18}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h3 id="单例模式"><a href="#单例模式" class="header-anchor">#</a> 单例模式</h3> <blockquote><p>单例模式: 即单个实例, 指的是同一个类实例化多次的结果指向同一个对象, 用于节省内存空间</p></blockquote> <p><strong>应用场景:</strong><br> <font color="brown">当实例化多次得到的多个对象中存放的属性都一样时, 应该将多个对象指向同一个内存, 即同一个实例!</font></p> <p>settings.py配置文件内容如下:</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code>IP <span class="token operator">=</span> <span class="token string">&quot;1.1.1.10&quot;</span>
PORT <span class="token operator">=</span> <span class="token number">3306</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>若我们从配置文件中读取配置来进行实例化, 在配置相同的情况, 就没必要重复产生对象浪费内存啦!<br> <font color="blue">方式二和三,约定一个规则,Mysql()不传参数,默认从配置文件中读取参数!!Hhh.</font></p> <h5 id="方式一-类方法"><a href="#方式一-类方法" class="header-anchor">#</a> 方式一:类方法</h5> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> settings

<span class="token keyword">class</span> <span class="token class-name">Mysql</span><span class="token punctuation">:</span>
    __instance <span class="token operator">=</span> <span class="token boolean">None</span>

    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> ip<span class="token punctuation">,</span> port<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>ip <span class="token operator">=</span> ip
        self<span class="token punctuation">.</span>port <span class="token operator">=</span> port

    <span class="token decorator annotation punctuation">@classmethod</span>
    <span class="token keyword">def</span> <span class="token function">from_conf</span><span class="token punctuation">(</span>cls<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> cls<span class="token punctuation">.</span>__instance<span class="token punctuation">:</span>
            cls<span class="token punctuation">.</span>__instance <span class="token operator">=</span> cls<span class="token punctuation">(</span>settings<span class="token punctuation">.</span>IP<span class="token punctuation">,</span> settings<span class="token punctuation">.</span>PORT<span class="token punctuation">)</span>
        <span class="token keyword">return</span> cls<span class="token punctuation">.</span>__instance

obj1 <span class="token operator">=</span> Mysql<span class="token punctuation">.</span>from_conf<span class="token punctuation">(</span><span class="token punctuation">)</span>
obj2 <span class="token operator">=</span> Mysql<span class="token punctuation">.</span>from_conf<span class="token punctuation">(</span><span class="token punctuation">)</span>
obj3 <span class="token operator">=</span> Mysql<span class="token punctuation">.</span>from_conf<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>obj1 <span class="token keyword">is</span> obj2 <span class="token keyword">is</span> obj3<span class="token punctuation">)</span>  <span class="token comment"># True</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h5 id="方式二-装饰器"><a href="#方式二-装饰器" class="header-anchor">#</a> 方式二:装饰器</h5> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> settings
<span class="token triple-quoted-string string">&quot;&quot;&quot;
def singleton(cls):
    _isinstance = None
    def wrapper(*args, **kwargs):
        if args or kwargs:
            return cls(*args, **kwargs)
        nonlocal _isinstance
        if not _isinstance:
            _isinstance = cls(settings.IP, settings.PORT)
        return _isinstance
    return wrapper
&quot;&quot;&quot;</span>
<span class="token comment"># -- Ps:装饰器还可以用类实现,具体参考面向对象高级部分中关于描述符的知识点!!</span>
<span class="token keyword">def</span> <span class="token function">singleton</span><span class="token punctuation">(</span>cls<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># -- 可以放到类里 cls.__isinstance</span>
    <span class="token comment">#    注意:函数中约定一个下划线,类中约定两个下划线.</span>
    _isinstance <span class="token operator">=</span> cls<span class="token punctuation">(</span>settings<span class="token punctuation">.</span>IP<span class="token punctuation">,</span> settings<span class="token punctuation">.</span>PORT<span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">wrapper</span><span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> args <span class="token keyword">or</span> kwargs<span class="token punctuation">:</span>
            <span class="token keyword">return</span> cls<span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>
        <span class="token comment"># -- cls.__isinstance</span>
        <span class="token keyword">return</span> _isinstance
      
    <span class="token keyword">return</span> wrapper

<span class="token comment"># -- 被装饰对象可以是任意可被调用的对象 类是可以调用的</span>
<span class="token decorator annotation punctuation">@singleton</span>
<span class="token keyword">class</span> <span class="token class-name">Mysql</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> ip<span class="token punctuation">,</span> port<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>ip <span class="token operator">=</span> ip
        self<span class="token punctuation">.</span>port <span class="token operator">=</span> port

obj1 <span class="token operator">=</span> Mysql<span class="token punctuation">(</span><span class="token punctuation">)</span>
obj2 <span class="token operator">=</span> Mysql<span class="token punctuation">(</span><span class="token punctuation">)</span>
obj3 <span class="token operator">=</span> Mysql<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>obj1 <span class="token keyword">is</span> obj2 <span class="token keyword">is</span> obj3<span class="token punctuation">)</span>  <span class="token comment"># True</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br></div></div><h5 id="方式三-元类"><a href="#方式三-元类" class="header-anchor">#</a> 方式三:元类</h5> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> settings


<span class="token keyword">class</span> <span class="token class-name">Mymeta</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">)</span><span class="token punctuation">:</span>

    <span class="token comment"># -- 定义类Mysql时触发</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> class_name<span class="token punctuation">,</span> class_bases<span class="token punctuation">,</span> class_dic<span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># -- self为Mysql</span>
        <span class="token comment"># -- 在Mysql调用之前,事先先从配置文件中取配置来造一个Mysql的实例出来</span>
        self<span class="token punctuation">.</span>__instance <span class="token operator">=</span> <span class="token builtin">object</span><span class="token punctuation">.</span>__new__<span class="token punctuation">(</span>self<span class="token punctuation">)</span>  <span class="token comment"># -- 造出一个Mysql的空对象</span>
        self<span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>self<span class="token punctuation">.</span>__instance<span class="token punctuation">,</span> settings<span class="token punctuation">.</span>IP<span class="token punctuation">,</span> settings<span class="token punctuation">.</span>PORT<span class="token punctuation">)</span>  <span class="token comment"># -- 加载配置文件初始化Mysql的空对象</span>
        <span class="token comment">#    上述两步可以合成下面的任意一种写法(即上方的两行代码等效于下方的两行代码中的任意一条)</span>
        <span class="token comment">#    建议不合成 难得理解 —_-&quot;&quot;  此__call__是type中的, 看前面的·模版分析·就晓得咋个回事了.</span>
        <span class="token comment"># self.__instance = super().__call__(settings.IP, settings.PORT)</span>
        <span class="token comment"># self.__instance = type.__call__(self, settings.IP, settings.PORT)</span>

        <span class="token comment"># -- 此行模版代码放到此函数的哪个位置都可以..</span>
        <span class="token comment">#    因为type中的__call__方法里的__new__步骤已经创建好了Mymeta的空对象.</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span>Mymeta<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>class_name<span class="token punctuation">,</span> class_bases<span class="token punctuation">,</span> class_dic<span class="token punctuation">)</span>

    <span class="token comment"># -- Mysql调用时触发</span>
    <span class="token keyword">def</span> <span class="token function">__call__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># -- self为Mysql</span>
        <span class="token keyword">if</span> args <span class="token keyword">or</span> kwargs<span class="token punctuation">:</span>
            obj <span class="token operator">=</span> self<span class="token punctuation">.</span>__new__<span class="token punctuation">(</span>self<span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>
            <span class="token keyword">return</span> obj
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>__instance


<span class="token keyword">class</span> <span class="token class-name">Mysql</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">,</span> metaclass<span class="token operator">=</span>Mymeta<span class="token punctuation">)</span><span class="token punctuation">:</span>

    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> ip<span class="token punctuation">,</span> port<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>ip <span class="token operator">=</span> ip
        self<span class="token punctuation">.</span>port <span class="token operator">=</span> port


<span class="token comment"># -- 没有传值则默认从配置文件中读配置来实例化,所有的实例应该指向一个内存地址</span>
obj1 <span class="token operator">=</span> Mysql<span class="token punctuation">(</span><span class="token punctuation">)</span>
obj2 <span class="token operator">=</span> Mysql<span class="token punctuation">(</span><span class="token punctuation">)</span>
obj3 <span class="token operator">=</span> Mysql<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>obj1 <span class="token keyword">is</span> obj2 <span class="token keyword">is</span> obj3<span class="token punctuation">)</span>  <span class="token comment"># True</span>
obj4 <span class="token operator">=</span> Mysql<span class="token punctuation">(</span><span class="token string">'127.0.0.1'</span><span class="token punctuation">,</span> <span class="token number">8000</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>obj1 <span class="token keyword">is</span> obj4<span class="token punctuation">)</span>  <span class="token comment"># False</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br></div></div><hr> <h2 id="补充"><a href="#补充" class="header-anchor">#</a> 补充</h2> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">MyType</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;2&quot;</span><span class="token punctuation">)</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">__new__</span><span class="token punctuation">(</span>cls<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span>
        new_cls <span class="token operator">=</span> <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__new__<span class="token punctuation">(</span>cls<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>  <span class="token comment"># 创建类</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>new_cls<span class="token punctuation">)</span>  <span class="token comment"># &lt;class '__main__.Foo'&gt;</span>
        <span class="token keyword">return</span> new_cls


<span class="token keyword">class</span> <span class="token class-name">Foo</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">,</span> metaclass<span class="token operator">=</span>MyType<span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># 也遵循,先执行new再执行init</span>
    <span class="token keyword">pass</span>


<span class="token comment"># 类创建对象先执行类中的new再执行init,对象加括号会执行类中的call方法</span>
<span class="token comment"># 创建类的&quot;东西&quot;在创建类时也会先执行&quot;东西&quot;里的new再执行init,类加括号会执行&quot;东西&quot;里的call方法</span>
<span class="token comment"># 意味着 类加括号会执行 &quot;东西&quot; 里的call方法??</span>

<span class="token comment"># 先new后init是因为call里定义了的</span>



根据类创建对象
<span class="token number">1</span><span class="token operator">&gt;</span> 先执行__new__方法<span class="token punctuation">,</span>创建空对象<span class="token punctuation">;</span> <span class="token operator">==</span><span class="token operator">&gt;</span> 构造方法
<span class="token number">2</span><span class="token operator">&gt;</span> 执行类的__init__方法<span class="token punctuation">,</span>初始化对象<span class="token punctuation">;</span> <span class="token operator">==</span><span class="token operator">&gt;</span> 初始化方法
Q<span class="token punctuation">:</span> 对象是基于类创建的<span class="token punctuation">.</span>那么类是由谁创建的? 
A<span class="token punctuation">:</span> 类默认是由<span class="token builtin">type</span>创建的!!
<span class="token keyword">class</span> <span class="token class-name">Foo</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    v1 <span class="token operator">=</span> <span class="token number">123</span>
    <span class="token keyword">def</span> <span class="token function">func</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token number">666</span>
等同于
Foo <span class="token operator">=</span> <span class="token builtin">type</span><span class="token punctuation">(</span><span class="token string">&quot;Foo&quot;</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string">&quot;v1&quot;</span><span class="token punctuation">:</span><span class="token number">123</span><span class="token punctuation">,</span><span class="token string">&quot;func&quot;</span><span class="token punctuation">:</span><span class="token keyword">lambda</span> self<span class="token punctuation">:</span><span class="token number">666</span><span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token comment"># 类名、继承类、成员</span>

<span class="token builtin">type</span>也是一个继承了<span class="token builtin">object</span>的类<span class="token punctuation">,</span><span class="token builtin">type</span>括号后面的三个参数是init的参数???

<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>
类默认是由<span class="token builtin">type</span>创建的<span class="token punctuation">,</span>那如何让一个类的创建改成其他东西呢? 元类!!
元类<span class="token punctuation">,</span>指定类由谁来创建!!通过metaclass<span class="token operator">=</span><span class="token punctuation">.</span><span class="token punctuation">.</span>来指定!
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br></div></div><hr></div></div> <!----> <div class="page-edit"><!----> <!----> <!----></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/247946/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">反射、内置方法</div></a> <a href="/pages/cf4ca9/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">异常处理</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/247946/" class="prev">反射、内置方法</a></span> <span class="next"><a href="/pages/cf4ca9/">异常处理</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/pages/8sk2b3/"><div>
            搜索相关
            <!----></div></a> <span class="date">03-22</span></dt></dl><dl><dd>02</dd> <dt><a href="/pages/2kn2p2/"><div>
            CURD
            <!----></div></a> <span class="date">03-20</span></dt></dl><dl><dd>03</dd> <dt><a href="/pages/1kn1m1/"><div>
            自动生成
            <!----></div></a> <span class="date">03-15</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="https://github.com/OnePieceDC" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://www.cnblogs.com/DC0307/" title="博客园" target="_blank" class="iconfont icon-bokeyuan"></a><a href="https://music.163.com/#/song?id=1854188649" title="听音乐" target="_blank" class="iconfont icon-erji"></a><a href="https://www.jianshu.com/u/5310eb537315" title="简书" target="_blank" class="iconfont icon-jianshu"></a><a href="mailto:1415806497@qq.com" title="QQ" target="_blank" class="iconfont icon-youjian"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2023-2024
    <span>DC | One Piece</span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <div class="body-bg" style="background:url() center center / cover no-repeat;opacity:0.5;"></div> <!----> <!----></div><div class="global-ui"><!----><div id="goTop" class="hide-cat" data-v-8ccb5928></div><div></div><canvas id="vuepress-canvas-cursor"></canvas><div></div><div></div></div></div>
    <script src="/assets/js/app.ac54adc6.js" defer></script><script src="/assets/js/4.7ddc74e3.js" defer></script><script src="/assets/js/1.a0c4ff1b.js" defer></script><script src="/assets/js/3.8b03321d.js" defer></script><script src="/assets/js/159.37d9c659.js" defer></script><script src="/assets/js/104.cae2d944.js" defer></script><script src="/assets/js/184.46eabf07.js" defer></script>
  </body>
</html>
