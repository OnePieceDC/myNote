(window.webpackJsonp=window.webpackJsonp||[]).push([[166],{1211:function(s,t,a){"use strict";a.r(t);var n=a(0),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h2",{attrs:{id:"网卡名字修改"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#网卡名字修改"}},[s._v("#")]),s._v(" 网卡名字修改")]),s._v(" "),n("blockquote",[n("p",[s._v("以太网协议规定上网的机器必须有一块网卡, 俗成以太网卡")])]),s._v(" "),n("p",[s._v("CentOS6及以前, 第一块、第二块网卡依次命名为 eth0、eth1... CentOS7网卡的命名为ens33.."),n("br"),s._v("\n除此之外,都有一块命名为lo虚拟的本地回环网卡.. 数据包到网卡了,没有往交换机走,原路返回,自己发给自己."),n("br"),s._v(" "),n("font",{attrs:{color:"gray"}},[s._v("127.0.0.1 相当于一台计算机即当客户端也当服务端,用于保证软件本身的开发没问题,"),n("strong",[s._v("排除网络的因素")])])],1),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v('"-- '),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".GRUB添加kernel参数 --"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v('"\n'),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/sysconfig/grub "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -- GRUB_CMDLINE_LINUX=\"rhgb quiet 'net.ifnames=0 biosdevname=0'\"")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v('"-- '),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(".加载到引导分区 --"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v('"\ngrub2-mkconfig '),n("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-o")]),s._v(" /boot/grub2/grub.cfg\n\n"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v('"-- '),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(".修改网卡配置文件名称以及配置文件里网卡的名称 --"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v('"\n'),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /etc/sysconfig/network-scripts/\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("mv")]),s._v(" ifcfg-ens33 ifcfg-eth0\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"s#ens33#eth0#g"')]),s._v(" ifcfg-eth0 "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -- 将ens33改为eth0")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 注意哦,前三步没有先后顺序,怎么样都可以")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v('"-- 重启系统生效 --'),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v('"\n'),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("reboot")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br")])]),n("p",[s._v("关机为vm虚拟机添加一张NAT模式的网卡.. 添加后开机 可以发现第二块网卡的默认名字是eth1")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v('"-- 临时激活网卡 --'),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v('"\n'),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ifconfig eth1 up")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ifconfig | grep eth[01]")]),s._v("\neth0: "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("flags")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("416")]),n("span",{pre:!0,attrs:{class:"token operator"}},[n("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("3")]),s._v("<")]),s._v("UP,BROADCAST,RUNNING,MULTICAST"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("  mtu "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1500")]),s._v("\neth1: "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("flags")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("416")]),n("span",{pre:!0,attrs:{class:"token operator"}},[n("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("3")]),s._v("<")]),s._v("UP,BROADCAST,RUNNING,MULTICAST"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("  mtu "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1500")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("hr"),s._v(" "),n("h2",{attrs:{id:"网络相关的一些命令"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#网络相关的一些命令"}},[s._v("#")]),s._v(" 网络相关的一些命令")]),s._v(" "),n("h3",{attrs:{id:"lspci"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#lspci"}},[s._v("#")]),s._v(" lspci")]),s._v(" "),n("blockquote",[n("p",[s._v("查看当前系统所连接的所有网卡")])]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  lspci | grep -i eth")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 可以看到,现目前有两块以太网协议的网卡")]),s._v("\n02:01.0 Ethernet controller: Intel Corporation 82545EM Gigabit Ethernet Controller "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Copper"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("rev 01"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n02:04.0 Ethernet controller: Intel Corporation 82545EM Gigabit Ethernet Controller "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Copper"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("rev 01"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("h3",{attrs:{id:"mii-tool"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#mii-tool"}},[s._v("#")]),s._v(" mii-tool")]),s._v(" "),n("blockquote",[n("p",[s._v("检测网卡是否已经连接好网线")])]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mii-tool eth1")]),s._v("\neth1: negotiated 1000baseT-FD flow-control, "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("link")]),s._v(" ok "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -- link ok代表该网卡是接了网线的")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("h3",{attrs:{id:"ping"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#ping"}},[s._v("#")]),s._v(" ping")]),s._v(" "),n("blockquote",[n("p",[s._v("用于测试两台主机网络是否连通")])]),s._v(" "),n("p",[n("code",[s._v("ping 目标IP地址")]),n("br"),s._v(" "),n("code",[s._v("ping -c 次数 目标IP地址")])]),s._v(" "),n("p",[n("strong",[s._v("原理:")]),s._v("  ping命令会基于ICMP协议(TCP/IP协议簇的一个子协议)给对方发送数据包,若对方回应,就代表连通了.")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /proc/sys/net/ipv4/icmp_echo_ignore_all\n设置此命令后,其他任何主机都ping不同本机"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(" 通常会在整个集群架构的网络环境部署完成后进行该设置"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("hr"),s._v(" "),n("h2",{attrs:{id:"ifconfig"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#ifconfig"}},[s._v("#")]),s._v(" ifconfig")]),s._v(" "),n("h3",{attrs:{id:"基本选项"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#基本选项"}},[s._v("#")]),s._v(" 基本选项")]),s._v(" "),n("p",[n("code",[s._v("ifconfig")]),s._v("                         -- 查看已经激活的网卡信息"),n("br"),s._v(" "),n("code",[s._v("ifconfig -a")]),s._v("                   -- 查看所有网卡信息(包括未激活的网卡)"),n("br"),s._v(" "),n("code",[s._v("ifconfig eth0")]),s._v("                  -- 查看单个网卡信息")]),s._v(" "),n("p",[n("code",[s._v("ifconfig eth1 up")]),s._v("         -- "),n("em",[s._v("临时")]),s._v(" 开启网卡"),n("br"),s._v(" "),n("code",[s._v("ifconfig eth1 down")]),s._v("         -- 关闭网卡 "),n("font",{attrs:{color:"gray"}},[s._v("实验时,别关闭eth0网卡,xshll远程连接是通过该网卡连接的..")])],1),s._v(" "),n("p",[n("code",[s._v("ifconfig eth1 192.168.1.122 netmask 255.255.255.0")]),s._v("   or  "),n("code",[s._v("ifconfig eth1 192.168.1.122/24")]),n("br"),s._v("\n                                                -- "),n("em",[s._v("临时")]),s._v(" 为网卡设定IP和掩码 (重启服务器失效)")]),s._v(" "),n("p",[n("code",[s._v("ifconfig eth0:1 192.168.0.2 netmask 255.255.255.0")]),n("br"),s._v("\n                                                -- "),n("em",[s._v("临时")]),s._v(" 为网卡配置子接口"),n("br"),s._v(" "),n("code",[s._v("ifconfig eth0:1 down")]),s._v("  or  "),n("code",[s._v("ifconfig eth0:1 del 192.168.0.2")]),n("br"),s._v("\n                                               -- 删除该子接口  "),n("font",{attrs:{color:"gray"}},[s._v("不必指定子网掩码")])],1),s._v(" "),n("p",[n("font",{attrs:{color:"brown"}},[n("strong",[s._v("注意哦!")])]),s._v("  通过ifconfig命令的配置都是 "),n("strong",[s._v("临时")]),s._v(" 配的!! 重启机器后就恢复如初了.."),n("br"),s._v(" "),n("font",{attrs:{color:"blue"}},[s._v("若想永久配置,需要修改 "),n("code",[s._v("/etc/sysconfig/network-scripts")]),s._v(" 路径下面的配置文件 ")])],1),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## -- 若要使用ifconfig命令,需要安装 yum install net-tools -y")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# rpm -qf `which ifconfig`")]),s._v("\nnet-tools-2.0-0.25.20131004git.el7.x86_64\n\n"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v('"\neth0:1 此网卡是不存在的,是没有mac地址的,可叫做虚拟网卡\n       相当于给eth0配了两个IP地址'),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(" 但流量走的都是同一张网卡\n真实环境下,若要给服务器配置两个IP地址,会使用两个网卡,两个网卡处于不同的网段并连接不同的交换机"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("这样靠谱些.\n"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v('"\n'),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ifconfig eth0:1 192.168.0.2/24")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ifconfig")]),s._v("\neth0: "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("flags")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("416")]),n("span",{pre:!0,attrs:{class:"token operator"}},[n("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("3")]),s._v("<")]),s._v("UP,BROADCAST,RUNNING,MULTICAST"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("  mtu "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1500")]),s._v("\n        inet "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".150.131  netmask "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("255.255")]),s._v(".255.0  broadcast "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".150.255\n\t\t\t\t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(". "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(". "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\neth0:1: "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("flags")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("416")]),n("span",{pre:!0,attrs:{class:"token operator"}},[n("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("3")]),s._v("<")]),s._v("UP,BROADCAST,RUNNING,MULTICAST"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("  mtu "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1500")]),s._v("\n        inet "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.2  netmask "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("255.255")]),s._v(".255.0  broadcast "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.255\n        ether 00:0c:29:90:30:3e  txqueuelen "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Ethernet"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(". "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(". "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(". \n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br")])]),n("h3",{attrs:{id:"命令结果解析"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#命令结果解析"}},[s._v("#")]),s._v(" 命令结果解析")]),s._v(" "),n("p",[n("code",[s._v("ifconfig eth0")])]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v('" 第一行\n从flags标记可知该接口已启用,支持广播、组播. MTU最大传输单元:1500字节\nflags参数:\n    UP:表示“接口已启用”/网卡已经激活\n    BROADCAST:表示该网卡支持广播,能收到广播包\n    RUNNING:表示网卡已连接网线,该网线能正常工作\n    MULTICAST:表示该网卡支持多播'),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(" \n            多播/组播简单来说就是将多台机器放到一个组里,发包的时候,只有这个组里的机器能收到\n\t\tpromisc:繁杂模式,简单来说,这台机器所有数据包都可以收到\n\t\t        我们知道局域网里广播的数据包,计算机收到后发现目标主机不是自己,会将这个包丢掉\n\t\t        若该计算机开启了繁杂模式,就不会将此广播包丢掉.抓包.\n\t\t        繁杂模式通常用于kali等渗透测试,安全方面的配置"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("\n\t\t        感兴趣可以参考:https://www.cnblogs.com/linhaifeng/articles/13949611.html\n\t\t\t\t\t\t\n"),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ifconfig")]),s._v(" eth0 promisc"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("   "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -- 开启繁杂模式")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ifconfig")]),s._v(" eth0 "),n("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-promisc")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -- 关闭繁杂模式")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v('"\neth0: '),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("flags")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("416")]),n("span",{pre:!0,attrs:{class:"token operator"}},[n("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("3")]),s._v("<")]),s._v("UP,BROADCAST,RUNNING,MULTICAST"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("  mtu "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1500")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -- 网卡的IPv4地址、子网掩码、本网段的广播地址")]),s._v("\n        inet "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".150.131  netmask "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("255.255")]),s._v(".255.0  broadcast "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".150.255\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -- IPv6地址、掩码长度、作用域,link表示仅该接口有效    ")]),s._v("\n        inet6 fe80::20c:29ff:fe90:303e  prefixlen "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v("  scopeid 0x2"),n("span",{pre:!0,attrs:{class:"token operator"}},[n("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("0")]),s._v("<")]),s._v("link"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -- 以太网卡的MAC地址、以太网卡最大传输队列长度,接口类型为Ethernet")]),s._v("\n        ether 00:0c:29:90:30:3e  txqueuelen "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Ethernet"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v('" R接收 T发送'),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v('"\n        '),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -- 从该主机开机那一刻到现在,此接口/网卡累积接收的报文个数,这些包总共有多大")]),s._v("\n        RX packets "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3942")]),s._v("  bytes "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("764610")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("746.6")]),s._v(" KiB"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -- 累积接收报文错误数、丢弃数、溢出数(很重要!!!)、冲突的帧数")]),s._v("\n        RX errors "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  dropped "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  overruns "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  frame "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -- 从该主机开机那一刻到现在,此接口/网卡累积发送的报文个数,总字节数")]),s._v("\n        TX packets "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("842")]),s._v("  bytes "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("130860")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.7")]),s._v(" KiB"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -- 累积发送报文错误数、丢弃数、溢出数、载荷数(发生carrier错误而丢失的数据包数)、冲突数 ")]),s._v("\n        TX errors "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  dropped "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" overruns "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  carrier "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  collisions "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br")])]),n("hr"),s._v(" "),n("h2",{attrs:{id:"万兆网卡的mtu"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#万兆网卡的mtu"}},[s._v("#")]),s._v(" 万兆网卡的MTU")]),s._v(" "),n("blockquote",[n("p",[s._v("千兆  1000Mb/s  管理网络-- MTU: 1500\t万兆 10000Mb/s  集群化作业 -- MTU: 9000")])]),s._v(" "),n("h3",{attrs:{id:"千兆万兆区别"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#千兆万兆区别"}},[s._v("#")]),s._v(" 千兆万兆区别")]),s._v(" "),n("p",[s._v("现目前我们用的网卡是双绞线接个水晶头连接的"),n("strong",[s._v("千兆网卡")]),s._v(", "),n("strong",[s._v("主要用于管理网络")]),s._v("; 保持MTU默认值1500kb就行..")]),s._v(" "),n("p",[s._v("若涉及到集群化作业, 比如用集群做存储..  通常就需要用到"),n("strong",[s._v("万兆网卡")]),s._v("..\tMTU值应该设置为9000kb.."),n("br"),s._v("\n万兆(10G)网卡需要搭配光纤模块、光纤、万兆交换机(几十万RMB,很贵)使用 Hhhh"),n("br"),s._v(" "),n("font",{attrs:{color:"gray"}},[s._v("像阿里云提供给中小型公司的虚机就是构建在一套集群之上, vm之间的通信本来就比物理主机慢, 为了尽可能减少网络IO, 提高网络传输效率, 阿里云在硬件方面用的就是万兆网卡.... ")]),n("br"),s._v(" "),n("font",{attrs:{color:"gray",size:"2"}},[s._v("小声bibi,若是用真机做集群化架构,需要进行网卡绑定, 涉及到team技术、lacp协议等.. (集群相关的都是高阶知识,我暂且只会学基础,等我以后开发转运维,再捣腾捣腾, 哈哈哈哈哈)")])],1),s._v(" "),n("h3",{attrs:{id:"永久配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#永久配置"}},[s._v("#")]),s._v(" 永久配置")]),s._v(" "),n("p",[n("code",[s._v("ifconfig eth0 mtu 9000")]),s._v("  临时配置MTU值,重启服务器就失效了.. 那如何永久配置呢？")]),s._v(" "),n("p",[n("font",{attrs:{color:"blue"}},[n("strong",[s._v("解决方案")]),s._v(": 在 "),n("code",[s._v("/etc/rc.local")]),s._v("文件里添加 修改MTU值的命令...")]),n("br"),s._v("\n原理: /etc/rc.local文件在计算机开机的时候,它会自动运行, 所以一开机就需要运行的命令都可写到此文件里")],1),s._v(" "),n("p",[n("strong",[s._v("注意:")]),s._v(" 记得执行命令 "),n("code",[s._v("chmod +x /etc/rc.d/rc.local")])]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## -- 可以看到/etc/rc.local的文件类型是l 代表软链接")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## -- 源文件是 /etc/rc.d/rc.local")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ll /etc/rc.local")]),s._v("\nlrwxrwxrwx. "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v("月  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),s._v(":42 /etc/rc.local -"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" rc.d/rc.local\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## -- /etc/rc.d/rc.local文件是没有可执行权限的 意味着除了root用户的其他用户都不能执行它")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## -- 所以需要赋予其他用户对此文件的可执行权限 chmod +x /etc/rc.d/rc.local")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ll /etc/rc.d/rc.local")]),s._v("\n-rw-r--r--. "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("473")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("月  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),s._v(" /etc/rc.d/rc.local\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# chmod +x /etc/rc.d/rc.local")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 在里面添加内容,ifconfig eth0 mtu 9000")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim /etc/rc.local")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br")])]),n("hr"),s._v(" "),n("h2",{attrs:{id:"解决溢出数严重的问题"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#解决溢出数严重的问题"}},[s._v("#")]),s._v(" 解决溢出数严重的问题")]),s._v(" "),n("blockquote",[n("p",[s._v("ifconfig结果中第6行的 "),n("font",{attrs:{color:"brown"}},[n("strong",[s._v("overruns")])]),s._v(" 溢出数是非常重要的指标!!!")],1),s._v(" "),n("p",[n("code",[s._v("ethtool -g eth0")]),n("br"),s._v(" "),n("code",[s._v("ethtool -G eth0 rx 2048")]),n("br"),s._v(" "),n("code",[s._v("ethtool -G eth0 tx 2048")])])]),s._v(" "),n("h3",{attrs:{id:"储备知识"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#储备知识"}},[s._v("#")]),s._v(" 储备知识")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token operator"}},[n("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("1")]),s._v(">")]),s._v(" 全｜半双工通信\n   全双工是指交换机在发送数据的同时也能够接收数据,两者同步进行,\n   这好比我们平时打电话一样,说话的同时也能够听到对方的声音"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(". 半双工好比是对讲机"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n   目前网卡一般都应该采用全双工模式,全双工的好处在于迟延小、冲突少、速度快.\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[n("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("2")]),s._v(">")]),s._v(" 数据链路层三大功能之一差错监测: 循环冗余检验码CRC\n   步骤关键字: 多项式 异或操作"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("异为1 同为0"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n   假设有数据1101011011需要传输, 采用CRC的生成多项式为P"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("X"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("X^4+X+1, 请计算添加了CRC校验码之后的数据.\n   解: 多项式位串为 --"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10011")]),s._v(", 模二除法得到余数1110, 所以得到结果11010110111110\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[n("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("3")]),s._v(">")]),s._v(" 网卡工作原理:\n   先从OSI七层协议视角,回顾下发包:\n      应用层产生一个数据,依次往下发,包装TCP/UDP的头 -- 数据段"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("包装网络IP的头 -- 数据报"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n      包装以太网的头 -- 数据帧frame"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" 接着转成二进制位通过网线传输给对方.\n   网卡发包:\n      "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(". ip数据报+14个字节的mac头/以太网头变成数据帧frame\n      "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(". frame被拷贝到网卡芯片内部的缓冲区,由网卡处理\n      "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(". 网卡芯片为frame添加头部同步信息和CRC校验"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("此时才是真正可以发送的包"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(",然后发送该包\n   网卡收包:\n      "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(". 网络包到达网卡,网卡先检查数据包的CRC校验,保证其完整性和正确性,\n         若不完整会丢弃"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("丢弃不可怕,TCP协议会重新发包的"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("若完整会去掉它的头得到frame\n      "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(". 网卡将frame拷贝到网卡内部的FIFO"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("frist "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" frist out先进先出"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("缓冲区\n      "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(". 网卡驱动程序会产生硬件中断,提醒OS干活,OS产生软件中断,将frame从网卡拷贝到内存中\n\t\t\t\t 然后一层层的拆包\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br")])]),n("h3",{attrs:{id:"解决过程"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#解决过程"}},[s._v("#")]),s._v(" 解决过程")]),s._v(" "),n("p",[s._v("正常情况, 网卡一边接收数据包放到网卡缓冲区中,OS一边从中取出数据包到内存中, 网卡缓冲区不会有溢出."),n("br"),s._v("\n若遇到高并发的情况,流量激增,网卡缓冲区满了,往网卡缓冲区里挤的网络包速度远大于OS取的速度..."),n("br"),s._v("\n新的网络包进不了缓冲区,就会出现溢出.. overruns值升高.."),n("br"),s._v("\n这会导致客户端就访问不进来了,用户等待时间较长,体验很差!!")]),s._v(" "),n("p",[n("font",{attrs:{color:"purple"}},[n("strong",[s._v("排除网络的干扰")])])],1),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v('" step1:查看是否连接网线 '),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v('"\n'),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mii-tool eth0")]),s._v("\neth0: negotiated 1000baseT-FD flow-control, "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("link")]),s._v(" ok\n"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v('" step2:查看工作模式是否正常 '),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v('"\n'),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ethtool eth0 | egrep 'Speed|Duplex'")]),s._v("\n\tSpeed: 1000Mb/s\t\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## -- 千兆网卡")]),s._v("\n\tDuplex: Full\t\t\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## -- Full 代表全双工 half的话代表半双工")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v('" step3:查看网卡与MTU是否匹配 '),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v('"\n'),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ifconfig eth0 | grep mtu")]),s._v("\neth0: "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("flags")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("416")]),n("span",{pre:!0,attrs:{class:"token operator"}},[n("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("3")]),s._v("<")]),s._v("UP,BROADCAST,RUNNING,MULTICAST"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("  mtu "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1500")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v('" step4:查看CRC校验是否正常 '),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v('"\n'),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ethtool -S eth0 | grep crc ")]),s._v("\n     rx_crc_errors: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## -- crc错误值大通常是因为服务器外部的网络环境有问题导致的")]),s._v("\n     \nSpeed、Duplex、CRC之类的都没问题,基本可以排除物理层面的干扰\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br")])]),n("p",[n("font",{attrs:{color:"purple"}},[n("strong",[s._v("网络没问题, 那么问题就出现在服务器上了")])])],1),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("【监测overruns值】\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("do")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ifconfig")]),s._v(" eth0 "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" RX "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" overruns"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.5")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("clear")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("done")]),s._v("\n    监测的时候,某一时刻,overruns达到了上百,又降了下来"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("TCP重新发包了"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(",不用过于担心\n    若值一直一直在增长,意味着在一直累积溢出的包,用户一直访问不进来,体验极差"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("\n\n解决方案:\n    低配版 -- 单台服务器,调大缓冲区"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("\n             缓冲区最高4096,不够了咋整？一个网卡的性能有极限的,用多个网卡 -- 垂直扩展\n    高配版 --加机子,集群化作业,多台机器抗压力,流量就被分散了. -- 水平扩展"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("\n    So"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("开发不能鄙视运维,开发的软件再好,最多支持几千并发,但运维集群化作业能把软件的并发性能放大几十上百倍"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ethtool -g eth0   # -- 查看")]),s._v("\nRing parameters "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" eth0:\nPre-set maximums:\nRX:\t\t"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4096")]),s._v("\t\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -- 接收的缓冲区大小")]),s._v("\nRX Mini:\t"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\nRX Jumbo:\t"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\nTX:\t\t"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4096")]),s._v("\t\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -- 传输的缓冲区大小")]),s._v("\nCurrent hardware settings: "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -- 当前硬件的设置")]),s._v("\nRX:\t\t"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("256")]),s._v("\nRX Mini:\t"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\nRX Jumbo:\t"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\nTX:\t\t"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("256")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ethtool")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-G")]),s._v(" eth0 rx "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2048")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置调大")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ethtool")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-G")]),s._v(" eth0 tx "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2048")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置调大")]),s._v("\nPs:还可以想着将网卡降速"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("这想法挺奇怪的Hhhh\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br")])]),n("hr"),s._v(" "),n("h2",{attrs:{id:"网卡相关配置文件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#网卡相关配置文件"}},[s._v("#")]),s._v(" 网卡相关配置文件")]),s._v(" "),n("h3",{attrs:{id:"解析-ifcfg-eth0文件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#解析-ifcfg-eth0文件"}},[s._v("#")]),s._v(" 解析 ifcfg-eth0文件")]),s._v(" "),n("blockquote",[n("p",[s._v("vim /etc/sysconfig/network-scripts/ifcfg-eth0")])]),s._v(" "),n("p",[n("code",[s._v("systemctl restart network")]),s._v("  重启网络服务会去加载这些配置文件")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("▲ 必要字段\n"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v('"\nBOOTPROTO若设置为dchp,表明动态获取IP地址,在租约时间内IP地址不会变'),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("到期了后重新分配IP"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("\nIPADDR、NETMASK、GATEWAY、DNS1、DNS2这几个字段只有在BOOTPROTO的值为static或none时才会生效"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("\nIPADDR、NETMASK保证了局域网里的通信,GATEWAY、DNS1、DNS2保证了与外网的通信.\n    IPADDR的配置要注意,vm网卡若用的桥接模式要防止占用其他设备的IP,若用的NAT模式没关系.\n    DNS的地址最多配置3个,配置后会写入/etc/resolv.conf文件中\n    GATEWAY的值可以通过"),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),s._v("route "),n("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("命令查看路由器上配置的网关地址"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n企业里通常是集群化作业,so,BOOTPROTO的值都会是static"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("\nPs:可以先DHCP动态获取IP,然后在静态配置时,去查看/etc/resolv.conf文件里面已设置的DNS"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("nameserver字段的值"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\t 通常是8.8.8.8 和 网关的地址\n\nNM_CONTROLLED可以不添加,前提是执行命令\n   systemctl stop NetworkManger\tsystemctl disable NetworkManger\n"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v('"\n'),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("TYPE")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Ethernet"')]),s._v("             "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## -- Ethernet类型表明是以太网卡！")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("BOOTPROTO")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"static"')]),s._v("          "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## -- none 或者 static 都可以手动指定静态IP")]),s._v("\nIPADDR "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.100      "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## -- IP地址")]),s._v("\nNETMASK "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("255.255")]),s._v(".255.0     "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## -- IP掩码地址")]),s._v("\nGATEWAY "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.254     "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## -- 网关地址")]),s._v("\nDNS1 "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.254        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## -- 第一个DNS地址")]),s._v("\nDNS2 "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8.8")]),s._v(".8.8              "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## -- 第二个DNS地址")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("NAME")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"eth0"')]),s._v("                 "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## -- 名字")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("DEVICE")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"eth0"')]),s._v("               "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## -- 设备名")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ONBOOT")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"yes"')]),s._v("                "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## -- 代表网卡是否跟着NETWORK网络服务的启动而激活")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("NM_CONTROLLED")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"no"')]),s._v("          "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## -- 表明网卡不受NetworkManager服务的影响")]),s._v("\n\n\n\n▲ 其他不必要字段\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## -- 配置网卡路由文件的时候需要进行此字段的设置 表示DHCP的路由配置不生效!!")]),s._v("\nDEFROUTE "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"no"')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## -- 配置网卡路由文件的时候需要进行此字段的设置 值为no表示DHCP设置的路由允许被覆盖!!")]),s._v("\nPEERROUTES "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"no"')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## -- 网卡的MAC地址信息,centos7里没有,centos6里有")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("HWADDR")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(":da:e9:eb:a9:61  \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## -- 是否允许普通用户启动或者停止该网卡")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("USERCTL")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("no\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## -- 是否在该网卡上启动IPV6的功能")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("IPV6INIT")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("no 　　　　　　　\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## --是否允许网卡在启动时向DHCP服务器查询DNS信息,该字段了解即可")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置为yes时,此文件设置的DNS将覆盖/etc/resolv.conf")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# BOOTPROTO若设置为dchp(配置文件中的DNS1是不生效的),则默认为yes,dhcp的dns会覆盖/etc/resolv.conf")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("PEERDNS")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("yes 　　　　　　　　 \t\t\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## -- 若冲突,可以直接删除")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("UUID")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"3919d7da-ef03-40a0-814e-d78c047e1f87"')]),s._v(" \n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br")])]),n("h3",{attrs:{id:"配置ifcfg-eth1文件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#配置ifcfg-eth1文件"}},[s._v("#")]),s._v(" 配置ifcfg-eth1文件")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -- 可以发现只有网卡eth0的配置文件,虽然新增了eth1网卡,但系统并没有自动为它生成配置文件,所以eth1是临时的")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ls /etc/sysconfig/network-scripts | grep ifcfg-eth")]),s._v("\nifcfg-eth0\n\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /etc/sysconfig/network-scripts/\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" ifcfg-eth0 ifcfg-eth1\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" ifcfg-eth1\n\n"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v('"\n若不想通过172.16.150.100这个IP地址访问外网就没必要指定GATEWAY网关等字段信息\n真正的生产环境里,也不会给每块网卡配置网关,一块网卡配置了就行了\nSo,我们可以将eth0网卡用于外网通信,eth1网卡用于内网通信'),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v('"\n'),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("TYPE")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Ethernet"')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("BOOTPROTO")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"static"')]),s._v("\nIPADDR "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".150.100\nNETMASK "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("255.255")]),s._v(".255.0\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#GATEWAY = 172.16.150.2")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#DNS1 = 172.16.150.2 ")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#DNS2 = 8.8.8.8")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("NAME")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"eth1"')]),s._v("\t\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("DEVICE")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"eth1"')]),s._v("\t\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ONBOOT")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"yes"')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("NM_CONTROLLED")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"no"')]),s._v(" \n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br")])]),n("hr"),s._v(" "),n("h2",{attrs:{id:"dns相关配置文件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#dns相关配置文件"}},[s._v("#")]),s._v(" DNS相关配置文件")]),s._v(" "),n("p",[n("code",[s._v("/etc/resolv.conf")]),s._v("       DNS解析文件, 可设置DNS指向,最多3个"),n("br"),s._v(" "),n("code",[s._v("/etc/hosts")]),s._v("                     本地名称解析文件,  "),n("font",{attrs:{color:"blue"}},[n("strong",[s._v("优先于DNS解析文件")])])],1),s._v(" "),n("p",[n("font",{attrs:{color:"brown"}},[s._v("DNS查询顺序 ")]),n("br"),s._v("\n     浏览器DNS缓存 --\x3e 本地系统DNS缓存 --\x3e 本地计算机HOSTS文件 --\x3e ISP DNS缓存 --\x3e 递归or迭代搜索")],1),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("▲ 一个小实验,修改配置文件/etc/hosts 在末尾添加1.1.1.1 www.baidu.com\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ping www.baidu.com")]),s._v("\nPING www.a.shifen.com "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("14.215")]),s._v(".177.39"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("56")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("84")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" bytes of data.\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(". "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ping www.baidu.com")]),s._v("\nPING www.baidu.com "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.1")]),s._v(".1.1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("56")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("84")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" bytes of data.  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -- 百度域名被解析成了1.1.1.1")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(". "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n\n某公司用A B C D E"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("HI"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("等20台机器搭建了一个集群"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" A要跟其它机器通信,需要知道目标主机的IP地址"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("\n并且在相应的配置文件中配置目标主机的IP"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("\n这样做不好,一方面IP地址难记"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("另一方面主机的IP地址日后可能会变"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("一变,20台主机重新修改配置文件很麻烦"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("\n\n\n最规范的做法:\n    在公司内部自己搭建个DNS服务"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("会先给这20台机器每台机器起个名字,也就是域名,每个域名对应一个IP地址记录在DNS服务器中"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),s._v("hostnamectl set-hostname egon.xxx.com"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("永久设置主机名.\n    这样一来,配置文件中只需要使用域名即可,当A主机与集群中其他机器通信时,会去自己搭建的DNS服务器上查一查对应的域名解析"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(" 当某个主机的IP地址变了,集群中20级台机器的配置文件都不需要动,改DNS服务器上的某条解析记录即可"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("\n因为是内部搭建的DNS服务器,域名还不用注册"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(" 也便于集群中增加主机时的操作"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("\n    搭建个DNS服务不仅可以增加可扩展性,DNS服务器还可以做负载均衡等"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("\n\n偷懒的做法:\n    不搭建DNS服务,在一台机器上将20台机器的解析记录写入/etc/hosts文件,再给每台机器都发送一份,但意味着每次改动,每台机器都要同步一下"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("有一些自动化管理工具,改动以后可自动批量的每台机器都传一份"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br")])]),n("hr"),s._v(" "),n("h2",{attrs:{id:"etc-services"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#etc-services"}},[s._v("#")]),s._v(" /etc/services")]),s._v(" "),n("blockquote",[n("p",[s._v("记录了每一个软件跟它对应的端口号以及协议")])]),s._v(" "),n("p",[s._v("常见的服务端对应的端口号")]),s._v(" "),n("table",[n("thead",[n("tr",[n("th",[s._v("服务端")]),s._v(" "),n("th",[s._v("端口号")])])]),s._v(" "),n("tbody",[n("tr",[n("td",[s._v("dhcp")]),s._v(" "),n("td",[s._v("67")])]),s._v(" "),n("tr",[n("td",[s._v("dns")]),s._v(" "),n("td",[s._v("53")])]),s._v(" "),n("tr",[n("td",[s._v("mysql")]),s._v(" "),n("td",[s._v("3306")])]),s._v(" "),n("tr",[n("td",[s._v("ssh")]),s._v(" "),n("td",[s._v("22")])])])]),s._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[s._v("grep "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'^ftp\\|^ssh'")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etc"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("services \n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("hr"),s._v(" "),n("h2",{attrs:{id:"交换与路由"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#交换与路由"}},[s._v("#")]),s._v(" 交换与路由")]),s._v(" "),n("p",[n("strong",[s._v("交换:")]),s._v(" 指同网络访问."),n("br"),s._v("\n        多台主机处于同一个LAN/交换机/局域网中,配置同网段的不同ip就可以直接通信,二层网络本质是基于mac地址的通信,不需要进行转发,这里默认交换机未划分过vlan("),n("font",{attrs:{color:"gray"}},[s._v("即不讨论三层交换")]),s._v(")..")],1),s._v(" "),n("p",[n("strong",[s._v("路由:")]),s._v(" 指跨网络访问的路径选择."),n("br"),s._v("\n        若要与外网通信,就需要转发/路由.. 路由器上配置的有网关.. "),n("strong",[s._v("网关有个特点, 至少得有两个地址, 对内得有一个局域网地址, 对外得有一个外网地址..")])]),s._v(" "),n("hr"),s._v(" "),n("h2",{attrs:{id:"linux主机充当路由"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#linux主机充当路由"}},[s._v("#")]),s._v(" Linux主机充当路由")]),s._v(" "),n("h3",{attrs:{id:"三大前提"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#三大前提"}},[s._v("#")]),s._v(" 三大前提")]),s._v(" "),n("p",[s._v("将一台linux主机A当作路由的"),n("font",{attrs:{color:"brown"}},[s._v("三大前提")]),s._v(":"),n("br"),s._v("\n1> 主机A至少得有两块网卡分别连接不同的网段;"),n("br"),s._v("\n     (A主机连接的不同网段里的主机都必须将网关指向主机A)"),n("br"),s._v("\n2> 主机A开启路由转发功能(默认是关闭的); "),n("code",[s._v("echo 1 > /proc/sys/net/ipv4/ip_forward")]),s._v(" 临时打开."),n("br"),s._v("\n3> 在该linux主机上添加正确的路由规则/策略..")],1),s._v(" "),n("h3",{attrs:{id:"转发流程"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#转发流程"}},[s._v("#")]),s._v(" 转发流程")]),s._v(" "),n("p",[s._v("A主机的linux OS左手网卡1,右手网卡2,连接两个不同的网段..(B主机处于网段1,C主机处于网段2)"),n("br"),s._v("\nB、C处于不同网段,是不能直接通信的, A可以作为BC之间互通的桥梁..  "),n("font",{attrs:{color:"gray"}},[s._v("B <==> A <==> C")])],1),s._v(" "),n("p",[s._v("主机B发送了个数据包,会从网卡1进来的, A主机的linux内核会先判断此包是不是给本机的, 不是的话就正常的丢掉..")]),s._v(" "),n("p",[s._v("若是给本机的:\t"),n("br"),s._v("\n     情况1: 该数据包就是明确的给本机上层的应用程序的;"),n("br"),s._v(" "),n("font",{attrs:{color:"blue"}},[s._v(" 数据包流向: 网卡1 - 操作系统(A主机的 "),n("em",[s._v("内核空间")]),s._v(" ) - 应用程序(A主机的 "),n("em",[s._v("用户空间")]),s._v(") ")]),n("br"),s._v("\n                情况1> 应用程序处理完数据包就结束了,不需要返回数据包;"),n("br"),s._v("\n                情况2> 应用程序处理完数据包产生了新的结果,新的数据包从A的用户空间丢到了A的内核空间.."),n("br"),s._v("\n                                内核再判断新的数据包从哪个网卡发出去..."),n("br"),s._v("\n                                新数据包的目标主机是C就从网卡2出去;是B就从网卡1原路返回..."),n("br"),s._v("\n     情况2: 将本机的OS Linux当作路由器使用,数据包不会进入A主机的用户空间,数据包会从网卡2出去,转发给C;")],1),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -- 可以看到 linux主机的路由转发功能默认是关闭的 0关闭 1开启")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat /proc/sys/net/ipv4/ip_forward")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("hr"),s._v(" "),n("h2",{attrs:{id:"网关-路由"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#网关-路由"}},[s._v("#")]),s._v(" 网关/路由")]),s._v(" "),n("blockquote",[n("p",[n("strong",[s._v("route命令")])])]),s._v(" "),n("h3",{attrs:{id:"分类、优先级"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#分类、优先级"}},[s._v("#")]),s._v(" 分类、优先级")]),s._v(" "),n("p",[s._v("Linux上的路由分为3种:"),n("br"),s._v("\n     1> "),n("strong",[s._v("主机路由")]),s._v(": 明确指定了到达某台主机应该怎么走.. 主机路由也叫做静态路由 "),n("font",{attrs:{color:"gray"}},[s._v("掩码位32位 ")]),n("br"),s._v("\n     2> "),n("strong",[s._v("网络路由")]),s._v(": 指明到某类网络怎么走, 精确到了某个网段.. "),n("font",{attrs:{color:"gray"}},[s._v("掩码位小于32位")]),n("br"),s._v("\n     3> "),n("strong",[s._v("默认路由")]),s._v(": 不走主机路由的和网络路由的, 全部都走默认路由.  "),n("font",{attrs:{color:"gray"}},[s._v("掩码全为0 ")]),n("br"),s._v("\n                        操作系统上设置的默认路由一般称为网关..")],1),s._v(" "),n("p",[n("font",{attrs:{color:"gray"}},[n("strong",[s._v("回顾下,")]),s._v(" 子网掩码与IP地址做与运算可以算出网络地址(同1为1,否则为0).. 一个B类的IP地址,子网掩码至少是8位,IP地址的网络位向主机位借位(借的叫做子网位)来划分子网..")]),n("br"),s._v("\n子网掩码越短意味着划分的子网数越少, 每个子网的范围(每个子网中的主机个数)就越大; 反之则相反!!!")],1),s._v(" "),n("p",[n("font",{attrs:{color:"brown"}},[n("strong",[s._v("优先级:(根据精确度判断的)")]),s._v(" 主机路由 > 网络路由 > 默认路由 ")]),n("br"),s._v(" "),n("font",{attrs:{color:"gray"}},[s._v("若路由条目的掩码长度相同, 则比较节点之间的管理距离(比如metric), 管理距离短的生效")])],1),s._v(" "),n("p",[s._v("举个栗子, "),n("code",[s._v("1.1.1.10/32")]),s._v(" 32位的掩码意味着IP地址的前32位都是网络号,没有剩下主机位,不能借位,该IP也就不能划分任何的子网.. 1.1.1.10网段没有任何其他机器... 只有它自己.. 精确到了一台机器!!!")]),s._v(" "),n("hr"),s._v(" "),n("h3",{attrs:{id:"查看路由表信息"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#查看路由表信息"}},[s._v("#")]),s._v(" 查看路由表信息")]),s._v(" "),n("blockquote",[n("p",[n("code",[s._v("route -n")]),s._v("  \t-n选项表示不解析主机名")])]),s._v(" "),n("p",[s._v("Destination: 去往目标,目的地"),n("br"),s._v("\n        0.0.0.0/0 代表所有的IP地址都是目的地"),n("br"),s._v("\nGateway: 下一跳(下一步交给谁做转发)"),n("br"),s._v("\n        0.0.0.0表明没有下一跳,通过Iface指定的网卡往局域网里一丢."),n("br"),s._v("\n谁收到算谁的,收到的那台主机不会将该数据包做下一跳的转发."),n("br"),s._v("\n        172.16.150.2 指定了网关IP 表明网关会安排下一跳"),n("br"),s._v("\n        169.254.0.0   是保留网关"),n("br"),s._v("\nGenmask: 子网掩码"),n("br"),s._v("\nFlags: 标志位"),n("br"),s._v("\n        U 此路由规则正在生效"),n("br"),s._v("\n        G 网关"),n("br"),s._v("\n        H 主机路由"),n("br"),s._v("\nMetric: 总共经历多少跳"),n("br"),s._v("\nIface: 从哪个网卡出去")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## -- 这些信息是从DHCP里获取到的,若不想要DHCP的,想自己配置的生效,则需要修改配置文件！")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# route -n")]),s._v("\nKernel IP routing table "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -- 内核IP路由表")]),s._v("\nDestination     Gateway         Genmask         Flags Metric Ref    Use Iface\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0         "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".150.2    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0         UG    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" eth0\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("169.254")]),s._v(".0.0     "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0         "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("255.255")]),s._v(".0.0     U     "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1002")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" eth0 "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# --保留网关,了解")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".150.0    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0         "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("255.255")]),s._v(".255.0   U     "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" eth0\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".122.0   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0         "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("255.255")]),s._v(".255.0   U     "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" virbr0\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("hr"),s._v(" "),n("h3",{attrs:{id:"添加-删除路由"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#添加-删除路由"}},[s._v("#")]),s._v(" 添加/删除路由")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("eth0网卡 -- inet "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".150.131  netmask "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("255.255")]),s._v(".255.0\n系统会默认添加一条网络路由"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),s._v("route "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-net")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.0/24 dev eth0"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("\n\n为何只要添加一个ip地址,就会默认增加一个该ip地址的网段路由？\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("p",[s._v("1> "),n("strong",[s._v("添加/删除主机路由,精确到一个IP地址")])]),s._v(" "),n("p",[n("code",[s._v("route add -host 1.1.1.10/32 dev eth0")]),s._v("                      --  不需要转发则指定dev"),n("br"),s._v(" "),n("code",[s._v("route add -host 1.1.1.11/32 gw 172.16.150.2")]),s._v("           --  若需要转发,指定gw\n"),n("code",[s._v("route del -host 1.1.1.10/32")])]),s._v(" "),n("p",[s._v("2> "),n("strong",[s._v("添加/删除网络路由")])]),s._v(" "),n("p",[n("code",[s._v("route add -net 2.2.2.0/24 dev eth0")]),n("br"),s._v(" "),n("code",[s._v("route del -net 2.2.2.0/24")])]),s._v(" "),n("p",[s._v("3> "),n("strong",[s._v("删除/添加默认路由")])]),s._v(" "),n("p",[n("code",[s._v("route del default")]),n("br"),s._v(" "),n("code",[s._v("route add -net 0.0.0.0/0 gw 172.16.150.2")]),s._v(" 或者 "),n("code",[s._v("route add default gw 172.16.150.2")])]),s._v(" "),n("p",[n("font",{attrs:{color:"blue"}},[s._v("systemctl restart network 重启网络配置后, 上述的设置失效")])],1),s._v(" "),n("hr"),s._v(" "),n("h3",{attrs:{id:"配置永久路由"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#配置永久路由"}},[s._v("#")]),s._v(" 配置永久路由")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/syconfig/network-scripts/route-eth0\n\n注意:\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[n("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("1")]),s._v(">")]),s._v(" 新增一个路由配置文件,前提需要一个相对应的名为ifcfg-eth0的网卡配置文件 \n       名字要对应上哦"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" route-ethX, 要从哪个接口出去X就是几\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[n("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("2")]),s._v(">")]),s._v(" 在文件中配置永久默认路由, 则必须保证所有使用了DHCP服务的网卡配置文件ifcfg-ethX中的\n\t\t   DEFROUTE指令设置为"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"no"')]),s._v(",表明DHCP的路由配置不生效"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\t\t   PEERROUTES指令设置为"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"no"')]),s._v(",表示DHCP设置的路由允许被覆盖.\n\n配置规则:每一行一个路由条目, 先是要到达的目标, 然后是via关键字,最后是下一跳地址.\n       要求下一跳必须能到达,且一般都和ethX同网段"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br")])]),n("p",[s._v("例如eth0网卡的IP地址是192.168.10.123,,要通过网卡eth0出去到达10.0.0.10,,"),n("strong",[s._v("那么下一跳的地址要和eth0的地址在同网段")]),s._v("..如192.168.10.222 ..."),n("br"),s._v(" "),n("font",{attrs:{color:"purple"}},[s._v("看计算机网络之网络层.md 中 网络层整个流程 这部分的内容, 注意图中的路由器1的IP 192.168.100.4 和路由器2的IP 192.168.100.5 !!")])],1),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -- 默认路由")]),s._v("\ndefault     via "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".100.1 dev eth0\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0/0   via "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".100.1 dev eth0\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -- 网段路由")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".10.0/24   via "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".100.1 dev eth0\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -- 主机路由,在centos7中 dev得指定")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".100.52/32 via "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".100.33 dev eth0\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br")])]),n("p",[s._v("配置完后, 重启network服务即可立即生效...")]),s._v(" "),n("hr"),s._v(" "),n("h2",{attrs:{id:"路由实验"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#路由实验"}},[s._v("#")]),s._v(" 路由实验")]),s._v(" "),n("p",[n("img",{attrs:{src:a(507),alt:""}})]),s._v(" "),n("p",[s._v("略.. 实验详见"),n("code",[s._v("https://zhuanlan.zhihu.com/p/337256553")])]),s._v(" "),n("p",[n("font",{attrs:{color:"gray"}},[s._v("让我偷偷懒,主要是开发真就用不到... 路由的配置又很繁琐.. 有点累, 理论方面是整理规整了的！！！ ")])],1),s._v(" "),n("hr")])}),[],!1,null,null,null);t.default=e.exports},507:function(s,t,a){s.exports=a.p+"assets/img/14.261f4596.jpeg"}}]);