(window.webpackJsonp=window.webpackJsonp||[]).push([[22],{1324:function(s,t,a){"use strict";a.r(t);var n=a(0),r=Object(n.a)({},(function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("p",[n("font",{attrs:{color:"brown"}},[n("strong",[s._v("目标:")]),s._v(" 开发一个通用的权限组件 以及 一个帮助我们CURD增删改查的stark组件. 将它们应用到CRM业务中!!")])],1),s._v(" "),n("h2",{attrs:{id:"权限系统介绍"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#权限系统介绍"}},[s._v("#")]),s._v(" 权限系统介绍")]),s._v(" "),n("blockquote",[n("p",[s._v("三个问题!")])]),s._v(" "),n("p",[n("font",{attrs:{color:"purple",size:"4"}},[s._v("Q1: ")]),n("strong",[s._v("为什么需要权限控制?")]),n("br"),s._v(" "),n("font",{attrs:{color:"purple",size:"4"}},[s._v("A1:")]),s._v(" 程序开发时的权限控制, 对于 不同用户/不同角色的人员 使用系统时候就应该有不同的功能")],1),s._v(" "),n("p",[n("font",{attrs:{color:"purple",size:"4"}},[s._v("Q2:")]),s._v(" "),n("strong",[s._v("为什么要开发组件?")]),n("br"),s._v(" "),n("font",{attrs:{color:"purple",size:"4"}},[s._v("A2:")]),s._v(" 假设你今年25岁, 从今天开始写代码到80岁, 每年写5个项目, 那么你的一生就会写275个项目."),n("br"),s._v("\n保守估计其中应该有150+个都需要用到权限控制, 为了以后不再重复的写代码, 所以就开发一个权限组件以便之后55年的岁月中使用!")],1),s._v(" "),n("p",[n("font",{attrs:{color:"purple",size:"4"}},[s._v("Q3:")]),s._v(" "),n("strong",[s._v("在web中, 什么是权限?")]),n("br"),s._v(" "),n("font",{attrs:{color:"purple",size:"4"}},[s._v("A3:")]),s._v(" web程序是通过 url 的切换来查看不同的页面(功能), 所以权限指的其实就是URL, 对url控制就是对权限的控制!!"),n("br"),s._v(" "),n("font",{attrs:{color:"brown"}},[s._v("★ 一个人有多少个权限就取决于他有多少个URL的访问权限!!")])],1),s._v(" "),n("hr"),s._v(" "),n("h2",{attrs:{id:"权限表结构设计"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#权限表结构设计"}},[s._v("#")]),s._v(" 权限表结构设计")]),s._v(" "),n("blockquote",[n("p",[s._v("我们深知 "),n("font",{attrs:{color:"brown"}},[s._v("权限就是URL!!")]),s._v(" 那如何设计表结构呢?")],1)]),s._v(" "),n("h3",{attrs:{id:"基于用户"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#基于用户"}},[s._v("#")]),s._v(" 基于用户")]),s._v(" "),n("blockquote",[n("p",[n("strong",[s._v("第一版")]),s._v(": 基于用户的权限控制 too young too native")])]),s._v(" "),n("p",[n("img",{attrs:{src:a(896),alt:"image-20240228190554126"}})]),s._v(" "),n("h3",{attrs:{id:"基于角色"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#基于角色"}},[s._v("#")]),s._v(" 基于角色")]),s._v(" "),n("blockquote",[n("p",[n("strong",[s._v("第二版")]),s._v(": 基于角色的权限控制 - rbac(Role-Based Access Control).")])]),s._v(" "),n("p",[n("font",{attrs:{color:"blue"}},[s._v("Q: 若给你一个用户, 需要根据该用户找到它所对应的所有权限.")]),n("br"),s._v("\nA: 用户 --\x3e 所拥有的所有角色 --\x3e 再根据角色找到所对应的权限"),n("font",{attrs:{color:"gray"}},[s._v("(不同角色所拥有的权限可能会有交集!)")])],1),s._v(" "),n("p",[n("img",{attrs:{src:a(897),alt:"image-20240228192455815"}})]),s._v(" "),n("hr"),s._v(" "),n("h2",{attrs:{id:"客户管理系统"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#客户管理系统"}},[s._v("#")]),s._v(" 客户管理系统")]),s._v(" "),n("blockquote",[n("p",[s._v("我们用一个简易版的《客户管理》系统为示例, 来实现对其 的权限控制!!")])]),s._v(" "),n("p",[s._v("客户系统相关功能的代码在该篇博文中,不会进行呈现,我们需要关注的是 权限控制 是如何实现的!!"),n("br"),s._v("\n武sir提供了该系统的源码, 详看"),n("code",[s._v("https://www.cnblogs.com/wupeiqi/articles/9178982.html")])]),s._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[s._v("新建一个python项目dc_crm "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" 利用pycharm构建虚拟环境\npip install Django"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.2")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("i https"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("//")]),s._v("pypi"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("tuna"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("tsinghua"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("edu"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("cn"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("simple\ndjango"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("admin startproject dc_crm "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\npython manage"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("py startapp rbac apps"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("rbac    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 权限管理")]),s._v("\npython manage"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("py startapp web apps"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("web      "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#《客户系统》")]),s._v("\n注册app "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" 进行Django项目快速启动的配置\n\n开始进行客户系统的开发!! \n▲《客户管理》系统 大致包含以下功能"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n   "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" 客户管理相关"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 客户列表、新增客户、修改客户、删除客户、批量导入\n   "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" 账单管理相关"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 账单列表、新增账单、修改账单、删除账单\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.")]),s._v(" 开发过程中"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("我对源码的项目结构进行了重构"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("采用了 多app "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" views文件夹 "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" 多个业务文件夹 !! ★这种结构我超喜欢\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.")]),s._v(" 武sir提供的 客户系统 相关代码"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("样式使用的是BootStrap"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("太丑了!! 我忍不了"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("（¯﹃¯）\n   我使用layui对呈现出来的样式进行了更改!!并且添加了 侧边栏收缩展开等前端样式!!\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.")]),s._v(" 客户系统的每个页面都会继承 layout"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("html"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" 这是个前端后台框架代码!!\n   换个系统"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("换汤不换药"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("所以我将其集成到了rbac组件中!!\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br")])]),n("p",[s._v("回顾一点比较容易混淆的知识吧")]),s._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[s._v("■ 模版的查找顺序\n"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'DIRS'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("os"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("path"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("join"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("BASE_DIR"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'templates'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 可以在该路径下找模版文件")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'APP_DIRS'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("True")]),s._v("                                "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 可以在注册的app路径下找到templates目录,在该目录下找模版文件")]),s._v("\n\n■ 静态文件的查找顺序\nSTATIC_URL "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/xxx/'")]),s._v("\nSTATICFILES_DIRS "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("os"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("path"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("join"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("BASE_DIR"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'static'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token triple-quoted-string string"}},[s._v('"""\nSTATIC_URL必须得有.\n若只有STATIC_URL,那么只能在app下创建static文件夹.该文件夹下存放静态文件(img、js、css等)\n若写了STATICFILES_DIRS,那么可以在该路径下存放静态文件(img、js、css等)\n可以在浏览器中域名进行拼接访问静态文件 \nhttp://127.0.0.1:8000/xxx/images/bg.jpg 它会自动去app的static文件夹下找images/bg.jpg,或者去BASE_DIR/static/下找\n"""')]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br")])]),n("p",[s._v("客户管理系统的功能基本开发完成后."),n("br"),s._v("\n接下来, 我们需要实现 权限控制、动态菜单、面包屑导航、将权限粒度控制到按钮级别等.."),n("br"),s._v(" "),n("font",{attrs:{color:"gray"}},[s._v("路漫漫其修远兮,吾将上下而求索. (´･Д･)」")])],1),s._v(" "),n("hr"),s._v(" "),n("h2",{attrs:{id:"基本的权限控制"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#基本的权限控制"}},[s._v("#")]),s._v(" 基本的权限控制")]),s._v(" "),n("blockquote",[n("p",[s._v("快速完成一个基本的权限控制!!")])]),s._v(" "),n("h3",{attrs:{id:"准备工作"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#准备工作"}},[s._v("#")]),s._v(" 准备工作")]),s._v(" "),n("blockquote",[n("p",[s._v("给基于角色的权限控制的表结构 录入一些数据!!")])]),s._v(" "),n("p",[s._v("■ 在rbac组件中,编写权限控制相关的表,并进行数据库迁移!"),n("br"),s._v(" "),n("strong",[s._v("（¯﹃¯）注:")]),s._v(" "),n("font",{attrs:{color:"blue"}},[s._v("现在的设计还不是最终版, 但之后的设计都是在此版本基础上扩增的!!")])],1),s._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" django"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("db "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" models\n\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Permission")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("models"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Model"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token triple-quoted-string string"}},[s._v('""" 权限表 """')]),s._v("\n    title "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" models"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("CharField"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("verbose_name"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'标题'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" max_length"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("32")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    url "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" models"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("CharField"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("verbose_name"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'含正则的URL'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" max_length"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("128")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("__str__")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("title\n\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Role")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("models"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Model"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token triple-quoted-string string"}},[s._v('""" 角色表 """')]),s._v("\n    title "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" models"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("CharField"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("verbose_name"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'角色名称'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" max_length"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("32")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    permissions "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" models"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ManyToManyField"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("verbose_name"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'拥有的所有权限'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" to"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Permission'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" blank"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("True")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("__str__")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("title\n\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("UserInfo")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("models"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Model"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token triple-quoted-string string"}},[s._v('""" 用户表 """')]),s._v("\n    name "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" models"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("CharField"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("verbose_name"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'用户名'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" max_length"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("32")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    password "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" models"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("CharField"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("verbose_name"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'密码'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" max_length"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    email "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" models"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("CharField"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("verbose_name"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'邮箱'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" max_length"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("32")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    roles "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" models"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ManyToManyField"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("verbose_name"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'拥有的所有角色'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" to"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Role'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" blank"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("True")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("__str__")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("name\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br")])]),n("p",[s._v("■ 创建一个超级用户, "),n("code",[s._v("root")]),s._v(" "),n("code",[s._v("admin123")])]),s._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[s._v("python manage"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("py createsuperuser\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("■ 在rbac组件的admin.py文件中进行admin站点的注册")]),s._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" django"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("contrib "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" admin\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" models\n\nadmin"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("site"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("register"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("models"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Permission"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nadmin"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("site"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("register"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("models"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Role"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nadmin"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("site"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("register"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("models"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("UserInfo"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("p",[s._v("■ 以超级管理员的身份登陆项目的 "),n("strong",[s._v("admin后台")]),s._v(" , 在 "),n("code",[s._v("权限组件")]),s._v(" 中录入相关信息 !!")]),s._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" 录入权限\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" 创建用户\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" 创建角色\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" 用户分配角色\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" 角色分配权限\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# - 在此处,展示下,有哪些权限")]),s._v("\n客户列表"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("web"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("customer"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("list")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("\n添加客户"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("web"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("customer"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("add"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("\n删除客户"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("web"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("customer"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("del")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("?P"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("cid"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\\d"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("\n修改客户"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("web"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("customer"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("edit"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("?P"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("cid"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\\d"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("\n批量导入"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("web"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("customer"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("\n账单列表"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("web"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("payment"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("list")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("\n添加账单"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("web"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("payment"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("add"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("\n删除账单"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("web"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("payment"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("del")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("?P"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("pid"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\\d"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("\n修改账单"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("web"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("payment"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("edit"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("?P"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("pid"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\\d"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br")])]),n("h3",{attrs:{id:"关键逻辑"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#关键逻辑"}},[s._v("#")]),s._v(" 关键逻辑")]),s._v(" "),n("blockquote",[n("p",[n("font",{attrs:{color:"brown"}},[s._v("★ 快速完成一个基本权限控制!!")])],1)]),s._v(" "),n("p",[n("img",{attrs:{src:a(898),alt:"per"}})]),s._v(" "),n("p",[n("code",[s._v("大体的思路:")]),n("br"),s._v(" "),n("em",[s._v("用户登录时, 根据当前用户找到所有的角色, 再根据角色找到所有的权限, 再将权限信息放入session."),n("br"),s._v("\n以后每次访问某个url的时候都需要先去session检查是否有权访问!!")])]),s._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" 用户登录"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" 获取权限信息并放入session\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" 用户访问"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" 在中间件从session中获取用户权限信息\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"YES"')]),s._v(" session中有权限信息"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" 对用户当前访问的url进行权限的判断"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("是否在session的权限信息中!\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"NO"')]),s._v("  session中没有权限信息"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" 未登陆或未给当前登陆用户分配权限!!\n\nsession默认是在数据库中的"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("但以后我们可以将session放到memcache、redis等地方!!\n★ 为什么去session中校验"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("而不是每次都去数据库中校验？联表查询性能会降低"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("减少数据库压力"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("p",[n("img",{attrs:{src:a(899),alt:"image-20240301131054692"}})]),s._v(" "),n("p",[s._v("(*≧ω≦) 获取当前登陆用户的所有权限信息的ORM查询语句, 值得细品一番!!"),n("br"),s._v(" "),n("strong",[s._v("★细品点1")]),n("br"),s._v("\ncurrent_user是UserInfo表的一条记录/一个对象,roles是该表的多对多外键字段!"),n("br"),s._v("\n正向查询 - "),n("code",[s._v("对象.外键字段.all()")]),s._v(" 可得到外键关联的那张表中的多条记录 "),n("code",[s._v("<对象.外键字段 跨到了外键关联所在的那张表!!>")]),n("br"),s._v(" "),n("font",{attrs:{color:"brown"}},[s._v("current_user.roles.all()")])],1),s._v(" "),n("p",[n("strong",[s._v("★细品点2")]),n("br"),s._v("\n因为 current_user.roles 已经跨到了Role表!! permissions是Role角色表中的多对多外键字段."),n("br"),s._v("\nSo,我们可以通过values来 正向联表查询 指定 查询字段 !!"),n("br"),s._v(" "),n("font",{attrs:{color:"gray"}},[s._v("values "),n("code",[s._v("[{k1:v1,k2:v2},{k1:v11,k2:v22}]")]),s._v(" 、values_list "),n("code",[s._v("[(v1,v2),(v11,v22)]")]),s._v(" 查询结果都是queryset对象")]),n("br"),s._v(" "),n("font",{attrs:{color:"brown"}},[s._v('current_user.roles.all().values("permissions__pk", "permissions__url")')])],1),s._v(" "),n("p",[n("strong",[s._v("★细品点3")]),n("br"),s._v("\n用户:角色 = n:n  角色:权限 = n:n -- 若一个用户拥有多个角色,而这些角色有权限的重合."),n("br"),s._v("\nSo,需要通过distinct()去重处理."),n("br"),s._v(" "),n("font",{attrs:{color:"brown"}},[s._v('current_user.roles.all().values("permissions__pk", "permissions__url").distinct()')])],1),s._v(" "),n("p",[n("strong",[s._v("★细品点4")]),n("br"),s._v("\n创建了一个角色,并没有给它分配权限,但该角色分配给了用户."),n("br"),s._v("\n那么在联表查询时候,对该角色的权限查询结果为 "),n("code",[s._v("{'permissions__pk':None,'permissions__url':None,}")]),n("br"),s._v("\n我们应该避免这种情况!!"),n("br"),s._v(" "),n("code",[s._v("permissions__isnull=False")]),s._v(" 保证了 该角色在 角色-权限关联表 中是有记录的/是给该角色分配了权限的"),n("br"),s._v(" "),n("font",{attrs:{color:"brown"}},[s._v('current_user.roles.filter(permissions__isnull=False).values("permissions__pk", "permissions__url").distinct()')])],1),s._v(" "),n("hr"),s._v(" "),n("h2",{attrs:{id:"动态菜单"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#动态菜单"}},[s._v("#")]),s._v(" 动态菜单")]),s._v(" "),n("blockquote",[n("p",[s._v("构造菜单一层 和 菜单两层的数据结构, 然后在模版中循环该数据进行渲染即可!!")])]),s._v(" "),n("p",[n("strong",[s._v("一点小知识回顾")])]),s._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" ★★★ 添加 templatetags 模块后"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" 你需要重启服务器!!! 这样才能在模板中使用 tags 和 filters\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" inclusion_tag 找到模版"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"遵循模版的查找顺序"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("根据返回值渲染"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"示例中返回值返回的是字典"')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" 若使用的是py3"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v("及以下的"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("要注意字典是无序的!! 示例代码使用的是py3"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("p",[n("strong",[s._v("如何实现呢?")]),s._v(" "),n("font",{attrs:{color:"brown"}},[s._v("简单来说, 权限请求+动态菜单!!")]),n("br"),s._v("\n■ 首先 登陆时,做权限和菜单的初始化 - 获取权限信息、获取菜单信息"),n("br"),s._v("\n■ 再次访问 "),n("font",{attrs:{color:"gray"}},[s._v('"eg:登陆成功后跳转的客户列表页面!"')]),n("br"),s._v("\n     中间件进行权限的校验(根据权限信息)."),n("br"),s._v("\n     模版中使用inclusion_tag生成动态菜单(根据菜单信息进行动态生成)")],1),s._v(" "),n("h3",{attrs:{id:"菜单一层"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#菜单一层"}},[s._v("#")]),s._v(" 菜单一层")]),s._v(" "),n("blockquote",[n("p",[s._v("绝大多数情况下 菜单都不可能只有一层.Hhh")])]),s._v(" "),n("p",[n("strong",[s._v("先来看看效果:")]),n("br"),s._v("\nxiaoming这个用户只有客户相关的权限,所以动态菜单中没有关于账单的项.."),n("br"),s._v("\n而dengchuan这个用户是有客户和账单相关权限的,所以动态菜单中都有!!"),n("br"),s._v('\n不足之处在于,当我点击 "客户列表"展示的页面里的"添加客户"这些功能时, "客户列表"的选中状态会消失!!')]),s._v(" "),n("p",[n("img",{attrs:{src:a(900),alt:"33"}})]),s._v(" "),n("p",[n("strong",[s._v("具体思考过程")])]),s._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[s._v("在前面"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("我们设计了 基于角色的权限控制 的表结构"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v(" 用户"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("角色"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("权限 ψ"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("｀∇´"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("ψ\n按照惯性思维"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("动态菜单的实现"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("需要再添加一个菜单表"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("为每个用户分配菜单"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n那新增的这个菜单表的字段有哪些呢? 菜单项的名称、点击每个菜单项时跳转的url"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v(" So"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("菜单表的字段至少有"),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("id")]),s._v("、title、url \n\n你品、你细品"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("这跟权限表很像啊!! 哇"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("~")]),s._v(" 那么我们就不用额外再添加这个菜单表啦!!\n★ 我们可以给权限表添加一个字段"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("字段值为"),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("bool")]),s._v("类型"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("表明该条权限记录能否成为菜单! 即 "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),s._v("权限可能是菜单"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n举个栗子"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  假设当前权限表有四个权限"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 客户列表、新增客户、删除客户、修改客户\n  我们通常会将客户列表作为菜单"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("点击客户列表"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("在展示的页面中包含新增、删除、修改客户的功能"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n  但也可以将新增用户作为菜单中的一项"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("这个是可以让管理员自定义的!!"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  另外"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("特别注意"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("修改和删除客户是不能作为菜单的"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("why? "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\\d"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("“动态url”对哪个用户进行操作呢?\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br")])]),n("p",[n("strong",[s._v("经过上述的分析, 在已有代码的基础上, 我们需要做三件事:")]),n("br"),s._v("\n1> 表结构修改, 并手动录入菜单数据. - "),n("code",[s._v("models.py")]),n("br"),s._v("\n2> 获取菜单信息并保存到session中 - "),n("code",[s._v("init_permission方法中.")]),n("br"),s._v("\n3> 模版从session中读取菜单信息,并在页面上显示动态菜单. - "),n("code",[s._v("inclusion_tag")])]),s._v(" "),n("p",[n("img",{attrs:{src:a(901),alt:"image-20240229191315999"}})]),s._v(" "),n("h3",{attrs:{id:"菜单两层"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#菜单两层"}},[s._v("#")]),s._v(" 菜单两层")]),s._v(" "),n("blockquote",[n("p",[s._v("ψ(｀∇´)ψ")])]),s._v(" "),n("h5",{attrs:{id:"缺陷版"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#缺陷版"}},[s._v("#")]),s._v(" 缺陷版")]),s._v(" "),n("blockquote",[n("p",[s._v("该示例中, 菜单一层和菜单二层的实现效果有一处相同的缺陷"),n("br"),s._v('\n当我点击 "客户列表"展示的页面里的"添加客户"这些非菜单权限功能时, "客户列表"的选中状态会消失!!')])]),s._v(" "),n("p",[n("strong",[s._v("先来看看效果.")])]),s._v(" "),n("p",[n("img",{attrs:{src:a(902),alt:"34"}})]),s._v(" "),n("p",[s._v("将菜单一层和菜单两层的关键代码进行比较!!")]),s._v(" "),n("p",[n("img",{attrs:{src:a(903),alt:"image-20240301162330596"}})]),s._v(" "),n("p",[s._v("二层菜单是渲染到下面这样的模版代码中的!!")]),s._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("div "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"layui-side-scroll"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("ul "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"layui-nav layui-nav-tree"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" level_one "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" menu_dict"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("values "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("li "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"layui-nav-item {{ level_one.class }}"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("a href"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"javascript:"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n                    "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("i "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"layui-icon {{ level_one.icon }}"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("i"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" level_one"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("title "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("a"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("dl "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"layui-nav-child"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n                    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" level_two "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" level_one"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("children "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n                        "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("dd "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"{{ level_two.class }}"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n                            "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("a href"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"{{ level_two.url }}"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" level_two"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("title "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("a"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n                        "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("dd"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n                    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),s._v(" endfor "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("dl"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("li"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),s._v(" endfor "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("ul"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("div"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br")])]),n("h5",{attrs:{id:"完美版"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#完美版"}},[s._v("#")]),s._v(" 完美版")]),s._v(" "),n("blockquote",[n("p",[s._v("我们要解决缺陷版的bug!!"),n("br"),s._v(" "),n("font",{attrs:{color:"brown"}},[s._v("明确需求: 点击非菜单权限时, 一级菜单默认展开,二级菜单默认选中!!")])],1)]),s._v(" "),n("p",[n("strong",[s._v("先来看看最终效果!")])]),s._v(" "),n("p",[n("img",{attrs:{src:a(904),alt:"35"}})]),s._v(" "),n("p",[s._v("■ Bug现象:"),n("br"),s._v('\n     就菜单二层而言,点击客户编辑按钮时,"客户列表"所属的一级菜单"客户管理"不会展开, 二级菜单"客户列表"没有默认选中的样式.'),n("br"),s._v("\n■ 产生该Bug的原因:"),n("br"),s._v("\n     菜单有选中样式的关键判定代码."),n("br"),s._v("\n     菜单一层: "),n("code",[s._v("current_url = request.path_info")]),n("br"),s._v("\n     菜单二层: "),n("code",[s._v("if re.match(f\"^{level_two['url']}$\", request.path_info)")]),n("br"),s._v(" "),n("font",{attrs:{color:"blue"}},[s._v("当我们点击客户编辑按钮时,其url是 "),n("code",[s._v("/web/customer/edit/2/")]),s._v(", 当前访问的这个url不是 菜单数据结构里的url")]),n("br"),s._v("\n■ 解决方案."),n("br"),s._v("\n     给 非菜单的权限/url 做一个 归属/关联!"),n("br"),s._v("\n     具体操作:在权限表中实现<自关联>, 将非菜单权限跟菜单权限进行关联.")],1),s._v(" "),n("p",[n("img",{attrs:{src:a(905),alt:"image-20240301171904873"}})]),s._v(" "),n("p",[s._v('具体如何实现呢? 在"缺陷版"菜单二层的代码上进行了更改, 更改的地方在截图中都进行了标注!!'),n("br"),s._v(" "),n("font",{attrs:{color:"brown"}},[s._v("精髓在于: 以前是通过url来判定默认选中、现在通过id来判定默认选中!!")])],1),s._v(" "),n("p",[n("img",{attrs:{src:a(906),alt:"image-20240301183121524"}})]),s._v(" "),n("hr"),s._v(" "),n("h2",{attrs:{id:"面包屑导航"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#面包屑导航"}},[s._v("#")]),s._v(" 面包屑导航")]),s._v(" "),n("blockquote",[n("p",[s._v("路径导航 可以显示 权限之间的层级关系.")])]),s._v(" "),n("p",[n("strong",[s._v("先来看看效果!")])]),s._v(" "),n("p",[n("img",{attrs:{src:a(907),alt:"36"}})]),s._v(" "),n("p",[s._v("主要是对登陆获取到的权限信息进行一点处理!")]),s._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[s._v("  ■ 原来"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'id'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'url'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/web/customer/list/'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'pid'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("None")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" \n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'id'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'url'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/web/customer/add/'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'pid'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" \n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'id'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'url'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/web/customer/del/(?P<cid>\\\\d+)/'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'pid'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  ■ 现在"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("变成下方的样子"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 权限信息以及其父级权限的信息"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'id'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" \n      "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'title'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'客户列表'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" \n      "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'url'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/web/customer/list/'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" \n      "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'pid'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("None")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" \n      "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'p_title'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("None")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'p_url'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("None")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" \n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'id'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'title'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'添加客户'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'url'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/web/customer/add/'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'pid'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'p_title'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'客户列表'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'p_url'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/web/customer/list/'")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" \n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'id'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'title'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'删除客户'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'url'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/web/customer/del/(?P<cid>\\\\d+)/'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" \n      "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'pid'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'p_title'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'客户列表'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" \n      "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'p_url'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/web/customer/list/'")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br")])]),n("p",[s._v("在已有代码的基础上, 修改的地方在截图中都进行了标注!!")]),s._v(" "),n("p",[n("img",{attrs:{src:a(908),alt:"image-20240301191817928"}})]),s._v(" "),n("hr"),s._v(" "),n("h2",{attrs:{id:"权限粒度-按钮"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#权限粒度-按钮"}},[s._v("#")]),s._v(" 权限粒度-按钮")]),s._v(" "),n("blockquote",[n("p",[s._v("将权限粒度控制到按钮级别!! "),n("font",{attrs:{color:"brown"}},[s._v("★ 关键在于url的name!!")])],1)]),s._v(" "),n("p",[n("font",{attrs:{color:"blue"}},[s._v("需求: 若当前登陆用户没有账单的修改和删除权限,那么在账单表格里 修改和删除的按钮 都不应该出现!!")])],1),s._v(" "),n("p",[s._v("Step1: 给权限表添加一个name字段,先允许为空,在数据库里修改后,再设置为unique=True."),n("br"),s._v("\nStep2: 权限信息的数据结构还得修改.列表改成字典!!")]),s._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[s._v("★ 细数一路以来权限信息的结构经历的变化!!\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" 满足基本权限控制\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("url"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("url"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("url"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" 满足菜单两层完美版\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"id"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"url"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"pid"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"id"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"url"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"pid"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" 满足面包屑导航\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"id"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"url"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"pid"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"title"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"p_title"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"p_url"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"id"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"url"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"pid"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"title"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"p_title"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"p_url"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" 满足权限粒度之按钮\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"id"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"url"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"pid"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"title"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"p_title"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"p_url"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"id"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"url"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"pid"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"title"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"p_title"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"p_url"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br")])]),n("p",[s._v("Step3: 在模版页面添加判断条件 用的filter")]),s._v(" "),n("p",[n("strong",[s._v("看代码截图,其实就改了下 权限信息的数据结构, 其余的都没咋动!!")])]),s._v(" "),n("p",[n("img",{attrs:{src:a(909),alt:"image-20240301205329283"}})]),s._v(" "),n("hr")])}),[],!1,null,null,null);t.default=r.exports},896:function(s,t,a){s.exports=a.p+"assets/img/image-20240228190554126.99e77d6f.png"},897:function(s,t,a){s.exports=a.p+"assets/img/image-20240228192455815.4c18efcc.png"},898:function(s,t,a){s.exports=a.p+"assets/img/per.ea9711a0.gif"},899:function(s,t,a){s.exports=a.p+"assets/img/image-20240301131054692.0f300d62.png"},900:function(s,t,a){s.exports=a.p+"assets/img/33.5772838a.gif"},901:function(s,t,a){s.exports=a.p+"assets/img/image-20240229191315999.e596adb8.png"},902:function(s,t,a){s.exports=a.p+"assets/img/34.b9e69d89.gif"},903:function(s,t,a){s.exports=a.p+"assets/img/image-20240301162330596.4ce2531b.png"},904:function(s,t,a){s.exports=a.p+"assets/img/35.3b9bb60a.gif"},905:function(s,t,a){s.exports=a.p+"assets/img/image-20240301171904873.7ceaa9f8.png"},906:function(s,t,a){s.exports=a.p+"assets/img/image-20240301183121524.d98a344d.png"},907:function(s,t,a){s.exports=a.p+"assets/img/36.a0c09a80.gif"},908:function(s,t,a){s.exports=a.p+"assets/img/image-20240301191817928.79f4026c.png"},909:function(s,t,a){s.exports=a.p+"assets/img/image-20240301205329283.135f31b6.png"}}]);