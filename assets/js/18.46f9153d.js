(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{1325:function(s,t,a){"use strict";a.r(t);var n=a(0),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("p",[s._v("在前面一章节博客中, 我们进行了基本的权限控制和动态菜单的实现."),n("br"),s._v("\n细心的你应该可以发现, 完成这些功能的前提是 进行权限、用户、角色信息的录入!"),n("br"),s._v("\n当时我们是基于Django admin后台进行的信息录入. 这种方式不太友好. 接下来, 我们换一种方式完成权限分配相关的操作.")]),s._v(" "),n("p",[n("font",{attrs:{color:"blue"}},[s._v("注: 为了方便进行编码,先在layout.html中注释掉 动态菜单和面包屑 的代码 + 注释掉 中间件的代码!!")])],1),s._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" 角色管理\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" 用户管理\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" 菜单和权限管理\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" 批量的权限操作\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" 分配权限 "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" 专门用来处理 角色"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("用户"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("权限三者之间关系的"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("外键"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"因为篇幅原因,分配权限单独弄了一个md来写"')]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("hr"),s._v(" "),n("h2",{attrs:{id:"角色管理"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#角色管理"}},[s._v("#")]),s._v(" 角色管理")]),s._v(" "),n("blockquote",[n("p",[s._v("此处对Role表的title字段进行处理, permissions外键字段在 后续的分配权限处 进行处理!!")])]),s._v(" "),n("p",[n("font",{attrs:{color:"brown"}},[s._v("应用场景: 就是纯粹的对一张单表CURD, 不涉及到外键、自定义字段啥的! So, 添加和删除都使用的是同一个Form表单!")]),n("br"),s._v("\n(*≧ω≦) CURD都大同小异, 后续复杂的场景都是基于下面这个模版根据需求作的一些改变!! 慢慢悟,对比比较,很快就会明白的.")],1),s._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" django"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("shortcuts "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" render"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" redirect\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" django"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("urls "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" reverse\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" apps"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("rbac "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" models\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("form "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" RoleModelForm\n\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("role_list")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("request"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token triple-quoted-string string"}},[s._v('"""角色列表"""')]),s._v("\n    role_queryset "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" models"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Role"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("objects"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("all")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" render"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("request"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'rbac/role/role_list.html'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'roles'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" role_queryset"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("role_add")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("request"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token triple-quoted-string string"}},[s._v('"""添加角色"""')]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" request"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("method "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'GET'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        form "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" RoleModelForm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" render"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("request"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'rbac/change.html'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'form'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" form"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n    form "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" RoleModelForm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("data"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("request"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("POST"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" form"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("is_valid"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        form"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("save"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" redirect"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("reverse"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'rbac:role_list'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" render"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("request"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'rbac/change.html'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'form'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" form"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("role_edit")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("request"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" pk"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token triple-quoted-string string"}},[s._v('"""编辑角色"""')]),s._v("\n    obj "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" models"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Role"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("objects"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("filter")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("id")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("pk"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("first"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("not")]),s._v(" obj"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -- 保证不会人为的修改页面url中的id值!!")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" render"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("request"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'rbac/500.html'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"msg"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string-interpolation"}},[n("span",{pre:!0,attrs:{class:"token string"}},[s._v('f"ID值为')]),n("span",{pre:!0,attrs:{class:"token interpolation"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("pk"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")])]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('的角色不存在,请联系管理员!"')])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" request"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("method "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'GET'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        form "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" RoleModelForm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("instance"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("obj"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -- 修改时显示初始数据!!")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" render"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("request"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'rbac/change.html'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'form'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" form"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    form "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" RoleModelForm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("data"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("request"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("POST"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" instance"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("obj"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -- 前者用于校验,后者是确定修改哪条记录")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" form"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("is_valid"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        form"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("save"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" redirect"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("reverse"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'rbac:role_list'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" render"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("request"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'rbac/change.html'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'form'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" form"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("role_del")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("request"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" pk"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token triple-quoted-string string"}},[s._v('"""删除角色"""')]),s._v("\n    role_queryset "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" models"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Role"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("objects"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("filter")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("id")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("pk"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("not")]),s._v(" role_queryset"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" render"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("request"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'rbac/500.html'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"msg"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"该角色不存在,请联系管理员!"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    origin_url "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" reverse"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'rbac:role_list'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" request"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("method "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'GET'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" render"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("request"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'rbac/delete.html'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'cancel'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" origin_url"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n    role_queryset"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("delete"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" redirect"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("origin_url"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br")])]),n("p",[n("strong",[s._v("效果动态如下:")])]),s._v(" "),n("p",[n("img",{attrs:{src:a(910),alt:"37"}})]),s._v(" "),n("p",[s._v("具体的代码就不展示啦!就是普遍的Django CURD. 注意几个点:")]),s._v(" "),n("p",[s._v("■ 根据namcespace和name反向生成URL")]),s._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" 根路由\n   path"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'rbac/'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" include"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'apps.rbac.urls'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" namespace"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"rbac"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" app_rbac\n   path"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'role/'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" include"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'apps.rbac.views.role.routers'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" role的routers\n   urlpatterns "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n       path"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'list/'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" views"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("role_list"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" name"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'role_list'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n       path"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'add/'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" views"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("role_add"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" name"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'role_add'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n       path"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'edit/<int:pk>/'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" views"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("role_edit"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" name"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'role_edit'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n       path"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'del/<int:pk>/'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" views"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("role_del"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" name"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'role_del'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n   "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" 模版中 举个栗子\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("a href"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("\"{% url 'rbac:role_edit' row.pk %}\"")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br")])]),n("p",[s._v("■ 添加和编辑模版代码的复用")]),s._v(" "),n("p",[n("img",{attrs:{src:a(911),alt:"image-20240310161525443"}})]),s._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[s._v("细心的观察 添加和编辑的视图代码 返回给前端模版的数据 都是form对象!! "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"在模版中通过for循环进行渲染即可!!"')]),s._v("\n★ form对象中包含多少个字段对象"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("都是在各自的modelform中处理好了的"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\nSo"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("添加和编辑的模版代码是一样的"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("我们命名为 change"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("html "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("在其他地方也可以进行复用"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n\nPS"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" html中的label对应ORM表中字段的verbose_name的属性值\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("p",[s._v("■ 删除模版代码的复用")]),s._v(" "),n("p",[n("img",{attrs:{src:a(912),alt:"image-20240310161043422"}})]),s._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[s._v("删除的模版代码也可进行复用 特别注意的是"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"传入模版中的cancel值"')]),s._v(" 表明点击取消按钮后 返回"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"哪里"')]),s._v("的列表页面! 示例中是返角色列表!!\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" 点击确认按钮后 使用的是表单的提交!form标签没写method"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("代表提交到当前url地址!\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("hr"),s._v(" "),n("h2",{attrs:{id:"用户管理"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#用户管理"}},[s._v("#")]),s._v(" 用户管理")]),s._v(" "),n("blockquote",[n("p",[s._v("UserInfo表的roles外键字段在 后续的分配权限处 进行处理!!")])]),s._v(" "),n("p",[s._v("用户管理的CURD相对于角色管理的CURD, 复杂那么一丢丢. 涉及到了以下知识点!!"),n("br"),s._v(" "),n("font",{attrs:{color:"brown"}},[s._v("额外字段、定义插件的两种方式、重写"),n("code",[s._v("__init__")]),s._v("方法、modelForm的继承、勾子函数、readonly+initial 、中文的错误提示设置.")])],1),s._v(" "),n("p",[n("strong",[s._v("先来看效果图.Hhh")])]),s._v(" "),n("p",[n("img",{attrs:{src:a(913),alt:"38"}})]),s._v(" "),n("p",[s._v("用户新增页面 > UserModelForm."),n("br"),s._v("\n用户编辑页面 > UpdateUserModelForm."),n("br"),s._v("\n密码重置页面 > ResetPasswordUserModelForm.")]),s._v(" "),n("p",[s._v("■ 用户列表页面 - "),n("font",{attrs:{color:"gray"}},[s._v("与角色管理中角色列表差不多")])],1),s._v(" "),n("p",[n("img",{attrs:{src:a(914),alt:"image-20240310163033573"}})]),s._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[s._v("◎ UserInfo表字段 name、password、email、roles\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" 在视图函数里返回前端模版的是 用户对象"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("该用户对象虽包含了该用户的所有的信息"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("eg"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("包括用户密码"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n  但最终渲染到模版中的信息有哪些"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("模版中是可以把控的!! "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" 展示字段 用户名、邮箱\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" 模版中可通过a标签跳转其他功能 新增用户、重置密码、操作"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("编辑"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("删除"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("p",[s._v("■ 用户新增页面+重置密码页面. "),n("font",{attrs:{color:"brown"}},[s._v("readonly+initial")])],1),s._v(" "),n("p",[n("img",{attrs:{src:a(915),alt:"image-20240310205003724"}})]),s._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[s._v("◎ UserInfo表字段 name、password、email、roles\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" 用户新增页面 "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" UserModelForm\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" 展示字段 name、email、password "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" 额外字段confirm_password\n    需在勾子函数中验证 新增用户的密码和确认密码是否一致\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" 定制插件的方式 保证了 在页面中输入密码和确认密码时 输入密码时是隐式的"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" 密码重置页面 "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" ResetPasswordUserModelForm\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" 展示字段 name、password "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" 额外字段confirm_password\n    需在勾子函数中验证 新增用户的密码和确认密码是否一致\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" 在重置密码的页面"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" 用户名字段是不能编辑的"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" 用 readonly 和 initial 来实现的!! ★★★\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" 定制插件的方式 保证了 在页面中输入密码和确认密码时 是以小黑点的样子隐藏了"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br")])]),n("p",[s._v("■ 用户编辑页面")]),s._v(" "),n("p",[n("img",{attrs:{src:a(916),alt:"image-20240310205316594"}})]),s._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[s._v("▲ 用户编辑页面 "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" UpdateUserModelForm\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" 展示字段 name、email\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("p",[s._v("■ 删除用户功能 与 角色管理中的删除一致")]),s._v(" "),n("p",[s._v("■ 关于错误提示信息的中文显示,两种方式")]),s._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("）每个字段用插件自定义 error_messages"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"required"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"用户名不能为空!"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("）一劳永逸 在settings"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("py配置文件中 \n   LANGUAGE_CODE "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'en-us'")]),s._v(" 改为 LANGUAGE_CODE "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'zh-hans'")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("hr"),s._v(" "),n("h2",{attrs:{id:"菜单和权限管理"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#菜单和权限管理"}},[s._v("#")]),s._v(" 菜单和权限管理")]),s._v(" "),n("blockquote",[n("p",[n("font",{attrs:{color:"brown"}},[s._v("(´･Д･)」三级联动、保留URL中的原搜索条件、ModelFrom中定制radio、ModelFrom 在save之前对其instance进行修改")])],1)]),s._v(" "),n("h3",{attrs:{id:"三级联动"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#三级联动"}},[s._v("#")]),s._v(" 三级联动")]),s._v(" "),n("blockquote",[n("p",[s._v("用一个路由/一个视图函数 实现一级菜单列表+二级菜单列表+非菜单权限列表 属实是三级联动了Hhh")])]),s._v(" "),n("p",[n("font",{attrs:{size:"2",color:"brown"}},[s._v("一级菜单<处理的是Menu表> -- 二级菜单<处理的Premission表中能当菜单的权限>   -- 非菜单权限<处理的Premission表中不能当菜单的权限>.")]),n("br"),s._v("\n通过传递给模版first_menu_id、second_menu_id 实现选中的样式.以及新增按钮是否展示."),n("br"),s._v("\n通过 url的mid / first_menu_id获取到二级菜单的所有数据、通过url的sid / second_menu_id获取到非菜单权限的所有数据.")],1),s._v(" "),n("p",[n("img",{attrs:{src:a(917),alt:"image-20240311161309874"}})]),s._v(" "),n("p",[n("font",{attrs:{color:"brown"}},[s._v("敲黑板!! ?mid=2 后端接收到的是str类型  {row.id|safe} safe将row.id 整型变成了字符串  ★★★")])],1),s._v(" "),n("p",[s._v("■ "),n("code",[s._v("http://127.0.0.1:8000/rbac/menu/list/")]),n("br"),s._v("\n当访问该网址的时候, 执行截图中"),n("font",{attrs:{color:"green"}},[s._v('"绿色"')]),s._v("标注的部分, 获得一级菜单的数据, 传递给模版, 在模版中进行渲染!!"),n("br"),s._v("\n此时, 二三级的数据是没有的!! "),n("font",{attrs:{color:"gray"}},[s._v("(一级菜单没选的话,二级菜单是没有数据的,二级菜单面板上也不该有新增按钮)")])],1),s._v(" "),n("p",[s._v("■ "),n("code",[s._v("http://127.0.0.1:8000/rbac/menu/list/?mid=1")]),s._v(" --\x3e mid表明用户选择的一级菜单."),n("br"),s._v("\n当访问该网址的时候, 执行截图中"),n("font",{attrs:{color:"red"}},[s._v('"红色"')]),s._v("标注的部分!!"),n("br"),s._v("\n简单来说, "),n("code",[s._v('<a href="?mid={/{row.id}/}">')]),s._v(" 通过url的mid这个param实现了 "),n("strong",[s._v("一级二级的联动.")])],1),s._v(" "),n("ul",[n("li",[n("strong",[s._v("实现了一级菜单选中的样式")]),n("br"),s._v("\n后端获取url参数,  "),n("code",[s._v('first_menu_id = request.GET.get("mid")')]),s._v(" , 将该参数传递到模版中!!"),n("br"),s._v("\n在模版中  "),n("code",[s._v('<tr class="{% if row.id|safe == first_menu_id %}dc_menu_active{% endif %}">')])]),s._v(" "),n("li",[n("strong",[s._v("获取了二级菜单的数据.")]),n("br"),s._v("\n这里很有意思! 我们不能直接通过 "),n("code",[s._v("models.Permission.objects.filter(menu__id=first_menu_id)")]),s._v(" 来获取!!"),n("br"),s._v("\n因为URL中没有mid参数的话, "),n("code",[s._v('request.GET.get("mid")')]),s._v(" 的结果是None."),n("br"),s._v("\n根据Premission表的结构, 可知: "),n("code",[s._v("models.Permission.objects.filter(menu__id=None)")]),s._v(" 得到的是 所有非菜单权限!!"),n("br"),s._v("\n这不是我们想要的, 所以进行截图中那样的判断!")]),s._v(" "),n("li",[s._v("first_menu_id 这个变量在模版中还有一个妙用!! "),n("strong",[s._v('一级菜单没选择,二级菜单的面板上不应该有"新增"的按钮!!')]),n("br"),s._v(" "),n("font",{attrs:{color:"blue"}},[s._v("Q: 需要考虑的是, 用户可以通过手动给url添加mid参数来使二级面板上出现新增按钮, 如何解决呢? ")]),n("br"),s._v("\n只需把截图的视图函数中注释的部分打开! 简单说就是在db中看存在不存在!!"),n("font",{attrs:{color:"gray"}},[s._v("(之所以注释掉了,是因为每次都要查一下, 消耗性能")])],1)]),s._v(" "),n("p",[s._v("■ "),n("code",[s._v("http://127.0.0.1:8000/rbac/menu/list/?mid=1&sid=1")]),s._v(" --\x3e mid表明用户选择的一级菜单.sid表明用户选择的二级菜单!!"),n("br"),s._v(" "),n("font",{attrs:{color:"blue"}},[s._v('二级三级的联动同理, 通过sid实现了二级菜单的选中样式+获取了三级面板的数据+三级面板"新增"按钮是否展示!!')]),n("br"),s._v("\n具体的就不再赘述!! 但特别提醒的是:  "),n("code",[s._v('<a href="?mid={/{first_menu_id}/}&sid={/{row.id}/}">')])],1),s._v(" "),n("p",[s._v("三级联动,模版中其他需要注意的地方.")]),s._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[s._v("◆ 二级可作菜单的权限面板中\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" 为了避免 url 太长 导致二级菜单的表格的样式出现问题 合并单元格\n  将CODE列和URL列放到了同一列 Hhhh "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" rowspan"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"2"')]),s._v("占两行"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("colspan"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"2"')]),s._v("占两列"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("style"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"border-bottom: 0"')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" 二级菜单选中的样式\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("a href"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"?mid={{ choice_menu_id }}&sid={{ row.id }}"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" row"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("title "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("a"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n  同样的套路"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("后端接收到url的sid这个param"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("再传给前端模版"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("模版中进行比对"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("对的上则加上选中样式\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("tr "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"{% if row.id|safe == second_menu_id %}dc_menu_active{% endif %}"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" 两个tr都要判断哦!\n\n◆ 非菜单权限就不需要默认选中啦"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("展示即可\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br")])]),n("h3",{attrs:{id:"保留url原搜索条件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#保留url原搜索条件"}},[s._v("#")]),s._v(" 保留URL原搜索条件")]),s._v(" "),n("blockquote",[n("p",[s._v("就该示例而言: 当我们完成一些功能(eg:新增、编辑、删除)后, 返回原来的菜单列表页面, 页面上的菜单选中的样式依旧存在!!")])]),s._v(" "),n("p",[n("font",{attrs:{color:"brown"}},[s._v("★★★ 换个说法,点击新增、删除、编辑按钮生成的url,携带当前url中的参数")]),n("br"),s._v(" "),n("font",{attrs:{color:"gray"}},[s._v("这还是蛮重要的细节<保留原搜索条件的功能 Django Admin的源码就是这么实现的> (它也可以应用到角色和用户管理里面!!)")])],1),s._v(" "),n("p",[n("img",{attrs:{src:a(918),alt:"image-20240311190537649"}})]),s._v(" "),n("p",[s._v("Q: 新生成的url中产生的url参数可能与原搜索条件的url参数可能会产生冲突/混乱."),n("br"),s._v("\nA: 解决方案: "),n("strong",[s._v("QueryDict")]),s._v(' - &被转义了 等于"="符号也被转义')]),s._v(" "),n("p",[n("img",{attrs:{src:a(919),alt:"39"}})]),s._v(" "),n("p",[s._v("当前url地址 "),n("code",[s._v("http://127.0.0.1:8000/rbac/menu/list/?mid=9&sid=25")]),s._v(" mid、sid选中了一级二级菜单."),n("br"),s._v("\n首先要知道当前访问的url地址对应的Django模版中, 还有修改、删除等按钮.."),n("br"),s._v("\n就删除一级菜单的按钮而言, 此时已经自动渲染成了 "),n("code",[s._v('href="/rbac/menu/del/9/?_filter=mid%3D9%26sid%3D25"')]),n("br"),s._v("\n当我们点击一级菜单的删除按钮后, 在对应的视图函数里, 取出 删除url中的参数 拼接到要删除后需跳转的地址上!!")]),s._v(" "),n("h3",{attrs:{id:"modelfrom定制radio"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#modelfrom定制radio"}},[s._v("#")]),s._v(" ModelFrom定制radio")]),s._v(" "),n("blockquote",[n("p",[s._v("在ModelForm中定制 radio输入框 实现图标列表!! Ahh")])]),s._v(" "),n("p",[n("img",{attrs:{src:a(920),alt:"image-20240311192547467"}})]),s._v(" "),n("p",[s._v("Ps: 在前面我们设计一级菜单表的时候, 该表中的menu图标字段是可为空的, 现在应该改为不为空!!"),n("br"),s._v(" "),n("font",{attrs:{color:"blue"}},[s._v("make_safe 表明不是以html代码显示, html渲染后显示,它是安全的")])],1),s._v(" "),n("h3",{attrs:{id:"modelfrom显示默认值"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#modelfrom显示默认值"}},[s._v("#")]),s._v(" ModelFrom显示默认值")]),s._v(" "),n("blockquote",[n("p",[s._v("通过 first_menu_id 和 initial 来实现")])]),s._v(" "),n("p",[s._v('一级、二级、三级面板的数据列表展示在 "三级联动" 那已经实现啦!'),n("br"),s._v("\n一级菜单的CUD, 该说的 定制radio、保留URL原搜索条件(这个可复用) 都已经阐述了, 其余的不再赘述. 自己看代码都看得懂."),n("br"),s._v("\n下面我们先来瞅瞅二级菜单的CUD, 值得关注的地方就是."),n("br"),s._v("\n1> 新增二级菜单的时候 ModelFrom显示默认值!! 需传代表 用户选择的一级菜单的参数 first_menu_id!!"),n("br"),s._v(" "),n("font",{attrs:{color:"gray"}},[s._v("2> 修改和删除跟前面的CURD的模版中一样,只需要传当前二级菜单表格中某一条数据的pk就行,Hhh")])],1),s._v(" "),n("p",[n("img",{attrs:{src:a(921),alt:"image-20240312140246017"}})]),s._v(" "),n("p",[s._v("Ps: "),n("code",[s._v("self.fields['menu'].empty_label = \"请选择一级菜单\"")]),s._v(" 会将 "),n("code",[s._v('"------"变成了"请选择一级菜单"')])]),s._v(" "),n("p",[n("font",{attrs:{color:"brown"}},[s._v("★ 思考一个问题!!")])],1),s._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[s._v("♀ 思考下"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  假比 一级菜单我们选择的是 权限管理"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" 其ID值是"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v("!!\n  模版中href"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("\"{% memory_url request 'rbac:menu_second_add' first_menu_id=first_menu_id %}\"")]),s._v("经过渲染后的地址是\n  http"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("//")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8000")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("rbac"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("menu"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("second"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("add"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("?_filter"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("mid"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),s._v("3D9\n  So"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("点击二级面板中的新增"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("跳转的是该地址!!\n  「知道为啥渲染后是这个地址吗?因为 \n   path"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'second/add/<int:first_menu_id>/'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" views"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("menu_second_add"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" name"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'menu_second_add'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("」\n  \n  该地址会在浏览器的URL栏显示"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("用户可以人为的修改 url地址中的 数字"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("该数字代表用户选择的一级菜单"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n  假比将 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v("改为了 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("900")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" ID为"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("900")]),s._v("的一级菜单是不存在的!! \n  代入代码中 initial"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'menu'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("first_menu_obj"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" 实验效果相当于失效了"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v(" 页面上 显示的是 "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"---------"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("当然用户可在页面上自己选"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n  \n  综上"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("我们不用做任何额外的处理!!"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("eg"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("在initial之前判断first_menu_id是否存在 是不用做的!!"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br")])]),n("p",[n("strong",[s._v("补充!!")]),s._v(" "),n("font",{attrs:{color:"brown"}},[s._v("严谨点,在二级菜单新增时,menu字段不应该为空,Hhh")])],1),s._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[s._v("在Permission表中 menu字段是可以为空的 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" 因为要兼顾非菜单权限"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("非菜单权限时pid有值"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("menu没值\n但在二级面板中 针对可做菜单权限的增加"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v(" 因为是可做菜单的权限"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("所以menu应该有值"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("pid没值!!\n综上"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("严谨点"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("用户选择 "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"---------"')]),s._v(" 后端校验应该通过不了!! 怎么做呢?需要改一下ModelForm!!\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("BasicModelForm")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("forms"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ModelForm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("__init__")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("args"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("**")]),s._v("kwargs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("super")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("BasicModelForm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("__init__"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("args"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("**")]),s._v("kwargs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" field "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("fields"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("items"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            field"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("widget"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("attrs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'class'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'layui-input'")]),s._v("\n            field"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("widget"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("attrs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'autocomplete'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"off"')]),s._v("\n        self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("fields"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'menu'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("empty_label "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"请选择一级菜单"')]),s._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# !!!（¯﹃¯）增加用户体验")]),s._v("\n        self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("fields"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'menu'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("required "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("True")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# !!!（¯﹃¯）字段校验不能为空. 数据库中的该字段是可以为空的.相当于覆盖啦.")]),s._v("\n\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SecondMenuModelForm")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("BasicModelForm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token triple-quoted-string string"}},[s._v('"""添加修改二级菜单时使用的"""')]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Meta")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        model "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" models"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Permission\n        exclude "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"pid"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n        \n■ 再想多一点"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("想让把这个菜单权限变成非菜单权限呢? 去批量处理的页面进行操作!!那里可以进行更新"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Hhh\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br")])]),n("h3",{attrs:{id:"save前修改instance"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#save前修改instance"}},[s._v("#")]),s._v(" save前修改instance")]),s._v(" "),n("blockquote",[n("p",[s._v("实现 非菜单权限的新增, 有两个方案!! 此示例我们选择用方案二 在save前修改instance来实现!!")])]),s._v(" "),n("p",[s._v("目前, 一级和二级面板中的CURD+三级面板中的R 我们都已经完成. 下面我们来瞅瞅 三级面板中的 CUD!!")]),s._v(" "),n("p",[n("img",{attrs:{src:a(922),alt:"image-20240312151447981"}})]),s._v(" "),n("p",[n("font",{attrs:{color:"brown"}},[s._v("★ 思考一个问题!!")])],1),s._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[s._v("针对二级面板中 可做菜单权限的增加! 我们想的是 二级菜单归属的一级菜单可能会经常改变"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("所以可以让用户自己选!!\n那么三级面板中 非菜单权限的增加"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v(" 也这样吗? No!\n我们发现 非菜单权限一般都是新增、修改、删除"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("其归属的二级菜单一般不会改变!!\n★ 所以 我们规定 新增的非菜单权限的归属必定是当前选中的二级菜单!!!!\n\n非菜单权限的新增 如何实现呢?\n◎ Permission表已有字段 title、url、menu、pid、name\n首先要明确menu字段是用不到的!!因为其在db中可为空"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("所以不使用该字段"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("在save时会自动赋值Null\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" 方案一\n  使用字段 title、url、pid、name \n  之所以 使用了pid 是想让当前新增的非菜单权限归属的二级菜单给用户进行展示!!\n  "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"该pid需要像可做菜单权限的新增一样 这里是通过second_menu_id传递!!"')]),s._v("\n  path"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'permission/add/<int:second_menu_id>/'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" views"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("permission_add"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" name"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'permission_add'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  但默认展示的该字段用户改不了"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("但会表单提交到后端!! 技术要点"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" readonly"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v("initial "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"(´･Д･)」参考-用户管理处的重置密码页面!!"')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" 方案二 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("该示例我们采用它!!"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  使用字段 title、url、name\n  path"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'permission/add/<int:second_menu_id>/'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" views"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("permission_add"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" name"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'permission_add'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  后端获取到second_menu_id后"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("就知道用户选择的二级菜单是哪个了!! \n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("严谨性"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("需要验证该值背后的对象是否存在!! "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"与可做菜单权限的新增的代码进行对比,就很容易知道怎么回事啦!"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  接下来重点在于!\n    在保存之前往instance里加点东西!! ★★★\n    form"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("instance"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pid "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" second_menu_obj\n    form"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("save"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br")])]),n("p",[s._v("Ps: 非菜单权限的编辑和删除类似!")]),s._v(" "),n("hr"),s._v(" "),n("h2",{attrs:{id:"formset的使用"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#formset的使用"}},[s._v("#")]),s._v(" formset的使用")]),s._v(" "),n("blockquote",[n("p",[s._v("■ formset是什么?"),n("br"),s._v('\nForm组件或ModelForm组件用于做"一个"表单的验证, formset用于做"多个"表单的验证'),n("br"),s._v("\n表格里每一行都是一个表单,多个行由formset组合在了一起,批量的进行了验证")]),s._v(" "),n("p",[s._v("■ 应用场景: 批量操作")])]),s._v(" "),n("p",[s._v("为啥不用modelformset_factory呢??? 我试着捣鼓了下.. 有些技术问题 Hhh不想捣鼓了."),n("br"),s._v("\n武sir也说, ModelFormSet在该rbac项目中不适合..（¯﹃¯）")]),s._v(" "),n("h3",{attrs:{id:"formset的批量添加"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#formset的批量添加"}},[s._v("#")]),s._v(" formset的批量添加")]),s._v(" "),n("blockquote",[n("p",[s._v('(´･Д･)」实现批量添加/增加的功能,并且有了"唯一"的异常也能捕获的')])]),s._v(" "),n("p",[n("strong",[s._v("关键代码如下:")])]),s._v(" "),n("p",[n("img",{attrs:{src:a(923),alt:"image-20240312203738343"}})]),s._v(" "),n("p",[s._v("因为截图中空白区域有限, 在这里补充两个细节!!")]),s._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[s._v("■ formset"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("is_valid"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" 注意哦"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("因为使用的是forms"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Form"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("所以是根据我们在表单中自己定义的字段进行的验证哦!\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Don\'t ask why?!"')]),s._v(" 实验结果就是这样的!! （¯﹃¯）想要知道为啥就去研究formset的源码"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("Hhh\n  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.")]),s._v(" 表格中的两行 都不填"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("内部不会做验证"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" 直接让你通过\n     formset"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("cleaned_data "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.")]),s._v(" 第一行数据哪怕写了一个"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("都会对这一行数据进行表单验证"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" 第二行啥都不写"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("是不会对这一行数据进行表单验证的"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("直接通过\n     formset"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("cleaned_data "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'title'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'11'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'url'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'111'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'name'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'111'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'menu_id'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'pid_id'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\n■ post_row_list "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" formset"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("cleaned_data\n  要注意一个细节"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("当formset里没有错误信息的时"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("执行formset"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("cleaned_data才不会报错\n  若检查formset中没有错误信息"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("才能将用户提交的数据获取到!! 每次执行formset"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("cleaned_data该语句"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("都会检查\n  因为后续可能会人为的往formset添加错误 So"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("进行了一个赋值!!\n  \n  \n"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'\\(≧▽≦)/'")]),s._v(" formset_class "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" formset_factory"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("MultiPermissionForm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" extra"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" \nQ"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 在添加的时候"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("更新的时候"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("默认的显示几行初始数据"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("如何实现?"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("若extra"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("的话"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("不会额外生成"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("那么个数如何指定呢? \nA"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" formset_class"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("实例化时使用initial参数!传入"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("像这样就会对应两条数据 暂略"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n   "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("在后面权限的批量添加一级批量更新代码中"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("发送GET请求时"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("就是这样弄的!Hhh"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("´･Д･"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("」 Ps"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("你对比下角色管理那CURD的模版"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("会有不一样的feel哦!!\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br")])]),n("h3",{attrs:{id:"formset的批量更新"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#formset的批量更新"}},[s._v("#")]),s._v(" formset的批量更新")]),s._v(" "),n("blockquote",[n("p",[s._v("(´･Д･)」实现批量更新, 相比于添加, Form中多了一个ID字段, 因为需根据这个ID字段进行更新!!")])]),s._v(" "),n("p",[n("strong",[s._v("关键代码如下:")])]),s._v(" "),n("p",[n("img",{attrs:{src:a(924),alt:"image-20240312205717494"}})]),s._v(" "),n("hr"),s._v(" "),n("h2",{attrs:{id:"自动发现项目中url"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#自动发现项目中url"}},[s._v("#")]),s._v(" 自动发现项目中URL")]),s._v(" "),n("blockquote",[n("p",[s._v("给你一个项目, 请帮我获取当前项目中都有哪些URL以及name!!"),n("br"),s._v("\n注意哦, name是用于反向生成url,所以有namespace的话,需要进行namespace的拼接!")])]),s._v(" "),n("p",[s._v("在任何一个视图函数中执行 下面的get_all_url_dict方法就可获取项目中的所有路由!!"),n("br"),s._v("\n构建的数据结构: "),n("code",[s._v('eg: {"rbac:menu_list":{"name":"rbac:menu_list","url":"/rbac/menu/list/"},...,...}')])]),s._v(" "),n("p",[n("font",{attrs:{color:"gray"}},[s._v("代码中的批注已经很清晰啦, 不再过多阐述.ψ(｀∇´)ψ")])],1),s._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" collections "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" OrderedDict  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 有序字典")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" django"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("conf "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" settings\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" django"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("utils"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("module_loading "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" import_string  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 根据字符串的形式导入该模块")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" django"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("urls"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("resolvers "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" URLResolver"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" URLPattern\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" re\n\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("check_url_exclude")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("url"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token triple-quoted-string string"}},[s._v('"""自定制 排除一些特定的URL"""')]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token triple-quoted-string string"}},[s._v('"""\n    AUTO_DISCOVER_EXCLUDE = [\n        \'/admin/.*\',\n        \'/rbac/login/\',\n    ]\n    """')]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" regex "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" settings"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("AUTO_DISCOVER_EXCLUDE"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" re"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("match")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("regex"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" url"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("True")]),s._v("\n\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("recursion_url")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("pre_namespace"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" pre_url"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" urlpatterns"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" url_ordered_dict"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token triple-quoted-string string"}},[s._v('"""\n    用于递归的获取URL\n    :param pre_namespace: namespace前缀,以后用于拼接name\n    :param pre_url: url前缀,以后用于拼接url\n    :param urlpatterns: 路由关系列表\n    :param url_ordered_dict: 用于保存递归中获取的所有路由\n    :return:\n    """')]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" item "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" urlpatterns"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token triple-quoted-string string"}},[s._v("\"\"\" eg: 根路由下的urlpatterns循环出来的item\n        <URLResolver <URLPattern list> (admin:admin) 'admin/'>\n        <URLResolver <module 'apps.rbac.urls' from '/Desktop/dc_crm/apps/rbac/urls.py'> (rbac:rbac) 'rbac/'>\n        <URLResolver <module 'apps.web.urls' from '/Desktop/dc_crm/apps/web/urls.py'> (None:None) 'web/'>\n        <URLPattern 'xxx/'>\n        - Django1.x中是RegexURLResolver、RegexURLPattern \n          -- from django.urls import RegexURLResolver, RegexURLPattern\n        - Django2.x开始是URLResolver、URLPattern \n          -- from django.urls.resolvers import URLResolver, URLPattern\n        \"\"\"")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("isinstance")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("item"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" URLResolver"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 证明是路由分发,那么需要进行递归操作!!")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ■ 该语句体里表明,是进行路由分发的路由,该路由肯定不具备name值的,所以只能先对namespace进行处理!!")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# [前面n级路由分发拼接的namespace] [当前的路由分发的namespace] 有 无 -- 排列组合,一共四种情况 Hhh")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 情况1: 当前路由分发有namespace和前面的n级路由分发经过迭代后拼接的namespace 都有,再次进行拼接")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" pre_namespace "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("and")]),s._v(" item"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("namespace"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("  \n                namespace "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string-interpolation"}},[n("span",{pre:!0,attrs:{class:"token string"}},[s._v('f"')]),n("span",{pre:!0,attrs:{class:"token interpolation"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("pre_namespace"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")])]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token interpolation"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("item"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("namespace"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")])]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"')])]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 情况2: 前面的n级路由分发都没有namespace,当前路由分发有")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("elif")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("not")]),s._v(" pre_namespace "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("and")]),s._v(" item"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("namespace"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n                namespace "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" item"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("namespace\n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 情况3: 前面的n级路由分发经过迭代后拼接的namespace 有, 当前路由分发没有")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("elif")]),s._v(" pre_namespace "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("and")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("not")]),s._v(" item"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("namespace"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("  \n                namespace "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" pre_namespace\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 情况4: 所有的路由分发都没有namespace")]),s._v("\n                namespace "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("None")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token triple-quoted-string string"}},[s._v('"""\n            - Django1.x中这么写\n              recursion_urls(namespace, pre_url + item.regex.pattern, item.url_patterns, url_ordered_dict)\n            - Django2以上不支持 item.regex\n              item.regex.pattern 应改为 item.pattern.regex.pattern\n            """')]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ■ url需要拼接当前路由的url前缀!! Ps: 你无需担心path中的<str:pk>之类的写法,它内部会自动转换为正则的样式!!")]),s._v("\n            url "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" pre_url "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" item"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pattern"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("regex"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pattern\n            recursion_url"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("namespace"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" url"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" item"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("url_patterns"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" url_ordered_dict"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# <★开始递归>")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# <★★★其实它就是递归结束的条件,尽管执行它时,return的是None 也证明开始了回溯的过程!!>")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("elif")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("isinstance")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("item"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" URLPattern"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 证明是非路由分发,那么需将路由添加到url_ordered_dict字典中!")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("not")]),s._v(" item"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 该url没有name,那么就不管")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("continue")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 若该url的上一级进行了路由分发,分发时设置了namespace,那么需要将namespace与当前name进行拼接!")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" pre_namespace"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n                name "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"%s:%s"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("pre_namespace"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" item"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n                name "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" item"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("name\n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 同理,若该url的上一级进行了路由分发,分发时设置了url前缀,那么需要进行拼接! 前缀 + 当前url")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# 仔细想一想,其实每个上一级都有url前缀,哪怕是根路由,我们也手动传入了 "/" 前缀')]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# item.pattern.regex.pattern 可取到当前路由的url, Don't ask me why, 武sir在源码中看到的!")]),s._v("\n            url "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" pre_url "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" item"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pattern"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("regex"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pattern\n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# eg: /^rbac/^user/edit/(?P<pk>\\d+)/$ --\x3e /rbac/user/edit/(?P<pk>\\d+)/")]),s._v("\n            url "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" url"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("replace"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'^'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("replace"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'$'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# □ 排除的自定制!! 比如排除,admin为前缀的url、login登陆")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" check_url_exclude"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("url"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("continue")]),s._v("\n            url_ordered_dict"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"name"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"url"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" url"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("get_all_url_dict")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token triple-quoted-string string"}},[s._v('"""获取项目中所有的<有name>的URL (约定前提:URL必须得有name别名该URL才能被自动发现!!)"""')]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# eg: {"rbac:menu_list":{"name":"rbac:menu_list","url":"/rbac/menu/list/"},...,...}')]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 为啥要这么构建数据结构?")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 1.name值我们在数据库里设置了unique=True,具备唯一性,所有name值可以作为key")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 2.name还可以做粒度控制到按钮的权限判断")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# So,我们约定俗成,项目中的url必须设置name,不然不会自动找到它!!")]),s._v("\n    url_ordered_dict "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" OrderedDict"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# settings.ROOT_URLCONF 表明根路由的路径,我们需根据字符串的形式导入该模块")]),s._v("\n    md "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" import_string"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("settings"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ROOT_URLCONF"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 'dc_crm.urls' --\x3e from dc_crm import urls")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# [item for item in md.urlpatterns] # item ==> RegexURLResolver/URLResolver   RegexURLPattern/URLPattern")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 调用它帮助我们递归的去获取所有路由 注:")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 1. 根路由是没有上一级的,也就不存在分发,所以一开始pre_namespace值为None")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# 2. 给根路由的url前面都加上"/",所以一开始pre_url值为"/"')]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 3. md.urlpatterns根路由的路由关系列表")]),s._v("\n    recursion_url"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("None")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" md"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("urlpatterns"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" url_ordered_dict"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" url_ordered_dict\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br"),n("span",{staticClass:"line-number"},[s._v("63")]),n("br"),n("span",{staticClass:"line-number"},[s._v("64")]),n("br"),n("span",{staticClass:"line-number"},[s._v("65")]),n("br"),n("span",{staticClass:"line-number"},[s._v("66")]),n("br"),n("span",{staticClass:"line-number"},[s._v("67")]),n("br"),n("span",{staticClass:"line-number"},[s._v("68")]),n("br"),n("span",{staticClass:"line-number"},[s._v("69")]),n("br"),n("span",{staticClass:"line-number"},[s._v("70")]),n("br"),n("span",{staticClass:"line-number"},[s._v("71")]),n("br"),n("span",{staticClass:"line-number"},[s._v("72")]),n("br"),n("span",{staticClass:"line-number"},[s._v("73")]),n("br"),n("span",{staticClass:"line-number"},[s._v("74")]),n("br"),n("span",{staticClass:"line-number"},[s._v("75")]),n("br"),n("span",{staticClass:"line-number"},[s._v("76")]),n("br"),n("span",{staticClass:"line-number"},[s._v("77")]),n("br"),n("span",{staticClass:"line-number"},[s._v("78")]),n("br"),n("span",{staticClass:"line-number"},[s._v("79")]),n("br"),n("span",{staticClass:"line-number"},[s._v("80")]),n("br"),n("span",{staticClass:"line-number"},[s._v("81")]),n("br"),n("span",{staticClass:"line-number"},[s._v("82")]),n("br"),n("span",{staticClass:"line-number"},[s._v("83")]),n("br"),n("span",{staticClass:"line-number"},[s._v("84")]),n("br"),n("span",{staticClass:"line-number"},[s._v("85")]),n("br"),n("span",{staticClass:"line-number"},[s._v("86")]),n("br"),n("span",{staticClass:"line-number"},[s._v("87")]),n("br"),n("span",{staticClass:"line-number"},[s._v("88")]),n("br"),n("span",{staticClass:"line-number"},[s._v("89")]),n("br"),n("span",{staticClass:"line-number"},[s._v("90")]),n("br"),n("span",{staticClass:"line-number"},[s._v("91")]),n("br"),n("span",{staticClass:"line-number"},[s._v("92")]),n("br"),n("span",{staticClass:"line-number"},[s._v("93")]),n("br"),n("span",{staticClass:"line-number"},[s._v("94")]),n("br"),n("span",{staticClass:"line-number"},[s._v("95")]),n("br"),n("span",{staticClass:"line-number"},[s._v("96")]),n("br"),n("span",{staticClass:"line-number"},[s._v("97")]),n("br"),n("span",{staticClass:"line-number"},[s._v("98")]),n("br"),n("span",{staticClass:"line-number"},[s._v("99")]),n("br"),n("span",{staticClass:"line-number"},[s._v("100")]),n("br"),n("span",{staticClass:"line-number"},[s._v("101")]),n("br")])]),n("hr"),s._v(" "),n("h2",{attrs:{id:"权限的批量操作"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#权限的批量操作"}},[s._v("#")]),s._v(" 权限的批量操作")]),s._v(" "),n("blockquote",[n("p",[s._v("在上面我们已经学会两个前置知识点: formset的使用 + 自动发现项目中的URL"),n("br"),s._v("\n该小节 我们来完成权限的批量操作!!"),n("br"),s._v(" "),n("strong",[s._v("基本思路:")]),n("br"),s._v("\n     集合1 - 自动发现,获取项目中所有的URL -- name集合"),n("br"),s._v("\n     集合2 - 获取数据库中已添加的所有的URL -- name集合"),n("br"),s._v("\n     对比两个集合,整理出应该添加、删除、修改的权限有哪些?!"),n("br"),s._v("\n     - 数据库URL > 项目发现的URL, 删除权限."),n("br"),s._v("\n     - 数据库URL < 项目发现的URL, 增加权限."),n("br"),s._v("\n     - 数据库URL & 项目发现的URL, 更新权限.")])]),s._v(" "),n("p",[s._v("我就直接粘贴代码啦, 注释写得很清楚了!! "),n("font",{attrs:{color:"gray"}},[s._v('(本来想截图的, 篇幅太长了, 截不好 ╮(￣▽￣"")╭ 这样反而省事了')])],1),s._v(" "),n("p",[n("img",{attrs:{src:a(925),alt:"image-20240312212252421"}})]),s._v(" "),n("p",[s._v("提醒几点:")]),s._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[s._v("■ 批量操作的页面有三个面板"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" 当第一个面板执行post请求"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" 提交有错误时"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" 会在第一个面板上显示错误"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n但一定要注意此时第二个第三个面板中的数据也是要有的!! 我做了以下两个努力"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.")]),s._v(" 我使用了Django的CBV的写法"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("让代码看起来更加清晰\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.")]),s._v(" 我封装了一个方法get_mutil_data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" 获取需在页面上展示的数据"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("GET、POST请求都要执行它!!\n你听起来可能云里雾里的"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("但相信我"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("你看代码就很容易明白啦!!\n\n■ Form组件中"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("细品下这行代码  ★核心思想在于"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("menu和pid不能同时为空但有且只有一个有值!!\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 获得应该归属的二级菜单!!")]),s._v("\nself"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("fields"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'pid_id'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("choices "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+=")]),s._v(" models"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Permission"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("objects"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("filter")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("pid__isnull"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("True")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" \\\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("exclude"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v(" menu__isnull"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("True")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("values_list"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'id'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'title'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 其实还有种写法是等效的!! ")]),s._v("\nself"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("fields"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'pid_id'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("choices "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+=")]),s._v(" models"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Permission"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("objects"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("filter")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("menu__isnull"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("False")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" \\\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("exclude"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("pid__isnull"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("False")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("values_list"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'id'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'title'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n■ 在批量添加的代码中"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("细品下批量进行添加"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("减轻数据库负担"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("就不用每次连接数据库进行增加"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n  此处结合new_object"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("validate_unique"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("的思考!!\n  \n\n■ 实现权限的批量增加"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("权限批量更新"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("一个个的删除\n  新增"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("更新\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"☆★★!!!"')]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("button "),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("type")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"submit"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("按钮 或者 "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("input")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("type")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"submit"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("表单控件 都可以点击后通过form表单post请求进行提交\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" 记得在前端form表单中写上 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),s._v(" csrf_token "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" formset"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("management_form "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("form method"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"post"')]),s._v(" action"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"?type=generate"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("form method"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"post"')]),s._v(" action"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"?type=update"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" \n    \n■ 其它\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" Layui弹层layer中select没CSS样式或渲染失效的解决方法\n  必须给表单体系所在的父元素加上 "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"layui-form"')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" Django中form组件的所有内置字段\n  https"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("//")]),s._v("blog"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("csdn"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("net"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("weixin_30835933"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("article"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("details"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("98952153")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br")])]),n("p",[s._v("■ apps/rbac/views/menu/routers.py")]),s._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" django"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("urls "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" path\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" views\n\nurlpatterns "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n    path"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'list/'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" views"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("menu_list"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" name"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'menu_list'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 一级菜单列表+二级菜单列表+非菜单权限列表")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 一级菜单的CUD")]),s._v("\n    path"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'add/'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" views"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("menu_add"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" name"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'menu_add'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    path"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'edit/<int:pk>/'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" views"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("menu_edit"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" name"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'menu_edit'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    path"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'del/<int:pk>/'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" views"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("menu_del"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" name"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'menu_del'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 二级菜单的CUD")]),s._v("\n    path"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'second/add/<int:first_menu_id>/'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" views"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("menu_second_add"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" name"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'menu_second_add'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    path"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'second/edit/<int:pk>/'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" views"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("menu_second_edit"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" name"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'menu_second_edit'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    path"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'second/del/<int:pk>/'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" views"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("menu_second_del"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" name"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'menu_second_del'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 非菜单权限的CUD")]),s._v("\n    path"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'permission/add/<int:second_menu_id>/'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" views"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("permission_add"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" name"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'permission_add'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    path"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'permission/edit/<int:pk>/'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" views"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("permission_edit"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" name"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'permission_edit'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    path"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'permission/del/<int:pk>/'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" views"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("permission_del"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" name"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'permission_del'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 批量操作")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# path('mutil/permissions/', views.multi_permissions, name='mutil_permissions'),")]),s._v("\n    path"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'mutil/permissions/'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" views"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("MultiPermissionsView"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("as_view"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" name"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'multi_permissions'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    path"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'multi/permissions/del/<int:pk>/'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" views"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("multi_permissions_del"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" name"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'multi_permissions_del'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br")])]),n("p",[s._v("■ apps/rbac/views/menu/form.py")]),s._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MultiAddPermissionForm")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("forms"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Form"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 特别注意哦!这里使用的是forms.Form")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token triple-quoted-string string"}},[s._v('"""用于批量添加"""')]),s._v("\n    title "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" forms"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("CharField"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n        widget"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("forms"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("TextInput"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("attrs"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'class'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"layui-input"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    url "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" forms"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("CharField"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n        widget"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("forms"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("TextInput"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("attrs"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'class'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"layui-input"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    name "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" forms"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("CharField"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n        widget"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("forms"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("TextInput"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("attrs"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'class'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"layui-input"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    menu_id "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" forms"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ChoiceField"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n        choices"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("None")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'-----'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        widget"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("forms"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Select"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("attrs"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'class'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"layui-input"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        required"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("False")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    pid_id "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" forms"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ChoiceField"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n        choices"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("None")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'-----'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        widget"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("forms"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Select"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("attrs"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'class'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"layui-input"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"style"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"width:10px"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        required"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("False")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("__init__")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("args"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("**")]),s._v("kwargs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("super")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("__init__"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("args"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("**")]),s._v("kwargs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" field "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("fields"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("items"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            field"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("widget"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("attrs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'autocomplete'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"off"')]),s._v("\n        self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("fields"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'menu_id'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("choices "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+=")]),s._v(" models"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Menu"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("objects"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("values_list"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'id'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'title'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 我们的默认是menu_id和pid_id一有值一无值,可能存在两个都无值,但不会存在两个都有值")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# pid__isnull=True证明是二级菜单权限了,那么menu_id一定要有值 ")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# So,这里有排除了menu__isnull=True 保证不会出现两个都没值的情况 ")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 两个都没值 - 应该是一开始添加的权限没进行分配的时候")]),s._v("\n        self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("fields"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'pid_id'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("choices "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+=")]),s._v(" models"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Permission"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("objects"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("filter")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("pid__isnull"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("True")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("exclude"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n            menu__isnull"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("True")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("values_list"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'id'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'title'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MultiEditPermissionForm")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("forms"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Form"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token triple-quoted-string string"}},[s._v('"""用于批量更新"""')]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("id")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" forms"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("IntegerField"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n        widget"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("forms"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("HiddenInput"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n    title "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" forms"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("CharField"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n        widget"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("forms"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("TextInput"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("attrs"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'class'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"layui-input"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    url "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" forms"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("CharField"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n        widget"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("forms"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("TextInput"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("attrs"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'class'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"layui-input"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    name "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" forms"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("CharField"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n        widget"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("forms"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("TextInput"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("attrs"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'class'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"layui-input"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    menu_id "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" forms"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ChoiceField"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n        choices"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("None")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'-----'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        widget"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("forms"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Select"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("attrs"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'class'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"layui-input"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        required"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("False")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n    pid_id "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" forms"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ChoiceField"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n        choices"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("None")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'-----'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        widget"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("forms"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Select"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("attrs"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'class'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"layui-input"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        required"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("False")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("__init__")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("args"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("**")]),s._v("kwargs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("super")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("__init__"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("args"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("**")]),s._v("kwargs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" field "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("fields"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("items"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            field"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("widget"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("attrs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'autocomplete'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"off"')]),s._v("\n        self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("fields"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'menu_id'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("choices "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+=")]),s._v(" models"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Menu"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("objects"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("values_list"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'id'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'title'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("fields"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'pid_id'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("choices "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+=")]),s._v(" models"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Permission"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("objects"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("filter")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("pid__isnull"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("True")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("exclude"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n            menu__isnull"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("True")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("values_list"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'id'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'title'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br"),n("span",{staticClass:"line-number"},[s._v("63")]),n("br"),n("span",{staticClass:"line-number"},[s._v("64")]),n("br"),n("span",{staticClass:"line-number"},[s._v("65")]),n("br"),n("span",{staticClass:"line-number"},[s._v("66")]),n("br"),n("span",{staticClass:"line-number"},[s._v("67")]),n("br"),n("span",{staticClass:"line-number"},[s._v("68")]),n("br"),n("span",{staticClass:"line-number"},[s._v("69")]),n("br")])]),n("p",[s._v("■ apps/rbac/views/menu/views.py")]),s._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MultiPermissionsView")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("View"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    generate_formset "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("None")]),s._v("\n    update_formset "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("None")]),s._v("\n    delete_row_list "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("get_mutil_data")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token triple-quoted-string string"}},[s._v('"""获取需在页面上展示的数据,GET、POST请求都要执行它!Hhh"""')]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# step1: 自动发现,获取项目中所有的URL -- name集合")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# eg: {"rbac:menu_list":{"name":"rbac:menu_list","url":"/rbac/menu/list/"},...,...}')]),s._v("\n        all_url_dict "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" get_all_url_dict"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        router_name_set "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("set")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("all_url_dict"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("keys"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 获得路由对应的name 集合!")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# step2: 获取数据库中已添加的所有的URL -- name集合")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# permissions --\x3e queryset对象[{},{}..]")]),s._v("\n        permissions "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" models"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Permission"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("objects"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("all")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("values"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"id"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"title"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"name"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"url"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"menu_id"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"pid_id"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" \n        permission_dict "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" OrderedDict"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        permission_name_set "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("set")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" row "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" permissions"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            permission_dict"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("row"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"name"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" row\n            permission_name_set"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("add"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("row"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"name"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# step3: 对比两个集合,整理出应该添加、删除、修改的权限有哪些?!")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 1> 计算出应该增加的name -- 程序中有db中没有,相减得应该往db中添加的 So,循环的是all_url_dict")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("not")]),s._v(" self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("generate_formset"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ◆ 若是POST请求,这个if函数体的代码就不用执行")]),s._v("\n            generate_name_set "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" router_name_set "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" permission_name_set\n            generate_formset_class "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" formset_factory"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("MultiAddPermissionForm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" extra"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# formset批量增加")]),s._v("\n            self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("generate_formset "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" generate_formset_class"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("initial"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n                row_dict "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" row_dict "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" all_url_dict"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("items"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" name "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" generate_name_set\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 2> 计算出应该更新的name -- db中有程序中也有,两者取完交集就是要更新的")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("not")]),s._v(" self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("update_formset"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ◆ 若是POST请求,这个if函数体的代码就不用执行")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Q:循环谁? A:循环permission_dict,因为db中还有menu_id,pid_id")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 思考:")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   需要更新的记录,name值肯定一样、url还需要判断是否一样")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   若不一样,应该以程序中的为准")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   <这里我们让用户自行选择,因为程序中的可能因为手贱写错了,多打了一个字符>,不然项目的某些功能会出问题.")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" value "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" permission_dict"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("items"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n                router_row_dict "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" all_url_dict"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("get"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# and第一个条件表明db中有程序中也有!! 若router_row_dict的bool值为False,表明db中有,程序中没有,这里直接不管")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# if not router_row_dict:")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#     continue")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" router_row_dict "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("and")]),s._v(" value"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'url'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" router_row_dict"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'url'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n                    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# permission_dict中对应记录的url字段的值进行了修改,用于提示用户,这个赋值并没有同步数据库哈Hhh")]),s._v("\n                    value"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'url'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'路由和数据库中不一致'")]),s._v("  \n            update_name_list "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" router_name_set "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v(" permission_name_set\n            update_formset_class "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" formset_factory"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("MultiEditPermissionForm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" extra"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# formset批量更新 ☆必须要有个隐藏的ID")]),s._v("\n            self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("update_formset "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" update_formset_class"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("initial"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n                row_dict "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" row_dict "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" permission_dict"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("items"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" name "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" update_name_list\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 3> 计算出应该删除的name -- db中有程序中没有,相减得应该在db中删除的 So,循环的是permission_dict")]),s._v("\n        delete_name_set "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" permission_name_set "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" router_name_set\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 不会批量删除,一股脑的批量删除不好,因为可能是百度合作的地址之类的!!")]),s._v("\n        self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("delete_row_list "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" \\\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("row_dict "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" row_dict "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" permission_dict"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("items"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" name "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" delete_name_set"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" request"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("args"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("**")]),s._v("kwargs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("get_mutil_data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" render"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("request"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'rbac/menu/multi_permissions.html'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'generate_formset'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("generate_formset"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# formset批量增加 的数据")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'delete_row_list'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("delete_row_list"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 删除的数据列表 的数据")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'update_formset'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("update_formset"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# formset批量更新 的数据 ☆必须要有个隐藏的ID")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("post")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" request"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("args"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("**")]),s._v("kwargs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        post_type "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" request"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("GET"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("get"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'type'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        generate_formset_class "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" formset_factory"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("MultiAddPermissionForm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" extra"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        update_formset_class "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" formset_factory"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("MultiEditPermissionForm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" extra"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 批量添加")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" post_type "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'generate'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            formset "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" generate_formset_class"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("data"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("request"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("POST"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# print(request.POST)")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" formset"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("is_valid"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n                object_list "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n                has_error "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("False")]),s._v("\n                post_row_list "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" formset"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("cleaned_data  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 通过表单验证成功的数据,但还需手动进行唯一索引验证!!")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" i "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("range")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" formset"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("total_form_count"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n                    row_dict "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" post_row_list"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("i"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n                    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("print")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("row_dict"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n                        new_object "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" models"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Permission"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("**")]),s._v("row_dict"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                        "),n("span",{pre:!0,attrs:{class:"token triple-quoted-string string"}},[s._v('"""\n                        不得不提的是,validate_unique是先看ORM表中哪个字段(eg:name字段)有唯一索引,\n                        然后去db数据库中跟已有数据进行比对!!\n                        这里,我们的代码逻辑是连接一次数据库,添加多条数据,\n                        所以 新增的那些行数据如果有name值相同的,该行代码是检查不出来的.\n                        但回过头来想想,name值是程序员自己设定的,设定重复了,就是自己蠢.\n                        再者,你回顾自动发现url的代码逻辑,name作为字段的key值,发现了重复的name,直接就覆盖了!!\n                        So,此处模版中 待新增表格中的name字段必不可能重复. \n                        综合下来,只要不是人为的修改,添加到db中的name值也必不可能重复!!\n                        >>> my_dict = {}\n                        >>> my_dict["1"] = 2\n                        >>> my_dict\n                        {\'1\': 2}\n                        >>> my_dict["1"] = 3\n                        >>> my_dict\n                        {\'1\': 3}\n                        """')]),s._v("\n                        new_object"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("validate_unique"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 未抛出异常,则唯一索引验证通过")]),s._v("\n                        object_list"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("append"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("new_object"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("except")]),s._v(" Exception "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("as")]),s._v(" e"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n                        formset"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("errors"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("i"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("update"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("e"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 唯一索引的错误添加到formset中!!")]),s._v("\n                        self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("generate_formset "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" formset  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# （¯﹃¯）")]),s._v("\n                        has_error "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("True")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("not")]),s._v(" has_error"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n                    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# **批量进行添加,减轻数据库负担 就不用每次连接数据库进行增加 放心大胆的用!!")]),s._v("\n                    models"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Permission"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("objects"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("bulk_create"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("object_list"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" batch_size"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# is_valid()未验证通过")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 错误信息在formset里,赋值给了类实例对象的generate_formset,根据查找规则,会用它,而不会用类里的.")]),s._v("\n                self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("generate_formset "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" formset  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# （¯﹃¯）")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 批量更新")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" post_type "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'update'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            formset "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" update_formset_class"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("data"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("request"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("POST"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" formset"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("is_valid"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n                post_row_list "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" formset"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("cleaned_data\n                "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" i "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("range")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" formset"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("total_form_count"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n                    row_dict "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" post_row_list"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("i"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n                    permission_id "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" row_dict"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pop"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'id'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 拿到那个隐藏的ID,你才知道更新哪个嘛!")]),s._v("\n                    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n                        row_object "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" models"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Permission"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("objects"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("filter")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("id")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("permission_id"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("first"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" k"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" v "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" row_dict"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("items"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n                            "),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("setattr")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("row_object"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" k"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" v"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                        row_object"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("validate_unique"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                        row_object"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("save"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 鬼知道为啥这里又一行行的save到db中.Hhh")]),s._v("\n                    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("except")]),s._v(" Exception "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("as")]),s._v(" e"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n                        formset"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("errors"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("i"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("update"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("e"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                        self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("update_formset "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" formset\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n                self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("update_formset "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" formset\n\n        self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("get_mutil_data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" render"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("request"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'rbac/menu/multi_permissions.html'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'generate_formset'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("generate_formset"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'delete_row_list'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("delete_row_list"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'update_formset'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("update_formset"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("multi_permissions_del")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("request"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" pk"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token triple-quoted-string string"}},[s._v('"""批量页面的权限删除"""')]),s._v("\n    url "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" memory_reverse"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("request"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'rbac:multi_permissions'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" request"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("method "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'GET'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" render"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("request"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'rbac/delete.html'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'cancel'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" url"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n    models"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Permission"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("objects"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("filter")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("id")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("pk"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("delete"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" redirect"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("url"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br"),n("span",{staticClass:"line-number"},[s._v("63")]),n("br"),n("span",{staticClass:"line-number"},[s._v("64")]),n("br"),n("span",{staticClass:"line-number"},[s._v("65")]),n("br"),n("span",{staticClass:"line-number"},[s._v("66")]),n("br"),n("span",{staticClass:"line-number"},[s._v("67")]),n("br"),n("span",{staticClass:"line-number"},[s._v("68")]),n("br"),n("span",{staticClass:"line-number"},[s._v("69")]),n("br"),n("span",{staticClass:"line-number"},[s._v("70")]),n("br"),n("span",{staticClass:"line-number"},[s._v("71")]),n("br"),n("span",{staticClass:"line-number"},[s._v("72")]),n("br"),n("span",{staticClass:"line-number"},[s._v("73")]),n("br"),n("span",{staticClass:"line-number"},[s._v("74")]),n("br"),n("span",{staticClass:"line-number"},[s._v("75")]),n("br"),n("span",{staticClass:"line-number"},[s._v("76")]),n("br"),n("span",{staticClass:"line-number"},[s._v("77")]),n("br"),n("span",{staticClass:"line-number"},[s._v("78")]),n("br"),n("span",{staticClass:"line-number"},[s._v("79")]),n("br"),n("span",{staticClass:"line-number"},[s._v("80")]),n("br"),n("span",{staticClass:"line-number"},[s._v("81")]),n("br"),n("span",{staticClass:"line-number"},[s._v("82")]),n("br"),n("span",{staticClass:"line-number"},[s._v("83")]),n("br"),n("span",{staticClass:"line-number"},[s._v("84")]),n("br"),n("span",{staticClass:"line-number"},[s._v("85")]),n("br"),n("span",{staticClass:"line-number"},[s._v("86")]),n("br"),n("span",{staticClass:"line-number"},[s._v("87")]),n("br"),n("span",{staticClass:"line-number"},[s._v("88")]),n("br"),n("span",{staticClass:"line-number"},[s._v("89")]),n("br"),n("span",{staticClass:"line-number"},[s._v("90")]),n("br"),n("span",{staticClass:"line-number"},[s._v("91")]),n("br"),n("span",{staticClass:"line-number"},[s._v("92")]),n("br"),n("span",{staticClass:"line-number"},[s._v("93")]),n("br"),n("span",{staticClass:"line-number"},[s._v("94")]),n("br"),n("span",{staticClass:"line-number"},[s._v("95")]),n("br"),n("span",{staticClass:"line-number"},[s._v("96")]),n("br"),n("span",{staticClass:"line-number"},[s._v("97")]),n("br"),n("span",{staticClass:"line-number"},[s._v("98")]),n("br"),n("span",{staticClass:"line-number"},[s._v("99")]),n("br"),n("span",{staticClass:"line-number"},[s._v("100")]),n("br"),n("span",{staticClass:"line-number"},[s._v("101")]),n("br"),n("span",{staticClass:"line-number"},[s._v("102")]),n("br"),n("span",{staticClass:"line-number"},[s._v("103")]),n("br"),n("span",{staticClass:"line-number"},[s._v("104")]),n("br"),n("span",{staticClass:"line-number"},[s._v("105")]),n("br"),n("span",{staticClass:"line-number"},[s._v("106")]),n("br"),n("span",{staticClass:"line-number"},[s._v("107")]),n("br"),n("span",{staticClass:"line-number"},[s._v("108")]),n("br"),n("span",{staticClass:"line-number"},[s._v("109")]),n("br"),n("span",{staticClass:"line-number"},[s._v("110")]),n("br"),n("span",{staticClass:"line-number"},[s._v("111")]),n("br"),n("span",{staticClass:"line-number"},[s._v("112")]),n("br"),n("span",{staticClass:"line-number"},[s._v("113")]),n("br"),n("span",{staticClass:"line-number"},[s._v("114")]),n("br"),n("span",{staticClass:"line-number"},[s._v("115")]),n("br"),n("span",{staticClass:"line-number"},[s._v("116")]),n("br"),n("span",{staticClass:"line-number"},[s._v("117")]),n("br"),n("span",{staticClass:"line-number"},[s._v("118")]),n("br"),n("span",{staticClass:"line-number"},[s._v("119")]),n("br"),n("span",{staticClass:"line-number"},[s._v("120")]),n("br"),n("span",{staticClass:"line-number"},[s._v("121")]),n("br"),n("span",{staticClass:"line-number"},[s._v("122")]),n("br"),n("span",{staticClass:"line-number"},[s._v("123")]),n("br"),n("span",{staticClass:"line-number"},[s._v("124")]),n("br"),n("span",{staticClass:"line-number"},[s._v("125")]),n("br"),n("span",{staticClass:"line-number"},[s._v("126")]),n("br"),n("span",{staticClass:"line-number"},[s._v("127")]),n("br"),n("span",{staticClass:"line-number"},[s._v("128")]),n("br"),n("span",{staticClass:"line-number"},[s._v("129")]),n("br"),n("span",{staticClass:"line-number"},[s._v("130")]),n("br"),n("span",{staticClass:"line-number"},[s._v("131")]),n("br"),n("span",{staticClass:"line-number"},[s._v("132")]),n("br"),n("span",{staticClass:"line-number"},[s._v("133")]),n("br"),n("span",{staticClass:"line-number"},[s._v("134")]),n("br"),n("span",{staticClass:"line-number"},[s._v("135")]),n("br"),n("span",{staticClass:"line-number"},[s._v("136")]),n("br"),n("span",{staticClass:"line-number"},[s._v("137")]),n("br"),n("span",{staticClass:"line-number"},[s._v("138")]),n("br"),n("span",{staticClass:"line-number"},[s._v("139")]),n("br"),n("span",{staticClass:"line-number"},[s._v("140")]),n("br"),n("span",{staticClass:"line-number"},[s._v("141")]),n("br"),n("span",{staticClass:"line-number"},[s._v("142")]),n("br"),n("span",{staticClass:"line-number"},[s._v("143")]),n("br"),n("span",{staticClass:"line-number"},[s._v("144")]),n("br"),n("span",{staticClass:"line-number"},[s._v("145")]),n("br"),n("span",{staticClass:"line-number"},[s._v("146")]),n("br"),n("span",{staticClass:"line-number"},[s._v("147")]),n("br")])]),n("hr")])}),[],!1,null,null,null);t.default=e.exports},910:function(s,t,a){s.exports=a.p+"assets/img/37.ffcff0dd.gif"},911:function(s,t,a){s.exports=a.p+"assets/img/image-20240310161525443.c2b9e138.png"},912:function(s,t,a){s.exports=a.p+"assets/img/image-20240310161043422.f2a849f9.png"},913:function(s,t,a){s.exports=a.p+"assets/img/38.b8cb7562.gif"},914:function(s,t,a){s.exports=a.p+"assets/img/image-20240310163033573.2b86ba70.png"},915:function(s,t,a){s.exports=a.p+"assets/img/image-20240310205003724.f41cc921.png"},916:function(s,t,a){s.exports=a.p+"assets/img/image-20240310205316594.574744c7.png"},917:function(s,t,a){s.exports=a.p+"assets/img/image-20240311161309874.d80362a0.png"},918:function(s,t,a){s.exports=a.p+"assets/img/image-20240311190537649.f8da6a60.png"},919:function(s,t,a){s.exports=a.p+"assets/img/39.e815ba23.gif"},920:function(s,t,a){s.exports=a.p+"assets/img/image-20240311192547467.70995d2a.png"},921:function(s,t,a){s.exports=a.p+"assets/img/image-20240312140246017.93a7abca.png"},922:function(s,t,a){s.exports=a.p+"assets/img/image-20240312151447981.3155e064.png"},923:function(s,t,a){s.exports=a.p+"assets/img/image-20240312203738343.ae99d83c.png"},924:function(s,t,a){s.exports=a.p+"assets/img/image-20240312205717494.917d4667.png"},925:function(s,t,a){s.exports=a.p+"assets/img/image-20240312212252421.6bd1084d.png"}}]);