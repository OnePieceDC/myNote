(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{1e3:function(s,t,a){s.exports=a.p+"assets/img/image-20231215173522505.36979641.png"},1001:function(s,t,a){s.exports=a.p+"assets/img/image-20231215183733059.a288c25f.png"},1002:function(s,t,a){s.exports=a.p+"assets/img/17.8cf5c6c6.gif"},1003:function(s,t,a){s.exports=a.p+"assets/img/image-20231213132348476.3dac88f2.png"},1004:function(s,t,a){s.exports=a.p+"assets/img/18.2d0c9913.gif"},1005:function(s,t,a){s.exports=a.p+"assets/img/image-20231215182025421.290da851.png"},1006:function(s,t,a){s.exports=a.p+"assets/img/image-20231215182940665.ecc221d5.png"},1007:function(s,t,a){s.exports=a.p+"assets/img/19.9179ae56.gif"},1008:function(s,t,a){s.exports=a.p+"assets/img/image-20231218174236956.3ab5b742.png"},1009:function(s,t,a){s.exports=a.p+"assets/img/image-20231218173646087.adb1052b.png"},1010:function(s,t,a){s.exports=a.p+"assets/img/image-20231219094545496.e5d0234e.png"},1011:function(s,t,a){s.exports=a.p+"assets/img/image-20231219105907887.da024ff0.png"},1012:function(s,t,a){s.exports=a.p+"assets/img/20.e1beb9ed.gif"},1013:function(s,t,a){s.exports=a.p+"assets/img/21.fff3c7c4.gif"},1014:function(s,t,a){s.exports=a.p+"assets/img/22.19bf9517.gif"},1015:function(s,t,a){s.exports=a.p+"assets/img/image-20231222134854201.3b83b7b5.png"},1016:function(s,t,a){s.exports=a.p+"assets/img/image-20231222220249036.88a932e1.png"},1017:function(s,t,a){s.exports=a.p+"assets/img/image-20231222223512521.e07baba4.png"},1332:function(s,t,a){"use strict";a.r(t);var n=a(0),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h2",{attrs:{id:"后端上传文件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#后端上传文件"}},[s._v("#")]),s._v(" 后端上传文件")]),s._v(" "),n("blockquote",[n("p",[s._v("我们先用apifox模拟前端上传文件, 完成后端上传文件的代码!!")])]),s._v(" "),n("h3",{attrs:{id:"媒体资源配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#媒体资源配置"}},[s._v("#")]),s._v(" 媒体资源配置")]),s._v(" "),n("blockquote",[n("p",[s._v("静态资源分为 static 和 media"),n("br"),s._v("\n1> static 开发所需的图片、css、js等,常用于前后端不分离时.. eg: 默认头像."),n("br"),s._v("\n2> medis 用户上传的excel、图片等.. eg: 用户上传头像.")]),s._v(" "),n("p",[s._v("media的路径配置、路由配置.. 往后遇到了直接copy即可!!")])]),s._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" 在settings"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("py中进行媒体资源的配置\n MEDIA_URL "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/media/'")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 浏览器上访问媒体文件的url前缀")]),s._v("\n MEDIA_ROOT "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" os"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("path"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("join"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("BASE_DIR"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'media'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 文件目录")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" 在根路由下进行配置\n "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" django"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("urls "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" path"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" re_path"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" include\n "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" django"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("conf "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" settings\n "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" django"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("views"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("static "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" serve\n urlpatterns "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n     path"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'api/shipper/'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" include"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"apps.shipper.urls"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n     re_path"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('r"^media/(?P<path>.*)$"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" serve"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'document_root'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" settings"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("MEDIA_ROOT"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" name"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"media"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -- ★ 配置media路由 的详细说明")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ○ 写法1: re_path(r'^media/(?P<path>.*)', serve, {'document_root': settings.MEDIA_ROOT}),")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#          - 因为媒体文件的访问可能是 /media/banner/1.png 也可能是/media/course/other.png")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#            banner、course是media目录下的文件夹 所以这里的路由用了有名分组,且命名必须叫做path!")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#          - serve是视图函数的内存地址")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#            可以查看导入的serve,它就是一个视图函数,有名分组中的path分出来需要传给它,作为它的第二个参数!!")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#            eg: /media/banner/1.png -> '/banner/1.png' 会作为views视图函数的path实参..")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#          - serve函数还需要传递一个document_root参数.")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#            相当于别人写好了一个视图函数,(?P<path>.*)解析出来后,去settings.MEDIA_ROOT路径下找文件.")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#            url(正则表达式,views视图函数,参数,别名)")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#              正则表达式若分组,会分出来传到视图函数中,若视图函数还缺参数,会在后面通过字典形式传递.")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#       ")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ○ 写法2: path('media/<path:path>', serve, {'document_root': settings.MEDIA_ROOT})")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#          - 使用转换器 转化器叫做path,分出来的key值也叫做path.")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" 为了方便测试"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("在项目根目录下创建名为media的目录"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("在里面添加一张 img"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("png 图片\n  启动后端的Django项目"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("通过 http"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("//")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8000")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("media"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("img"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("png"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" 就能访问到该资源!! "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("注意是后端的"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8000")]),s._v("而不是前端的"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br")])]),n("h3",{attrs:{id:"定义上传路由"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#定义上传路由"}},[s._v("#")]),s._v(" 定义上传路由")]),s._v(" "),n("blockquote",[n("p",[s._v("后端实现上传,需要先定义路由!!定义的方式有两种. 传统的和非传统的!"),n("br"),s._v("\n此处的示例以非传统的为例!")])]),s._v(" "),n("p",[s._v("▲ 传统的."),n("br"),s._v("\n按照传统的方式,我们可以在shipper这个App的url.py中添加一个路由 "),n("code",[s._v("path('upload/', account.UploadView.as_view()),")]),n("br"),s._v("\n因为上传的逻辑是将上传的图片放到media目录下,并不涉及对数据库做增删改查."),n("br"),s._v("\n所以此处的视图类UploadView可以像登陆一样继承APIView,在post方法里写自己的业务逻辑.")]),s._v(" "),n("p",[s._v("▲ 非传统的."),n("br"),s._v(" "),n("strong",[s._v("使用SimpleRouter是前提,再通过action在视图类中自动扩展路由!!")]),n("br"),s._v(" "),n("font",{attrs:{color:"brown"}},[s._v("注意,使用SimpleRouter意味着我们写的视图类必须继承ViewSet类或其子类.")])],1),s._v(" "),n("p",[n("strong",[s._v("思考:")]),s._v(" 并不意味着第二种就比第一种好!两种方式有各自的应用场景."),n("br"),s._v("\n若这个上传是通用的,所有的地方都用该上传,使用方式一; 若只是针对认证功能,只在认证里进行上传,那么使用方式二更好!!")]),s._v(" "),n("p",[n("strong",[s._v("代码实现逻辑如下:")])]),s._v(" "),n("p",[n("img",{attrs:{src:a(999),alt:"image-20231215160210974"}})]),s._v(" "),n("p",[s._v("1> 文件上传的后端API地址, 后端服务网址"),n("code",[s._v("http://127.0.0.1:8000/")]),s._v("+根路由的路由分发"),n("code",[s._v("api/shipper")]),s._v(" +"),n("br"),s._v("\nSimpleRouter注册视图集里的 "),n("code",[s._v("auth")]),s._v(" + 利用action扩展的路由里的url_path的值(示例中detail值为False) "),n("code",[s._v("upload")]),n("br"),s._v("\n2> 截图中利用apifox模拟前端进行文件上传, 选择的是form-data, 其实还可以选择 binary.."),n("br"),s._v("\n详见 第二次学drf中解析器章节里FileUploadParser的使用!!!")]),s._v(" "),n("h3",{attrs:{id:"上传逻辑"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#上传逻辑"}},[s._v("#")]),s._v(" 上传逻辑")]),s._v(" "),n("blockquote",[n("p",[s._v("在上面定义路由的小节中,我们可以已经可以获取到前端传递过来的文件对象.."),n("br"),s._v("\n接下来,我们需要对action匹配的那个upload函数做一些处理, 返还给前端需要的符合规范的json格式的数据!!")])]),s._v(" "),n("p",[s._v("后续有关文件上传,直接copy拿来用即可!!")]),s._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[s._v("关于文件 Django "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" request"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("FILES "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" DRF "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" request"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("data 、request"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("FILES\nrequest"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("data  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# <QueryDict: {'file': [<InMemoryUploadedFile: 存储器.png (image/png)>]}>")]),s._v("\nrequest"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("FILES "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# <MultiValueDict: {'file': [<InMemoryUploadedFile: 存储器.png (image/png)>]}>")]),s._v("\nupload_object "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" request"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("FILES"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("get"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"file"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 获取文件对象,相当于open打开了该文件")]),s._v("\nupload_object"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("size          "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 文件大小")]),s._v("\nupload_object"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("name          "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 文件名字")]),s._v("\nupload_object"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("read"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 一次性获取文件内容")]),s._v("\nupload_object"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("chunks"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 一点一点的读取,此处一次取1024字节 是生成器")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 你可以打印type(upload_object)看里面有什么方法！")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" 读取前端传递过来的文件"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("并保存到服务器中 若自己写的话"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("像下面这样"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" os\nupload_object "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" request"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("FILES"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("get"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"file"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nfile_path "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" os"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("path"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("join"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"media"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" upload_object"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("with")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("open")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("file_path"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'wb'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("as")]),s._v(" f"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" chunk "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" upload_object"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("chunks"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    f"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("write"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("chunk"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" 自己写的保存"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("需要考虑几个问题\n  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" 若上传的图片重名"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("会导致图片覆盖\n  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" 我们想根据日期分类在服务器存储前端上传的图片\n  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" 我们最后需要返回给前端上传的文件在后端存储的路径\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br")])]),n("p",[n("strong",[s._v("关键代码如下:")])]),s._v(" "),n("p",[n("img",{attrs:{src:a(1e3),alt:"image-20231215173522505"}})]),s._v(" "),n("p",[n("strong",[s._v("后端上传的图片路径像是这样:")])]),s._v(" "),n("p",[n("img",{attrs:{src:a(1001),alt:"image-20231215183733059"}})]),s._v(" "),n("hr"),s._v(" "),n("h2",{attrs:{id:"账号认证-页面a"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#账号认证-页面a"}},[s._v("#")]),s._v(" 账号认证 - 页面A")]),s._v(" "),n("blockquote",[n("p",[s._v("实现账号认证,相关信息的展示页面")])]),s._v(" "),n("p",[n("strong",[s._v("页面展示效果如下:")])]),s._v(" "),n("p",[n("img",{attrs:{src:a(1002),alt:"17"}})]),s._v(" "),n("p",[n("strong",[s._v("关键代码如下:")])]),s._v(" "),n("p",[n("img",{attrs:{src:a(1003),alt:"image-20231213132348476"}})]),s._v(" "),n("hr"),s._v(" "),n("h2",{attrs:{id:"账号认证-页面b-上传"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#账号认证-页面b-上传"}},[s._v("#")]),s._v(" 账号认证 - 页面B+上传")]),s._v(" "),n("blockquote",[n("p",[s._v("点击编辑按钮, 跳转认证信息的编辑界面! + 实现上传(elmentPlus 组件会自动发送POST请求进行上传)")])]),s._v(" "),n("p",[s._v("该页面的html太多了,不好截图.. 此小节重点展示两种上传是如何实现的!!")]),s._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[s._v("说在前面"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" upload组件中"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("data属性"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("是用于后面图像识别时区分正反面用的\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" licence_path 为了提交审核到数据库中"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("存储到数据库中的图片路径不应该携带前面的域名信息\n  licence_path_url 为了预览"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("用作预览肯定得是全部路径\n  leader_identity_front、leader_identity_front_url 同理\n  leader_identity_back、leader_identity_back_url 同理\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("p",[n("strong",[s._v("先来看看最终效果")])]),s._v(" "),n("p",[n("img",{attrs:{src:a(1004),alt:"18"}})]),s._v(" "),n("h3",{attrs:{id:"预览图片可放大"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#预览图片可放大"}},[s._v("#")]),s._v(" 预览图片可放大")]),s._v(" "),n("blockquote",[n("p",[s._v("营业执照可以上传并预览放大.."),n("br"),s._v("\n应用的是elementplues Upload上传组件上 自定义缩略图+拖拽上传 这两种方式的结合..")])]),s._v(" "),n("p",[s._v("上传了图片展示预览并可以放大; 没有上传图片展示上传框!")]),s._v(" "),n("p",[n("img",{attrs:{src:a(1005),alt:"image-20231215182025421"}})]),s._v(" "),n("h3",{attrs:{id:"只简单预览"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#只简单预览"}},[s._v("#")]),s._v(" 只简单预览")]),s._v(" "),n("blockquote",[n("p",[s._v("身份证正面和身份证反面就简单的上传并预览"),n("br"),s._v("\n应用的是elementplues Upload上传组件上 用户头像 这种方式!")])]),s._v(" "),n("p",[n("img",{attrs:{src:a(1006),alt:"image-20231215182940665"}})]),s._v(" "),n("hr"),s._v(" "),n("h2",{attrs:{id:"账号认证-ai识别"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#账号认证-ai识别"}},[s._v("#")]),s._v(" 账号认证 - AI识别")]),s._v(" "),n("blockquote",[n("p",[s._v("基于百度AI接口对上传图片内容进行识别")])]),s._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[s._v("领取身份证识别的免费额度 https"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("//")]),s._v("cloud"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("baidu"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("doc"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("OCR"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("s"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("fk3h7xu7h 卡证OCR\n创建应用\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" AppID       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("45048380")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" API Key     zE9gQFGOkXKiDO5TSqyAb6o5\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" Secret Key  By0BjaPWp1ydPIx7ReDuhpuBoWGvM8Wm\n参考官方API文档进行调用\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("p",[n("strong",[s._v("先来看看是咋样的!!")])]),s._v(" "),n("p",[n("img",{attrs:{src:a(1007),alt:"19"}})]),s._v(" "),n("h3",{attrs:{id:"调用官方接口"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#调用官方接口"}},[s._v("#")]),s._v(" 调用官方接口")]),s._v(" "),n("blockquote",[n("p",[s._v("调用官方识别接口")])]),s._v(" "),n("p",[s._v("1> 因为身份证识别和营业执照识别的接口代码基本一致,我根据前端传递的图片类型(front、back、licence)进行了一下封装."),n("br"),s._v("\n2> 为了避免调用官方接口获取access_token,我们会将access_token放到redis中进行缓存."),n("br"),s._v("\n     access_token有过期时间,默认为30天,到期后可重新调用官方接口获取新的access_token进行缓存.")]),s._v(" "),n("p",[n("font",{attrs:{color:"green"}},[s._v("server/utils/baidu_ai.py")])],1),s._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" requests\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" django_redis "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" get_redis_connection\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" base64\n\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("get_token")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token triple-quoted-string string"}},[s._v('"""获取access_token"""')]),s._v("\n    url "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://aip.baidubce.com/oauth/2.0/token"')]),s._v("\n    params "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"grant_type"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"client_credentials"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"client_id"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"zE9gQFGOkXKiDO5TSqyAb6o5"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"client_secret"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"By0BjaPWp1ydPIx7ReDuhpuBoWGvM8Wm"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    payload "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("\n    headers "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Content-Type'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'application/json'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Accept'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'application/json'")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    response "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" requests"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("request"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"POST"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" url"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" headers"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("headers"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" data"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("payload"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" params"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("params"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" response"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        data_dict "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" response"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("json"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" data_dict"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"access_token"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("save_token_to_redis")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("access_token"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token triple-quoted-string string"}},[s._v('"""将access_token缓存到redis数据库中,避免频繁调用官方的对应API引发异常"""')]),s._v("\n    conn "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" get_redis_connection"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"default"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    conn"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("set")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"access_token"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" access_token"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" ex"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2592000")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("get_token_from_redis")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token triple-quoted-string string"}},[s._v('"""第一次调用时,会进行redis缓存操作,往后的调用就直接从缓存中取了;过期导致不存在,直接重新调用API获取并进行缓存;"""')]),s._v("\n    conn "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" get_redis_connection"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"default"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    access_token "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" conn"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("get"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"access_token"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 取出来的是bytes数据")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("not")]),s._v(" access_token"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        access_token "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" get_token"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        save_token_to_redis"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("access_token"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" access_token\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" access_token"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("decode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"utf-8"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("recognize")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("img_type"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" img_content"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token triple-quoted-string string"}},[s._v('"""根据图片的类型(身份证正面、反面、营业执照) 来调用官方API进行识别"""')]),s._v("\n    request_url "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" img_type "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"front"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("or")]),s._v(" img_type "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"back"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        request_url "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://aip.baidubce.com/rest/2.0/ocr/v1/idcard"')]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("elif")]),s._v(" img_type "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"licence"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        request_url "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://aip.baidubce.com/rest/2.0/ocr/v1/business_license"')]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# - 基于本地文件的识别")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# f = open('x.jpeg', 'rb')")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# img = base64.b64encode(f.read())")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# - 基于上传文件的识别")]),s._v("\n    img "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" base64"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("b64encode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("img_content"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n    params "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"id_card_side"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" img_type"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"image"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" img"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# front正面/back反面")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# access_token是从redis中获取的.")]),s._v("\n    access_token "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" get_token_from_redis"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    request_url "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" request_url "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"?access_token="')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" access_token\n    headers "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'content-type'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'application/x-www-form-urlencoded'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    response "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" requests"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("post"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("request_url"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" data"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("params"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" headers"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("headers"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" response"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" response"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("json"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" __name__ "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'__main__'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" os\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" django\n\n    os"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("environ"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("setdefault"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'DJANGO_SETTINGS_MODULE'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'dahe.settings'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    django"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("setup"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n    f "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("open")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'x.jpeg'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'rb'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    res_dict "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" recognize"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("img_type"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"front"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" img_content"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("f"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("read"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" k"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" v "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" res_dict"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"words_result"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("items"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("print")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("k"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" v"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br"),n("span",{staticClass:"line-number"},[s._v("63")]),n("br"),n("span",{staticClass:"line-number"},[s._v("64")]),n("br"),n("span",{staticClass:"line-number"},[s._v("65")]),n("br"),n("span",{staticClass:"line-number"},[s._v("66")]),n("br"),n("span",{staticClass:"line-number"},[s._v("67")]),n("br"),n("span",{staticClass:"line-number"},[s._v("68")]),n("br"),n("span",{staticClass:"line-number"},[s._v("69")]),n("br"),n("span",{staticClass:"line-number"},[s._v("70")]),n("br"),n("span",{staticClass:"line-number"},[s._v("71")]),n("br"),n("span",{staticClass:"line-number"},[s._v("72")]),n("br"),n("span",{staticClass:"line-number"},[s._v("73")]),n("br"),n("span",{staticClass:"line-number"},[s._v("74")]),n("br"),n("span",{staticClass:"line-number"},[s._v("75")]),n("br"),n("span",{staticClass:"line-number"},[s._v("76")]),n("br"),n("span",{staticClass:"line-number"},[s._v("77")]),n("br"),n("span",{staticClass:"line-number"},[s._v("78")]),n("br")])]),n("p",[n("font",{attrs:{color:"green"}},[s._v("apps/shipper/views/auth.py")]),s._v(" 其实跟前面的上传逻辑的代码相比,增加了 "),n("code",[s._v("★▲●")]),s._v(" 标记地方的代码.")],1),s._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" os\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" datetime "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" datetime\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" django"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("conf "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" settings\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" django"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("core"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("files"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("storage "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" default_storage\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" rest_framework "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" serializers\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" rest_framework"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("decorators "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" action\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" rest_framework"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("response "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" Response\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" rest_framework"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("viewsets "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" ModelViewSet\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" apps"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("repository "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" models\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" server"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ext "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" ret\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" server"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("utils "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" baidu_ai\n\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AuthModelSerializers")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("serializers"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ModelSerializer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Meta")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        model "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" models"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("CompanyAuth\n        fields "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"__all__"')]),s._v("\n\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AuthView")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ModelViewSet"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    queryset "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" models"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("CompanyAuth"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("objects"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("all")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    serializer_class "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" AuthModelSerializers\n\n    "),n("span",{pre:!0,attrs:{class:"token decorator annotation punctuation"}},[s._v("@staticmethod")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("get_upload_filename")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("file_name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token triple-quoted-string string"}},[s._v('"""\n        自己写了一个静态方法用于获取上传的文件在media目录下存储的路径!\n        若上传的图片重名了,会自动处理\n        """')]),s._v("\n        date_path "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" datetime"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("now"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("strftime"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'%Y/%m/%d'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# date_path --\x3e '2023/12/14'")]),s._v("\n        upload_path "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" os"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("path"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("join"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("settings"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("UPLOAD_PATH"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" date_path"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# upload_path --\x3e 'upload/2023/12/14'")]),s._v("\n        file_path "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" os"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("path"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("join"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("upload_path"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" file_name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# file_path --\x3e upload/2023/12/14/存储器.png")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 图片重名了,会自动处理 upload_url --\x3e upload/2023/12/14/存储器_E9M9jvo.png")]),s._v("\n        upload_url "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" default_storage"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("get_available_name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("file_path"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" upload_url\n\n    "),n("span",{pre:!0,attrs:{class:"token decorator annotation punctuation"}},[s._v("@action")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("methods"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'GET'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'POST'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" detail"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("False")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" url_path"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'upload'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" url_name"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'upload '")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("upload")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" request"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            upload_object "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" request"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("FILES"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("get"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"file"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" upload_object"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("size "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" Response"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                    "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"code"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ret"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("UPLOAD_ERROR"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                    "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"msg"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"文件太大!"')]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            \n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  ★▲● 识别图片")]),s._v("\n            img_type "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" request"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("get"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"type"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            img_content "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" upload_object"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("read"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            img_info "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" baidu_ai"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("recognize"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("img_type"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" img_content"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 调用官方识别接口.")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 你别问我为何要这么判断,测试一步步实践出来的..")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("not")]),s._v(" img_info"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("get"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"words_result"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" Response"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                    "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"code"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ret"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Baidu_AI"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                    "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"msg"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"图片识别失败!"')]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            \n            upload_url "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("get_upload_filename"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("upload_object"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 获取上传的文件在media目录下存储的路径!")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ★ 注意,上面识别图片时,图片的指针已经到最后了,再执行upload_object.read()是没东西的.需要将文件的指针先移到开头!!")]),s._v("\n            upload_object"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("seek"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  ★▲●")]),s._v("\n            default_storage"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("save"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("upload_url"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" upload_object"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 自动在media下创建目录并保存上传的文件")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# local_url --\x3e /media/upload/2023/12/14/%E5%AD%98%E5%82%A8%E5%99%A8_E9M9jvo.png")]),s._v("\n            local_url "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" default_storage"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("url"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("upload_url"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# asb_url --\x3e http://127.0.0.1:8000/media/upload/2023/12/14/%E5%AD%98%E5%82%A8%E5%99%A8_LzKBcwY.png")]),s._v("\n            asb_url "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" request"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("build_absolute_uri"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("local_url"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 注意,请务必查看前端引用的第三方上传组件是否规定了后端返回的数据结构是怎么样的.比如{status:0}")]),s._v("\n            context "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"code"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ret"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("SUCCESS"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"data"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                    "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'url'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" local_url"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 图片在后端服务器上存储的路径")]),s._v("\n                    "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'abs_url'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" asb_url"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 图片在后端服务器访问的路径")]),s._v("\n                    "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'img_info'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" img_info"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 前端上传图片的结果  ★▲●")]),s._v("\n                    "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'img_type'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" img_type  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 图片的类型 ★▲●")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" Response"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("except")]),s._v(" Exception "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("as")]),s._v(" e"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" Response"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"code"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ret"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("SUMMARY_ERROR"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'msg'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'上传图片失败,请联系管理员!'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br"),n("span",{staticClass:"line-number"},[s._v("63")]),n("br"),n("span",{staticClass:"line-number"},[s._v("64")]),n("br"),n("span",{staticClass:"line-number"},[s._v("65")]),n("br"),n("span",{staticClass:"line-number"},[s._v("66")]),n("br"),n("span",{staticClass:"line-number"},[s._v("67")]),n("br"),n("span",{staticClass:"line-number"},[s._v("68")]),n("br"),n("span",{staticClass:"line-number"},[s._v("69")]),n("br"),n("span",{staticClass:"line-number"},[s._v("70")]),n("br"),n("span",{staticClass:"line-number"},[s._v("71")]),n("br"),n("span",{staticClass:"line-number"},[s._v("72")]),n("br"),n("span",{staticClass:"line-number"},[s._v("73")]),n("br"),n("span",{staticClass:"line-number"},[s._v("74")]),n("br"),n("span",{staticClass:"line-number"},[s._v("75")]),n("br"),n("span",{staticClass:"line-number"},[s._v("76")]),n("br"),n("span",{staticClass:"line-number"},[s._v("77")]),n("br"),n("span",{staticClass:"line-number"},[s._v("78")]),n("br"),n("span",{staticClass:"line-number"},[s._v("79")]),n("br"),n("span",{staticClass:"line-number"},[s._v("80")]),n("br"),n("span",{staticClass:"line-number"},[s._v("81")]),n("br"),n("span",{staticClass:"line-number"},[s._v("82")]),n("br")])]),n("h3",{attrs:{id:"前端绑定渲染"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#前端绑定渲染"}},[s._v("#")]),s._v(" 前端绑定渲染")]),s._v(" "),n("blockquote",[n("p",[s._v("前端获取到数据后,进行数据绑定,将图片识别结果渲染到表单中.")])]),s._v(" "),n("p",[s._v("PS: 因为上传图片是需要时间的,所以还加入了loading组件,给用户更好的体验..")]),s._v(" "),n("div",{staticClass:"language-vue line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-vue"}},[n("code",[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("template")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("el-card")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("class")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("box-card"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("shadow")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("never"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("v-loading")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("state.loading"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("element-loading-text")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("上传图片中!"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n  ...\n  "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("el-card")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n  ...\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("template")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("script")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("setup")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),n("span",{pre:!0,attrs:{class:"token script"}},[n("span",{pre:!0,attrs:{class:"token language-javascript"}},[s._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("...")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v('// 该组件中的三个上传都加了 :before-upload="beforeImageUpload" , 其实可以将其进一步优化成闭包!!')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("beforeImageUpload")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("file")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" isPNG "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" file"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("type "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("===")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'image/png'")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" file"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("type "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("===")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'image/jpeg'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" isLt2M "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" file"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("size "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("isPNG"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        ElMessage"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("error")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"上传图片的格式 png 或 jpeg!"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("isLt2M"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        ElMessage"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("error")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"上传图片大小不能超过 20MB!"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("isPNG "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" isLt2M"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        state"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("loading "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ●△")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("uploadSuccessWrapper")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("fieldName"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" preViewFieldName")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("imageUploadSuccess")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("res")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        state"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("loading "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ●△")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("code "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("===")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            state"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("form"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("fieldName"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("url"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            state"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("form"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("preViewFieldName"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("abs_url"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ●△")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("img_type "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("===")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"licence"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                state"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("form"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"title"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("img_info"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"words_result"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"单位名称"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"words"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                state"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("form"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"unique_id"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("img_info"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"words_result"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"社会信用代码"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"words"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("img_type "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("===")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"front"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                state"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("form"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"leader"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("img_info"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"words_result"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"姓名"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"words"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                state"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("form"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"leader_identity"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("img_info"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"words_result"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"公民身份号码"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"words"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            ElMessage"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("error")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'上传失败：'")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("msg"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("...")]),s._v("\n")])]),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("script")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br")])]),n("hr"),s._v(" "),n("h2",{attrs:{id:"账号认证-页面a初始化"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#账号认证-页面a初始化"}},[s._v("#")]),s._v(" 账号认证 - 页面A初始化")]),s._v(" "),n("blockquote",[n("p",[s._v("进入账号认证-页面A时,应获取当前登陆用户所对应的认证信息.")])]),s._v(" "),n("h3",{attrs:{id:"无数据"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#无数据"}},[s._v("#")]),s._v(" 无数据")]),s._v(" "),n("p",[s._v("前端访问"),n("code",[s._v("http://192.168.2.106:8080/account/auth")]),n("br"),s._v("\n该页面加载时向后端API"),n("code",[s._v("http://127.0.0.1:8000/api/shipper/auth/1/")]),s._v(" 发送请求. "),n("strong",[s._v("账号认证页面A最开始的样子如下:")])]),s._v(" "),n("p",[n("img",{attrs:{src:a(1008),alt:"image-20231218174236956"}})]),s._v(" "),n("p",[s._v("在前面基本信息页面,我们编写过加载初始信息的代码!"),n("br"),s._v("\n我们照猫画虎,大体上是没有啥问题的,实践下来确实如此.但针对账号认证-页面A的初始信息加载,需额外注意两点:")]),s._v(" "),n("h5",{attrs:{id:"注意点1"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#注意点1"}},[s._v("#")]),s._v(" 注意点1")]),s._v(" "),n("blockquote",[n("p",[s._v('后端需把"没有找到对象的错误"进行捕获,返回给前端时,前端对code值为-5的情况不做任何处理.')])]),s._v(" "),n("p",[s._v("前面已经快速根据"),n("code",[s._v("SimpleRouter")]),s._v("、"),n("code",[s._v("class AuthView(ModelViewSet)")]),s._v(" 快速编写了6个接口.."),n("br"),s._v("\n账号认证页面A的初始数据加载属于获取单条数据, 所以 "),n("code",[s._v("class AuthView(GenericViewSet, RetrieveModelMixin)")])]),s._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[s._v("一开始"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("当前登陆用户对应的账号认证相关数据是没有的"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("即一开始 供应商认证表CompanyAuth是为空的!\n这种情况是合理的"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("允许存在的"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v(" \n但按照原先获取初始数据的前后端代码"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("当我们执行 instance "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("get_object"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" 时"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("肯定会报错"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n报啥错? 没有找到对象! “看get_object对应的源码就明白啦!”\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("RetrieveModelMixin")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("retrieve")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" request"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("args"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("**")]),s._v("kwargs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            instance "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("get_object"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            serializer "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("get_serializer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("instance"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" Response"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"code"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ret"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("SUCCESS"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"data"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" serializer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("except")]),s._v(" Exception "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("as")]),s._v(" e"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" Response"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"code"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ret"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("SUMMARY_ERROR"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"msg"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"获取该条数据失败!"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n前端会弹出一个弹出框"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("说"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("“获取该条数据失败!”\n\nNo! 按照我们的想法"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("账号认证"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("页面A的初始化信息时"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("没找到对象没关系"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("页面上不弹出这个弹出框即可!\n★★★ 如何是好呢?\n    把没有找到对象的错误进行捕获"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("返回给前端时"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("前端对code值为"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("的情况不做任何处理"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("也不影响前端对code值为"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("的情况抛出弹出框"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("）\n    把没有找到对象的错误进行捕获具体怎么操作"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("需要看get_object的源码!!里面有行代码 "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("raise")]),s._v(" Http404"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br")])]),n("p",[n("strong",[s._v("后端关键代码")])]),s._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" rest_framework"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("response "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" Response\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" django"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("http"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("response "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" Http404\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" server"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ext "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" ret\n\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("RetrieveModelMixin")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("retrieve")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" request"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("args"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("**")]),s._v("kwargs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            instance "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("get_object"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            serializer "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("get_serializer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("instance"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" Response"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"code"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ret"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("SUCCESS"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"data"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" serializer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 0")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("except")]),s._v(" Http404 "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("as")]),s._v(" e"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" Response"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"code"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ret"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("NOT_FOUND"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"msg"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"对象不存在!"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -5")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("except")]),s._v(" Exception "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("as")]),s._v(" e"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" Response"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"code"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ret"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("SUMMARY_ERROR"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"msg"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"获取该条数据失败!"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -2")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br")])]),n("p",[n("strong",[s._v("前端关键代码")])]),s._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("initRequest")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("let")]),s._v(" id "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" store"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("state"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("id"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    proxy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("$axios"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token template-string"}},[n("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[s._v("`")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("/api/shipper/auth/")]),n("span",{pre:!0,attrs:{class:"token interpolation"}},[n("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[s._v("${")]),s._v("id"),n("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[s._v("}")])]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[s._v("`")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("then")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("res")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("code "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("===")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// TO Do")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("code "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("===")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            ElMessage"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("error")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("msg"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("catch")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("error")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("error")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("error"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("onMounted")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("initRequest")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br")])]),n("h5",{attrs:{id:"注意点2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#注意点2"}},[s._v("#")]),s._v(" 注意点2")]),s._v(" "),n("blockquote",[n("p",[s._v("账号认证展示什么(未认证/已认证/认证中)、账号认证失败的消息提示, 这些都应由后端返回的数据进行决定.")])]),s._v(" "),n("p",[n("strong",[s._v("前端关键代码")]),s._v(" 截取的片段.")]),s._v(" "),n("p",[n("img",{attrs:{src:a(1009),alt:"image-20231218173646087"}})]),s._v(" "),n("h3",{attrs:{id:"有数据"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#有数据"}},[s._v("#")]),s._v(" 有数据")]),s._v(" "),n("blockquote",[n("p",[s._v("上面的注意点1注意点2, 解决的是新用户第一次打开账号认证页面, 对应的数据表为空的情况!!"),n("br"),s._v("\n我们还需编写对应数据表不为空的时候的业务逻辑代码.. 可参考基本信息页面加载初始信息的笔记.")])]),s._v(" "),n("p",[n("strong",[s._v("先来看看效果!")])]),s._v(" "),n("p",[n("img",{attrs:{src:a(1010),alt:"image-20231219094545496"}})]),s._v(" "),n("p",[s._v("我们先上传了几张图片作为服务端的媒体资源, 然后在供应商认证表CompanyAuth表中手动添加一条记录用作实验!!")]),s._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[s._v("◆ 我们先来分析\n我们写的视图类继承了重写的RetrieveModelMixin类 “Company"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("CompanyAuth"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("”\n也就意味着"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("当供应商认证表CompanyAuth表中有 当前登陆用户"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("供应商 对应的记录时"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("会返回该表中的这条记录"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n那么返回的那条记录的字段能否满足账号认证"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("页面A上想要渲染的数据呢? \n答案是不能"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v(" 还需在已有的基础上增加几个字段 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("记得进行数据库数据迁移"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("迁移时会让你选设置默认值还是设置允许为空"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nCompanyAuth表\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" leader_identity_front "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" models"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("CharField"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("verbose_name"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"身份证-人头"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" max_length"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("128")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" leader_identity_back "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" models"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("CharField"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("verbose_name"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"身份证-国徽"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" max_length"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("128")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" remark "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" models"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("TextField"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("verbose_name"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"审核备注"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" null"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("True")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" blank"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("True")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nCompany表\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" auth_type_class_map "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"danger"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"info"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"success"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n◆ 再继续分析"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("够了吗?还是不够"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v(" 我们需要在获取单条供应商认证信息接口所对应的序列化器类中添加两个额外的字段!!\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" 后端还需返回前端认证状态\n  认证状态在哪？在CompanyAuth表的外键所在的关联表中"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("额外字段auth_type_text通过source属性跨表来实现!\n  auth_type_text "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" serializers"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("CharField"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("source"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"company.get_auth_type_display"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" 后端还需返回前端认证状态的样式"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("额外字段auth_type_class通过自定义方法来实现!\n  auth_type_class "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" serializers"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("SerializerMethodField"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("get_auth_type_class")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" obj"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# obj是CompanyAuth表中的一条记录, 点语法obj.company通过company外键跨到了Company表,拿到对应的auth_type的值")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# models.Company.auth_type_class_map 是一个字典")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" models"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Company"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("auth_type_class_map"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("obj"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("company"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("auth_type"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\n注意"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("当前登陆用户的ID为"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("手动添加的供应商认证的数据ID也为"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("不严谨的对应了起来"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n“严谨的来说用户"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("即供应商"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("应该跟供应商认证表中的那个外键字段值对应"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("以便于实现当前登陆用户应该只能得到自己的关联的那一条供应商记录”\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br")])]),n("p",[n("strong",[s._v("关键代码如下:")])]),s._v(" "),n("p",[n("img",{attrs:{src:a(1011),alt:"image-20231219105907887"}})]),s._v(" "),n("p",[s._v("Ps: 此示例中在数据库中存储的媒体资源路径是带http前缀的, 像这样 "),n("code",[s._v("http://127.0.0.1:8000/media/upload/2023/12/18/z.png")]),n("br"),s._v("\n其实在数据库中的媒体资源不应该带http前缀,暂且先这样,后续再进行处理!!")]),s._v(" "),n("hr"),s._v(" "),n("h2",{attrs:{id:"账号认证-页面b初始化"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#账号认证-页面b初始化"}},[s._v("#")]),s._v(" 账号认证 - 页面B初始化")]),s._v(" "),n("blockquote",[n("p",[s._v("读取认证信息,在页面B上做默认的展示!!")])]),s._v(" "),n("p",[n("strong",[s._v("先来看看样子")])]),s._v(" "),n("p",[n("img",{attrs:{src:a(1012),alt:"20"}})]),s._v(" "),n("p",[s._v("需要思考的地方:")]),s._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[s._v("我们在很早以前就说过"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("licence_path、licence_path_url的区别"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("前者是存储数据库中的"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("不带http前缀"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("后者用于前端预览"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("需要带http\nSo"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("这里先我们对上一小节 账号认证"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("页面A初始化 进行完善!\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" 将我们在供应商认证表CompanyAuth表中新增的那条记录的licence_path、leader_identity_front、leader_identity_back\n  去除前面的http"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("最终样子像这样"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("media"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("upload"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2023")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("z"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("png\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" 账号认证"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("页面A 的前端"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("图片渲染不再使用字段licence_path、leader_identity_front、leader_identity_back\n  而是使用字段licence_path_url、leader_identity_front_url、leader_identity_back_url\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" licence_path_url、leader_identity_front_url、leader_identity_back_url这些前端用作预览的字段\n  需要后端通过licence_path、leader_identity_front、leader_identity_back拼接http然后返回\n  \n到这一步\n你仔细观察AuthView"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("vue和AuthEditView"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("vue中需要渲染到页面上的那些字段"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v(" \n它两的初始化可以共用同一个序列化器类!!连发送axios请求的API接口都可以是一样的!!也就是前端组件中初始化的代码基本一致!\n这两个组件初始化获得的API数据是一样的"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"code"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"data"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"id"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"auth_type_text"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"未认证"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"auth_type_class"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"danger"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"licence_path_url"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://127.0.0.1:8000/media/upload/2023/12/18/z.png%0A"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"leader_identity_front_url"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://127.0.0.1:8000/media/upload/2023/12/18/x.jpeg"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"leader_identity_back_url"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://127.0.0.1:8000/media/upload/2023/12/18/y.png"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"title"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"北京一天天教育科技有限公司"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"unique_id"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"91110114074157297A"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"licence_path"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/media/upload/2023/12/18/z.png\\n"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"leader"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"胡沙"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"leader_identity"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"431023199205297212"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"leader_identity_front"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/media/upload/2023/12/18/x.jpeg"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"leader_identity_back"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/media/upload/2023/12/18/y.png"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"remark"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" null"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"company"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  \n▲ 若你非要用两个序列化器类"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("那么可以借鉴 基本信息页面的手机号更改和名称更改!\n  前端在发送axios请求时加了个"),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("type")]),s._v("参数"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("?"),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("type")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("xxx\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br")])]),n("p",[n("strong",[s._v("最关键的代码如下:")])]),s._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" rest_framework "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" serializers\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" apps"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("repository "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" models\n\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MySerializerMethodField")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("serializers"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("SerializerMethodField"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("to_representation")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" value"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token triple-quoted-string string"}},[s._v('"""用于在前面拼接http"""')]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ★ 你细品源码可知!")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# value 是instance一条记录")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# self字段对象; self.parent该字段对象所在序列化器类的实例对象; self.field_name该字段对象的字段名")]),s._v("\n        name "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("field_name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("replace"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"_url"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("parent"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'request'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("build_absolute_uri"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("getattr")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("value"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AuthModelSerializers")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("serializers"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ModelSerializer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    auth_type_text "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" serializers"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("CharField"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("source"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"company.get_auth_type_display"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    auth_type_class "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" serializers"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("SerializerMethodField"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# licence_path_url = serializers.SerializerMethodField()")]),s._v("\n    licence_path_url "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" MySerializerMethodField"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    leader_identity_front_url "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" MySerializerMethodField"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    leader_identity_back_url "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" MySerializerMethodField"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Meta")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        model "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" models"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("CompanyAuth\n        fields "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"__all__"')]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("get_auth_type_class")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" obj"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" models"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Company"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("auth_type_class_map"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("obj"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("company"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("auth_type"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -- ▲ 这个是最容易想到的办法,有三个预览图片地址就要写三个,但通过重写可以不写这些代码!")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# def get_licence_path_url(self, obj):")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#     return self.context['request'].build_absolute_uri(obj.licence_path)")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br")])]),n("hr"),s._v(" "),n("h2",{attrs:{id:"账号认证-页面b提交"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#账号认证-页面b提交"}},[s._v("#")]),s._v(" 账号认证 - 页面B提交")]),s._v(" "),n("blockquote",[n("p",[s._v("细节还是蛮多的!")])]),s._v(" "),n("h3",{attrs:{id:"★回顾drf知识"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#★回顾drf知识"}},[s._v("#")]),s._v(" ★回顾drf知识")]),s._v(" "),n("blockquote",[n("p",[s._v("回顾的知识点很重要!!")])]),s._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[s._v("Django ORM的语法\n   "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" 更新时"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("传了不相干的字段进去也没事"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n     !!!! 注"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("若是局部更新哪怕只传一个字段进去即可!\n        ★ 序列化器类中的字段对象摆在那"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" 前端需要传哪些呢? \n          "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"前端必须传的字段需要同时满足三者 可验证的、不为空/必填、没有默认值.."')]),s._v("\n   "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" 新增的话"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("必须一个不多一个不少"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("当然ORM表中允许为空和有默认值的字段可不传"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n验证"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("存储"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("序列化大体逻辑\n   "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" 验证会从request"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("data中取值!\n     注"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 一般情况下"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("字段对象自身验证规则是必填"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("但允许为空和设置了默认值的字段对象自身验证规则是不必填!\n        ★ 意思是"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" 该字段是需要验证的字段"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("但该字段不是必填的"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("允许为空或有默认值"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" 那么前端也可以不用传!!\n   "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" 验证成功后的数据关乎save操作"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("也就是说"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("验证成功的数据ser"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("validated_data与数据库相关\n     注"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" save时"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("**")]),s._v("validated_data解包后的键名是字段对象的source_attr\n     ★ 换个角度"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("read_only"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("True")]),s._v("的字段不验证"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("也就跟save无关"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("也就不涉及新增更新"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v(" Hhh\n       但序列化跟save后的返回值instance有关!\n   "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" 无论save执行的是新增还是更新操作"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("都有一个返回值instance"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("是当前数据库中新增或更新的那条记录"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n     注"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 进行序列化返回时"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("执行的是 "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"instance.字段对象的source_attr"')]),s._v(" 的操作!!\n     若验证后没有save直接序列化"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("序列化的数据是ser"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("validated_data \n   "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" 额外说一点"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("关于save时的源码 当验证成功的数据中b的值是"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("我可以在save是传b"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("就可以覆盖前面那个b的值!!\n     "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("func1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("args"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("**")]),s._v("kwargs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n         "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("print")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("kwargs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# {'b': 3}")]),s._v("\n         my_dict "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"a"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"b"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n         "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("print")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("**")]),s._v("my_dict"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("**")]),s._v("kwargs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# {'a': 1, 'b': 3}")]),s._v("\n     func1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("b"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n源码的dispatch方法中\n   "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("dispatch")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" request"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("args"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("**")]),s._v("kwargs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# self是视图类实例; *args,**kwargs是路由上传递的参数")]),s._v("\n       self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("args "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" args\n       self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("kwargs "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" kwargs    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 看到没,视图类实例是可以直接取到动态路由上传递的参数的!")]),s._v("\n       request "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("initialize_request"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("request"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("args"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("**")]),s._v("kwargs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n       self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("request "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" request  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 看到没,视图类实例是可以直接取到封装好的request的!")]),s._v("\nGenericAPIView中的过滤\n   你看源码就可以知道"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("我们自定义的过滤类中filter_queryset方法的view形参就是视图类实例!!\n  \n进行反向查询时"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("没有查到会报错\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  auth_id "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" instance"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("companyauth"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pk\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("except")]),s._v(" models"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("CompanyAuth"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("DoesNotExist"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  auth_id "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br")])]),n("h3",{attrs:{id:"思考问题"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#思考问题"}},[s._v("#")]),s._v(" 思考问题:")]),s._v(" "),n("blockquote",[n("p",[s._v("关于账号认证-页面B的提交, 先来思考几个问题")])]),s._v(" "),n("h5",{attrs:{id:"请求类型"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#请求类型"}},[s._v("#")]),s._v(" 请求类型")]),s._v(" "),n("blockquote",[n("p",[n("font",{attrs:{size:"5"}},[s._v("Q1:")]),s._v(' 点击"提交审核"按钮, 是向后端API发送 POST 请求还是 PUT 请求呢?')],1)]),s._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[s._v("当我们点击“提交审核”按钮时"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("是有两种可能的"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("一种是新增、一种是新建\n在我们已有的认知里"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("根据RESTful API规范\n   往http"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("//")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8000")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("api"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("shipper"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("auth"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" 发送POST请求 是新增\n   往http"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("//")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8000")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("api"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("shipper"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("auth"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" 发送PUT请求 是更新\n那么问题来了"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("点击“提交审核”按钮时"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("应该往哪个地址发数据axios请求呢?\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" 前端在vue组件里判断"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("没数据就往新增地址提交"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("否则就往更新地址提交 具体实现起来比较费劲\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" ★ 我们采取扩展方案"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("不必一味的遵循RESTful API规范\n  前端就往http"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("//")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8000")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("api"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("shipper"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("auth"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("发送POST请求\n  后端进行判断"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("数据不存在就执行新增逻辑"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("存在就执行更新逻辑!! "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" 在我们重写的CreateUpdateModelMixin的create方法里实现!\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" 我们自己写的视图类是这样写的"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AuthView")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("GenericViewSet"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" RetrieveModelMixin"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" CreateUpdateModelMixin"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n    注"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("GenericViewSet "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" ViewSetMixin "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" GenericAPIView\n    按照运行逻辑"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("向后端地址"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("api"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("shipper"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("auth"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("发送POST请求"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("后端会执行create这个视图函数"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br")])]),n("h5",{attrs:{id:"请求体数据"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#请求体数据"}},[s._v("#")]),s._v(" 请求体数据")]),s._v(" "),n("blockquote",[n("p",[n("font",{attrs:{size:"5"}},[s._v("Q2:")]),s._v(' OK,我们确定了点击"提交审核"按钮向后端发送POST请求, 那么请求体中应该包含哪些字段?')],1)]),s._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" 在AuthEditView"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("vue组件中"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("向后端"),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("API")]),s._v("发送的请求的请求体中理应不包含预览图片相关的字段\n  "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("即理应不包含licence_path_url、leader_identity_front_url、leader_identity_back_url字段")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("预览图片相关字段的值都带有http前缀"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("后端拿来没用"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("存储到数据库中的值是不带http前缀的"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" 此处我们将其从state"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("form中提取出来放到了state"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("preview中\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" state "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("reactive")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("dialogLicenceVisible")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("loading")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 需提交到后端的字段")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("form")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("tile")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("unique_id")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("licence_path")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("leader")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("leader_identity")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("leader_identity_front")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("leader_identity_back")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 我们没有做前端校验,但后端返回code=-1时还是需要在相应表单字段下展示错误信息")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("error")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("title")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("unique_id")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("licence_path")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("leader")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("leader_identity")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("leader_identity_front")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("leader_identity_back")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 预览图片相关字段无需提交到后端")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("preview")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("licence_path_url")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("leader_identity_front_url")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("leader_identity_back_url")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" vue组件"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("template"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("模版中对应预览图片字段值的渲染要相应进行改变下\n  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("在uploadSuccessWrapper")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("fieldName"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" preViewFieldName"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("这个闭包函数中"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("当成功上传图片后"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("需要这样做\n     state"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("form"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("fieldName"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("url"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n     state"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("preview"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("preViewFieldName"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("abs_url"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" 对AuthEditView"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("vue组件中的数据进行划分后"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("晃眼看去"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("对于点击"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"提交审核"')]),s._v("按钮触发的doSubmit方法发送的axios请求里\n  其请求体操作写上state"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("form即可"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("doSubmit")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("clearFormError")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("state"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("error"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    proxy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("$axios"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("post")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/api/shipper/auth/"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" state"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("form"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("then")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("res")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("catch")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("error")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("error")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("error"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" 理论上没有任何问题"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("实则页面"),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("B")]),s._v("的初始化数据加载的代码埋下的大坑在这里触发了"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("\n    你点击"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"提交审核"')]),s._v("的按钮"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("右键检查查看网络请求"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("可以发现请求体里的字段是页面初始化请求后端返回的那些字段"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n    问题的根源就是 initRequest 方法里的这两行代码"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("进行了覆盖"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" （当时图方便的埋下的坑啊）\n      state"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("form "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("...")]),s._v("res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n      state"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("preview "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("...")]),s._v("res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" 如何解决"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),s._v(" 将那两行代码替换成下面的代码"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("let")]),s._v(" key "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n          "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("key "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" state"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("form"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n              state"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("form"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("key"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("key"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n          "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n          "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("key "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" state"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("preview"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n              state"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("preview"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("key"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("key"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n          "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// state.form = {...res.data.data}")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// state.preview = {...res.data.data}")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" 其实不管这个坑"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("请求体的数据提交多了也没事"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("你站在通过Apifox发送请求的角度思考"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("后端肯定不能说传过来了啥就要啥"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    licence_path_url、leader_identity_front_url、leader_identity_back_url这些字段前端提交到后端也无大碍\n    后端的序列化器类里会将这三个字段设置为 read_only"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("True 的"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("\n    意味着"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("哪怕你前端给了后端"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("后端也不会对其进行校验"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("不校验也就意味着read_only"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("True的字段跟save无关"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("也就不涉及新增更新"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br"),n("span",{staticClass:"line-number"},[s._v("63")]),n("br")])]),n("h3",{attrs:{id:"upload组件后端认证"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#upload组件后端认证"}},[s._v("#")]),s._v(" Upload组件后端认证")]),s._v(" "),n("blockquote",[n("p",[s._v('这个是前面小节 "后端上传文件" 中遗留的问题. 这里单独用一小节提出来解决下!')])]),s._v(" "),n("p",[s._v("后续认证的逻辑代码必定会在AuthView视图类中添加认证类, 保证登陆后才能访问AuthView类中的这些接口.."),n("br"),s._v(" "),n("font",{attrs:{color:"gray"}},[s._v("(包括 图片上传的 "),n("code",[s._v("http://127.0.0.1:8000/api/shipper/auth/upload/")]),s._v("  这个接口!)")]),n("br"),s._v("\n一般, 前端发送的axios请求会通过axios拦截器在发送前添加包含token信息的请求头, 后端的认证组件对token信息进行验证!"),n("br"),s._v("\n但前端的upload上传组件的请求是自动完成的!! 请求到了后端, 就存在认证失败的问题."),n("br"),s._v(" "),n("strong",[s._v("如何解决呢?")])],1),s._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[s._v("前端需进行的操作\n  方案一"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 查看elementplus的官方文档"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("在upload组件上添加个headers属性是可以解决的"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n  方案二"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 在图片上传的 http"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("//")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8000")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("api"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("shipper"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("auth"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("upload"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" 这个接口后面拼接token信息!\n  方案一页面上每个上传的地方都要加"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("我们嫌麻烦"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("此处我们采取方案二!!\n  const imageUploadUrl "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" `http"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("//")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8000")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("api"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("shipper"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("auth"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("upload"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("?token"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("$"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("store"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("state"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("token"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("`\n      \n后端需进行的操作\n  编写认证类并在AuthView视图类中进行应用"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n  authentication_classes "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("JwtAuthentication"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" JwtParamAuthentication"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" NoAuthentication"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  PS"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 若没有NoAuthentication"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("编写时JwtParamAuthentication认证失败返回"),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("None")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("JwtAuthentication认证失败"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("raise")]),s._v("\n      那么JwtParamAuthentication需要在前"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("JwtAuthentication需要在后!! 需要注意先后顺序!!\n      why? 复习下"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v("的认证类就很容易理解了!! 注"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("AuthView视图类中的接口都会经历authentication_classes里的认证类的!!\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br")])]),n("p",[n("strong",[s._v("后端关键代码如下:")])]),s._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" rest_framework "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" exceptions\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" rest_framework"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("authentication "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" BaseAuthentication\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" server"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("utils"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("jwt_auth "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" parse_payload\n\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("JwtAuthentication")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("BaseAuthentication"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token triple-quoted-string string"}},[s._v('"""从请求头中获取token进行校验"""')]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("authenticate")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" request"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        authorization "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" request"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("META"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("get"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'HTTP_AUTHORIZATION'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        status"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" info_or_error "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" parse_payload"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("authorization"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# if not status:")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#     raise exceptions.AuthenticationFailed({\"code\": 8888, 'msg': info_or_error})")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("not")]),s._v(" status"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# request.info_or_error = info_or_error")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" info_or_error"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" authorization\n\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("authenticate_header")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" request"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'API'")]),s._v("\n\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("JwtParamAuthentication")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("BaseAuthentication"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token triple-quoted-string string"}},[s._v('"""从请求url中获取token进行校验"""')]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("authenticate")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" request"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        authorization "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" request"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("query_params"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("get"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'token'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        status"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" info_or_error "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" parse_payload"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("authorization"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("not")]),s._v(" status"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" info_or_error"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" authorization\n\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("authenticate_header")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" request"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'API'")]),s._v("\n\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("NoAuthentication")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("BaseAuthentication"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token triple-quoted-string string"}},[s._v('"""从请求url中获取token进行校验"""')]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("authenticate")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" request"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("raise")]),s._v(" exceptions"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("AuthenticationFailed"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"code"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8888")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'msg'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"认证失败,请重新登陆"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("authenticate_header")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" request"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'API'")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br")])]),n("h3",{attrs:{id:"createupdatemodelmixin"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#createupdatemodelmixin"}},[s._v("#")]),s._v(" CreateUpdateModelMixin")]),s._v(" "),n("blockquote",[n("p",[s._v("CreateUpdateModelMix 中 包含新增以及更新!!")])]),s._v(" "),n("h5",{attrs:{id:"测试新增"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#测试新增"}},[s._v("#")]),s._v(" 测试新增")]),s._v(" "),n("p",[n("img",{attrs:{src:a(1013),alt:"21"}})]),s._v(" "),n("p",[n("strong",[s._v("至此, 提交的逻辑基本打通, 但看到没, 测试结果中还有两个问题:")]),n("br"),s._v("\n1> 新增数据成功后, AB页面的数据初始化在页面上是没有数据的!"),n("br"),s._v("\n2> 再次到进行认证编辑的B页面, 因为数据库中有数据了,此次 提交审核是更新数据. 因为这些字段是必填的,所以更新失败!!")]),s._v(" "),n("h5",{attrs:{id:"测试更新"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#测试更新"}},[s._v("#")]),s._v(" 测试更新")]),s._v(" "),n("p",[s._v("喵的,我想测试 更新功能啊!! 如何是好?")]),s._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[s._v("我们做一点点小操作"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" 当前登陆用户的"),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("id")]),s._v("是"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" 我们将CompanyAuth表中新增的那条记录的"),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("id")]),s._v("从"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v("手动改成"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n再刷新页面A、页面B"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" 可以惊奇的发现"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" 初始化数据成功渲染出来了"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" 再进行更改数据的测试!也成功啦!!\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("p",[n("img",{attrs:{src:a(1014),alt:"22"}})]),s._v(" "),n("h5",{attrs:{id:"关键代码"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#关键代码"}},[s._v("#")]),s._v(" 关键代码")]),s._v(" "),n("p",[n("img",{attrs:{src:a(1015),alt:"image-20231222134854201"}})]),s._v(" "),n("hr"),s._v(" "),n("h2",{attrs:{id:"页面ab初始化遗留问题"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#页面ab初始化遗留问题"}},[s._v("#")]),s._v(" 页面AB初始化遗留问题")]),s._v(" "),n("blockquote",[n("p",[s._v("哎, 前面留的坑啊! 听我细细道来!")])]),s._v(" "),n("h3",{attrs:{id:"★传的id应是谁"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#★传的id应是谁"}},[s._v("#")]),s._v(" ★传的ID应是谁?")]),s._v(" "),n("blockquote",[n("p",[s._v("应是CompanyAuth表中的某条记录的ID,该条记录得满足外键字段company的值等于当前登陆用户的ID!")])]),s._v(" "),n("p",[n("font",{attrs:{color:"red"}},[s._v("页面AB初始化数据时, 传递的ID不应该是当前登陆用户的ID"),n("br"),s._v("\n而应该是CompanyAuth表中的某条记录的ID,该条记录得满足外键字段company的值等于当前登陆用户的ID!!")])],1),s._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[s._v("在对于提交认证进行更新的测试中\n我们是先手动将新增的那条记录的"),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("id")]),s._v("改为跟当前登陆用户的"),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("id")]),s._v("一致"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("才使得页面AB初始化数据成功的!!进而"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("很顺利的进行了更新的测试"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n\n不难想到"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("问题出在"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("页面AB在进行数据初始化时"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("向后端传递的那个ID值有问题?!!\n我们咋写的呢？\n  let "),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("id")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" store"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("state"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("id")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("//")]),s._v(" 当前登陆用户的ID\n  前端向 `"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("api"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("shipper"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("auth"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("$"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("auth_id"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("` 发送get请求"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("该API对应的视图函数是RetrieveModelMixin"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("使用的是数据表CompanyAuth\n  RetrieveModelMixin函数中执行self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("get_object"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("会根据动态路由传递过来的ID查询CompanyAuth表中的某条记录"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n在上面的账号认证"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("页面A初始化、账号认证"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("页面B初始化小节"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("当时为了图方便\n我们使 "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"当前登陆用户ID"')]),s._v(" 和 "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"新增认证的数据的ID"')]),s._v(" 以及 "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"新增的这条认证数据中外键字段company的值"')]),s._v(" 都是"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" !!\n所以当时误打误撞正确了"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("但存在巨大的代码隐患"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n\n★★★ 初始化数据时"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("动态路由ID不应该是当前登陆用户ID\n    而应该是 CompanyAuth表中的某条记录的ID"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("该条记录得满足外键字段的值等于当前登陆用户的ID!!\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br")])]),n("p",[s._v("如何解决呢? 两种解决方案!"),n("br"),s._v(" "),n("font",{attrs:{color:"red"}},[s._v("★ 不必严格遵守restful API规范, 需按照实际情况来进行调整!")])],1),s._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[s._v("方案"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 不遵守restful API规范\n  http"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("//")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8000")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("api"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("shipper"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("auth"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" 页面AB初始化数据时向该地址发送GET请求\n  该地址不用携带"),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("id")]),s._v("!\n  因为drf认证组件"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("所以后端可根据request"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("user获取到当前登陆用户的ID"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("再通过反向查询拿到CompanyAuth表中对应的那条记录!!\n  因为向该地址发送请求"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("会执行后端的"),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("list")]),s._v("方法"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("所以需要对"),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("list")]),s._v("方法进行重写!! 具体如何实现暂略"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n \n方案"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 遵守restful API规范\n  `http"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("//")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8000")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("api"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("shipper"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("auth"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("$"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("auth_id"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("` 页面AB初始化数据时向该地址发送GET请求\n  该地址需要携带"),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("id")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" 该"),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("id")]),s._v("是CompanyAuth表中的某条记录的ID"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("该条记录得满足外键字段company的值等于当前登陆用户的ID!!\n  step1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("当用户登陆成功后"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("后端返回前端的值中还需包括auth_id\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" 当前登陆用户的"),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("id")]),s._v("反向查询到CompanyAuth表中对应记录的"),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("id")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("该记录的"),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("id")]),s._v("也就是我们需要的auth_id\n      "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" 若查询到了"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("auth_id的值就是查询到的"),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("id")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" 若没有查询到"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("auth_id的值为"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n  step2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("前端拿到登陆API返回的关于auth_id的数据"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("保存到vuex中并做持久化\n  step3"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("当页面AB进行数据初始化时"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("从vuex中取出auth_id\n    通过http"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("//")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8000")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("api"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("shipper"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("auth"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("$"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("auth_id"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("传递到后端\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" 若auth_id为"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("断然是查不到的"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("页面AB没有任何数据渲染\n      PS"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" RetrieveModelMixin函数中执行self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("get_object"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" 拿"),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("id")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("到CompanyAuth表中查"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("直接"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("404")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" 若auth_id不为"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("肯定是查的到的"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("页面AB渲染对应的数据\n  step4"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("有这么一种情况"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("刚注册登陆进去还未进行账号认证"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n    用户在访问页面AB进行数据初始化时"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("从vuex中拿到的auth_id都是"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("意味页面上没有数据渲染"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    然后点击 提交审核 按钮"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("新增了一条数据\n    但新增后"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("CompanyAuth表中有当前登陆用户对应的认证数据了"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("用户再次访问页面AB进行数据初始化时"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("依旧没有数据渲染"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n    why?! no why"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v(" 我们需要在新增数据后"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("后端返回当前新增数据的ID"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("在回调中把vuex中auth_id的值同步更新!!\n    这样新增数据后"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("页面AB的数据初始化才能成功!!!\n  \n此处的示例中我们使用方案"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n特别注意一个问题"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" API地址中携带的这个auth_id可能没有"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("啥时候没有"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("刚注册登陆进去还未进行账号认证"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("CompanyAuth整张表中没有对应的记录!\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br")])]),n("p",[n("strong",[s._v("关键代码如下:")])]),s._v(" "),n("p",[n("img",{attrs:{src:a(1016),alt:"image-20231222220249036"}})]),s._v(" "),n("p",[s._v("这样操作后, 新增账号认证数据后, 再次访问页面AB,页面AB进行初始化数据就能渲染出来!!")]),s._v(" "),n("h3",{attrs:{id:"只能初始化自己的记录"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#只能初始化自己的记录"}},[s._v("#")]),s._v(" 只能初始化自己的记录")]),s._v(" "),n("blockquote",[n("p",[s._v("账号认证AB页面进行数据初始化时,后端返回的数据应该是当前登陆用户对应的那条认证信息!!")])]),s._v(" "),n("p",[s._v("怎么个原理, 在 "),n("code",[s._v("基本信息-加载初始数据")]),s._v(" 时,已经分析的明明白白, 这里不再赘述..")]),s._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[s._v("可以发现的是 基本信息"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("加载初始数据"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("和账号认证AB页面加载初始数据使用的都是 我们重写的 RetrieveModelMixin\n只不过编码到这一步"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("我们在RetrieveModelMixin多添加了个"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("404")]),s._v("的处理!! "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("屎山就是这么一步步堆起来的Hhh"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\nPS"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("你可以做个实验\n   在视图类中 将filter_backends "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("AuthFilterBackend"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" 这行代码注释掉"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n   登陆后"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("在浏览器控制台输入localStorage"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("setItem"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'auth_id'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n   若CompanyAuth表中"),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("id")]),s._v("为"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v("的记录存在"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("刷新账号认证页面AB后"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("就会渲染这条记录"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("就看到别人的认证信息啦!\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("p",[n("img",{attrs:{src:a(1017),alt:"image-20231222223512521"}})]),s._v(" "),n("hr"),s._v(" "),n("h2",{attrs:{id:"账号认证-其他注意"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#账号认证-其他注意"}},[s._v("#")]),s._v(" 账号认证 - 其他注意")]),s._v(" "),n("blockquote",[n("p",[s._v("账号认证还有几个需要注意的地方")])]),s._v(" "),n("p",[s._v("注意的地方如下:")]),s._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"提交审核"')]),s._v("按钮 关于CompanyAuth表中的remark字段!\n   账号认证页面B上是没有remark字段的"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("但通过apifox的工具可以在提交请求时包含该字段!!\n   我们不希望通过这些工具能随意修改remark"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("认证的备注信息"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("这信息应该只能是后台管理人员才能进行的操作\n   那么备注信息"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("再次提交时"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("原来的审核信息是否保留?\n     "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" 保留"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 将remark字段设置为 read_only"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("True")]),s._v("\n        extra_kwargs "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'remark'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'read_only'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("True")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n     "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" 不保留"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 在save时"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" ser"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("save"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("remark"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n       "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("perform_create")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" serializer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n           user_id "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("request"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("user"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'user_id'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n           serializer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("save"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("company_id"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("user_id"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" remark"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n       "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("perform_update")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" serializer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n           serializer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("save"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("remark"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" 关于状态"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("用户 提交审核后"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" 审核状态应该由未认证变为认证中!!\n   ser"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("save"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" 有返回值 instance"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("即当前新增或更新的那条记录"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v(" 拿到这条记录去变更审核状态!\n   "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# instance.company 从CompanyAuth表跨到了Company表")]),s._v("\n   "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("perform_create")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" serializer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        user_id "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("request"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("user"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'user_id'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n        instance "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" serializer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("save"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("company_id"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("user_id"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" remark"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        instance"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("company"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("auth_type "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("  \n        instance"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("company"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("save"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("perform_update")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" serializer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        instance "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" serializer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("save"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("remark"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        instance"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("company"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("auth_type "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n        instance"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("company"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("save"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n   \n   \nOther"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" elementPlus的Loading加载组件!账号认证表单提交时前端的校验!\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br")])]),n("hr")])}),[],!1,null,null,null);t.default=e.exports},999:function(s,t,a){s.exports=a.p+"assets/img/image-20231215160210974.4054d7b6.png"}}]);