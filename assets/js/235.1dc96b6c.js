(window.webpackJsonp=window.webpackJsonp||[]).push([[235],{1204:function(s,t,a){"use strict";a.r(t);var n=a(0),r=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"介绍"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#介绍"}},[s._v("#")]),s._v(" 介绍")]),s._v(" "),a("blockquote",[a("p",[s._v("因为root用户的权限太大,破坏力太强,安全风险极高, 所以通常情况下公司的服务器对外都是禁止root用户直接登录的.. 做运维时,通常使用的都是普通用户,但在进行日常运维管理的过程中,经常需要获得某些root才有的管理权限才能完成任务,"),a("strong",[s._v("例如需要执行/sbin目录下的某些命令")]),s._v("...")]),s._v(" "),a("p",[s._v("那么如何才能在不使用root用户直接登录操作系统的同时又能保证普通用户完成日常工作呢?")])]),s._v(" "),a("p",[s._v("让普通用户具备管理员权限,有两种方案:"),a("br"),s._v("\n1> "),a("strong",[s._v("su切换用户身份")]),s._v(": 使用普通用户登录,然后使用su命令切换到root账户下  "),a("font",{attrs:{color:"gray"}},[a("strong",[s._v("不推荐")])]),a("br"),s._v("\n        需要知道root密码; 权限控制不精细, 每次获取的都是所有root权限\t"),a("br"),s._v("\n2> "),a("strong",[s._v("sudo提权")]),s._v(": 使用普通用户登录,不切换用户,用sudo命令提取root用户的 "),a("strong",[s._v("部分")]),s._v(" 管理权限"),a("br"),s._v("\n        不需要知道root密码,输入的是用户自己的密码;"),a("br"),s._v("\n        权限控制更为精细, 可以控制普通用户只获取部分root权限")],1),s._v(" "),a("hr"),s._v(" "),a("h2",{attrs:{id:"su切换用户"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#su切换用户"}},[s._v("#")]),s._v(" su切换用户")]),s._v(" "),a("h3",{attrs:{id:"登录与非登录shell"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#登录与非登录shell"}},[s._v("#")]),s._v(" 登录与非登录shell")]),s._v(" "),a("p",[s._v("linux中的shell可以分为两类:"),a("br"),s._v("\n1> 登录级别shell"),a("br"),s._v("\n     输入账号密码登录进来运行的;"),a("br"),s._v(" "),a("code",[s._v("su - 用户名")]),s._v(" "),a("font",{attrs:{color:"gray"}},[s._v("管理员root切换到普通用户下无需输入密码,反之需要 ")]),a("br"),s._v("\n2> 非登录级别shell"),a("br"),s._v(" "),a("code",[s._v("su 用户名")])],1),s._v(" "),a("p",[a("font",{attrs:{color:"gray"}},[s._v("Ps: shell的使用方式有两种 -- 交互式;非交互式(即执行shell脚本)")])],1),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v('"\n'),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("su")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("dc")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("\t只是切换了用户身份,环境没有改变,还是在/root下\n"),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("su")]),s._v(" - "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("dc")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v(" 直接到普通用户dc的家目录下\n"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v('"\n'),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# su dc")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("dc@localhost root"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("$ "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("pwd")]),s._v("\n/root\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("dc@localhost ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("$ "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exit")]),s._v("\n登出\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# su - dc")]),s._v("\n上一次登录：一 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("月  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(" 08:31:32 CST 2022pts/0 上\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("dc@localhost ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("$ "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("pwd")]),s._v("\n/home/dc\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br")])]),a("h3",{attrs:{id:"加载的配置文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#加载的配置文件"}},[s._v("#")]),s._v(" 加载的配置文件")]),s._v(" "),a("p",[s._v("登录级别shell与非登录级别的shell本质上区别在于加载的配置文件以及顺序不一样!")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("全局配置文件"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("系统级别的,对所有用户都生效"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(":\n    /etc/profile\n    /etc/profile.d/*.sh  一堆shell脚本文件,可执行程序\n    /etc/bashrc\n\t\t\n个人配置文件"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("对单独的用户生效,归属于某个具体用户 ～号是会根据用户的不同变的"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(":家目录下的两个隐藏文件 \n    ~/.bash_profile \n    ~/.bashrc\n\nPS: 验证使用echo在配置文件的每行添加一个输出即可,注意,要把输出放在文件的第一行"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("具体过程略.\n\n若执行的是登录式shell,那么配置文件执行顺序是:\n   /etc/profile --"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /etc/profile.d/*.sh --"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" ~/.bash_profile --"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" ~/.bashrc --"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /etc/bashrc\n\t\n如果执行的是非登录式shell,那么配置文件执行顺序是:\n   ~/.bashrc --"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /etc/bashrc --"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /etc/profile.d/*.sh\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br")])]),a("h3",{attrs:{id:"配置文件的妙用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置文件的妙用"}},[s._v("#")]),s._v(" 配置文件的妙用")]),s._v(" "),a("p",[s._v("注意哦,下述操作的环境变量拼接是临时生效的TnT"),a("br"),s._v(" "),a("font",{attrs:{color:"brown"}},[a("strong",[s._v("若想其永久生效,可以将那个拼接命令写到用户登录时加载的任意一个全局配置文件中..")]),s._v("^_^")]),a("br"),s._v("\nPs: 通常往配置文件的末尾加两条命令  "),a("font",{attrs:{color:"red"}},[a("code",[s._v("PATH=/opt/soft:$PATH")]),s._v(" "),a("code",[s._v("export PATH")])]),a("br"),s._v("\n     添加环境变量并将新的环境变量值继承到bash进程的子子孙孙中.."),a("br"),s._v("\n     环境变量顾名思义在系统中的每个地方都有效!!!")],1),s._v(" "),a("p",[a("strong",[s._v("举一反三:")]),a("br"),s._v("\n     若想针对登录级别与非登录级别的所有用户设置统一的配置"),a("br"),s._v(" "),a("code",[s._v("vim /etc/bashrc")]),s._v(" ;  "),a("code",[s._v("source /etc/bashrc")]),s._v("或者重新登录生效"),a("br"),s._v("\n               Ps: 若是登录级别的所有用户,通常操作的是/etc/profile文件"),a("br"),s._v("\n     若想针对某一个用户设置配置"),a("br"),s._v(" "),a("code",[s._v("vim ~/.bashrc")]),s._v(" ; "),a("code",[s._v("source ~/.bashrc")]),s._v("或者重新登录生效")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v('"\n我们知道,可以单独执行ls命令是因为ls加到了'),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("PATH")]),s._v("环境变量当中"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v('"\n'),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# which ls")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("alias")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ls")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'ls --color=auto'")]),s._v("\n\t/usr/bin/ls\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ls")]),s._v("\nanaconda-ks.cfg       公共  视频  文档  音乐\ninitial-setup-ks.cfg  模板  图片  下载  桌面\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# /usr/bin/ls")]),s._v("\nanaconda-ks.cfg       公共  视频  文档\t音乐\ninitial-setup-ks.cfg  模板  图片  下载\t桌面\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# echo $PATH")]),s._v("\n/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/root/bin\n\n"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v('"\n若此时新建一个可执行文件,不想写文件的路径前缀,只写可执行文件的名称\n就需要对'),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("PATH")]),s._v("变量进行拼接,"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("注意哦,此拼接是临时生效的"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v('"\n'),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cd /opt/")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost opt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mkdir soft")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost opt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim /opt/soft/sb")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost opt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat /opt/soft/sb")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"画一个大大的饼,吃不下消不了xswl"')]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## root用户新建的文件默认权限是644,将文件变为可执行文件,需要对其加上x可执行权限")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# /opt/soft/sb")]),s._v("\n-bash: /opt/soft/sb: 权限不够\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# chmod +x /opt/soft/sb")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ll /opt/soft/sb")]),s._v("\n-rwxr-xr-x "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("52")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("月   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(" 09:17 /opt/soft/sb\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# /opt/soft/sb")]),s._v("\n画一个大大的饼,吃不下消不了xswl\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost opt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# sb")]),s._v("\nsb: need at least one "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" to send\nTry `sb --help' "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("more")]),s._v(" information.\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 将sb所在的目录路径加入环境变量中")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# PATH=/opt/soft:$PATH")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# echo $PATH")]),s._v("\n/opt/soft:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/root/bin\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# sb")]),s._v("\n画一个大大的饼,吃不下消不了xswl\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br")])]),a("hr"),s._v(" "),a("h2",{attrs:{id:"sudo提权"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#sudo提权"}},[s._v("#")]),s._v(" sudo提权")]),s._v(" "),a("blockquote",[a("p",[s._v("通过配置sudo, 我们可以实现让普通用户输入自己的密码的情况下而获取我们为其配置的特定权限"),a("br"),s._v("\n这样既保证了普通用户拥有他想要的特定权限, 又不至于泄露管理root的密码...")])]),s._v(" "),a("h3",{attrs:{id:"两种编辑方式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#两种编辑方式"}},[s._v("#")]),s._v(" 两种编辑方式")]),s._v(" "),a("p",[s._v("在root管理员下修改配置文件/etc/sudoers来分配权限"),a("br"),s._v("\n1> "),a("code",[s._v("vim /etc/sudoers")]),s._v(" "),a("code",[s._v("visudo -c")]),a("br"),s._v("\n2> "),a("code",[s._v("visudo")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost opt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim /etc/sudoers\t## -- 在第一行加入字符aaaa")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost opt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# visudo -c")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /etc/sudoers: 语法错误 near line "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<<")]),s._v("\n/etc/sudoers 中第 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" 行附近出现解析错误\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost opt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim /etc/sudoers\t## -- 删除第一行的aaaa字符")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost opt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# visudo -c")]),s._v("\n/etc/sudoers：解析正确\n\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 与第一种方式相比,是黑白的..但会自动提示语法错误")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost opt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# visudo\t\t\t\t\t\t## -- 同样的在第一行加入字符aaaa")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /etc/sudoers: 语法错误 near line "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<<")]),s._v("\n现在做什么？e\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## -- e代表继续编辑")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /etc/sudoers: 语法错误 near line "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<<")]),s._v("\n现在做什么？Q\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## -- Q代表直接退出")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br")])]),a("h3",{attrs:{id:"sudo语法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#sudo语法"}},[s._v("#")]),s._v(" sudo语法")]),s._v(" "),a("blockquote",[a("p",[a("strong",[s._v("user   MACHINE=COMMANDS")]),s._v("    什么用户在什么机器上可以运行什么样的命令..")])]),s._v(" "),a("p",[a("strong",[s._v("用户 能登录的主机IP或主机名=(能转换成的用户身份,表示允许用户以哪个用户的权限做事情) 管理命令")]),a("br"),s._v(" "),a("font",{attrs:{color:"red"}},[a("strong",[s._v("注意")])]),s._v(": 管理命令要写绝对路径.. 通过"),a("code",[s._v("which 命令")]),s._v("可得知命令的绝对路径...")],1),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),s._v("root  "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ALL")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ALL"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  ALL"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v(" -- root用户可以在所有主机上以任意用户身份执行所有命令\n    root: root用户\n    第一个ALL: \t可以在任何一台机器上登录 \n                通常就写成ALL 因为将配置文件拷贝到任意一台服务端的机器,ALL肯定包含当前这台主机\n                敲黑板:代表的是服务端的IP地址,与客户端无关！！！\n    第二个"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ALL"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": 可以转换成任何用户的身份,即拥有所有的权限 通常就写成"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ALL"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    第三个ALL:   所有命令\n\n\n"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v('"\nCmnd_Alias 命令组别名\nHost_Alias 主机组别名\nUser_Alias 用户组别名\n'),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v('"\n'),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),s._v("Cmnd_Alias NETWORKING "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" /sbin/route,/sbin/ifconfig"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),s._v("tom  "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ALL")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ALL"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  /bin/cp,/bin/touch"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("\n    -- 只允许tom用户以root用户的身份执行NETWORKING命令组里的route,ifconfig命令\n"),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("dc")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ALL")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ALL"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  ALL"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v(" \n    -- 这样用户dc相对于一个root超级管理员,可以无视文件权限,对任何文件使用任何命令\n"),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),s._v("onepiece "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ALL")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ALL"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  NOPASSWD:/user/bin/passed,/usr/bin/vim,"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("/usr/bin/vim /opt/def.txt"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v(" \n    -- 允许lili用户以root用户的身份对所有用户"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("包括root"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("的密码进行免密更改,\n       并能对所有文件免密进行编辑,但不能编辑/opt/def.txt文件\n"),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),s._v("onepiece "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ALL")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ALL"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  ALL,"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("/usr/bin/vim /opt/def.txt"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v(" \n    -- 对onepiece用户放开所有权限,唯独对/opt/def.txt文件的编辑权限不放开"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),s._v("Host_Alias TEST1 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".0.128,192.168.0.129,192.168.0.130"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("  \n    -- 主机组别名TEST1,包含的是一台台服务器的IP地址,客户端是要远程连接到这些服务器上的,与客户端IP无关\n"),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),s._v("egon01 "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("TEST1")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ALL"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  NOPASSWD:/usr/sbin/ifconfig"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("\n    -- egon01用户能在TEST1包含的主机上转换成root身份以没有密码的方式运行ifconfig命令\n"),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),s._v("egon02 "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("localhost")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ALL"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  NOPASSWD:/usr/sbin/shutdown "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-h")]),s._v(" now"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("\n    -- localhost代表本机的IP地址. egon02用户只能在本机上以root身份免密执行立马关机的命令\n\t\t\n\n"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v('"\n多个用户可以进行同一个sudo提权,两个方案:\n    '),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("groupadd")]),s._v(" devops"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),s._v("gpasswd "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-a")]),s._v(" u1 devops"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),s._v("gpasswd "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-a")]),s._v(" u2 devops"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v('"\n'),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),s._v("%devops "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ALL")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ALL"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" NOPASSWD:/usr/sbin/ifconfig"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("\n或者另一个方案达到同样的效果:\n"),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),s._v("User_Alias ADMINS "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" u1,u2"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),s._v("ADMINS "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ALL")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ALL"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" NOPASSWD:/usr/sbin/ifconfig"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("\n\n\n"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v('"\nsudo常用参数:\n     -l: 登录用户下面，执行'),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-l")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v(" 显示当前用户有哪些权限\n     -k: 删除/var/db/sudo/下面对应的时间戳的信息,下次执行sudo需要输入当前用户的密码,系统默认5分钟失效\n"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v('"\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br")])]),a("p",[a("font",{attrs:{color:"blue"}},[s._v("要知道,每次使用命令sudo,都会重新加载配置文件/etc/sudoers... 所以编辑后,不需要重启..")])],1),s._v(" "),a("p",[a("strong",[s._v("一个小实验:")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("root用户依次执行以下命令:\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("touch")]),s._v(" /opt/abc.txt\n    "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("111")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" /opt/abc.txt\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" 00  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" /opt/abc.txt\n    \n    "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("touch")]),s._v(" def.txt\n    "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("222")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" def.txt\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("777")]),s._v(" /opt/def.txt\n\n"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v('"\n可以看到,数据准备阶段\n\t 我们使dc用户对文件a.txt没有任何权限'),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("onepiece对文件a.txt\n实验目的: \n    "),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("1")]),s._v(">")]),s._v(" 让dc用户使用sudo后能通过cat查看文件a.txt和echo "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" 追加内容到文件a.txt中"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("2")]),s._v(">")]),s._v(" 让onepiece用户使用sudo后能免密编辑任何文件,除了/opt/def.txt\n"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v('"\n'),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost opt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ll abc.txt ")]),s._v("\n---------- "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("月   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(":26 abc.txt\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost opt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ll def.txt ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-rwxrwxrwx")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("月   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(":05 def.txt\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost opt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ll -d /opt/")]),s._v("\ndrwxr-xr-x. "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" root root "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("21")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("月   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(":26 /opt/\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost opt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat /opt/abc.txt ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("111")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost opt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat /opt/def.txt ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("222")]),s._v("\n\n\n"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v('"\n对/etc/sudoers配置文件进行编辑\n'),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("dc")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ALL")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ALL"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  ALL"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v(" \n"),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),s._v("onepiece "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ALL")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ALL"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  NOPASSWD:/user/bin/passed,/usr/bin/vim,"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("/usr/bin/vim /opt/def.txt"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v(" \n"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v('"\n'),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost opt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim /etc/sudoers")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost opt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# visudo -c")]),s._v("\n/etc/sudoers：解析正确\n\n\n"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v('"\n验证\nPS:若达不到预期的实验效果,\n      第一步看文件权限后面是否有加号,若有即使用了ACL '),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),s._v("getfacl abc.txt"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("\n      第二步检查有无文件特殊属性干扰 "),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),s._v("lsattr abc.txt"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v('"\n'),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("dc@localhost ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" /opt/abc.txt \ncat: /opt/abc.txt: 权限不够\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("dc@localhost ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" /opt/abc.txt \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("sudo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("dc")]),s._v(" 的密码：\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("111")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 因为重定向符号“>>”也是bash的命令;sudo只是让echo命令具有了root权限")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 所以bash会认为这个命令没有写入信息的权限")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("dc@localhost ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"123"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" /opt/abc.txt\n-bash: /opt/abc.txt: 权限不够\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 解决方案: 利用“sh -c”命令,它可以让bash将一串字符作为完整的命令来执行")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("dc@localhost ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sh")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"echo 123 >> /opt/abc.txt"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("dc@localhost ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" /opt/abc.txt \n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("111")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("123")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## onepiece用户本身是有权限编辑def.txt文件的,但加上sudo就不行..")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("onepiece@localhost ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /opt/def.txt\n对不起,用户onepiece无权以root的身份在localhost.localdomain上执行/bin/vim /opt/def.txt\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br"),a("span",{staticClass:"line-number"},[s._v("57")]),a("br"),a("span",{staticClass:"line-number"},[s._v("58")]),a("br"),a("span",{staticClass:"line-number"},[s._v("59")]),a("br"),a("span",{staticClass:"line-number"},[s._v("60")]),a("br"),a("span",{staticClass:"line-number"},[s._v("61")]),a("br"),a("span",{staticClass:"line-number"},[s._v("62")]),a("br")])]),a("hr")])}),[],!1,null,null,null);t.default=r.exports}}]);