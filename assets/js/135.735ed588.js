(window.webpackJsonp=window.webpackJsonp||[]).push([[135],{1212:function(s,t,a){"use strict";a.r(t);var n=a(0),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h2",{attrs:{id:"为什么要用lvm"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#为什么要用lvm"}},[s._v("#")]),s._v(" 为什么要用LVM")]),s._v(" "),n("p",[s._v("传统的磁盘管理我们将某个硬盘通过fdisk或gdisk工具进行隔断,划分出了一个个的分区,紧接着,对这些分区进行格式化,即在分区上安装文件系统,通过文件系统这个软件来对分区进行管理..."),n("br"),s._v(" "),n("font",{attrs:{color:"blue"}},[s._v("So, "),n("strong",[s._v("分区")]),s._v(" 是站在 "),n("strong",[s._v("硬件角度")]),s._v(" 的说法,"),n("strong",[s._v("文件系统")]),s._v(" 是站在 "),n("strong",[s._v("软件角度")]),s._v(" 的说法!!!")])],1),s._v(" "),n("p",[s._v("在我们对磁盘分区的大小进行规划时, 往往不能确定每个分区使用的空间大小, 只能凭经验分配一个大小.. 每个分区的大小就固定死了.. 这样做会有点弊端:"),n("br"),s._v("\n        若分区设置的过大, 就白白浪费了磁盘空间;\n        若分区设置的过小, 就会导致空间不够用的情况出现;\n        "),n("font",{attrs:{color:"gray"}},[s._v('针对A磁盘空间不够用,有个解决方案是新增块硬盘(不分区,整体作为一个分区),新增的硬盘格式化后,将A磁盘中的某个目录作为其挂载点..  "具体可以参考文件系统那的实践案例" ... 很麻烦,增大了管理难度 TnT')])],1),s._v(" "),n("p",[s._v("上述的问题,可以通过LVM来解决..")]),s._v(" "),n("hr"),s._v(" "),n("h2",{attrs:{id:"lvm原理"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#lvm原理"}},[s._v("#")]),s._v(" LVM原理")]),s._v(" "),n("p",[n("img",{attrs:{src:a(508),alt:""}}),s._v(" "),n("strong",[s._v("PV物理卷")]),s._v("      -- 把常规的磁盘设备通过pvcreate命令对其进行初始化,形成了物理卷"),n("br"),s._v("\n                             磁盘空间可以是 整块硬盘("),n("font",{attrs:{color:"gray"}},[s._v("sda")]),s._v(")也可以是某块盘的某个分区("),n("font",{attrs:{color:"gray"}},[s._v("sdb5")]),s._v(")"),n("br"),s._v(" "),n("strong",[s._v("PE基本单元")]),s._v("      --  物理卷里最小的存储单位,默认为4MB"),n("br"),s._v(" "),n("strong",[s._v("VG卷组")]),s._v("           --  将多个PV整合到一起,那么卷组的大小就是多个PV大小之和.."),n("br"),s._v("\n                             或者说, 将这些PV里的PE放到了一个名为VG的资源池里"),n("br"),s._v(" "),n("font",{attrs:{color:"gray"}},[n("strong",[s._v("注意哦,")]),s._v(" 不一定要将所有的pv放到一个vg里 ")]),n("br"),s._v(" "),n("strong",[s._v("LV逻辑卷")]),s._v("         --  从卷组中划分需要的空间大小出来, 用户仅需对其格式化创建文件系统,挂载后即可使用"),n("br"),s._v(" "),n("font",{attrs:{color:"brown"}},[s._v("LV可由VG里面不同的PV里的一个个PE组成...即跨越磁盘")])],1),s._v(" "),n("p",[s._v("VG不够用可以扩容,加PV进去即可. "),n("strong",[s._v("通常不会从卷组中移除磁盘...")]),n("br"),s._v("\nLV可以动态扩容/缩容: 从VG里再拿几个PE/还几个PE给VG.."),n("br"),s._v(" "),n("strong",[s._v("虽然LVM支持LV缩容,但LV格式化若制作成xfs文件系统,是不支持缩容的")])]),s._v(" "),n("p",[n("font",{attrs:{color:"gray"}},[s._v("打个比方,磁盘空间是小麦,PV将一束束小麦都磨成了面粉,PE将这些面粉整合到了一起揉成了一个面团,LV就是在将面团切成一块一块的.")])],1),s._v(" "),n("hr"),s._v(" "),n("h2",{attrs:{id:"lvm优缺点"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#lvm优缺点"}},[s._v("#")]),s._v(" LVM优缺点")]),s._v(" "),n("p",[n("font",{attrs:{color:"blue"}},[n("strong",[s._v("优点")])])],1),s._v(" "),n("p",[s._v("        1> 可以在系统运行的状态下动态的扩展文件系统(LV格式化并挂载后)的大小"),n("br"),s._v("\n​        2> 文件系统可以跨多个磁盘, 因此文件系统大小不会受物理磁盘的限制"),n("br"),s._v("\n​        3> 可以增加新的磁盘到LVM的存储池VG中"),n("br"),s._v("\n​        4> 可以以镜像的方式冗余重要的数据到多个物理磁盘   --  LVM的快照,用于进行备份"),n("br"),s._v("\n​        5> 方便导出整个卷组到另外一台机器(基本用不到,了解即可)")]),s._v(" "),n("p",[n("font",{attrs:{color:"blue"}},[n("strong",[s._v("缺点")])])],1),s._v(" "),n("p",[s._v("        1> 画个解藕图  "),n("strong",[s._v("硬件 - LVM - 文件系统")]),s._v("  简单来说,LVM是处于分区与文件系统之间的一个软件!!"),n("br"),s._v("\n             更高级了,但存取性能收到了影响"),n("br"),s._v("\n​        2> 当VG中的某个PV所在的磁盘空间坏了, 整个卷组都会受到影响"),n("br"),s._v("\n​             "),n("font",{attrs:{color:"brown"}},[s._v(" 因为LV里面的PE是跨越磁盘的...")]),s._v(" 所以要尽量保证磁盘不会损坏.."),n("br"),s._v("\n​        "),n("font",{attrs:{color:"red"}},[n("strong",[s._v("解决方案")]),s._v(": 底层用RAID + 上层LVM = 既有冗余又有动态扩展")])],1),s._v(" "),n("hr"),s._v(" "),n("h2",{attrs:{id:"lvm的基本使用"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#lvm的基本使用"}},[s._v("#")]),s._v(" LVM的基本使用")]),s._v(" "),n("p",[s._v("简写逻辑: (大概只有我能一眼看懂 Hhhh)"),n("br"),s._v("\n        sdb + sdc1 -- vg1 -- lv1_from_vg1(/test1)、lv2_from_vg1(/test2)"),n("br"),s._v("\n        sdc2 + sdc3 -- vg2 -- lv1_from_vg2(/test3)、lv2_from_vg2(/test4)")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -- 先移除前面实验环境中添加的硬盘 新建20G 30G 40G三块硬盘sdb sdc sdd 虚拟机不支持热插拔 关机重启生效")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -- 在真实的实验环境中(真机) 多块硬盘需要做RAID; 云服务器不需要做RAID..")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("fdisk")]),s._v(" /dev/sdc\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -- 制作5个分区 3主1扩1逻辑")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# lsblk /dev/sdc")]),s._v("\nNAME   MAJ:MIN RM SIZE RO TYPE MOUNTPOINT\nsdc      "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(":32   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  30G  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" disk \n├─sdc1   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(":33   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  10G  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" part \n├─sdc2   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(":34   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   5G  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" part \n├─sdc3   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(":35   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   5G  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" part \n├─sdc4   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(":36   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   1K  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" part \n└─sdc5   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(":37   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   5G  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" part \n\n"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v('"-- '),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".制作pv,可以对整块盘做,也可以对分区做 --"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v('" \npvcreate /dev/sdb\npvcreate /dev/sdc1\npvcreate /dev/sdc2\npvcreate /dev/sdc3\n\n'),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v('"-- '),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(".制作vg:将pv划入vg中 --"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v('"\n'),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## vgcreate vg3 /dev/sdd 将做过pv的某一块盘或某一个分区单独做vg也可以")]),s._v("\nvgcreate vg1 /dev/sdb /dev/sdc1\nvgcreate vg2 /dev/sdc2 /dev/sdc3\n\n"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v('"-- '),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(".创建逻辑卷lv --"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v('"\n'),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## -L 大小 -n 名字")]),s._v("\nlvcreate "),n("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-L")]),s._v(" 1G "),n("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" lv1_from_vg1 vg1\nlvcreate "),n("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-L")]),s._v(" 2G "),n("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" lv2_from_vg1 vg1\nlvcreate "),n("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-L")]),s._v(" 3G "),n("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" lv1_from_vg2 vg2\nlvcreate "),n("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-L")]),s._v(" 4G "),n("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" lv2_from_vg2 vg2\n\n"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v('"-- 查看 --'),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v('"\n'),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## -- 还可以使用 pvscan 命令")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# pvs")]),s._v("\n  PV         VG     Fmt  Attr PSize   PFree   \n  /dev/sda2  centos lvm2 a--  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(".00g       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" \t\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -- 这个是安装centos时,linux自己弄的")]),s._v("\n  /dev/sdb   vg1    lvm2 a--  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(".00g  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(".00g\n  /dev/sdc1  vg1    lvm2 a--  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(".00g  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(".00g\n  /dev/sdc2  vg2    lvm2 a--   "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(".00g   "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(".00g\n  /dev/sdc3  vg2    lvm2 a--   "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(".00g "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1020")]),s._v(".00m\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# lvs")]),s._v("\n  LV           VG     Attr       LSize   Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert\n  root         centos -wi-ao---- "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(".00g                                                    \n  swap         centos -wi-ao----   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(".00g                                                    \n  lv1_from_vg1 vg1    -wi-a-----   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".00g                                                    \n  lv2_from_vg1 vg1    -wi-a-----   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(".00g                                                    \n  lv1_from_vg2 vg2    -wi-a-----   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(".00g                                                    \n  lv2_from_vg2 vg2    -wi-a-----   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(".00g\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## -- 可以看到vg1由两个pv组成,划分了2个lv; vg1总大小为30G,减去2G和1G还剩27G..")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vgs")]),s._v("\n  VG     "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#PV #LV #SN Attr   VSize   VFree ")]),s._v("\n  centos   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" wz--n- "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(".00g     "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" \n  vg1      "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" wz--n-  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("29")]),s._v(".99g "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("26")]),s._v(".99g\n  vg2      "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" wz--n-   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v(".99g  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(".99g\n  \n"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v('"-- '),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(".格式化"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("制作文件系统"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("与挂载 --"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v('"\n'),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## -- 创建的vg卷组会在/dev下面")]),s._v("\nmkfs.xfs /dev/vg1/lv1_from_vg1 \nmkfs.xfs /dev/vg1/lv2_from_vg1 \nmkfs.xfs /dev/vg2/lv1_from_vg2\nmkfs.xfs /dev/vg2/lv2_from_vg2\n\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" /test1\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" /test2\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" /test3\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" /test4\n\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("mount")]),s._v(" /dev/vg1/lv1_from_vg1 /test1\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("mount")]),s._v(" /dev/vg1/lv2_from_vg1 /test2\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("mount")]),s._v(" /dev/vg2/lv1_from_vg2 /test3\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("mount")]),s._v(" /dev/vg2/lv2_from_vg2 /test4\n\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mount | grep test")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## -- /dev/mapper/vg1-lv1_from_vg1 就是 /dev/vg1/lv1_from_vg1 不要太在意..")]),s._v("\n/dev/mapper/vg1-lv1_from_vg1 on /test1 "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("type")]),s._v(" xfs "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("rw,relatime,attr2,inode64,noquota"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n/dev/mapper/vg1-lv2_from_vg1 on /test2 "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("type")]),s._v(" xfs "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("rw,relatime,attr2,inode64,noquota"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n/dev/mapper/vg2-lv1_from_vg2 on /test3 "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("type")]),s._v(" xfs "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("rw,relatime,attr2,inode64,noquota"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n/dev/mapper/vg2-lv2_from_vg2 on /test4 "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("type")]),s._v(" xfs "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("rw,relatime,attr2,inode64,noquota"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br"),n("span",{staticClass:"line-number"},[s._v("63")]),n("br"),n("span",{staticClass:"line-number"},[s._v("64")]),n("br"),n("span",{staticClass:"line-number"},[s._v("65")]),n("br"),n("span",{staticClass:"line-number"},[s._v("66")]),n("br"),n("span",{staticClass:"line-number"},[s._v("67")]),n("br"),n("span",{staticClass:"line-number"},[s._v("68")]),n("br"),n("span",{staticClass:"line-number"},[s._v("69")]),n("br"),n("span",{staticClass:"line-number"},[s._v("70")]),n("br"),n("span",{staticClass:"line-number"},[s._v("71")]),n("br"),n("span",{staticClass:"line-number"},[s._v("72")]),n("br"),n("span",{staticClass:"line-number"},[s._v("73")]),n("br"),n("span",{staticClass:"line-number"},[s._v("74")]),n("br"),n("span",{staticClass:"line-number"},[s._v("75")]),n("br"),n("span",{staticClass:"line-number"},[s._v("76")]),n("br"),n("span",{staticClass:"line-number"},[s._v("77")]),n("br"),n("span",{staticClass:"line-number"},[s._v("78")]),n("br")])]),n("hr"),s._v(" "),n("h2",{attrs:{id:"在线动态扩容"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#在线动态扩容"}},[s._v("#")]),s._v(" 在线动态扩容")]),s._v(" "),n("blockquote",[n("p",[s._v("动态扩容即在不用卸载的情况下对LV进行扩容")])]),s._v(" "),n("p",[n("code",[s._v("lvextend -L [+]MGT /dev/VG_NAME/VL_NAME")]),n("br"),s._v("\n注意:  -L 100M 与 -L +100M不是一个意思."),n("br"),s._v("\n        前者代表扩容至100M(不能小于原来的大小), 后者代表在原有的基础上扩容100M")]),s._v(" "),n("p",[n("font",{attrs:{color:"red"}},[n("strong",[s._v("不要缩容！！！并且xfs文件系统不支持缩容...")])])],1),s._v(" "),n("h3",{attrs:{id:"vg容量够"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#vg容量够"}},[s._v("#")]),s._v(" vg容量够")]),s._v(" "),n("p",[s._v("给1G大小的lv1_from_vg1扩容至5000M, 查看vg1容量是够的, 所以lv1_from_vg1可直接扩容")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vgs | grep vg1")]),s._v("\n  vg1      "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" wz--n-  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("29")]),s._v(".99g "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("26")]),s._v(".99g\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# lvs | grep lv1_from_vg1")]),s._v("\n  lv1_from_vg1 vg1    -wi-ao----   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".00g \n\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# lvextend -L 5000M /dev/vg1/lv1_from_vg1")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 逻辑卷 vg1/lv1_from_vg1 的大小从 1.00 GiB(256 个扩展区) 更改为 4.88 GiB(1250 个扩展区).")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 逻辑卷 vg1/lv1_from_vg1 已成功调整大小")]),s._v("\nSize of logical volume vg1/lv1_from_vg1 changed from "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.00")]),s._v(" GiB"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("256")]),s._v(" extents"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" to "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.88")]),s._v(" GiB"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1250")]),s._v(" extents"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(". Logical volume vg1/lv1_from_vg1 successfully resized.\n\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vgs | grep vg1")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 简单验算下 lv增加的等于vg减少的 4.88 - 1 = 26.99 - 23.11 ")]),s._v("\n  vg1      "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" wz--n-  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("29")]),s._v(".99g "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),s._v(".11g\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# lvs | grep lv1_from_vg1")]),s._v("\n  lv1_from_vg1 vg1    -wi-ao----   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(".88g \n\nxfs_growfs /dev/vg1/lv1_from_vg1 "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## -!!! 扩展逻辑卷后需要更新xfs文件系统 df -h才能看到预期的结果")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br")])]),n("h3",{attrs:{id:"vg容量不够"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#vg容量不够"}},[s._v("#")]),s._v(" vg容量不够")]),s._v(" "),n("p",[s._v("给3G大小的lv1_from_vg2扩容至11G, 查看vg2容量为3G, 是不够的, 需要新增pv扩到vg2里")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vgs | grep vg2")]),s._v("\n  vg2      "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" wz--n-   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v(".99g   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(".99g\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# lvs | grep lv1_from_vg2")]),s._v("\n  lv1_from_vg2 vg2    -wi-ao----   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(".00g  \n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -- lv1_from_vg2扩容至11G需要新增8G sdc5只有5个G 不得行. 所以我们使用40G容量的sdd")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# lsblk /dev/sdc5 /dev/sdd")]),s._v("\nNAME MAJ:MIN RM SIZE RO TYPE MOUNTPOINT\nsdc5   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(":37   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   5G  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" part \nsdd    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(":48   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  40G  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" disk \n\npvcreate /dev/sdd\nvgextend vg2 /dev/sdd\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vgs | grep vg2")]),s._v("\n  vg2      "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" wz--n- "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("49")]),s._v(".99g "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("42")]),s._v(".99g\n\nlvextend "),n("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-L")]),s._v(" 10G /dev/vg2/lv1_from_vg2\nlvextend "),n("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-L")]),s._v(" +1G /dev/vg2/lv1_from_vg2\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# lvs | grep lv1_from_vg2")]),s._v("\n  lv1_from_vg2 vg2    -wi-ao----  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(".00g\n  \nxfs_growfs /dev/vg2/lv1_from_vg2  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## -!!! 扩展逻辑卷后需要更新xfs文件系统 df -h才能看到预期的结果")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br")])]),n("hr"),s._v(" "),n("h2",{attrs:{id:"删除"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#删除"}},[s._v("#")]),s._v(" 删除")]),s._v(" "),n("p",[s._v("一句话, 先将vg中所有lv的挂载点都卸载, 再删除vg, 最后删除vg中的pv")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v('" -- 删除,讲究个顺序 lv先卸载挂载点然后删除 lv删干净后再删除vg 最后删除pv --'),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v('"\n'),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 删除lv之前需要先卸载挂载点")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# umount /test3")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# lvremove /dev/vg2/lv1_from_vg2 ")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 因为挂载后,可能产生过数据,所以问你确定要删除吗？")]),s._v("\nDo you really want to remove active logical volume vg2/lv1_from_vg2? "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("y/n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": y\n  Logical volume "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"lv1_from_vg2"')]),s._v(" successfully removed\n\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vgs")]),s._v("\n  VG     "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#PV #LV #SN Attr   VSize   VFree  ")]),s._v("\n  centos   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" wz--n- "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(".00g      "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" \n  vg1      "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" wz--n-  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("29")]),s._v(".99g "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),s._v(".11g\n  vg2      "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" wz--n- "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("49")]),s._v(".99g "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("45")]),s._v(".99g\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 因为vg2里还有个已经挂载的lv,所以删除vg2不成功")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vgremove vg2")]),s._v("\nDo you really want to remove volume group "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"vg2"')]),s._v(" containing "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" logical volumes? "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("y/n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": y\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 逻辑卷 vg2/lv2_from_vg2 包含一个正在使用的文件系统")]),s._v("\n  Logical volume vg2/lv2_from_vg2 contains a filesystem "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" use.\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# umount /test4")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vgremove vg2")]),s._v("\nDo you really want to remove volume group "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"vg2"')]),s._v(" containing "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" logical volumes? "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("y/n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": y\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 相当于帮忙执行了 lvremove /dev/vg2/lv2_from_vg2 命令")]),s._v("\nDo you really want to remove active logical volume vg2/lv2_from_vg2? "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("y/n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": y\n  Logical volume "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"lv2_from_vg2"')]),s._v(" successfully removed\n  Volume group "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"vg2"')]),s._v(" successfully removed "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -- 成功删除vg2")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 删pv:只能删掉那些不属于任何vg的pv")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# pvs")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 可以看到原来在vg2中的3个pv已经闲置啦")]),s._v("\n  PV         VG     Fmt  Attr PSize   PFree  \n  /dev/sda2  centos lvm2 a--  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(".00g      "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" \n  /dev/sdb   vg1    lvm2 a--  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(".00g  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(".11g\n  /dev/sdc1  vg1    lvm2 a--  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(".00g "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(".00g\n  /dev/sdc2         lvm2 ---    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(".00g   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(".00g\n  /dev/sdc3         lvm2 ---    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(".00g   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(".00g\n  /dev/sdd          lvm2 ---   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("40")]),s._v(".00g  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("40")]),s._v(".00g\n\npvremove /dev/sdb2\npvremove /dev/sdb3\npvremove /dev/sdd\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -- 卸载的pv可以不使用lvm按照传统的磁盘管理方式进行操作啦..")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br")])]),n("p",[n("font",{attrs:{color:"blue"}},[n("strong",[s._v("格外实验:")]),s._v(" sdb使用完了才会使用sdc1")]),s._v(",实际上多少会用点sdc1,但很少显示不出来...")],1),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# lsblk /dev/sdb /dev/sdc")]),s._v("\nNAME               MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 当时很疑惑的一点,sdc1分区下面怎么没显示lv的名字呢？")]),s._v("\nsdb                  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(":16   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   20G  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" disk \n├─vg1-lv1_from_vg1 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("253")]),s._v(":2    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(".9G  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" lvm  /test1\n└─vg1-lv2_from_vg1 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("253")]),s._v(":3    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    2G  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" lvm  /test2\nsdc                  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(":32   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   30G  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" disk \n├─sdc1               "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(":33   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   10G  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" part \n├─sdc2               "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(":34   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    5G  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" part "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -- pv删除了,划分的分区还是在的")]),s._v("\n├─sdc3               "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(":35   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    5G  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" part \n├─sdc4               "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(":36   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    1K  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" part \n└─sdc5               "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(":37   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    5G  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" part \n\n"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v('"\n经过分析,sdb'),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("20G"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("+sdc1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("10G"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("总共30G,现目前,lv1_from_vg1 5G、lv2_from_vg1 2G\n我们实验将lv1_from_vg1扩容至22G 超过sdb容量的20G\n"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v('"\nlvextend '),n("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-L")]),s._v(" 22G /dev/vg1/lv1_from_vg1\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# pvs")]),s._v("\n  PV         VG     Fmt  Attr PSize   PFree \n  /dev/sda2  centos lvm2 a--  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(".00g     "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" \n  /dev/sdb   vg1    lvm2 a--  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(".00g     "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" \n  /dev/sdc1  vg1    lvm2 a--  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(".00g  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(".99g  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## -- 20+10-22-2 = 6")]),s._v("\n  /dev/sdd          lvm2 ---   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("40")]),s._v(".00g "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("40")]),s._v(".00g\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# lsblk /dev/sdb /dev/sdc")]),s._v("\nNAME                 MAJ:MIN RM SIZE RO TYPE MOUNTPOINT\nsdb                    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(":16   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  20G  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" disk \n├─vg1-lv1_from_vg1   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("253")]),s._v(":2    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  22G  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" lvm  /test1\n└─vg1-lv2_from_vg1   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("253")]),s._v(":3    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   2G  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" lvm  /test2\nsdc                    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(":32   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  30G  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" disk \n├─sdc1                 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(":33   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  10G  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" part \n│ └─vg1-lv1_from_vg1 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("253")]),s._v(":2    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  22G  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" lvm  /test1  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## -- 看!!它出现了..sdb满了才使用sdc1")]),s._v("\n├─sdc2                 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(":34   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   5G  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" part \n├─sdc3                 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(":35   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   5G  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" part \n├─sdc4                 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(":36   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   1K  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" part \n└─sdc5                 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(":37   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   5G  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" part \n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br")])]),n("hr"),s._v(" "),n("h2",{attrs:{id:"lvm快照"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#lvm快照"}},[s._v("#")]),s._v(" LVM快照")]),s._v(" "),n("blockquote",[n("p",[s._v("简单来说,做lvm快照就是给某个lv做备份"),n("br"),s._v("\nvm虚拟机也有快照,点击vm某一个快照,虚拟机就恢复到快照那一时刻的状态..在这一层面LVM快照是相同的..")])]),s._v(" "),n("h3",{attrs:{id:"制作快照"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#制作快照"}},[s._v("#")]),s._v(" 制作快照")]),s._v(" "),n("p",[n("strong",[s._v("被做快照的lv")]),s._v(": lv2_from_vg1         "),n("strong",[s._v("快照")]),s._v(": lv2_from_vg1_snap")]),s._v(" "),n("p",[s._v("1> lvm快照的本质就是创建一个特殊的LV逻辑卷.. 快照与被做快照的lv在同一vg里"),n("br"),s._v("\n2> lv2_from_vg1 与 lv2_from_vg1_snap的UUID是一样的.."),n("br"),s._v("\n3> lv2_from_vg1里的内容改变后,lv2_from_vg1_snap快照里的内容是不会同步改变的!!")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -- /test2是lv2_from_vg1逻辑卷xfs格式化后的挂载点")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# echo 111 > /test2/1.txt")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# echo 222 > /test2/2.txt")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# echo 333 > /test2/3.txt")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# tree /test2")]),s._v("\n/test2 \n├── "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".txt\n├── "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(".txt\n└── "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(".txt\n\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" directories, "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" files\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -- 对vg1卷组下的lv2_from_vg1逻辑卷做快照 首先要保证vg1要有剩余空间")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -- vg1还剩6g的空间")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vgs")]),s._v("\n  VG     "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#PV #LV #SN Attr   VSize   VFree")]),s._v("\n  centos   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" wz--n- "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(".00g    "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" \n  vg1      "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" wz--n-  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("29")]),s._v(".99g "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(".99g\n  \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -- 快照本质上也是制作一个lv. 对哪个lv做快照,就会向该lv所在的vg要空间.")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -s 即snapshot,表明是做快照")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -- lvcreate -L 快照大小 -s -n 快照名字 被做快照的lv的路径")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -- 快照先指定1G,不够的话,可以动态扩容嘛")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# lvcreate -L 1G -s -n lv2_from_vg1_snap /dev/vg1/lv2_from_vg1")]),s._v("\n  Logical volume "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"lv2_from_vg1_snap"')]),s._v(" created.\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# lvs")]),s._v("\n  LV                VG     Attr       LSize   Pool Origin       Data%  Meta%  Move Log Cpy%Sync Convert\n  root              centos -wi-ao---- "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(".00g                                                          \n  swap              centos -wi-ao----   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(".00g                                                          \n  lv1_from_vg1      vg1    -wi-ao----  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v(".00g   \n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -- 可以看到快照与被做快照的lv在同一vg里!")]),s._v("\n  lv2_from_vg1      vg1    owi-aos---   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(".00g                                                          \n  lv2_from_vg1_snap vg1    swi-a-s---   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".00g      lv2_from_vg1 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.01")]),s._v(" \n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -- vg1-lv2_from_vg1与vg1-lv2_from_vg1_snap的磁盘/分区UUID是一样的!!")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# blkid | grep lv2_from_vg1")]),s._v("\n/dev/mapper/vg1-lv2_from_vg1: "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("UUID")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"d0c4fc9b-3fea-409e-b7ab-d760c5c07c19"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("TYPE")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"xfs"')]),s._v(" \n/dev/mapper/vg1-lv2_from_vg1_snap: "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("UUID")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"d0c4fc9b-3fea-409e-b7ab-d760c5c07c19"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("TYPE")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"xfs"')]),s._v(" \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -- 同一个磁盘设备可以有多个挂载点,但有相同UUID的两个磁盘设备只能通过UUID挂载其中一个")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -- 可以回忆下永久挂载,在/etc/fstab配置文件中指定的就是磁盘设备的UUID")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -- So,lv2_from_vg1挂载后, 再mount挂载lv2_from_vg1_snap是失败的..")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mount /dev/vg1/lv2_from_vg1_snap /opt")]),s._v("\nmount: 文件系统类型错误、选项错误、/dev/mapper/vg1-lv2_from_vg1_snap 上有坏超级块、\n       缺少代码页或助手程序，或其他错误\n\n       有些情况下在 syslog 中可以找到一些有用信息- 请尝试\n       "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("dmesg")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("tail")]),s._v("  这样的命令看看.\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -- 但是可以曲线救国,指定-o选项让快照不通过UUID挂载")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -- 可以察觉到,做完lv2_from_vg1_snap快照后,我们并没有对其格式化做文件系统,却依旧能挂载成功!!")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mount -o nouuid /dev/vg1/lv2_from_vg1_snap /opt")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mount | grep lv2_from_vg1")]),s._v("\n/dev/mapper/vg1-lv2_from_vg1 on /test2 "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("type")]),s._v(" xfs "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("rw,relatime,attr2,inode64,noquota"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n/dev/mapper/vg1-lv2_from_vg1_snap on /opt "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("type")]),s._v(" xfs "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("rw,relatime,nouuid,attr2,inode64,noquota"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -- /opt里的内容跟/test2里的内容一模一样 ")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ls /opt")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".txt  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(".txt  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(".txt\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat /test2/1.txt")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("111")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat /opt/1.txt")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("111")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -- 但是 lv2_from_vg1里的内容改变后,lv2_from_vg1_snap快照里的内容是不会同步改变的!!")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# echo 123456 >> /test2/1.txt ")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat /test2/1.txt")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("111")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("123456")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat /opt/1.txt")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("111")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br"),n("span",{staticClass:"line-number"},[s._v("63")]),n("br"),n("span",{staticClass:"line-number"},[s._v("64")]),n("br"),n("span",{staticClass:"line-number"},[s._v("65")]),n("br"),n("span",{staticClass:"line-number"},[s._v("66")]),n("br"),n("span",{staticClass:"line-number"},[s._v("67")]),n("br")])]),n("h3",{attrs:{id:"快照恢复单个文件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#快照恢复单个文件"}},[s._v("#")]),s._v(" 快照恢复单个文件")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -- 平时没必要通过mount -o nouuid挂载快照,当被快照的lv里面的数据有问题了,才需要临时挂载快照进行数据恢复.")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -- 恢复单个文件数据")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cp /opt/1.txt /test2/1.txt ")]),s._v("\ncp：是否覆盖"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/test2/1.txt"')]),s._v("？ y\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat /test2/1.txt")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("111")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("h3",{attrs:{id:"多个文件合并恢复"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#多个文件合并恢复"}},[s._v("#")]),s._v(" 多个文件合并恢复")]),s._v(" "),n("p",[s._v("先卸载数据源与快照, 再进行合并,快照会自动删除,一次性的")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -- 恢复多个文件数据,可以合并,注意是一次性的!!(Ps:vm虚拟机里的快照恢复是永久的)")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-rf")]),s._v(" /test2/2.txt \n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("333")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" /test2/3.txt\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# tree /test2")]),s._v("\n/test2\n├── "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".txt\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 111")]),s._v("\n└── "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(".txt "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 333 /n 333")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# tree /opt")]),s._v("\n/opt\n├── "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".txt\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 111")]),s._v("\n├── "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(".txt "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 222")]),s._v("\n└── "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(".txt "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 333")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -- 若umount: /test2:目标忙, 先查看哪个进程占用fuser -cu /test2,ps查看该进程,再kill -9")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# umount /opt")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# umount /test2")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# lvconvert --mergesnapshot /dev/vg1/lv2_from_vg1_snap ")]),s._v("\n  Merging of volume vg1/lv2_from_vg1_snap started.\n  vg1/lv2_from_vg1: Merged: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("100.00")]),s._v("%\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -- 可以发现/dev/vg1/lv2_from_vg1_snap快照文件没了")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# lvs")]),s._v("\n  LV           VG     Attr       LSize   Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert\n  root         centos -wi-ao---- "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(".00g                                                    \n  swap         centos -wi-ao----   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(".00g                                                    \n  lv1_from_vg1 vg1    -wi-ao----  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v(".00g                                                    \n  lv2_from_vg1 vg1    -wi-ao----   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(".00g  \n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mount /dev/vg1/lv2_from_vg1 /test2/")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ls /test2")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".txt  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(".txt  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(".txt\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat /test2/*")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("111")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("222")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("333")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br")])]),n("p",[s._v("还有个思路是, "),n("code",[s._v("cp -r 源文件夹/* 目标文件夹")])]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("lvcreate "),n("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-L")]),s._v(" 1G "),n("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-s")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" lv2_from_vg1_snap /dev/vg1/lv2_from_vg1\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-rf")]),s._v(" /test2/2.txt\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("123456")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" /test2/1.txt\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat /test2/1.txt ")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("111")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("123456")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat /test2/2.txt ")]),s._v("\ncat: /test2/2.txt: 没有那个文件或目录\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mount -o nouuid /dev/vg1/lv2_from_vg1_snap /opt")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ls /opt")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".txt  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(".txt  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(".txt\n\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cp -r /opt/* /test2")]),s._v("\ncp:是否覆盖"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/test2/1.txt"')]),s._v("？ y\ncp:是否覆盖"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/test2/3.txt"')]),s._v("？ y\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ls /test2")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".txt  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(".txt  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(".txt\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat /test2/*")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("111")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("222")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("333")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -- 快照文件还在")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# lvs | grep snap")]),s._v("\n  lv2_from_vg1_snap vg1    swi-aos---   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".00g      lv2_from_vg1 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.20")]),s._v(" \n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br")])]),n("h3",{attrs:{id:"底层原理"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#底层原理"}},[s._v("#")]),s._v(" 底层原理")]),s._v(" "),n("p",[n("img",{attrs:{src:a(509),alt:""}})]),s._v(" "),n("p",[s._v("为了便于阐述,在这里约定被制作快照的lv叫做原始卷..(不存在这个名词哈,我们自己创造的)")]),s._v(" "),n("p",[n("font",{attrs:{size:"5"}},[s._v("Q1:")]),s._v(" 我们"),n("code",[s._v("lvcreate -L 1G")]),s._v("先分配了1G的空间给快照,将快照挂载后,能访问到跟原始卷里一样的数据..."),n("br"),s._v("\n        实际上给快照分配的1G大小的空间几乎没有使用,"),n("font",{attrs:{color:"blue"}},[s._v("也就是说快照刚建立好时是不占用空间的;矛盾的是里面却有数据.")]),s._v(" 很神奇吧,如何做到的呢？"),n("br"),s._v(" "),n("font",{attrs:{size:"5"}},[s._v("A1:")]),s._v(" 快照刚建立好时,里面全是一堆原始卷的"),n("strong",[s._v("硬链接")]),s._v(", 快照空间里是没有存放数据的.."),n("br"),s._v(" "),n("font",{attrs:{color:"green"}},[s._v("正因为硬链接的创建不能跨区,所以快照跟原始卷不能跨区..")]),s._v(" "),n("em",[s._v("专业一点来说, LVM 采用的写时复制, 是指当 LVM 快照创建的时候, 仅创建到实际数据的inode的硬链接(hark-link)而已..")]),s._v("  快照与原始卷共享很多PE 区块..")],1),s._v(" "),n("p",[n("font",{attrs:{size:"5"}},[s._v("Q2:")]),s._v(" 再思考个问题,硬链接的特点是inode号相同,硬链接的源文件和目标文件内容的修改会同步.."),n("br"),s._v("\n        但在实验中原始卷里的1.txt文件内容改变了,快照却没有影响.. 这又是为何呢？"),n("br"),s._v(" "),n("font",{attrs:{color:"gray"}},[s._v("实验了下,挂载的快照里的数据改了,对原始卷里的数据也没有影响..")]),n("br"),s._v(" "),n("font",{attrs:{size:"5"}},[s._v("A2:")]),s._v("  我们知道 "),n("strong",[s._v("硬盘中的所有操作都是覆盖")]),s._v(" ("),n("font",{attrs:{color:"gray"}},[s._v("详见文件系统章节")]),s._v(")!! lvm快照机制在处理原始卷的改动时,"),n("br"),s._v("\n        会先将原始卷里改动的1.txt文件整个移动到快照空间中,然后再实现1.txt文件进行覆盖操作... "),n("strong",[s._v("So,原试卷改动,快照才会占用空间")]),s._v("."),n("br"),s._v(" "),n("font",{attrs:{color:"brown"}},[s._v("专业一点来说,只要实际的数据没有改变, 快照就只包含指向数据的inode的指针,而非数据本身!  快照会跟踪原始卷中块的改变, 一旦你更改了快照对应的文件或目录，这个时候原始卷上将要改变的数据会在改变之前拷贝到快照预留的空间.")]),n("br"),s._v("\n        随着时间的推移,假设原试卷里的文件都改动过了,那么全都会倒腾到快照空间中. "),n("font",{attrs:{color:"red"}},[s._v("因而,快照空间的大小不会超过原始卷打快照时那一刻的大小!!")]),s._v(" 快照空间不够怎么办,动态扩容嘛！"),n("font",{attrs:{color:"gray"}},[s._v("快照是原试卷那一时刻内容的复刻,只有原始卷里面的文件第一次改动时才会惊动快照空间..")])],1),s._v(" "),n("p",[n("strong",[s._v("注意哦,")]),s._v(" 备份不一定必须用LVM快照, 也可以用前面提及的xfsdump增量备份...")]),s._v(" "),n("hr")])}),[],!1,null,null,null);t.default=e.exports},508:function(s,t,a){s.exports=a.p+"assets/img/3.2786c97b.png"},509:function(s,t,a){s.exports=a.p+"assets/img/4.e54326e3.jpeg"}}]);