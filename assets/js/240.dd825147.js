(window.webpackJsonp=window.webpackJsonp||[]).push([[240],{1214:function(s,t,a){"use strict";a.r(t);var n=a(0),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("p",[a("font",{attrs:{color:"brown"}},[s._v("系统优化参考链接: "),a("code",[s._v("https://zhuanlan.zhihu.com/p/340313062")])]),a("br"),s._v(" "),a("font",{attrs:{color:"gray"}},[s._v("内心OS: 运维好吃经验.. 难道开发不吃经验嘛？可感觉运维比开发更繁琐一丢丢.. 运维不简单啊!! 若几年后我开发不转运维,那我得去考个研... 进行python AI方面的系统化学习  路漫漫其修远兮.. 学到老活到老...")])],1),s._v(" "),a("h2",{attrs:{id:"yum源处理与常用软件包安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#yum源处理与常用软件包安装"}},[s._v("#")]),s._v(" yum源处理与常用软件包安装")]),s._v(" "),a("p",[a("strong",[s._v("注意")]),s._v(":"),a("br"),s._v("\n     若从头接手项目, 将部署过程中安装的包缓存本地,将所有主机上的软件包汇总到一起, 做成一个自己的yum源用来后期使用."),a("br"),s._v("\n     若中途接手项目,进行升级时, 测试环境先倒腾一遍,将回滚方案全都写好,一旦出问题,自动运行脚本回滚.. 然后线上环境升级,最开始只升几台,观察一两周,再慢慢扩大升级规模..")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -- 1.将系统默认的yum源移动到指定目录下")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mv")]),s._v(" /etc/yum.repos.d/CentOS-Base.repo /etc/yum.repos.d/CentOS-Base.repo.backup\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -- 2.下载aliyun的Base源和epel源")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-o")]),s._v(" /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-o")]),s._v(" /etc/yum.repos.d/epel.repo http://mirrors.aliyun.com/repo/epel-7.repo\nyum update "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-y")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -- 刚装完系统后就立即执行,往后就不要轻易执行此命令啦")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -- 3.安装常用的软件包")]),s._v("\nyum "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-y")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" tree nmap sysstat lrzsz  telnet bash-completion bash-completion-extras "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("lsof")]),s._v("  net-tools "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rsync")]),s._v(" ntpdate nfs-utils\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("hr"),s._v(" "),a("h2",{attrs:{id:"规范系统主机名"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#规范系统主机名"}},[s._v("#")]),s._v(" 规范系统主机名")]),s._v(" "),a("p",[s._v("主机名通常会与 "),a("code",[s._v("/etc/hosts")]),s._v(" 文件搭配使用.. 进而实现集群主机之间相互用主机名解析..")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("hostnamectl set-hostname 主机名  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -- 主机名能够反映出主机的作用即可")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/hosts  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -- 编辑好之后,每台机器都发一份  hosts文件充当的就是DNS服务器的角色")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".10.11 nc1 ceph-deploy "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -- IP可以对应多个主机名")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".10.12 nc2\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".10.13 nc3\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".10.14 cs1\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".10.15 cs2\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".10.16 cs3\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("hr"),s._v(" "),a("h2",{attrs:{id:"ssh秘钥登录"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ssh秘钥登录"}},[s._v("#")]),s._v(" ssh秘钥登录")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("ssh-keygen\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -- 生成私钥与公钥 生成时候还可以加个密码,这样的话,密钥连接时,就需要输入这个密码")]),s._v("\nssh-copy-id "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" root@服务端ip地址  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -- 把自己的公钥上传到服务端")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ssh")]),s._v(" root@服务端ip地址  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -- 客户端连接到服务端(会通过密钥的方式连接,不再输入服务端的账号和密码)")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v('"\n密钥登录: 通常会在客户端生成公钥和私钥'),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(" \n         将公钥上传给服务器,往后客户端链接服务端的时候,就通过私钥链接即可.\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("1")]),s._v(">")]),s._v(" xshell客户端对应服务端的软件openssh-server. xshell可通过密钥登录.\n   xshell配置密钥登录后,在服务端可以禁用传统的账号密码登录"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("\n   "),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/ssh/sshd_config"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v(" 将PasswordAuthentication "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("yes")]),s._v(" 改为 PasswordAuthentication no\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("2")]),s._v(">")]),s._v(" 主机A、主机B"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("都可以通过密钥登录主机M"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("AB将该客户端的公钥给M就行"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" 过程略.\n   集群之间,主机与主机相连通常私钥不会再加个密码"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(" \n   主机A:  "),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ssh")]),s._v(" root@主机M的ip地址 命令"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -- 实现自动化")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v('"\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br")])]),a("hr"),s._v(" "),a("h2",{attrs:{id:"关闭selinux"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#关闭selinux"}},[s._v("#")]),s._v(" 关闭SELinux")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v('"\n  SELinux'),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Security-Enhanced Linux"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("是美国国家安全局"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("NSA"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("对于强制访问控制的实现.\n  这个功能让系统管理员又爱又恨,这里我们还是把它给关闭了吧,至于安全问题,后面通过其他手段来解决,这也是大多数生产环境的做法,如果非要开启也是可以的.\n "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v('"\n setenforce  '),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -- 临时关闭")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'s#SELINUX=enforcing#SELINUX=disabled#g'")]),s._v(" /etc/selinux/config "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -- 永久配置,重启生效")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"disabled"')]),s._v(" /etc/selinux/config\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -- 检查结果")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("hr"),s._v(" "),a("h2",{attrs:{id:"关闭防火墙或者开发对应的端口"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#关闭防火墙或者开发对应的端口"}},[s._v("#")]),s._v(" 关闭防火墙或者开发对应的端口")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v('"\n关闭防火墙的目的是为了让初学者学习更方便. 将来在学了Firewalld技术后可再统一开启. 在企业环境中,一般只有配置外网IP的linux服务器才需要开启防火墙,但即使是有外网IP,对于高并发高流量的业务服务器仍是不能开的,因为会有较大性能损失,导致网站访问很慢,这种情况下只能在前端加更好的硬件防火墙了'),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v('"\n'),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -- 临时关闭")]),s._v("\nsystemctl stop firewalld\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -- 设置开机不启动")]),s._v("\nsystemctl disable firewalld\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("hr"),s._v(" "),a("h2",{attrs:{id:"配置ntp服务-同步系统时间"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置ntp服务-同步系统时间"}},[s._v("#")]),s._v(" 配置ntp服务,同步系统时间")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -- 给定时任务加上注释")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'#Timing synchronization time'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" /var/spool/cron/root\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -- 定时任务")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'0 */1 * * * /usr/sbin/ntpdate ntp1.aliyun.com &>/dev/null'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" /var/spool/cron/root\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -- 检查结果")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("crontab")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-l")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("hr"),s._v(" "),a("h2",{attrs:{id:"ulimit"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ulimit"}},[s._v("#")]),s._v(" ulimit")]),s._v(" "),a("blockquote",[a("p",[s._v("我们可以使用ulimit命令对系统资源进行控制,是临时的配置")])]),s._v(" "),a("h3",{attrs:{id:"选项"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#选项"}},[s._v("#")]),s._v(" 选项")]),s._v(" "),a("p",[s._v("设置每个用户级/普通用户所能打开的最大进程数目: "),a("strong",[s._v("-u")]),s._v(" 选项")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("ulimit")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-u")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("设置 "),a("strong",[s._v("每个")]),s._v(" 用户级/普通用户开启的 "),a("strong",[s._v("每个进程")]),s._v(" 所能分配到的文件描述符/文件句柄数量: "),a("strong",[s._v("-n")]),s._v(" 选项")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v('"\n文件描述符是linux独有的机制,每打开一个文件,给打开的文件分配一个编号'),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("不是inode！！！"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n具体来说,进程每打开一个文件,OS内核就会为该打开的文件分配一个编号"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("非负整数"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(",该编号称之为文件描述符或者文件handle.\n\n文件打开后的处理逻辑:\n进程-"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("文件描述符-"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("操作系统内核-"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("一个具体的文件\n即内核"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("kernel"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("就是利用文件描述符"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("file descriptor"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("来访问文件\n\n文件描述符的数目是可以设置的\n一旦设置过小,进程会随着打开的文件数增多,因为达到了文件描述的上限而无法打开文件,从而抛出异常\n"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v('"\n'),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -- 注意是同时打开!!!什么场景一个进程会同时打开上千上万个文件？")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    高并发!!达到上限,打不开文件了,用户拿不到数据..进程报IO错误.")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("ulimit")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -- 默认是1024个")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br")])]),a("h3",{attrs:{id:"文件描述符"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#文件描述符"}},[s._v("#")]),s._v(" 文件描述符")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim fd.py")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat fd.py")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("import")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("time")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("import")]),s._v(" os\n\nprint"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("os.getpid"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")]),s._v("\n\nwith open"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'a.txt'")]),s._v(",mode"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'wt'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" as f1,open"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'b.txt'")]),s._v(",mode"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'wt'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" as f2:\n    time.sleep"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# python fd.py &")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14762")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v('"\n/proc 进程虚拟文件系统'),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n/proc/14762 放置该进程相关的所有文件"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n/proc/14762/fd 该进程打开的文件.  \n    一个进程可通过文件描述符"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("数字"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("关联打开的文件\n    要注意的是,该进程文件描述符的数量与该进程打开文件的数目不是一一对应的！！！\n"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v('"\n'),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat /proc/14762/fd")]),s._v("\n总用量 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -- 注意哦!! 多个文件描述符可对应同一个文件,这里0 1 2 指文件需要终端的输入,文件产生的结果需要输出到终端")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -- 一个进程产生默认就会带着 0 1 2 这三个文件描述符")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -- 这也跟linux一切皆文件 以及 重定向的知识对应了起来 芜湖～")]),s._v("\nlrwx------ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("月  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("31")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(":59 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" -"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /dev/pts/1\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -- /dev/pts/1是当前所在终端 标准输入")]),s._v("\nlrwx------ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("月  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("31")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(":59 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" -"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /dev/pts/1  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -- 标准正确输出")]),s._v("\nlrwx------ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("月  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("31")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(":59 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" -"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /dev/pts/1  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -- 标准错误输出")]),s._v("\nl-wx------ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("月  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("31")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(":59 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" -"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /root/a.txt\nl-wx------ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("月  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("31")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(":59 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" -"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /root/b.txt \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br")])]),a("h3",{attrs:{id:"永久配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#永久配置"}},[s._v("#")]),s._v(" 永久配置")]),s._v(" "),a("p",[s._v("修改配置文件 "),a("code",[s._v("/etc/security/limits.conf")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -- 加大文件描述符与最大打开的进程数")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v('"\n'),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("domain"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("type"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("item"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("value"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("domain"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("  表示要限制的用户\n    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("type"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("    设定类型\n    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("item"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("    表示可选的资源\n    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("value"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("   表示要限制的值\n"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v('"\n'),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -- 102400通常够用了.没有一个固定的标准,设置大了,若进程bug会无限占用资源,不安全 设置小了不够用,要权衡.")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat >>/etc/security/limits.conf<<EOF")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" * soft nofile "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("102400")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" * hard nofile "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("102400")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" * soft nproc "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("102400")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" * hard nproc "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("102400")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" EOF\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -- 重启查看")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ulimit -u")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("102400")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ulimit -n")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("102400")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v('"\nPs: 还有个配置文件更精细. /etc/security/limits.d/20-nproc.conf\n    该文件只用于控制用户最多同时打开的进程数目,优先级高于/etc/security/limits.conf\n    重启后,修改生效'),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v('"\n'),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@egon ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat /etc/security/limits.d/20-nproc.conf ")]),s._v("\negon1      soft    nproc     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("          "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 用户egon1最多同时开3个进程")]),s._v("\negon2      soft    nproc     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("          "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 用户egon2最多同时开4个进程")]),s._v("\n*          soft    nproc     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("          "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 其他用户最多同时开5个进程")]),s._v("\nroot       soft    nproc     unlimited  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# root用户无限制")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br")])]),a("hr"),s._v(" "),a("h2",{attrs:{id:"其他"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#其他"}},[s._v("#")]),s._v(" 其他")]),s._v(" "),a("p",[s._v("○ 开启VT和HT"),a("br"),s._v("\n        VT 虚拟化之意, Linux虚拟出多个OS运行在一个主机之上.."),a("br"),s._v("\n        HT 超线程技术..."),a("br"),s._v(" "),a("font",{attrs:{color:"gray"}},[s._v("Ps: 实体机才会配置,若用的阿里云(本身就是vm)是不需要配置的..")])],1),s._v(" "),a("p",[s._v("○ 关闭实体机的CPU节能")]),s._v(" "),a("p",[s._v("○ 关闭NetworkManager"),a("br"),s._v("\n        进行网卡绑定的话,必须关掉")]),s._v(" "),a("p",[s._v("○ Jumbo frames"),a("br"),s._v("\n        万兆网卡MTU=9000,交换机也要进行相应的设置")]),s._v(" "),a("p",[s._v("○ 调整swappiness"),a("br"),s._v("\n        linux内存够用,有时候也会使用swap分区..(linux底层算法决定的) 但会导致性能效率降低.."),a("br"),s._v("\n        所以在内存够用的时候,让它尽可能的少用swap分区.. 建议调整为10"),a("br"),s._v(" "),a("code",[s._v('echo "vm.swappiness = 10" | tee -a /etc/sysctl.conf')]),a("br"),s._v(" "),a("code",[s._v("sysctl -p")]),s._v(" 或者 "),a("code",[s._v("reboot")]),s._v(" 永久生效")]),s._v(" "),a("p",[s._v("○ 调整Kernel pid max  内核最大的pid个数")]),s._v(" "),a("hr")])}),[],!1,null,null,null);t.default=e.exports}}]);