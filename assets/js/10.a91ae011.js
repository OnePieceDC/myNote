(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{1018:function(s,t,a){s.exports=a.p+"assets/img/alipay.a5d2f4d3.gif"},1019:function(s,t,a){s.exports=a.p+"assets/img/image-20240106184852475.afb2d9a1.png"},1020:function(s,t,a){s.exports=a.p+"assets/img/image-20240103140725478.e6bc69e9.png"},1021:function(s,t,a){s.exports=a.p+"assets/img/image-20240103133500060.02114d3c.png"},1022:function(s,t,a){s.exports=a.p+"assets/img/image-20240103134300172.39943ef6.png"},1023:function(s,t,a){s.exports=a.p+"assets/img/image-20240103214056474.fbad94e3.png"},1024:function(s,t,a){s.exports=a.p+"assets/img/image-20240103220813971.41f02e32.png"},1025:function(s,t,a){s.exports=a.p+"assets/img/image-20240103223202352.29187c26.png"},1026:function(s,t,a){s.exports=a.p+"assets/img/image-20240104195848797.a8eb4949.png"},1027:function(s,t,a){s.exports=a.p+"assets/img/image-20240104211543344.2a70c547.png"},1028:function(s,t,a){s.exports=a.p+"assets/img/image-20240104214329463.59584192.png"},1029:function(s,t,a){s.exports=a.p+"assets/img/23.a374935a.gif"},1030:function(s,t,a){s.exports=a.p+"assets/img/image-20240106185116566.e88dbde9.png"},1031:function(s,t,a){s.exports=a.p+"assets/img/image-20240106210311929.0eb1ab14.png"},1032:function(s,t,a){s.exports=a.p+"assets/img/image-20240106212331163.78683001.png"},1033:function(s,t,a){s.exports=a.p+"assets/img/image-20240119140937111.b93aa087.png"},1034:function(s,t,a){s.exports=a.p+"assets/img/image-20240119134349980.757f36d4.png"},1035:function(s,t,a){s.exports=a.p+"assets/img/24.af4e3013.gif"},1036:function(s,t,a){s.exports=a.p+"assets/img/image-20240120155426858.2926b8fb.png"},1037:function(s,t,a){s.exports=a.p+"assets/img/image-20240120155833137.3a3d6fda.png"},1038:function(s,t,a){s.exports=a.p+"assets/img/image-20240123133659323.1dd5b916.png"},1039:function(s,t,a){s.exports=a.p+"assets/img/image-20240123135218161.1e499593.png"},1040:function(s,t,a){s.exports=a.p+"assets/img/25.bea2ffbc.gif"},1041:function(s,t,a){s.exports=a.p+"assets/img/image-20240123143449104.c65a039d.png"},1042:function(s,t,a){s.exports=a.p+"assets/img/27.2eeda788.gif"},1043:function(s,t,a){s.exports=a.p+"assets/img/image-20240123181754630.4f949b73.png"},1044:function(s,t,a){s.exports=a.p+"assets/img/image-20240123193134165.697fbcd7.png"},1045:function(s,t,a){s.exports=a.p+"assets/img/image-20240124195522133.23d51de9.png"},1046:function(s,t,a){s.exports=a.p+"assets/img/image-20240130125157238.6f84ab45.png"},1047:function(s,t,a){s.exports=a.p+"assets/img/28.adbfaa04.gif"},1048:function(s,t,a){s.exports=a.p+"assets/img/image-20240202153947262.4f392470.png"},1333:function(s,t,a){"use strict";a.r(t);var n=a(0),r=Object(n.a)({},(function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h2",{attrs:{id:"支付宝"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#支付宝"}},[s._v("#")]),s._v(" 支付宝")]),s._v(" "),n("blockquote",[n("p",[s._v("写了一个Django的小demo来单独实现支付宝的支付转账!! 后续再集成到供应链的项目中!")])]),s._v(" "),n("p",[s._v("demo地址: "),n("code",[s._v("https://github.com/OnePieceDC/alipay_demo")])]),s._v(" "),n("p",[n("img",{attrs:{src:a(1018),alt:"alipay"}})]),s._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[s._v("API与SDK的区别\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" API就是一堆http接口"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("写起来比较麻烦\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" SDK是集成工具包\n   "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" 基于这些 API"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("接口 封装了一些类和方法"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("基于开发语言封装的可以直接调用的功能"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("工具"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("集合"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("相对于直接使用API使用起来简便些"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n   "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" 厂商会提供了有不同语言java、python、go"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("的不同版本的sdk\n    \n    \n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" 正式环境\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" 沙箱环境 https"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("//")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("open")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("alipay"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("develop"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("sandbox"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("app 支付宝账号开发平台"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("开通沙箱\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" 沙箱应用\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" 基本信息\n      "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" APPID\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" 开发信息\n      "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" 接口加密方式 选系统默认密钥"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v("公钥模式"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("已启用"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" 查看 应用公钥"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("应用私钥"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("支付宝公钥\n      "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" 支付宝的网关地址 https"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("//")]),s._v("openapi"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("sandbox"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("dl"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("alipaydev"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("gateway"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("do  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" 里面有dev表明是测试环境\n      "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" 应用网关地址、授权回调地址 线上环境才会用到"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" 沙箱账号\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" 商家信息\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" 买家信息\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" 沙箱工具\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" 支付宝客户端沙箱版 "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" 下载到手机上"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("登陆沙箱账号中的买家信息用于支付\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" 关于文档 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("官方文档SDK对于python支持非常不友好"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("所以我们使用官方的API"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" 支付"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("统一下单支付的接口文档 https"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("//")]),s._v("opendoc"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("alipay"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("open")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("59da99d0_alipay"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("trade"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("page"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pay\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" 转账 https"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("//")]),s._v("opendocs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("alipay"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("open")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("029i78?scene"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("ca56bca529e64125a2786703c6192d41\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" 异步通知 https"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("//")]),s._v("opendoc"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("alipay"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("open")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("270")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("105902")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br")])]),n("p",[n("strong",[s._v('简单阐述下整体的逻辑(下述是支付 "前后端不分离下的流程"):')])]),s._v(" "),n("p",[n("img",{attrs:{src:a(1019),alt:"image-20240106184852475"}})]),s._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" 最重要的是如何用"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("代码中 构造的url参数的过程"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("加密解密的过程 都不必深究"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("可看代码注释"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("也能理解个七七八八"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  PS"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("构造的url参数中包括商品信息以及 签名"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("加密 信息"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" return_url 用户支付成功后"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("支付宝向该地址发送GET请求"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v(" 可重定向"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" 告诉用户支付成功\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" notify_url 用户支付成功后"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("支付宝向该地址发送POST请求"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" 告诉Django支付成功"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("后端会更新数据库中的订单状态"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n  根据官方文档"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("我们应该"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" HttpResponse"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Success"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" 否则"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("支付宝会不断重发通知"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("4min、10min"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n  why? 为了防止客户扫码支付完成时"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("服务器不巧宕机了"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("订单状态未及时更新"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v(" 在服务器修复后"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("可以再次收到支付成功的回复"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("更新订单状态!\n  注"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("支付宝会不断重发通知"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("超过"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("天后"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("就不会发了"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v(" So"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("宕机超过了"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("天"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("服务器恢复后"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("需手动查询用户支付结果"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("以此更新订单状态!!\n\n★ 不应该根据页面的跳转来判断支付是否成功\n  应该依据支付宝向我们发送的POST请求 "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("or")]),s._v(" 手动的查询支付信息 来判断支付是否成功"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("进而更新订单状态!\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br")])]),n("hr"),s._v(" "),n("h2",{attrs:{id:"我的钱包-前端界面"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#我的钱包-前端界面"}},[s._v("#")]),s._v(" 我的钱包 - 前端界面")]),s._v(" "),n("blockquote",[n("p",[s._v("代码分为三部分来展示")])]),s._v(" "),n("p",[n("img",{attrs:{src:a(1020),alt:"image-20240103140725478"}})]),s._v(" "),n("p",[s._v("前置工作: 创建walletView.vue、加入前端路由、写入左侧菜单中.")]),s._v(" "),n("h3",{attrs:{id:"第一部分-我的资产"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#第一部分-我的资产"}},[s._v("#")]),s._v(" 第一部分 - 我的资产")]),s._v(" "),n("blockquote",[n("p",[s._v("Card卡片 + el-row el-col布局 + Tooltip文字提示")])]),s._v(" "),n("p",[n("img",{attrs:{src:a(1021),alt:"image-20240103133500060"}})]),s._v(" "),n("h3",{attrs:{id:"第二部分-充值提现"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#第二部分-充值提现"}},[s._v("#")]),s._v(" 第二部分 - 充值提现")]),s._v(" "),n("blockquote",[n("p",[s._v("el-row el-col布局 + card卡片 + el-form表单")])]),s._v(" "),n("p",[n("img",{attrs:{src:a(1022),alt:"image-20240103134300172"}})]),s._v(" "),n("h3",{attrs:{id:"第三部分-交易记录"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#第三部分-交易记录"}},[s._v("#")]),s._v(" 第三部分 - 交易记录")]),s._v(" "),n("blockquote",[n("p",[s._v("交易记录的前端界面设计又分为三部分的知识, 搜索 + 表格 + 分页")])]),s._v(" "),n("h5",{attrs:{id:"交易记录-搜索"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#交易记录-搜索"}},[s._v("#")]),s._v(" 交易记录 - 搜索")]),s._v(" "),n("blockquote",[n("p",[s._v("搜索部分使用的是行内表单, 包含了三类输入框, 时间的范围选择 + 下拉框 + 直接输入")])]),s._v(" "),n("p",[n("img",{attrs:{src:a(1023),alt:"image-20240103214056474"}})]),s._v(" "),n("h5",{attrs:{id:"日期国际化"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#日期国际化"}},[s._v("#")]),s._v(" 日期国际化")]),s._v(" "),n("blockquote",[n("p",[s._v("选择日期时进行国际化的展示.. 添加两行代码即可!!")])]),s._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'./plugins/axios'")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("createApp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'vue'")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" App "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'./App.vue'")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" router "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'./router'")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" store "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'./store'")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" ElementPlus "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'element-plus'")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'element-plus/dist/index.css'")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" zhCn "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'element-plus/dist/locale/zh-cn.mjs'")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ★")]),s._v("\n\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("installAxios"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"@/plugins/axios"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" app "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("createApp")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("App"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("installAxios")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("app"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ★ use(ElementPlus, {locale: zhCn})")]),s._v("\napp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("use")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("store"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("use")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("router"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("use")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ElementPlus"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("locale")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" zhCn"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("mount")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'#app'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br")])]),n("h5",{attrs:{id:"交易记录-表格"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#交易记录-表格"}},[s._v("#")]),s._v(" 交易记录 - 表格")]),s._v(" "),n("blockquote",[n("p",[s._v("表格部分也挺有意思的,")])]),s._v(" "),n("p",[n("img",{attrs:{src:a(1024),alt:"image-20240103220813971"}})]),s._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[s._v("在缩放浏览器宽高时"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("页面大小响应式的变化"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("前端报错 ResizeObserver loop completed "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("with")]),s._v(" undelivered notifications"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n谷歌后"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("https")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("github"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("vuejs"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("vue"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("cli"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("issues"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("7431")]),s._v("\n在vue"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("config"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("js添加了几行代码解决"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" 不必深究"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("defineConfig"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("require")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'@vue/cli-service'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nmodule"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("exports "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("defineConfig")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("transpileDependencies")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("lintOnSave")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 添加了以下5行代码!!")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("devServer")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("client")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("overlay")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br")])]),n("h5",{attrs:{id:"交易记录-分页"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#交易记录-分页"}},[s._v("#")]),s._v(" 交易记录 - 分页")]),s._v(" "),n("blockquote",[n("p",[s._v("分页组件会根据总条数和每页多少条, 自动算出一共有多少页.")])]),s._v(" "),n("p",[n("img",{attrs:{src:a(1025),alt:"image-20240103223202352"}})]),s._v(" "),n("hr"),s._v(" "),n("h2",{attrs:{id:"我的资产-初始化"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#我的资产-初始化"}},[s._v("#")]),s._v(" 我的资产 - 初始化")]),s._v(" "),n("blockquote",[n("p",[s._v("当页面加载时/前端组件WalletView.vue加载时,向后台发送请求,获取当前登陆用户的资产数据并展示!!")])]),s._v(" "),n("p",[n("strong",[s._v('关于"我的资产", 需知:')]),n("br"),s._v("\n1> 总余额 = 可用余额 + 不可用余额;"),n("br"),s._v("\n2> 当用户进行提现操作时, 需要经过后台审核, 在审核期间, 提现的金额会从可用余额中扣除, 放到不可用余额中?!"),n("br"),s._v("\n3> 信用额度, 该功能项目中暂未开发, 因为涉及的比较多.. 它相当于透支, 大客户即使余额不够也可以用信用额度顶替!!")]),s._v(" "),n("h3",{attrs:{id:"后端-api的设计"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#后端-api的设计"}},[s._v("#")]),s._v(" 后端 - Api的设计")]),s._v(" "),n("blockquote",[n("p",[s._v("对于restful规范不要盲目的跟从, 可根据实际情况来进行优化调整!!")])]),s._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[s._v("我们熟知restful规范\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" http"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("//")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8000")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("api"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("shipper"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("wallet"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("\n\tGET  数据列表\n\tPOST 新建\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" http"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("//")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8000")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("api"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("shipper"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("wallet"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("\n\tGET     单条数据\n\tPUT     全部更新\n\tPATCH   局部更新\n\tDELETE  删除\n  \n代入"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"页面加载时获取当前登陆用户的资产信息"')]),s._v("这一需求中"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("我们很容易想到"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n前端应该向"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://127.0.0.1:8000/api/shipper/wallet/当前登陆用户ID/"')]),s._v("该地址发送GET请求"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("获取单条数据!!\n\n▲ 但此处我们不这样做"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("我们让前端向"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://127.0.0.1:8000/api/shipper/wallet/"')]),s._v("地址发送GET请求!!\n  后端需重写"),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("list")]),s._v("方法!\n  在该"),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("list")]),s._v("方法中"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("因为访问该接口必须得进行登陆认证"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("所以通过request"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("user获取到当前登陆用户的ID"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("进而返回该条用户的数据!\n\n※※※\n联想下前面 账号认证 功能模块的开发过程中"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("关于账号认证AB页面初始化时"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("我们探讨过url中传递的ID是什么?\n当时我们提出两种方案来解决"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("方案"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("不携带"),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("id")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("方案"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("携带"),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("id")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("最后使用的是方案"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("!!方案"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("的具体如何解决当时是省略的!!\n在这里"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"我的资产初始化"')]),s._v("这个需求不携带"),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("id")]),s._v("的解决思路"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("可供 账号认证页面初始化的方案"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" 的具体实现进行参考!!\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br")])]),n("p",[n("strong",[s._v("现在我们的目标:")]),s._v(" "),n("font",{attrs:{color:"brown"}},[s._v("前端向后端发送的url中不携带ID并发送的是GET请求, 前端最终获取到单条数据!!")])],1),s._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[s._v("别急"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("我们从头一步步的来分析"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("先回顾一点"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v("的知识"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("\n当我们的视图类继承了ViewSetMixin"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("该类重写了as_view方法"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("路由的写法就变了!!\n它将 get"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("post"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("put"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("delete 等方法映射到 "),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("list")]),s._v("、create、retrieve、update、partial_update、destroy方法中\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" http"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("//")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8000")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("api"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("shipper"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("wallet"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("\n\tGET  数据列表     "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("list")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n\tPOST 新建         "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("create"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" http"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("//")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8000")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("api"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("shipper"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("wallet"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("\n\tGET     单条数据   "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("retrive"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n\tPUT     全部更新   "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("update"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n\tPATCH   局部更新   "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("partial_update"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n\tDELETE  删除      "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("destroy"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n\nGenericViewSet "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" ViewSetMixin "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" GenericAPIView\ndrf的"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("个视图扩展类"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("CreateModelMixin、RetrieveModelMixin等 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("这"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("个视图扩展类往往会跟GenericViewSet一起用"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\ndrf的"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("个视图扩展类都把"),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("list")]),s._v("、create等方法里的代码给我们写好啦!!\n\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("结合我们的目标进行分析"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("\n◆ 先明确一个前提"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 我们后端使用的是自动生成路由!!所以"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("我们的视图类必须得继承 ViewSetMixin类或继承了该类的类!!\n◆ 接着实现我们的目标"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("向"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://127.0.0.1:8000/api/shipper/wallet/"')]),s._v("地址发送GET请求"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("获取单条数据\n根据drf默认的规则"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("这样的请求到后端后"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("需要在"),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("list")]),s._v("方法中写我们的业务逻辑!!\nok"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("我们在自己的视图类中写一个"),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("list")]),s._v("方法"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("里面如何编写呢?\n把视图扩展类ListModelMixin重新的"),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("list")]),s._v("方法里的代码 "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("or")]),s._v(" RetrieveModelMixin重写的retrive方法里的代码搬过来可以吗?\n不可以! \n前者返回的是多条数据"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("不符合我们的目标"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" 后者的源码中有代码 self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("get_object"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("它干了四件事"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("其中一件需要url中pk值"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("否则报错!\n解决方案"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("需要将两者糅合一下!!\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br")])]),n("h3",{attrs:{id:"后端-分类维度"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#后端-分类维度"}},[s._v("#")]),s._v(" 后端 - 分类维度")]),s._v(" "),n("blockquote",[n("p",[s._v("补充一点, 关于我们使用自动生成路由时, 业务代码的分类维度:")])]),s._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" 根据"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"业务功能"')]),s._v("进行分类\n  router "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" SimpleRouter"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  router"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("register"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'basic'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" basic"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("BasicView"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" basename"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'basic'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 基本信息")]),s._v("\n  router"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("register"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'auth'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" auth"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("AuthView"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" basename"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'auth'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 账号认证")]),s._v("\n  router"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("register"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'wallet'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" wallet"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("WalletView"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" basename"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'wallet'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 我的钱包")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" 根据"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"表结构"')]),s._v("进行分类\n  router "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" SimpleRouter"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Company供应商表 -- 里面包含 基本信息和我的钱包的业务")]),s._v("\n  router"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("register"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'company'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" company"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("CompanyView"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" basename"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'company'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# CompanyAuth供应商认证表  -- 里面包含 账号认证的业务")]),s._v("\n  router"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("register"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'companyAuth'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" companyAuth"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("CompanyAuthView"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" basename"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'CompanyAuth'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# PS: 有些也会这样 同样是Company供应商表,但也进一步进行了拆分")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# router.register('company/basic', basic.CompanyBasicView, basename='basic')")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# router.register('company/wallet', basic.CompanyWalletView, basename='wallet')")]),s._v("\n\n那我们使用哪个分类维度呢?一般情况下我们会根据"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"业务功能"')]),s._v("进行分类!!\nwhy?因为这样分类"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("通过url的名字就可以很方便的找到相应的业务代码!!\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br")])]),n("h3",{attrs:{id:"后端-功能初步实现"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#后端-功能初步实现"}},[s._v("#")]),s._v(" 后端 - 功能初步实现")]),s._v(" "),n("blockquote",[n("p",[s._v("先完成功能为前提, 下一步会进行封装!!")])]),s._v(" "),n("p",[s._v("url中不携带id + GET请求 + 自动添加路由, 决定了在视图类WalletView中得写list方法;"),n("br"),s._v("\n我们的目标是返回单条数据, 在list方法中使用了RetrieveModelMixin的retrieve方法的源码, 但必须得重写get_object方法!!"),n("br"),s._v("\n(因为源码的self.get_object,它干了四件事,其中一件需要url中pk值,否则报错!)")]),s._v(" "),n("p",[n("img",{attrs:{src:a(1026),alt:"image-20240104195848797"}})]),s._v(" "),n("h3",{attrs:{id:"后端-listretrievemodelmixin"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#后端-listretrievemodelmixin"}},[s._v("#")]),s._v(" 后端 - ListRetrieveModelMixin")]),s._v(" "),n("blockquote",[n("p",[s._v("对上面的代码进行改进和封装!!")])]),s._v(" "),n("p",[s._v("ListRetrieveModelMixin 简单来说就是 "),n("strong",[s._v('"list的url,retrieve的功能 单条数据由登陆认证组件通过后的request.user指定"')]),s._v(" ..")]),s._v(" "),n("p",[n("img",{attrs:{src:a(1027),alt:"image-20240104211543344"}})]),s._v(" "),n("h3",{attrs:{id:"前端-关键代码"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#前端-关键代码"}},[s._v("#")]),s._v(" 前端 - 关键代码")]),s._v(" "),n("blockquote",[n("p",[s._v("写过很多次了, 不再赘述.")])]),s._v(" "),n("h5",{attrs:{id:"loading区域加载"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#loading区域加载"}},[s._v("#")]),s._v(" Loading区域加载")]),s._v(" "),n("blockquote",[n("p",[s._v("初始化时,Loading区域加载")])]),s._v(" "),n("p",[n("img",{attrs:{src:a(1028),alt:"image-20240104214329463"}})]),s._v(" "),n("h5",{attrs:{id:"loading全屏加载"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#loading全屏加载"}},[s._v("#")]),s._v(" Loading全屏加载")]),s._v(" "),n("blockquote",[n("p",[s._v("初始化时,全屏Loading加载")])]),s._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" ElLoading "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'element-plus'")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ▲")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("initRequest")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" loadingInstance "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" ElLoading"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("fullscreen")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ▲ 全屏加载")]),s._v("\n    proxy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("$axios"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token template-string"}},[n("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[s._v("`")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("/api/shipper/wallet/")]),n("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[s._v("`")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("then")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("res")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        loadingInstance"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("close")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ▲ 请求到数据了,关闭全屏加载")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("code "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("===")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            state"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("money "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("data\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            ElMessage"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("error")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("msg"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("catch")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("error")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("error")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("error"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("onMounted")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("initRequest")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br")])]),n("hr"),s._v(" "),n("h2",{attrs:{id:"充值"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#充值"}},[s._v("#")]),s._v(" 充值")]),s._v(" "),n("blockquote",[n("p",[s._v("需明确, 这里的充值是指 用户通过支付宝支付后往平台里充值.")])]),s._v(" "),n("p",[n("img",{attrs:{src:a(1029),alt:"23"}})]),s._v(" "),n("p",[n("strong",[s._v("前后端分离, 支付宝支付流程如下:")])]),s._v(" "),n("p",[n("img",{attrs:{src:a(1030),alt:"image-20240106185116566"}})]),s._v(" "),n("p",[s._v("Ps: 后端构建好支付链接后,前端跳转该链接,该链接还会自己重定向到二维码页面!"),n("br"),s._v('\nPs: 图中"即证明是支付宝返回的信息" , 准确的说, 是保证 同步请求和异步请求都是支付宝发送过来的!!不是其他人伪造的!!')]),s._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[s._v("□ 流程想通了"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("开始编码实现"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("先思考几个问题"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\nQ1"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" 点击充值按钮后"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("浏览器需要向后端索要支付宝支付链接"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("向后端哪个API地址发送请求获取"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("发送什么请求?\nA1"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" 很容易先思考restful规范"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("没有适合的!! \n    那么在router"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("register"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'wallet'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" wallet"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("WalletView"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" basename"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'wallet'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("对应的WalletView中\n    利用action添加一个路由!!其url_path"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'charge'")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("api"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("shipper"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("wallet"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("charge"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("\n    \nQ2"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" 用户支付完成后"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("支付宝会向return_url发送GET请求"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("向notify_url地址发送POST请求!\n    return_url、notify_url 是前端地址还是后端地址呢?\nA2"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" 应该是后端的api地址"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("因为我们需要对其进行验证!!保证关于支付是否成功的信息是支付宝给我们的!!\n\nQ3"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" 我们确认了return_url、notify_url是后端地址"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("那么这格外的url也通过action写在WalletView视图类中吗？\nA3"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" No! 关于return_url、notify_url的请求是支付宝发送过来的"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("不是前端发送过来的"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("所以这两个请求不需要经过后端的认证组件认证!!\n    而WalletView视图类中写了认证组件"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("所以不合适!!\n    return_url、notify_url的值我们规定是 http"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("//")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8000")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("api"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("shipper"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("wallet"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("charge"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("notify"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" 解决方案"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n      router"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("register"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'wallet/charge'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" wallet"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ChargeNotifyView"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" basename"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'walletCharge'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ChargeNotifyView")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ViewSet"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n          authentication_classes "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 剔除全局的认证组件")]),s._v("\n\n          "),n("span",{pre:!0,attrs:{class:"token decorator annotation punctuation"}},[s._v("@action")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("methods"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'GET'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'POST'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" detail"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("False")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n          "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("notify")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" request"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n              "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" request"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("method "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"GET"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("pass")]),s._v("\n              "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" request"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("method "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"POST"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("pass")]),s._v("\n     "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" 解决方案"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n       path"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"wallet/charge/notify/"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("wallet"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ChargeNotifyView"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("as_view"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n       "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ChargeNotifyView")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("APIView"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n           authentication_classes "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n           "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" request"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n               "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# 将 if request.method == "GET"判断体的代码写在这里')]),s._v("\n               "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("pass")]),s._v("\n           "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("post")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" request"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n               "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# 将 if request.method == "POST" 判断体的代码写在这里')]),s._v("\n               "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("pass")]),s._v("\n              \n\n该示例中我们采取的是方案"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("解决的"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("纵览"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"我的钱包"')]),s._v("功能模块"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("目前一共有三个路由!\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("api"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("shipper"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("wallet"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("  我的资产初始化\n  router"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("register"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'wallet'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" wallet"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("WalletView"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" ListRetrieveModelMixin \n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("api"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("shipper"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("wallet"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("charge"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("  用户支付的链接地址\n  router"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("register"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'wallet'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" wallet"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("WalletView"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" action其url_path"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'charge'")]),s._v(" \n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("api"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("shipper"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("wallet"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("charge"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("notify"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("  用户支付完成后"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("支付宝的信息反馈\n  router"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("register"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'wallet/charge'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" wallet"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ChargeNotifyView"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" action其url_path"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'notify'")]),s._v(" \n  \n  \nPS"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("一点小思考"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("做了个小实验\npath"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"test/"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("wallet"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Test"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("as_view"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" rest_framework"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("views "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" APIView\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Test")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("APIView"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("request"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" redirect"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://localhost:8080/account/wallet?pay=success"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n在浏览器上直接输入http"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("//")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8000")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("api"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("shipper"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("test"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" 是能重定向到指定页面的!!\nQ"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 那么后端在接收到前端的axios请求后"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("让其redirect重定向到构建好的支付宝支付链接可以吗?? \nA"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 不行"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("因为vue前端的axios"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("js文件里规定了前端发送axios请求"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("后端必须Response返回值!!\n   "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("也许你又会问了"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("那为啥后端接受return_url的GET请求那"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("最后redirect是成功的呢??\n    因为那是支付宝让浏览器向return_url发送GET请求"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("浏览器发送该请求时"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("并不是通过我们自己编写的代码axios发送的!!"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br")])]),n("p",[s._v("按照上述的流程图, 一步步的来!!"),n("br"),s._v(" "),n("font",{attrs:{color:"red"}},[s._v("To do:")]),s._v(" 前端对充值表单的校验; 后端拿到表单字段后对其校验..")],1),s._v(" "),n("h3",{attrs:{id:"后端配置支付sdk"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#后端配置支付sdk"}},[s._v("#")]),s._v(" 后端配置支付SDK")]),s._v(" "),n("blockquote",[n("p",[s._v("在后端项目中加入根据支付宝官网api自己写的SDK")])]),s._v(" "),n("p",[n("strong",[s._v("Step1:")]),s._v(" 在后端项目的根目录下创建file文件夹, 里面添加两个文件, "),n("code",[s._v("应用私钥.txt")]),s._v(" 、"),n("code",[s._v("支付宝公钥.txt")]),n("br"),s._v(" "),n("strong",[s._v("Step2:")]),s._v(" 在后端项目的setting.py配置文件里添加以下代码")]),s._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[n("span",{pre:!0,attrs:{class:"token triple-quoted-string string"}},[s._v('"""\n支付宝相关的配置\n"""')]),s._v("\nALI_APP_PRI_KEY_PATH "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" os"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("path"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("join"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("BASE_DIR"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'files'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'应用私钥.txt'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nALI_PUB_KEY_PATH "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" os"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("path"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("join"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("BASE_DIR"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'files'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'支付宝公钥.txt'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\nALI_APPID "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"9021000131691684"')]),s._v("\nALI_GATEWAY "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://openapi-sandbox.dl.alipaydev.com/gateway.do"')]),s._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 网关地址")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 异步通知地址   POST,不是公网IP所以没看到请求到来")]),s._v("\nALI_NOTIFY_URL "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://127.0.0.1:8000/api/shipper/wallet/charge/notify/"')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 跳转地址      GET,为什么GET能访问呀？是基于js做的跳转.  location.href = 地址")]),s._v("\nALI_RETURN_URL "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://127.0.0.1:8000/api/shipper/wallet/charge/notify/"')]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br")])]),n("p",[n("strong",[s._v("Step3:")]),s._v(" 在后端项目中加入根据官网api自己写的SDK."),n("br"),s._v("\n项目根目录下, "),n("code",[s._v("server/alipayV1/alipay.py")]),s._v("、"),n("code",[s._v("server/alipayV1/md5AndUid.py")]),s._v("  (代码过多,不予粘贴)")]),s._v(" "),n("h3",{attrs:{id:"跳转支付页面"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#跳转支付页面"}},[s._v("#")]),s._v(" 跳转支付页面")]),s._v(" "),n("blockquote",[n("p",[s._v("实现目标,用户点击充值按钮后,页面跳转到支付宝的用户支付页面!!")])]),s._v(" "),n("p",[n("strong",[s._v("业务逻辑代码如下:")])]),s._v(" "),n("p",[n("img",{attrs:{src:a(1031),alt:"image-20240106210311929"}})]),s._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[s._v("你可以做个小实验!\n拿到后端构建好的支付链接"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("复制粘贴到浏览器上"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("你会发现支付宝会自动重定向到指定的地址!\n若你在复制粘贴时"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("哪怕修改了链接上的一个字符"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("你都会发现支付宝会告诉你不正确!!\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("h3",{attrs:{id:"支付成功后的通知"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#支付成功后的通知"}},[s._v("#")]),s._v(" 支付成功后的通知")]),s._v(" "),n("blockquote",[n("p",[s._v("实现目标,用户通过支付宝支付完成后,需要进行充值提示,通知用户平台充值成功!!")])]),s._v(" "),n("p",[n("strong",[s._v("业务逻辑代码如下:")])]),s._v(" "),n("p",[n("img",{attrs:{src:a(1032),alt:"image-20240106212331163"}})]),s._v(" "),n("hr"),s._v(" "),n("h2",{attrs:{id:"后端-交易记录"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#后端-交易记录"}},[s._v("#")]),s._v(" 后端 - 交易记录")]),s._v(" "),n("blockquote",[n("p",[s._v("点击充值按钮, 后端在生成支付链接时, 需在数据库中生成一条交易记录!! ( look前后端分离, 支付宝支付流程图")])]),s._v(" "),n("h3",{attrs:{id:"交易记录表"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#交易记录表"}},[s._v("#")]),s._v(" 交易记录表")]),s._v(" "),n("blockquote",[n("p",[s._v("新增了两张表, 记得进行数据库的迁移!!")])]),s._v(" "),n("p",[n("img",{attrs:{src:a(1033),alt:"image-20240119140937111"}})]),s._v(" "),n("h3",{attrs:{id:"业务逻辑"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#业务逻辑"}},[s._v("#")]),s._v(" 业务逻辑")]),s._v(" "),n("blockquote",[n("p",[s._v("在原来充值的逻辑上, 加上添加充值记录以及订单状态更新、供应商账户余额更改等操作!!")])]),s._v(" "),n("p",[n("img",{attrs:{src:a(1034),alt:"image-20240119134349980"}})]),s._v(" "),n("p",[s._v('PS: 框起来的部分是相较于 上面"充值"这一小节, 新增的内容!!')]),s._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" 在构建好支付链接后"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("需要在db中生成交易记录"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("默认待支付的状态"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" 理论上应该在接受到异步返回后"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("再进行订单状态的更改"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v(" 上面的示例代码临时在同步请求后进行的这一操作!\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" 订单状态更改\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" 该订单相关的供应商的余额进行更改\nPS"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" 订单号的组成变了下"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("变成了时间"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v("随机数\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" 注意下 tran_object "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" models"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("TransactionRecord"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("objects"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("filter")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("trans_id"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("out_trade_no"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" pay_status"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("first"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    查询条件"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("pay_status"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("保证了是对未支付的进行修改"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("其实这里应该加个判断"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" tran_object"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  \nTo do"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" 像这种涉及到数据表的操作"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("最好加上事务加上锁!!\n  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" 再次支付!!\n     有可能出现后端构建好支付链接"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("前端也成功挑战该支付链接"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("后端此时已经生成一条未支付的订单记录"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n     用户关掉了该支付页面"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("后续可以在页面上有关交易记录的表格里 选择取消该订单 或者 继续支付!!\n  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" 取消订单\n     "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" 交易记录的那条数据 修改其订单状态\n     "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" 支付宝关闭该订单的交易接口\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br")])]),n("hr"),s._v(" "),n("h2",{attrs:{id:"提现"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#提现"}},[s._v("#")]),s._v(" 提现")]),s._v(" "),n("blockquote",[n("p",[s._v("提现是需要审核的, 但这里我们为了方便测试,采取的无需审核!")])]),s._v(" "),n("p",[n("img",{attrs:{src:a(1035),alt:""}})]),s._v(" "),n("h3",{attrs:{id:"后端代码截图"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#后端代码截图"}},[s._v("#")]),s._v(" 后端代码截图")]),s._v(" "),n("p",[n("img",{attrs:{src:a(1036),alt:"image-20240120155426858"}})]),s._v(" "),n("p",[s._v("注: 提现的后端代码逻辑详看代码截图中的注释!!")]),s._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[s._v("注意"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  要知道"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("关于支付宝支付"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("支付宝主动向后端发送的同步和异步请求"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("需要对其进行验证"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("保证该请求是支付宝发送的!!\n  而关于支付宝转账"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("是后端直接向支付宝服务端发送请求"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("拿到返回的数据"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("是无需验证的"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("  你结合公钥私钥细细的品味"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n  \nTO DO"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" 转账的手续费问题 转的时候扣除手续费即可\n  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" ★★★ 加上事务和锁后"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("出现异常会回滚"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("我们还需捕获该异常!!\n     加上事务"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("在哪加?涉及到数据库的操作"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("就得考虑包含在事务里!\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("h3",{attrs:{id:"前端代码截图"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#前端代码截图"}},[s._v("#")]),s._v(" 前端代码截图")]),s._v(" "),n("p",[n("img",{attrs:{src:a(1037),alt:"image-20240120155833137"}})]),s._v(" "),n("hr"),s._v(" "),n("h2",{attrs:{id:"交易记录"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#交易记录"}},[s._v("#")]),s._v(" 交易记录")]),s._v(" "),n("blockquote",[n("p",[s._v("获取表格数据、分页、搜索")])]),s._v(" "),n("h3",{attrs:{id:"listpagenumbermodelmixin"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#listpagenumbermodelmixin"}},[s._v("#")]),s._v(" ListPageNumberModelMixin")]),s._v(" "),n("blockquote",[n("p",[s._v("后端先简单的实现 获取列表数据并分页!!")])]),s._v(" "),n("p",[n("img",{attrs:{src:a(1038),alt:"image-20240123133659323"}})]),s._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[s._v("像表格的分页我们通常采用的是基本分页PageNumberPagination"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n获取列表数据的逻辑 "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"集过 分实返"')]),s._v(" 看上面的代码截图可以分析个七七八八"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("就不再赘述"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("但要注意"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("上面代码截图中"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("使用的序列化器类就很简单的返回了所有的数据"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("没有做任何数据格式的处理!! 后续结合前端的展示会进一步修改!"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("p",[n("img",{attrs:{src:a(1039),alt:"image-20240123135218161"}})]),s._v(" "),n("h3",{attrs:{id:"表格和分页"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#表格和分页"}},[s._v("#")]),s._v(" 表格和分页")]),s._v(" "),n("blockquote",[n("p",[s._v("前端访问API,将数据在表格上进行展示!!"),n("br"),s._v("\n★ 每次点击前端分页器的页码,都会携带筛选条件向后端发送一次请求获取当前页的数据!!")])]),s._v(" "),n("p",[s._v("最终效果图如下:")]),s._v(" "),n("p",[n("img",{attrs:{src:a(1040),alt:"25"}})]),s._v(" "),n("p",[s._v("关键代码截图如下:"),n("br"),s._v(" "),n("strong",[s._v("注:")]),s._v(" 序列化器类中写的是"),n("code",[s._v("__all__")]),s._v(", ORM表中的字段都返回了, 但在前端表格中我们没有展示那么多字段罢了!")]),s._v(" "),n("p",[n("img",{attrs:{src:a(1041),alt:"image-20240123143449104"}})]),s._v(" "),n("h3",{attrs:{id:"筛选和重置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#筛选和重置"}},[s._v("#")]),s._v(" 筛选和重置")]),s._v(" "),n("blockquote",[n("p",[s._v('实现"交易记录"部分, 筛选/即搜索 的功能!!')])]),s._v(" "),n("p",[n("img",{attrs:{src:a(1042),alt:"27"}})]),s._v(" "),n("p",[s._v("api中实现筛选,一般都是通过url来传递参数的."),n("br"),s._v(" "),n("code",[s._v("/api/shipper/wallet/tran/?page=1&date_range_start=2024-01-19&date_range_end=2024-01-20&tran_type=1&trans_id=2")])]),s._v(" "),n("p",[n("img",{attrs:{src:a(1043),alt:"image-20240123181754630"}})]),s._v(" "),n("p",[s._v("PS: 订单号中包含用户填的号码就行..")]),s._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[s._v("打开钱包页面"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("交易记录一开始会显示当前用户全部的交易记录并分页好"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n我们假设全部记录有"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v("页"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("充值类型的记录有"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("页"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n当我们筛选订单类型“充值”后"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("并没有点击搜索按钮"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("而是点击 分页的页码"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"3"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("你会发现它都会携带着筛选条件向后端发送请求!\n而且页码还是停留在"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"3"')]),s._v("上"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("但总页码此时显示的是"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("页!!\n继续分析\n当我们筛选订单类型“充值”后"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("并没有点击搜索按钮"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("而是点击 分页的页码"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"7"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("同样的"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("它会携带着筛选条件向后端发送请求!\n这就出现了一个问题!!\n充值的记录只有"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("页啊!!所以 页码"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"7"')]),s._v(" 是无效页码!!\n于是乎 \n后端在接收到 http"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("//")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8000")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("api"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("shipper"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("wallet"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("tran"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("?page"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("tran_type"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" 请求后"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n后端代码ListPageNumberModelMixin类中的这行代码page "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("paginate_queryset"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("queryset"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" 就会抛出异常!!\n如何处理?看下方截图!!\n\nPS"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("每次点击前端分页器的页码"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("都会携带筛选条件向后端发送一次请求获取当前页的数据!!\n\n□ 思考一个问题"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("如果是无效页码咋整?\n  上面的这段话已经阐述了无效页码怎么出现的!!\n  我的处理是 "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" 并没有根据code值为"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("弹出信息提示框"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("而是直接定位到第一页!!\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br")])]),n("p",[n("img",{attrs:{src:a(1044),alt:"image-20240123193134165"}})]),s._v(" "),n("hr"),s._v(" "),n("h2",{attrs:{id:"按钮展示"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#按钮展示"}},[s._v("#")]),s._v(" 按钮展示")]),s._v(" "),n("blockquote",[n("p",[s._v('此处的按钮展示关乎"充值"的操作, 若我点击了充值跳转了,但是我没有支付!!\n此时, 该次"充值"操作会生成一条交易记录, 状态是"未支付", 还应显示两个按钮供客户继续操作.. <取消> 和 <重新支付> !!')])]),s._v(" "),n("p",[n("img",{attrs:{src:a(1045),alt:"image-20240124195522133"}})]),s._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[s._v("上图做了这几个操作"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" 在前端表格中\n   "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" 当满足 类型等于"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"充值"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" 状态等于"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"未支付"')]),s._v(" 两个条件"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" 在该交易记录后面会出现 "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"取消"')]),s._v("和"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"重新支付"')]),s._v("这两个选项!!\n   "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" 金额那列的数据"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("若是充值显示成 "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"+ ¥10.00"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" 若是提现"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("应显示成 "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"- ¥10.00"')]),s._v("\n   "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" 添加“审核状态”一列"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("并在该表头添加提示信息"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("充值无需审核"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("提现需审核!\n     PS"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("因为还未编写后台的代码"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("所以在充值的业务逻辑中"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("我们直接无需审核就充值成功了"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("所以此时“审核状态”一列的数据肯定都为null"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n        无需担心"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("后续编写了后台后"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("会进行完善!!\n        若你在效果截图中看到审核状态一列有数据"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("那是我为了测试"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("手动更改了数据库中的数据"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("Hhh"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" 后端对应的"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("需要在序列化器类中进行相应的处理!!\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br")])]),n("hr"),s._v(" "),n("h2",{attrs:{id:"重新支付"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#重新支付"}},[s._v("#")]),s._v(" 重新支付")]),s._v(" "),n("blockquote",[n("p",[s._v('"重新支付"和"充值"的流程其实倒差不差的..')])]),s._v(" "),n("p",[n("img",{attrs:{src:a(1046),alt:"image-20240130125157238"}})]),s._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[s._v("回顾下"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("充值过程是咋样的?点击充值按钮"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("向后端发送请求"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("后端生成支付宝支付链接返回给前端"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("前端跳转到该链接"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("用户开始支付"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n那么"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("此处的"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"重新支付"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("流程基本一致"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("不同的在于"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"充值"')]),s._v("向后端发送的请求需携带金额"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"重新支付"')]),s._v("无需携带金额"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("但需要携带充值操作生成的那条交易记录的唯一标识!\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"充值"')]),s._v("操作需生成一条交易记录"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"重新支付"')]),s._v("无需再次生成"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("使用原先的那条交易记录即可"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n重新支付的流程如下"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" 点击重新支付的按钮"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("携带这一行交易记录的唯一标识"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ID、账单号"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("向后端发送请求\n  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" 后端拿到交易记录的ID"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("获取核心的两个字段信息 订单号和金额"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("再次生成 支付宝支付链接\n  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" 前端跳转该支付链接!\n  \n注意截图中用蓝色和红色背景标注的部分!!\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br")])]),n("hr"),s._v(" "),n("h2",{attrs:{id:"取消支付"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#取消支付"}},[s._v("#")]),s._v(" 取消支付")]),s._v(" "),n("blockquote",[n("p",[s._v("参考官方文档,补充对于接口的sdk.")])]),s._v(" "),n("p",[n("strong",[s._v("先来看看效果")])]),s._v(" "),n("p",[n("img",{attrs:{src:a(1047),alt:"28"}})]),s._v(" "),n("p",[n("strong",[s._v("关键代码如下:")])]),s._v(" "),n("p",[n("img",{attrs:{src:a(1048),alt:"image-20240202153947262"}})]),s._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[s._v("▲ 实现流程"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" 与重新支付一样"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("点击取消按钮"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("携带ID发送请求\n  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" 后端拿到订单ID"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("获取订单信息中的 商户订单号"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("我们自己生成并传递给支付宝的订单号\n     "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" 注"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("除了商户订单号"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("还有支付订单号"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("我们通过支付宝的异步回调才能拿到这个支付订单号!!\n  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" 通过 取消订单的SDK 对该订单进行取消! SDK构造链接"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v("直接访问 类似与转账"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("构造的不是跳转链接"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("而是直接访问的链接"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" 后端根据访问后返回的信息得知是否取消订单成功"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("并进行相应数据库状态更新"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"未完成"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"已取消"')]),s._v("\n\n  \n▲ 在沙箱环境中"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("大抵会返回两种信息"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'alipay_trade_close_response'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'msg'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Business Failed'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" \n    "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'code'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'40004'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" \n    "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'sub_msg'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'交易不存在'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" \n    "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'sub_code'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'ACQ.TRADE_NOT_EXIST'")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("         \n  "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'sign'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'VC3vKorve/hfb...=='")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" 当前交易状态不支持此操作"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n  沙箱里"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("重新支付后网络不好没跳转"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("就没有get回调"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("db中的订单状态不好改变"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("但事实上已经支付成功了"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n  此时在页面上点击该订单的取消"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("是不会成功的!!\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" 交易不存在"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n  放在正式环境中是能成功的"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n\n▲ 注意"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n 在支付宝沙箱环境里测试时"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("对于取消支付和查看历史订单的接口的效果是展示不了的!"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("哪怕应该成功的也会返回订单不存在这一类的信息"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n 当移植到正式环境中是能展示相应效果的"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("无需担心!!\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br")])]),n("hr"),s._v(" "),n("h2",{attrs:{id:"其他"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#其他"}},[s._v("#")]),s._v(" 其他")]),s._v(" "),n("blockquote",[n("p",[s._v("遇到相关需求根据官方文档自行补充")])]),s._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" 异步通知"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("宕机\n  将支付宝的交易查询接口编写成sdk"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("查询的json结果中有所有的交易记录"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("将其与数据库中的进行比对并进行更新\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" 退款"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("原来返回"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("hr"),s._v(" "),n("h2",{attrs:{id:"附录-支付宝sdk"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#附录-支付宝sdk"}},[s._v("#")]),s._v(" 附录:支付宝SDK")]),s._v(" "),n("blockquote",[n("p",[s._v("支付宝的python SDK如下:")])]),s._v(" "),n("p",[n("font",{attrs:{color:"brown"}},[s._v("server/alipayV1/alipay.py")])],1),s._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[n("span",{pre:!0,attrs:{class:"token triple-quoted-string string"}},[s._v('"""\nhttps://www.cnblogs.com/xingxia/p/alipay_trade_page.html\nhttps://cloud.tencent.com/developer/article/1794013\nhttps://opendocs.alipay.com/common/02khjm\n"""')]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" base64\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" json\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" base64 "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" decodebytes\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" datetime "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" datetime\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" urllib"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("parse "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" quote_plus\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" Crypto"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Hash "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" SHA256\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" Crypto"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("PublicKey "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" RSA\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" Crypto"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Signature "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" PKCS1_v1_5\n\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AliPay")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("object")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token triple-quoted-string string"}},[s._v('"""\n    支付宝支付接口(PC端支付接口)\n    """')]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("__init__")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" appid"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" notify_url"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" app_private_key_path"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" alipay_public_key_path"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" return_url"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("appid "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" appid\n        self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("notify_url "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" notify_url\n        self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("return_url "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" return_url\n\n        self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("app_private_key_path "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" app_private_key_path  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 应用私钥")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("with")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("open")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("app_private_key_path"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("as")]),s._v(" fp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("app_private_key "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" RSA"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("importKey"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("fp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("read"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 处理成可用的私钥用于生成签名.")]),s._v("\n\n        self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("alipay_public_key_path "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" alipay_public_key_path  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 支付宝公钥")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("with")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("open")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("alipay_public_key_path"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("as")]),s._v(" fp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("alipay_public_key "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" RSA"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("importKey"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("fp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("read"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 处理成可用的公钥用于验证签名.")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("direct_pay")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" subject"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" out_trade_no"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" total_amount"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token triple-quoted-string string"}},[s._v('"""支付相关 将构造的url参数返回便于拼接在支付宝网关地址后面 """')]),s._v("\n        data "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"app_id"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("appid"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 支付宝分配给开发者的应用ID")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"method"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"alipay.trade.page.pay"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 接口名称")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"charset"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"utf-8"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 请求使用的编码格式")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"sign_type"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"RSA2"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 商户生成签名字符串所使用的签名算法类型")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"timestamp"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" datetime"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("now"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("strftime"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"%Y-%m-%d %H:%M:%S"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 发送请求的时间")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"version"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1.0"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 调用的接口版本")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 请求参数的集合,值为字符串. json.dumps将字典转化为json格式的字符串.")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"biz_content"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" json"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("dumps"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"subject"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" subject"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 订单标题")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"out_trade_no"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" out_trade_no"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 商品订单号")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"total_amount"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" total_amount"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 订单总金额")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"product_code"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"FAST_INSTANT_TRADE_PAY"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 销售产品码,电脑支付场景下固定为该值")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" separators"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("','")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("':'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("return_url"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 支付宝服务器主动通知商户服务器里指定的页面http/https路径")]),s._v("\n            data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"notify_url"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("notify_url\n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# HTTP/HTTPS开头字符串  支付完成之后,GET请求跳转到这个地址")]),s._v("\n            data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"return_url"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("return_url\n\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sign_data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 拿着这一堆data数据进行 签名/加密!!")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("transfer")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" out_biz_no"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" trans_amount"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" order_title"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" identity"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" identity_name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token triple-quoted-string string"}},[s._v('"""转账相关"""')]),s._v("\n        data "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"app_id"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("appid"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"method"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"alipay.fund.trans.uni.transfer"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"charset"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"utf-8"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"sign_type"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"RSA2"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"timestamp"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" datetime"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("now"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("strftime"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"%Y-%m-%d %H:%M:%S"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"version"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1.0"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"biz_content"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" json"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("dumps"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"out_biz_no"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" out_biz_no"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 订单号")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"trans_amount"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" trans_amount"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 金额")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"product_code"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"TRANS_ACCOUNT_NO_PWD"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"biz_scene"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"DIRECT_TRANSFER"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"order_title"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" order_title"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 标题")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"remark"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"备注信息"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"payee_info"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" json"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("dumps"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                    "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"identity_type"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ALIPAY_LOGON_ID"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                    "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"identity"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" identity"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 转账的目标账户的identity")]),s._v("\n                    "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"name"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" identity_name  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 转账的目标账户的name")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" separators"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("','")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("':'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" separators"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("','")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("':'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("return_url"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"notify_url"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("notify_url\n            data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"return_url"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("return_url\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sign_data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("close_pay")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" out_trade_no"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token triple-quoted-string string"}},[s._v('"""取消订单相关"""')]),s._v("\n        data "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"app_id"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("appid"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"method"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"alipay.trade.close"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"charset"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"utf-8"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"sign_type"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"RSA2"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"timestamp"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" datetime"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("now"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("strftime"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"%Y-%m-%d %H:%M:%S"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"version"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1.0"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"biz_content"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" json"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("dumps"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"out_trade_no"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" out_trade_no"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 商户订单号")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"trade_no"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("None")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 支付订单号,得写,不写的话报错")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" separators"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("','")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("':'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("return_url"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"notify_url"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("notify_url\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sign_data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sign_data")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token triple-quoted-string string"}},[s._v('"""官网的加签原理,共三步 https://opendocs.alipay.com/common/02khjm """')]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# step1: 获取所有支付宝开放平台的post内容,不包括字节类型参数,如文件、字节流，剔除 sign 字段,剔除值为空的参数;")]),s._v("\n        data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pop"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"sign"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("None")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# step2: 按照第一个字符的键值 ASCII 码递增排序(字母升序排序), 如果遇到相同字符则按照第二个字符的键值 ASCII 码递增排序,以此类推;")]),s._v("\n        unsigned_items "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ordered_data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# step3: 将排序后的参数与其对应值, 组合成 参数=参数值 的格式, 并且把这些参数用 & 字符连接起来, 此时生成的字符串为待签名字符串.")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# eg: app_id=..&biz_content=..&method=..")]),s._v("\n        unsigned_string "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"&"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("join"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"{0}={1}"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("format")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("k"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" v"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" k"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" v "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" unsigned_items"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 对处理后的数据,开始进行签名")]),s._v("\n        sign "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sign"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("unsigned_string"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("encode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"utf-8"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# quote_plus对冒号汉字等进行了url 转义.")]),s._v("\n        quoted_string "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"&"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("join"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"{0}={1}"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("format")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("k"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" quote_plus"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("v"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" k"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" v "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" unsigned_items"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将签名后的结果追加到最后,获得最终的订单信息字符串")]),s._v("\n        signed_string "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" quoted_string "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"&sign="')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" quote_plus"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("sign"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" signed_string\n\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ordered_data")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token triple-quoted-string string"}},[s._v('"""它的作用是对字典中的数据进行处理,将其中值为字典类型的键值对转换为JSON格式的字符串,并按照键的字母顺序进行排序"""')]),s._v("\n        complex_keys "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" key"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" value "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("items"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("isinstance")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("value"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("dict")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n                complex_keys"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("append"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("key"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" key "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" complex_keys"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("key"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" json"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("dumps"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("key"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" separators"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("','")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("':'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 其实,该处示例中传进来的data数据的键值对中的值是没有字典的,所以直接执行的是下面这一句代码!!")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("sorted")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("k"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" v"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" k"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" v "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("items"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sign")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" unsigned_string"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token triple-quoted-string string"}},[s._v('"""\n        利用应用私钥对待签名字符串进行 签名\n        :unsigned_string: 待签名data,格式bytes\n        :return: 生成的签名字符串\n        """')]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token triple-quoted-string string"}},[s._v('""" 效果是一样的!!\n        from base64 import encodebytes\n        key = self.app_private_key  # 应用私钥\n        signer = PKCS1_v1_5.new(key)\n        signature = signer.sign(SHA256.new(unsigned_string))\n        # base64 编码,转换为unicode表示并移除回车\n        sign = encodebytes(signature).decode("utf8").replace("\\n", "")\n        return sign  # 返回sign签名后的结果\n        """')]),s._v("\n        key "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("app_private_key  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 应用私钥")]),s._v("\n        signer "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" PKCS1_v1_5"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("new"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("key"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        digest "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" SHA256"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("new"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        digest"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("update"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("unsigned_string"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        sign "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" signer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sign"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("digest"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        signature "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" base64"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("b64encode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("sign"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" signature"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("decode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'utf-8'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("replace"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"\\n"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("verify")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" signature"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token triple-quoted-string string"}},[s._v('"""对签名进行验证"""')]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 先对支付宝回传的数据进行处理,跟上面的第一步第二步第三步一样,就是 官网加签原理的那三步!")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# step1")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"sign_type"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pop"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"sign_type"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# step2")]),s._v("\n        unsigned_items "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ordered_data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# step3")]),s._v("\n        message "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"&"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("join"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('u"{}={}"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("format")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("k"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" v"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" k"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" v "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" unsigned_items"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 利用支付宝公钥对处理后的数据再进行验签,借此保证数据是支付宝传递过来的!!")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("_verify"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("message"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" signature"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("_verify")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" raw_content"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" signature"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        key "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("alipay_public_key  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 支付宝公钥")]),s._v("\n        signer "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" PKCS1_v1_5"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("new"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("key"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        digest "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" SHA256"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("new"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        digest"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("update"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("raw_content"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("encode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"utf8"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 比较,看是否一致")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" signer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("verify"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("digest"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" decodebytes"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("signature"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("encode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"utf8"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("True")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("False")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br"),n("span",{staticClass:"line-number"},[s._v("63")]),n("br"),n("span",{staticClass:"line-number"},[s._v("64")]),n("br"),n("span",{staticClass:"line-number"},[s._v("65")]),n("br"),n("span",{staticClass:"line-number"},[s._v("66")]),n("br"),n("span",{staticClass:"line-number"},[s._v("67")]),n("br"),n("span",{staticClass:"line-number"},[s._v("68")]),n("br"),n("span",{staticClass:"line-number"},[s._v("69")]),n("br"),n("span",{staticClass:"line-number"},[s._v("70")]),n("br"),n("span",{staticClass:"line-number"},[s._v("71")]),n("br"),n("span",{staticClass:"line-number"},[s._v("72")]),n("br"),n("span",{staticClass:"line-number"},[s._v("73")]),n("br"),n("span",{staticClass:"line-number"},[s._v("74")]),n("br"),n("span",{staticClass:"line-number"},[s._v("75")]),n("br"),n("span",{staticClass:"line-number"},[s._v("76")]),n("br"),n("span",{staticClass:"line-number"},[s._v("77")]),n("br"),n("span",{staticClass:"line-number"},[s._v("78")]),n("br"),n("span",{staticClass:"line-number"},[s._v("79")]),n("br"),n("span",{staticClass:"line-number"},[s._v("80")]),n("br"),n("span",{staticClass:"line-number"},[s._v("81")]),n("br"),n("span",{staticClass:"line-number"},[s._v("82")]),n("br"),n("span",{staticClass:"line-number"},[s._v("83")]),n("br"),n("span",{staticClass:"line-number"},[s._v("84")]),n("br"),n("span",{staticClass:"line-number"},[s._v("85")]),n("br"),n("span",{staticClass:"line-number"},[s._v("86")]),n("br"),n("span",{staticClass:"line-number"},[s._v("87")]),n("br"),n("span",{staticClass:"line-number"},[s._v("88")]),n("br"),n("span",{staticClass:"line-number"},[s._v("89")]),n("br"),n("span",{staticClass:"line-number"},[s._v("90")]),n("br"),n("span",{staticClass:"line-number"},[s._v("91")]),n("br"),n("span",{staticClass:"line-number"},[s._v("92")]),n("br"),n("span",{staticClass:"line-number"},[s._v("93")]),n("br"),n("span",{staticClass:"line-number"},[s._v("94")]),n("br"),n("span",{staticClass:"line-number"},[s._v("95")]),n("br"),n("span",{staticClass:"line-number"},[s._v("96")]),n("br"),n("span",{staticClass:"line-number"},[s._v("97")]),n("br"),n("span",{staticClass:"line-number"},[s._v("98")]),n("br"),n("span",{staticClass:"line-number"},[s._v("99")]),n("br"),n("span",{staticClass:"line-number"},[s._v("100")]),n("br"),n("span",{staticClass:"line-number"},[s._v("101")]),n("br"),n("span",{staticClass:"line-number"},[s._v("102")]),n("br"),n("span",{staticClass:"line-number"},[s._v("103")]),n("br"),n("span",{staticClass:"line-number"},[s._v("104")]),n("br"),n("span",{staticClass:"line-number"},[s._v("105")]),n("br"),n("span",{staticClass:"line-number"},[s._v("106")]),n("br"),n("span",{staticClass:"line-number"},[s._v("107")]),n("br"),n("span",{staticClass:"line-number"},[s._v("108")]),n("br"),n("span",{staticClass:"line-number"},[s._v("109")]),n("br"),n("span",{staticClass:"line-number"},[s._v("110")]),n("br"),n("span",{staticClass:"line-number"},[s._v("111")]),n("br"),n("span",{staticClass:"line-number"},[s._v("112")]),n("br"),n("span",{staticClass:"line-number"},[s._v("113")]),n("br"),n("span",{staticClass:"line-number"},[s._v("114")]),n("br"),n("span",{staticClass:"line-number"},[s._v("115")]),n("br"),n("span",{staticClass:"line-number"},[s._v("116")]),n("br"),n("span",{staticClass:"line-number"},[s._v("117")]),n("br"),n("span",{staticClass:"line-number"},[s._v("118")]),n("br"),n("span",{staticClass:"line-number"},[s._v("119")]),n("br"),n("span",{staticClass:"line-number"},[s._v("120")]),n("br"),n("span",{staticClass:"line-number"},[s._v("121")]),n("br"),n("span",{staticClass:"line-number"},[s._v("122")]),n("br"),n("span",{staticClass:"line-number"},[s._v("123")]),n("br"),n("span",{staticClass:"line-number"},[s._v("124")]),n("br"),n("span",{staticClass:"line-number"},[s._v("125")]),n("br"),n("span",{staticClass:"line-number"},[s._v("126")]),n("br"),n("span",{staticClass:"line-number"},[s._v("127")]),n("br"),n("span",{staticClass:"line-number"},[s._v("128")]),n("br"),n("span",{staticClass:"line-number"},[s._v("129")]),n("br"),n("span",{staticClass:"line-number"},[s._v("130")]),n("br"),n("span",{staticClass:"line-number"},[s._v("131")]),n("br"),n("span",{staticClass:"line-number"},[s._v("132")]),n("br"),n("span",{staticClass:"line-number"},[s._v("133")]),n("br"),n("span",{staticClass:"line-number"},[s._v("134")]),n("br"),n("span",{staticClass:"line-number"},[s._v("135")]),n("br"),n("span",{staticClass:"line-number"},[s._v("136")]),n("br"),n("span",{staticClass:"line-number"},[s._v("137")]),n("br"),n("span",{staticClass:"line-number"},[s._v("138")]),n("br"),n("span",{staticClass:"line-number"},[s._v("139")]),n("br"),n("span",{staticClass:"line-number"},[s._v("140")]),n("br"),n("span",{staticClass:"line-number"},[s._v("141")]),n("br"),n("span",{staticClass:"line-number"},[s._v("142")]),n("br"),n("span",{staticClass:"line-number"},[s._v("143")]),n("br"),n("span",{staticClass:"line-number"},[s._v("144")]),n("br"),n("span",{staticClass:"line-number"},[s._v("145")]),n("br"),n("span",{staticClass:"line-number"},[s._v("146")]),n("br"),n("span",{staticClass:"line-number"},[s._v("147")]),n("br"),n("span",{staticClass:"line-number"},[s._v("148")]),n("br"),n("span",{staticClass:"line-number"},[s._v("149")]),n("br"),n("span",{staticClass:"line-number"},[s._v("150")]),n("br"),n("span",{staticClass:"line-number"},[s._v("151")]),n("br"),n("span",{staticClass:"line-number"},[s._v("152")]),n("br"),n("span",{staticClass:"line-number"},[s._v("153")]),n("br"),n("span",{staticClass:"line-number"},[s._v("154")]),n("br"),n("span",{staticClass:"line-number"},[s._v("155")]),n("br"),n("span",{staticClass:"line-number"},[s._v("156")]),n("br"),n("span",{staticClass:"line-number"},[s._v("157")]),n("br"),n("span",{staticClass:"line-number"},[s._v("158")]),n("br"),n("span",{staticClass:"line-number"},[s._v("159")]),n("br"),n("span",{staticClass:"line-number"},[s._v("160")]),n("br"),n("span",{staticClass:"line-number"},[s._v("161")]),n("br"),n("span",{staticClass:"line-number"},[s._v("162")]),n("br"),n("span",{staticClass:"line-number"},[s._v("163")]),n("br"),n("span",{staticClass:"line-number"},[s._v("164")]),n("br"),n("span",{staticClass:"line-number"},[s._v("165")]),n("br"),n("span",{staticClass:"line-number"},[s._v("166")]),n("br"),n("span",{staticClass:"line-number"},[s._v("167")]),n("br"),n("span",{staticClass:"line-number"},[s._v("168")]),n("br"),n("span",{staticClass:"line-number"},[s._v("169")]),n("br"),n("span",{staticClass:"line-number"},[s._v("170")]),n("br"),n("span",{staticClass:"line-number"},[s._v("171")]),n("br"),n("span",{staticClass:"line-number"},[s._v("172")]),n("br"),n("span",{staticClass:"line-number"},[s._v("173")]),n("br"),n("span",{staticClass:"line-number"},[s._v("174")]),n("br"),n("span",{staticClass:"line-number"},[s._v("175")]),n("br"),n("span",{staticClass:"line-number"},[s._v("176")]),n("br"),n("span",{staticClass:"line-number"},[s._v("177")]),n("br"),n("span",{staticClass:"line-number"},[s._v("178")]),n("br"),n("span",{staticClass:"line-number"},[s._v("179")]),n("br"),n("span",{staticClass:"line-number"},[s._v("180")]),n("br"),n("span",{staticClass:"line-number"},[s._v("181")]),n("br")])]),n("p",[n("font",{attrs:{color:"brown"}},[s._v("server/alipayV1/md5AndUid.py")])],1),s._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" hashlib\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" uuid\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" random\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" datetime\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" django"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("conf "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" settings\n\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("md5")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("string"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token triple-quoted-string string"}},[s._v('""" MD5加密,签名算法需要用到 """')]),s._v("\n    hash_object "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" hashlib"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("md5"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("settings"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("SECRET_KEY"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("encode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'utf-8'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    hash_object"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("update"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("string"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("encode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'utf-8'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" hash_object"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("hexdigest"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("gen_random_id")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("string"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token triple-quoted-string string"}},[s._v('""" 基于uid随机生成一个订单号,方便往后查询订单信息 """')]),s._v("\n    data "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"{}-{}"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("format")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("str")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("uuid"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("uuid4"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" string"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" md5"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("gen_random_oid")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token triple-quoted-string string"}},[s._v('""" 基于时间和一个随机数生成一个订单号,长度也是固定的 """')]),s._v("\n    rand_number "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" random"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("randint"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10000000")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("99999999")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    ctime "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" datetime"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("datetime"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("now"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("strftime"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"%Y%m%d%H%M%S%f"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    trans_id "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"{}{}"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("format")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ctime"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" rand_number"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" trans_id\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br")])]),n("hr")])}),[],!1,null,null,null);t.default=r.exports}}]);